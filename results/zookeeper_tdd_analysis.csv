Commit Hash,Commit Message,Commit Date,Author,Commit Type
2cc64f54fdf857437ac7325639afdb67bbfb0388,"Added test cases


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670799 13f79535-47bb-0310-9956-ffa450edef68",2007-11-09 00:36:20,Benjamin Reed,Not TDD
e655cad3c57b98be9ccd5645a712ff5a57dc0480,"[ 1835834 ] trivial warnings patch



git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670840 13f79535-47bb-0310-9956-ffa450edef68",2007-11-29 18:24:51,Benjamin Reed,Not TDD
62d5b08a2593c0ca772714cef7e933786208281f,"zookeeper unit test suite.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670864 13f79535-47bb-0310-9956-ffa450edef68",2008-01-10 01:08:47,Andrew Kornev,Not TDD
5a0a451b8069ef4e8bed9031f1f06ba1d0ed904d,"Added copyright header

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670870 13f79535-47bb-0310-9956-ffa450edef68",2008-01-10 20:04:53,Andrew Kornev,Not TDD
2474f37a0f2d5ceff68d6ca19d4d93fddb3995a1,"Added a mock for poll(); added a test for zk operations with concurrent disconnect.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670874 13f79535-47bb-0310-9956-ffa450edef68",2008-01-16 18:37:44,Andrew Kornev,Not TDD
a6d0a388682ae93fdee7e6c30143c60ad82ebcbb,"Refactored utility classes; added unit tests; removed an SVN property (eol-style)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670878 13f79535-47bb-0310-9956-ffa450edef68",2008-01-24 00:37:29,Andrew Kornev,Not TDD
911e7a8c6e6d1db1cd35ab7e809d4750a6a8b760,"Fixed gcc-2.95 compiler compatibility issues; updated README and ChangeLog

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670880 13f79535-47bb-0310-9956-ffa450edef68",2008-01-24 21:25:25,Andrew Kornev,Not TDD
1153591dea3c1ca8c19e6f353dd10551c68c11c1,"fixed session ids to always be in hex

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670886 13f79535-47bb-0310-9956-ffa450edef68",2008-01-30 18:43:29,,Not TDD
480cf1a3a180ac9a6125b8f82e8f04dfbc094554,"New tests

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670890 13f79535-47bb-0310-9956-ffa450edef68",2008-02-07 21:29:28,Andrew Kornev,Not TDD
ae6e4c603e4f9d3171bf40f110685b6c92c4c2c6,"Added a new return code to zookeeper_process() -- ZNOTHING -- that
indicates that the socket has no more data to read; updated the unit tests

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670913 13f79535-47bb-0310-9956-ffa450edef68",2008-04-04 19:02:37,Andrew Kornev,Not TDD
edc4bf7ec225bba914037a89cf04c6601a8b9c33,"[ 1942451 ] build optimization: uptodate check on jute
[ 1943392 ] Test environment changes: unit/func/perf/coverage test



git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670925 13f79535-47bb-0310-9956-ffa450edef68",2008-04-17 22:37:55,Benjamin Reed,Not TDD
cbf48b3780393f5f1c93ba3a2dfd94b9b7b2b047,"[ 1947090 ] Improper timeout tracking at clients (c patches)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670928 13f79535-47bb-0310-9956-ffa450edef68",2008-04-28 16:24:51,Benjamin Reed,Not TDD
888e0c5fc576415a7949a938bf1aad4be74984eb,"[ 1949253 ] Move to log4j for logging.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670930 13f79535-47bb-0310-9956-ffa450edef68",2008-04-29 22:27:32,Benjamin Reed,Mixed
1a85483357106cf0993080a56ddd5c1e2644100c,"[ 1947090 ] Improper timeout tracking at clients


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670933 13f79535-47bb-0310-9956-ffa450edef68",2008-04-29 23:11:26,Benjamin Reed,Mixed
ffce83512370e970426f7f6b7cff8f519de59bd4,"[ 1949196 ] KeeperException should be sub-typed


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670958 13f79535-47bb-0310-9956-ffa450edef68",2008-05-12 23:01:25,Benjamin Reed,Mixed
e2f182cf0c095784e205b5bd63d72c73d1258297,"changes to the api to take List as param rahter than arraylist

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670961 13f79535-47bb-0310-9956-ffa450edef68",2008-05-19 19:29:01,,Not TDD
23e39b5a8797d2be1b1ed0420d67f26983887c84,"[ 1937078 ] Passing a watch object to read requests


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@670967 13f79535-47bb-0310-9956-ffa450edef68",2008-06-06 19:01:57,Benjamin Reed,Mixed
083aaac1bb6f2d56f1034ca6c53e7c5cb4115c5a,"Removed unnecessary zookeeper subdir from trunk, moved subdirs up one level. See ZOOKEEPER-45

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@671249 13f79535-47bb-0310-9956-ffa450edef68",2008-06-24 16:55:54,Patrick D. Hunt,Mixed
be031cb42c842f5c5362b2333b6155f4985000fc,"Move c,java,test into the newly created toplevel src directory. See ZOOKEEPER-45

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@671256 13f79535-47bb-0310-9956-ffa450edef68",2008-06-24 17:04:36,Patrick D. Hunt,Mixed
94ea75adeca9109d127735fd00138e530770552c,"Moving package structure to org.apache.zookeeper. See ZOOKEEPER-45

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@671264 13f79535-47bb-0310-9956-ffa450edef68",2008-06-24 17:15:20,Patrick D. Hunt,Mixed
f1e02be300aee5e0174419526c697b5bdf7da4eb,"Moving package structure to org.apache.zookeeper. See ZOOKEEPER-45

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@671265 13f79535-47bb-0310-9956-ffa450edef68",2008-06-24 17:16:01,Patrick D. Hunt,Mixed
cfd2ecb8d049c1b51b2c1e6d5fd02edd5d3c26e8,"Updated code/build to support the new package prefix of org.apache.zookeeper. See ZOOKEEPER-45

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@671284 13f79535-47bb-0310-9956-ffa450edef68",2008-06-24 18:20:47,Patrick D. Hunt,Mixed
b4b73a37d43413efdf50427f96aab2720af11baf,"Edited source files to move from Yahoo to Apache source license header. See ZOOKEEPER-45

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@671295 13f79535-47bb-0310-9956-ffa450edef68",2008-06-24 18:56:38,Patrick D. Hunt,Mixed
0a81c16c4c921ef52179b943dd046fc72022ccc6,"Cleaned eol chars in files. See ZOOKEEPER-45

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@671303 13f79535-47bb-0310-9956-ffa450edef68",2008-06-24 19:04:58,Patrick D. Hunt,Not TDD
b6f0e5d5e0baf59038ac4381229437607746069a,"Removed svn:executable prop from text files. See ZOOKEEPER-45

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@671311 13f79535-47bb-0310-9956-ffa450edef68",2008-06-24 19:25:25,Patrick D. Hunt,Mixed
31d99a300ad9b0c66905333c7775321a58345ed6,"Fixed ZOOKEEPER-75, addressed some license issues and also removed the cobertura library (gpl). Moved from junit 4.1 to junit 4.4 at the same time (tests still pass).

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@677109 13f79535-47bb-0310-9956-ffa450edef68",2008-07-15 23:49:31,Patrick D. Hunt,Mixed
2bba284640acecb5794c4f0f9be8ae66e645c7eb,"[ZOOKEEPER-39] Use Watcher objects rather than boolean on read operations

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@679557 13f79535-47bb-0310-9956-ffa450edef68",2008-07-24 21:46:30,Andrew Kornev,Not TDD
3740b7c730e6e4ccccd78c35694689292bca4ddb,"Fixed ZOOKEEPER-48 - auth_id now handled correctly when no auth ids present

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@681465 13f79535-47bb-0310-9956-ffa450edef68",2008-07-31 20:10:24,Patrick D. Hunt,Not TDD
dbd65f592ba1398b9b8ac371917cb2b9e65eaff2,"ZOOKEEPER-44. Create sequence flag children with prefixes of 0's so that they can be lexicographically sorted. (Jakob Homan via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@681910 13f79535-47bb-0310-9956-ffa450edef68",2008-08-02 00:07:30,Mahadev Konar,Not TDD
435bc0ff5db851d341c373bc515f6a618691e6c4,"ZOOKEEPER-111. Significant cleanup of existing tests. (Patrick Hunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@686389 13f79535-47bb-0310-9956-ffa450edef68",2008-08-15 22:02:28,Mahadev Konar,Mixed
92c538d4d830d61fcaa4346c356e63d8f23bd2f3,"ZOOKEEPER-123. Fix  the wrong class specified for the logger. (Jakob Homan via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@688813 13f79535-47bb-0310-9956-ffa450edef68",2008-08-25 18:16:45,Mahadev Konar,Mixed
e3e0db789177a2e77882545dbdd9eed9a23eb392,"ZOOKEEPER-63. Race condition in client close() operation. (phunt via breed)



git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@689668 13f79535-47bb-0310-9956-ffa450edef68",2008-08-27 23:36:40,Benjamin Reed,Mixed
4cdb4305ad4acd8189b4f771b30f05d4cf68703e,"ZOOKEEPER-134 findbugs cleanup


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@692164 13f79535-47bb-0310-9956-ffa450edef68",2008-09-04 17:02:09,Benjamin Reed,Mixed
ada5b36e3683aadd061a9e3578c9b693f0b050ab,"ZOOKEEPER-128 test coverage on async client operations needs to be improved


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@692527 13f79535-47bb-0310-9956-ffa450edef68",2008-09-05 20:20:20,Benjamin Reed,Mixed
a6078d424766ba7ca60821ae802f3acb9e2c7758,"ZOOKEEPER-112 src/java/main ZooKeeper.java has test code embedded into it.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@692534 13f79535-47bb-0310-9956-ffa450edef68",2008-09-05 20:30:49,Benjamin Reed,Not TDD
931322a7c7287a715b4aa7046d4af4f42ddd5cd3,"fix for ZOOKEEPER-132, creation enum to replace createflag

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@693164 13f79535-47bb-0310-9956-ffa450edef68",2008-09-08 16:55:56,Patrick D. Hunt,Mixed
217107e26bef95aeb8f669013e03191406b9c7ee,"ZOOKEEPER-130. update build.xml to support apache release process.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@693912 13f79535-47bb-0310-9956-ffa450edef68",2008-09-10 17:49:26,Mahadev Konar,Not TDD
3553137b9a7e8d804fdb378be23196a74afaf731,"ZOOKEEPER-131. Fix Old leader election can elect a dead leader over and over again. (breed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@696891 13f79535-47bb-0310-9956-ffa450edef68",2008-09-19 01:24:25,Mahadev Konar,Not TDD
ad90e3700bd147bcec1691e51d40a09b43a82f8a,"Missed adding two files for ZOOKEEPER-137


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@698738 13f79535-47bb-0310-9956-ffa450edef68",2008-09-24 21:12:26,Benjamin Reed,Not TDD
d349e7bd5ec70f62f75c6bd3c986fcd29e1b3a4c,"cleanup event type/state fields, incompatible API change, ZOOKEEPER-139

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@699114 13f79535-47bb-0310-9956-ffa450edef68",2008-09-25 22:25:28,Patrick D. Hunt,Mixed
ad482ad24cc864686f268b71896606091d92a00f,"ZOOKEEPER-21. Improve zk ctor/watcher (state transition) docs 

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@699442 13f79535-47bb-0310-9956-ffa450edef68",2008-09-26 18:09:25,Patrick D. Hunt,Mixed
c92694d86f381164dc73251af3060d48ef03ec16,"ZOOKEEPER-6.patch

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@700417 13f79535-47bb-0310-9956-ffa450edef68",2008-09-30 11:14:17,Flavio Paiva Junqueira,Not TDD
0254f868ca34105308ac3524c73111d8d770091e,"ZOOKEEPER-38. headers (version+) in log/snap files


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@700690 13f79535-47bb-0310-9956-ffa450edef68",2008-10-01 06:26:47,Benjamin Reed,Mixed
0c6294e6cab2befc330b8a5c05ceeb156550c2fe,"ZOOKEEPER-127.  Use of non-standard election ports in config breaks services


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@700714 13f79535-47bb-0310-9956-ffa450edef68",2008-10-01 08:40:02,Benjamin Reed,Mixed
ea54ef0825c6670cc6714e749d391f477420b118,"ZOOKEEPER-136.patch

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@701369 13f79535-47bb-0310-9956-ffa450edef68",2008-10-03 13:06:39,Flavio Paiva Junqueira,Mixed
ff98502017f564c14008f5e55ba536bef7d60b78,"ZOOKEEPER-8. Stat enchaned to include num of children and size

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@702583 13f79535-47bb-0310-9956-ffa450edef68",2008-10-07 18:51:49,Patrick D. Hunt,Not TDD
0bc7d41e3f15f02c81d63cc8fcf0f373ee867327,"ZOOKEEPER-33. Better ACL management (Mahadev Konar)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@704592 13f79535-47bb-0310-9956-ffa450edef68",2008-10-14 17:47:54,Mahadev Konar,Not TDD
217fddb4b4a131fac932a65bcc45819e39fb35c4,"ZOOKEEPER-182.  zookeeper_init accepts empty host-port string and returns valid pointer to zhandle_t

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@704657 13f79535-47bb-0310-9956-ffa450edef68",2008-10-14 20:09:57,Patrick D. Hunt,Not TDD
f15c156be0ac92b252882be6d9e15058882ecfd9,"ZOOKEEPER-184. tests: An explicit include derective is needed for the usage  of memcpy(), memset(), strlen(), strdup() and free() functions --- also addressed some missing jiras from CHANGES.txt

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@704667 13f79535-47bb-0310-9956-ffa450edef68",2008-10-14 20:28:59,Patrick D. Hunt,Not TDD
82627a641750383bc7380c568291839bbea5c26e,"ZOOKEEPER-5. Upgrade Feature in Zookeeper server.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@705421 13f79535-47bb-0310-9956-ffa450edef68",2008-10-17 00:21:43,Patrick D. Hunt,Mixed
04ac2dc3e5527cd144c8fb0aa05e8747342d01d0,"ZOOKEEPER-197. create checksums for snapshots

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@706510 13f79535-47bb-0310-9956-ffa450edef68",2008-10-21 04:26:20,Patrick D. Hunt,Not TDD
30c3c0eb55026bf73c6c6a87fe662ba458f67233,"ZOOKEEPER-43. Server side of auto reset watches.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@706815 13f79535-47bb-0310-9956-ffa450edef68",2008-10-21 23:49:45,Mahadev Konar,Not TDD
5d56e6d2ead954483041a74112a69fb89a01199e,"ZOOKEEPER-23. Auto reset of watches on reconnect

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@706834 13f79535-47bb-0310-9956-ffa450edef68",2008-10-22 01:22:06,Patrick D. Hunt,Not TDD
f7673ae440408e4107c3a7874caf3e4df91b078c,"ZOOKEEPER-212. fix the snapshot to be asynchronous. (mahadev and ben)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@718433 13f79535-47bb-0310-9956-ffa450edef68",2008-11-17 23:18:47,Mahadev Konar,Not TDD
128807c962823b32bfd3f2872de1e3714b1e92f4,"ZOOKEEPER-219. fix events.poll timeout in watcher test to be longer. (pat via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@718445 13f79535-47bb-0310-9956-ffa450edef68",2008-11-18 00:11:13,Mahadev Konar,Not TDD
fa7764c88b063a672b48ec341b9e4a6d958cdce2,"ZOOKEEPER-228. fix apache header missing in DBTest. (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@718702 13f79535-47bb-0310-9956-ffa450edef68",2008-11-18 20:10:57,Mahadev Konar,Not TDD
1b7dbc1c523d4105899340b064f169e88a727081,"ZOOKEEPER-226. fix exists calls that fail on server if node has null data. (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@718799 13f79535-47bb-0310-9956-ffa450edef68",2008-11-18 23:42:22,Mahadev Konar,Not TDD
4a9ba5da6e438dd2049325624c3f12f55a2de809,"ZOOKEEPER-211 Not all Mock tests are working

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@718832 13f79535-47bb-0310-9956-ffa450edef68",2008-11-19 01:28:16,Patrick D. Hunt,Not TDD
3fcc62dae5f63a64f68b5d36f8d22e3ecf751a78,"ZOOKEEPER-204. SetWatches needs to be the first message after auth messages to the server (ben via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@718925 13f79535-47bb-0310-9956-ffa450edef68",2008-11-19 10:20:35,Mahadev Konar,Not TDD
7070ea227a201d0b69c7da2a14cc54ed9bbd5428,"ZOOKEEPER-208. Zookeeper C client uses API that are not thread safe, causing crashes when multiple instances are active. (austin shoemaker, chris daroch and ben reed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@719063 13f79535-47bb-0310-9956-ffa450edef68",2008-11-19 20:47:22,Mahadev Konar,Not TDD
2ed749ffd1ae55ad8090890908fa2d3d1a64b20e,"ZOOKEEPER-232. fix apache licence header in TestableZookeeper (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@720287 13f79535-47bb-0310-9956-ffa450edef68",2008-11-24 20:48:24,Mahadev Konar,Not TDD
4e482a0e8c2e79ea39ac98a422b604d5bd861250,"ZOOKEEPER-249. QuorumPeer.getClientPort() always returns -1. (nitay joffe via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@724607 13f79535-47bb-0310-9956-ffa450edef68",2008-12-09 05:09:48,Mahadev Konar,Mixed
9f7759d73f44901226873cdf2da685877fa06f62,"ZOOKEEPER-251. NullPointerException stopping and starting Zookeeper servers

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@725454 13f79535-47bb-0310-9956-ffa450edef68",2008-12-10 21:55:21,Patrick D. Hunt,Not TDD
2e135ab9287f8babeeeddcfb7cd362f4d2b4278f,"ZOOKEEPER-250. isvalidsnapshot should handle the case of 0 snapshot files better

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@725816 13f79535-47bb-0310-9956-ffa450edef68",2008-12-11 21:16:41,Patrick D. Hunt,Not TDD
10d8d9cf50040f100b0d2eedaae9fc263b06133d,"ZOOKEEPER-255. zoo_set() api does not return stat datastructure. (avery ching via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@728792 13f79535-47bb-0310-9956-ffa450edef68",2008-12-22 21:39:46,Mahadev Konar,Not TDD
88fab67e8bf006e10f23db1ae7059cb4c516a4a8,"ZOOKEEPER-246. review error code definition in both source and docs. (pat via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@728812 13f79535-47bb-0310-9956-ffa450edef68",2008-12-22 22:23:32,Mahadev Konar,Mixed
da1e988798fd0336a893e16e94d699e6b156c941,"ZOOKEEPER-234. Eliminate using statics to initialize the sever. Should allow server to be more embeddable in OSGi enviorments.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@734847 13f79535-47bb-0310-9956-ffa450edef68",2009-01-15 22:57:14,Patrick D. Hunt,Mixed
f340e569fe7c33985298397d31b89638a397bf19,"ZOOKEEPER-268.  tostring on jute generated objects can cause NPE. (pat via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@737784 13f79535-47bb-0310-9956-ffa450edef68",2009-01-26 19:21:38,Mahadev Konar,Not TDD
e5b90d600c69107da88d1758c1e66eba7cc1abad,"ZOOKEEPER-267.  java client incorrectly generating syncdisconnected event when in 
disconnected state


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@738316 13f79535-47bb-0310-9956-ffa450edef68",2009-01-28 00:15:33,Benjamin Reed,Not TDD
7d8d199a4662ab710c8f3a12745b86dbdb4c7520,"ZOOKEEPER-275. Bug in FastLeaderElection. (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@739075 13f79535-47bb-0310-9956-ffa450edef68",2009-01-29 23:11:02,Mahadev Konar,Not TDD
a1ac465be361ff478f9b66147731e588fef64ff3,"ZOOKEEPER-276. Bookkeeper contribution (Flavio and Luca Telloli via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@739388 13f79535-47bb-0310-9956-ffa450edef68",2009-01-30 19:30:27,Mahadev Konar,Mixed
85fc47a95dc4cd72a5ea79bcb3ab87613fa8535b,"ZOOKEEPER-16. Need to do path validation. (pat, mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@739446 13f79535-47bb-0310-9956-ffa450edef68",2009-01-30 23:01:33,Mahadev Konar,Not TDD
892b0941c13f3680a5e3cfc32d51694ac4861289,"ZOOKEEPER-215. expand system test environment

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@739475 13f79535-47bb-0310-9956-ffa450edef68",2009-01-31 01:04:12,Patrick D. Hunt,Not TDD
bdcdc82e97512d6094ea25775a8d77c1597e1223,"ZOOKEEPER-252. PurgeTxnLog is not handling the new dataDir directory structure

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@739479 13f79535-47bb-0310-9956-ffa450edef68",2009-01-31 01:18:30,Patrick D. Hunt,Mixed
8173d34f1bb7c59fa401c3db1c0e42264fc48924,"ZOOKEEPER-286. Make GenerateLoad use InstanceContainers. (breed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@740131 13f79535-47bb-0310-9956-ffa450edef68",2009-02-02 22:26:03,Mahadev Konar,Not TDD
a4c675afff3b26171efd78ced4916e2f5fb25eb4,"ZOOKEEPER-231. Quotas in ZooKeeper. (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@740216 13f79535-47bb-0310-9956-ffa450edef68",2009-02-03 05:23:47,Mahadev Konar,Mixed
2890f77b0ea58176e14780d99c4dc3cc0dfa88fd,"ZOOKEEPER-291. regression for legacy code using KeeperException.Code constants (due to 246). (pat via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@740847 13f79535-47bb-0310-9956-ffa450edef68",2009-02-04 19:57:39,Mahadev Konar,Not TDD
4447e6dfa786f918b7e89754b10c70509fccae46,"ZOOKEEPER-293. zoo_set needs to be abi compatible (3.1 changed the signature), fix this by adding zoo_set2 (pat via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@741294 13f79535-47bb-0310-9956-ffa450edef68",2009-02-05 21:16:02,Mahadev Konar,Not TDD
83cf0a93c37759334fab885c2010fa0b7d953f52,"ZOOKEEPER-308. improve the atomic broadcast performance 3x. (breed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@746067 13f79535-47bb-0310-9956-ffa450edef68",2009-02-20 00:23:40,Mahadev Konar,Not TDD
8b651cfb22985be3a755fb82e3619057e34f49ef,"ZOOKEEPER-334. bookkeeper benchmark (testclient.java) has compiling errros. (flavio and mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@749812 13f79535-47bb-0310-9956-ffa450edef68",2009-03-03 22:48:50,Mahadev Konar,Not TDD
9b76dc54e7327395d6842c7e0a141ece42778cab,"ZOOKEEPER-309. core dump using zoo_get_acl()

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@752730 13f79535-47bb-0310-9956-ffa450edef68",2009-03-12 00:48:47,Patrick D. Hunt,Not TDD
05eab5e567f49d984e3c299be42d9a9760d98ec2,"ZOOKEEPER-288. Cleanup and fixes to BookKeeper (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@761077 13f79535-47bb-0310-9956-ffa450edef68",2009-04-01 21:50:03,Mahadev Konar,Mixed
8aeade991cb813d3fa28e5f76931707e90d03274,"ZOOKEEPER-305.  Replace timers with semaphores in FLENewEpochTest. (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@761126 13f79535-47bb-0310-9956-ffa450edef68",2009-04-02 00:35:57,Mahadev Konar,Not TDD
56a1186f817bf13f7672ad07e31684bcd0f536f6,"ZOOKEEPER-60. Get cppunit tests running as part of Hudson CI. (girish via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@761433 13f79535-47bb-0310-9956-ffa450edef68",2009-04-02 21:28:27,Mahadev Konar,Not TDD
c9e8662617ac5d99cc08f858c21dc9c4ba175881,"ZOOKEEPER-362. Issues with FLENewEpochTest. (fix bug in Fast leader election) (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@761816 13f79535-47bb-0310-9956-ffa450edef68",2009-04-03 22:01:18,Mahadev Konar,Not TDD
b6320b80a4c08958d5b5028cf065cbcc57894a86,"ZOOKEEPER-343. add tests that specifically verify the zkmain and qpmain classes. (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@762532 13f79535-47bb-0310-9956-ffa450edef68",2009-04-06 22:19:05,Mahadev Konar,Mixed
06d451ad0c982c098458f7a40463b5034708bcfc,"ZOOKEEPER-363. NPE when recovering ledger with no hint. (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@762602 13f79535-47bb-0310-9956-ffa450edef68",2009-04-07 02:43:38,Mahadev Konar,Mixed
764e34ca913283f1059de2055b0aa313c0514c2a,"ZOOKEEPER-355. make validatePath non public in Zookeeper client api. (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@763799 13f79535-47bb-0310-9956-ffa450edef68",2009-04-09 21:02:49,Mahadev Konar,Not TDD
4b9f4168f19568a3c7bc89c0f7053e441cde0153,"ZOOKEEPER-361. integrate cppunit testing as part of hudson patch process. (giri via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@764673 13f79535-47bb-0310-9956-ffa450edef68",2009-04-14 04:55:06,Mahadev Konar,Not TDD
b82c45bd81386d5af77570393e5540c360e263ca,"ZOOKEEPER-374. Uninitialized struct variable in C causes warning which is treated as an error (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@765746 13f79535-47bb-0310-9956-ffa450edef68",2009-04-16 20:28:17,Mahadev Konar,Not TDD
f6521f7c29b1d330617aed3764ecc25ff73e2da1,"ZOOKEEPER-337. improve logging in leader election lookForLeader method when address resolution fails (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@765797 13f79535-47bb-0310-9956-ffa450edef68",2009-04-16 22:59:49,Mahadev Konar,Not TDD
1e1ccdcfb19a60e50b9393feac7c0322048e20e1,"ZOOKEEPER-367. RecoveryTest failure - 'unreasonable length' IOException

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@766107 13f79535-47bb-0310-9956-ffa450edef68",2009-04-17 18:11:43,Patrick D. Hunt,Not TDD
9bdd8cf6378245a36531d071f68cf58898e5cca6,"ZOOKEEPER-373. One thread per bookie (flavio via mahadev) 

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@766160 13f79535-47bb-0310-9956-ffa450edef68",2009-04-17 21:28:30,Mahadev Konar,Not TDD
579ad8454500a307b1ec07efc4eeed55d643f124,"ZOOKEEPER-78. added a high level protocol/feature - for easy Leader Election or exclusive Write Lock creation

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@768067 13f79535-47bb-0310-9956-ffa450edef68",2009-04-23 21:41:09,Patrick D. Hunt,Mixed
cfdc76c1eeea467b44b0fa934bbccfcdc877be00,"ZOOKEEPER-29. Flexible quorums (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@768390 13f79535-47bb-0310-9956-ffa450edef68",2009-04-24 18:26:08,Mahadev Konar,Not TDD
9b3953a4f713a4ddec398820ff222a537c033314,"ZOOKEEPER-382. zookeeper cpp tests fails on 64 bit machines with gcc 4.1.2

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@769882 13f79535-47bb-0310-9956-ffa450edef68",2009-04-29 19:11:39,Patrick D. Hunt,Not TDD
b4510d2b69db980525be0fcb6e11b692c690ac24,"ZOOKEEPER-384. keeper exceptions missing path (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@771563 13f79535-47bb-0310-9956-ffa450edef68",2009-05-05 04:55:31,Mahadev Konar,Not TDD
c41bd3f83e6ad99f03261ba21295eed5151eadda,"ZOOKEEPER-380. bookkeeper should have a streaming api so that its easier to
store checpoints/snapshots in bookkeeper. (mahadev via flavio)



git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@772098 13f79535-47bb-0310-9956-ffa450edef68",2009-05-06 08:49:48,Flavio Paiva Junqueira,Mixed
1cd080633bff3e8668f62149316d416698582b35,"ZOOKEEPER-36. REST access to ZooKeeper (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@772843 13f79535-47bb-0310-9956-ffa450edef68",2009-05-08 05:27:00,Mahadev Konar,Not TDD
c92b14b8e234977b0ec7a3fb265ef61cc501ac24,"ZOOKEEPER-395. Python bindings. (henry robinson via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@774656 13f79535-47bb-0310-9956-ffa450edef68",2009-05-14 06:37:59,Mahadev Konar,Not TDD
0566dc00b3fe9af48ea856a587ceee56fcc24cd8,"ZOOKEEPER-400. Issues with procedure to close ledger. (flavio)



git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@774679 13f79535-47bb-0310-9956-ffa450edef68",2009-05-14 08:21:16,Flavio Paiva Junqueira,Mixed
acd8adc4a75bb2b0b5dfa3f75f31a723b9e763e7,"ZOOKEEPER-395. forgot to set the executable perms. (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@774849 13f79535-47bb-0310-9956-ffa450edef68",2009-05-14 17:22:19,Mahadev Konar,Not TDD
382cce4d71475d3101cdd2caa57ccdae1064ee7c,"ZOOKEEPER-94. JMX tests are needed to verify that the JMX MBeans work properly (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@774909 13f79535-47bb-0310-9956-ffa450edef68",2009-05-14 20:15:06,Mahadev Konar,Mixed
c0500af30f4a01114b030fb3e4afbc7bbaf210fa,"ZOOKEEPER-402. zookeeper c library segfaults on data for a node in zookeeper being null

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@777265 13f79535-47bb-0310-9956-ffa450edef68",2009-05-21 21:22:10,Patrick D. Hunt,Not TDD
2c6174d961eb3d4966ea27b39e36fbba1f29d07a,"ZOOKEEPER-415. zookeeper c tests hang.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@777413 13f79535-47bb-0310-9956-ffa450edef68",2009-05-22 07:25:21,Patrick D. Hunt,Not TDD
4b88ebcce8879df1c522a55dc8053f7b40bb63e9,"ZOOKEEPER-385. crctest failed on hudson patch test

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@777419 13f79535-47bb-0310-9956-ffa450edef68",2009-05-22 07:43:14,Patrick D. Hunt,Not TDD
ba65c32347b12607cfa8160088b442e2f56a837e,"ZOOKEEPER-383. Asynchronous version of createLedger(). (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@779433 13f79535-47bb-0310-9956-ffa450edef68",2009-05-28 05:00:40,Mahadev Konar,Not TDD
f30c599844397dd75653ba2f924a2aca9760ee5c,"ZOOKEEPER-421. zkpython run_tests.sh is missing #!

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@780828 13f79535-47bb-0310-9956-ffa450edef68",2009-06-01 21:00:09,Patrick D. Hunt,Not TDD
01aee31cd6dc5d49cc931299121cfc6687c2f9a5,"ZOOKEEPER-358. Throw exception when ledger does not exist


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@781173 13f79535-47bb-0310-9956-ffa450edef68",2009-06-02 21:15:23,Benjamin Reed,Not TDD
0959e89f8bfd67735be718542872582ec1ce792d,"ZOOKEEPER-406. address all findbugs warnings in persistence classes


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@781264 13f79535-47bb-0310-9956-ffa450edef68",2009-06-03 05:14:16,Benjamin Reed,Not TDD
016f8c2ab755536ccc5daf953108978e9e0e9513,"reverting ZOOKEEPER-408 patch since it breaks the build


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@781266 13f79535-47bb-0310-9956-ffa450edef68",2009-06-03 05:32:59,Benjamin Reed,Not TDD
601320c3379194eb90a3b57a5f27e703727aa690,"ZOOKEEPER-435. allow ""super"" admin digest based auth to be configurable


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@782882 13f79535-47bb-0310-9956-ffa450edef68",2009-06-09 05:21:27,Benjamin Reed,Mixed
082a3f9b0ec10b9587c1f05473d3c42905a2056c,"forgot to add new files from ZOOKEEPER-336

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@782883 13f79535-47bb-0310-9956-ffa450edef68",2009-06-09 05:23:26,Benjamin Reed,Mixed
7f9dd70384c16e81a08fb8055ffa194bf72bdd7d,"ZOOKEEPER-375. zoo_add_auth only retains most recent auth on re-sync. (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@783096 13f79535-47bb-0310-9956-ffa450edef68",2009-06-09 19:01:11,Mahadev Konar,Not TDD
981052d54b87a7ec8989a46acf2d77d2064a9390,"ZOOKEEPER-432. Various improvements to zkpython bindings. (henry via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@785018 13f79535-47bb-0310-9956-ffa450edef68",2009-06-15 22:54:48,Mahadev Konar,Not TDD
360fc24572f0ba75362253450fea50dd48d2ea13,"ZOOKEEPER-433.  getacl on root znode (/) fails. (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@785871 13f79535-47bb-0310-9956-ffa450edef68",2009-06-18 01:08:52,Mahadev Konar,Not TDD
3402537c1f8d8301b6e16e6cebc8c1e655aa14bf,"ZOOKEEPER-408. address all findbugs warnings in persistence classes. (phunt, mahadev, flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@786156 13f79535-47bb-0310-9956-ffa450edef68",2009-06-18 16:37:49,Mahadev Konar,Mixed
cbd8be492393d9409ac0ee8c2dbb7c1bbad3cab3,"ZOOKEEPER-446. some traces of the host auth scheme left (breed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@787395 13f79535-47bb-0310-9956-ffa450edef68",2009-06-22 20:53:05,Mahadev Konar,Not TDD
e0316743684e9ef208cfe68efc28929ecfad5e67,"ZOOKEEPER-356. Masking bookie failure during writes to a ledger


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@787907 13f79535-47bb-0310-9956-ffa450edef68",2009-06-24 05:07:23,Benjamin Reed,Mixed
e3650bf5dd0bc427fc8000821ae70e69c563863f,"ZOOKEEPER-237. Add a Chroot request (phunt and mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@788205 13f79535-47bb-0310-9956-ffa450edef68",2009-06-24 22:59:34,Mahadev Konar,Mixed
32b76dabd04b8ee71148dce562919f74b7addfeb,"ZOOKEEPER-438.  addauth fails to register auth on new client that's not yet connected (breed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@788502 13f79535-47bb-0310-9956-ffa450edef68",2009-06-25 20:41:37,Mahadev Konar,Not TDD
0057dcb78313be28ae16b7e84c873191471dceee,"ZOOKEEPER-417. stray message problem when changing servers (breed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@788860 13f79535-47bb-0310-9956-ffa450edef68",2009-06-26 20:29:54,Mahadev Konar,Mixed
b37b8d6713c630901e46f0191b205061c0273133,"ZOOKEEPER-450. emphemeral cleanup not happening with session timeout. (breed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@789532 13f79535-47bb-0310-9956-ffa450edef68",2009-06-30 01:32:11,Mahadev Konar,Not TDD
8d2ae28491342663d9290114b8ecb182d6aa903e,"ZOOKEEPER-453. Worker is not removed in QuorumCnxManager upon crash. (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@789943 13f79535-47bb-0310-9956-ffa450edef68",2009-06-30 20:47:09,Mahadev Konar,Not TDD
a44fae6243a6363d0e07f3ba1275f8ecd3f5deb5,"ZOOKEEPER-473. cleanup junit tests to eliminate false positives due to socket reuse and failure to close client (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@794887 13f79535-47bb-0310-9956-ffa450edef68",2009-07-16 22:09:40,Mahadev Konar,Mixed
27df3be388c6f67fe493c355f6695b4f19db32d2,"ZOOKEEPER-470. include unistd.h for sleep() in c tests (chris via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@796045 13f79535-47bb-0310-9956-ffa450edef68",2009-07-20 22:30:40,Mahadev Konar,Not TDD
e4801d85185d436a09bb257c0dd175a0f999b2c2,"ZOOKEEPER-482. ignore sigpipe in testRetry to avoid silent immediate failure. (chris via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@799460 13f79535-47bb-0310-9956-ffa450edef68",2009-07-30 22:26:29,Mahadev Konar,Not TDD
f884f500b035946775edb18baff564eaf5a69fad,"ZOOKEEPER-487. setdata on root (/) crashes the servers

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@799702 13f79535-47bb-0310-9956-ffa450edef68",2009-07-31 19:07:59,Patrick D. Hunt,Not TDD
1bc05ce6a3363206fbcf0a4bc6c9bbdee1d361f0,"ZOOKEEPER-481. Add lastMessageSent to QuorumCnxManager. (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@800574 13f79535-47bb-0310-9956-ffa450edef68",2009-08-03 21:27:09,Mahadev Konar,Mixed
a92959ed01dc7425cc4fad14950dc1604934f6e2,"ZOOKEEPER-479.  QuorumHierarchical does not count groups correctly (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@800597 13f79535-47bb-0310-9956-ffa450edef68",2009-08-03 22:28:19,Mahadev Konar,Not TDD
e944652982bf75ae148020cd96338765391efc55,"ZOOKEEPER-466. crash on zookeeper_close() when using auth with empty cert

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@800652 13f79535-47bb-0310-9956-ffa450edef68",2009-08-04 01:58:02,Patrick D. Hunt,Not TDD
930380c9407184ba159181c0d8cd08d21ce90766,"ZOOKEEPER-480. FLE should perform leader check when node is not leading and add vote of follower (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@800891 13f79535-47bb-0310-9956-ffa450edef68",2009-08-04 17:59:58,Mahadev Konar,Not TDD
358f5122485b7ffa9dcc2e46e0751e88711f2ad9,"ZOOKEEPER-491. Prevent zero-weight servers from being elected. (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@800895 13f79535-47bb-0310-9956-ffa450edef68",2009-08-04 18:11:16,Mahadev Konar,Not TDD
d3bed4d6ff788cd800aca503d9d6a57e0cf75da9,"ZOOKEEPER-311. handle small path lengths in zoo_create()


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@801747 13f79535-47bb-0310-9956-ffa450edef68",2009-08-06 18:03:25,Benjamin Reed,Not TDD
9107bbaf5f94ea0c70bcaae458538c95aeb61454,"ZOOKEEPER-484.  Clients get SESSION MOVED exception when switching from follower to a leader. (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@801839 13f79535-47bb-0310-9956-ffa450edef68",2009-08-06 23:23:32,Mahadev Konar,Not TDD
30fe838bb0d0a728eb99f962094dcc115c9990d4,"ZOOKEEPER-501. CnxManagerTest failed on hudson. (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@802188 13f79535-47bb-0310-9956-ffa450edef68",2009-08-07 21:00:05,Mahadev Konar,Mixed
d26abefde17d4e168a32146238036e5515267655,"ZOOKEEPER-499. electionAlg should default to FLE (3) - regression (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@802943 13f79535-47bb-0310-9956-ffa450edef68",2009-08-10 22:24:06,Mahadev Konar,Not TDD
b12aad6381345396ad68be2c4c9df778883bd203,"ZOOKEEPER-483. ZK fataled on me, and ugly

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@802995 13f79535-47bb-0310-9956-ffa450edef68",2009-08-11 05:44:51,Patrick D. Hunt,Not TDD
a45c0e1b11ef8791778512ea23eebe21211f393d,"reverted: ZOOKEEPER-483. ZK fataled on me, and ugly

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@803000 13f79535-47bb-0310-9956-ffa450edef68",2009-08-11 06:16:41,Patrick D. Hunt,Not TDD
8b22eb1e4b8bfe4be08a766a98f636149e62fb28,"ZOOKEEPER-498. Unending Leader Elections : WAN configuration (flavio via  mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@803300 13f79535-47bb-0310-9956-ffa450edef68",2009-08-11 21:09:32,Mahadev Konar,Mixed
0a7c3b05744008862e1875dd6a651aa2a36d8cef,"ZOOKEEPER-508. proposals and commits for DIFF and Truncate messages from the leader to the followers is buggy. (mahadev and ben via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@807484 13f79535-47bb-0310-9956-ffa450edef68",2009-08-25 05:45:24,Mahadev Konar,Not TDD
6e69b7cc29200ad553154bef32b43e448c610092,"ZOOKEEPER-516 add support for 10 minute test ie ""pre-commit"" test

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@815574 13f79535-47bb-0310-9956-ffa450edef68",2009-09-16 00:09:47,Patrick D. Hunt,Mixed
4afe93e5e1cf3a9493618cf9f16aae76ea19527c,"ZOOKEEPER-420. build/test should not require install in zkpython

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@820808 13f79535-47bb-0310-9956-ffa450edef68",2009-10-01 21:37:36,Patrick D. Hunt,Not TDD
b9f518c92e648acb4efc39a30313947961d617c3,"ZOOKEEPER-510. zkpython lumps all exceptions as IOError, needs specialized exceptions for KeeperException types (henry & pat via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@823371 13f79535-47bb-0310-9956-ffa450edef68",2009-10-09 00:42:18,Mahadev Konar,Not TDD
724d1a0984c4ed3589ce390bfc93c0bc1c0f52d1,"ZOOKEEPER-541. zkpython limited to 256 handles

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@824971 13f79535-47bb-0310-9956-ffa450edef68",2009-10-13 23:14:05,Patrick D. Hunt,Not TDD
e8d31e674af714ee33bf4dcbabc6ad22387bc0b7,"zkpython can segfault when statting a deleted node

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@826787 13f79535-47bb-0310-9956-ffa450edef68",2009-10-19 19:42:17,Patrick D. Hunt,Not TDD
e9a7606bb0198f28ec9d9e5a3072d5f18b73b877,"ZOOKEEPER-562. c client can flood server with pings if tcp send queue filled. (ben reed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@831088 13f79535-47bb-0310-9956-ffa450edef68",2009-10-29 21:04:44,Mahadev Konar,Not TDD
0957b8404e1ecfc5703d7c2827752773b7dc23be,"ZOOKEEPER-549. Refactor Followers and related classes into a Peer->Follower hierarchy in preparation for Observers (henry robinson via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@831371 13f79535-47bb-0310-9956-ffa450edef68",2009-10-30 16:19:13,Mahadev Konar,Mixed
82a9d1d0a24147dcb533542559d61783058f1a1b,"ZOOKEEPER-555. Add stat information to GetChildrenResponse. (Arni Jonson and phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@831486 13f79535-47bb-0310-9956-ffa450edef68",2009-10-30 23:09:26,Mahadev Konar,Mixed
e3b97366f8064a6d65a3eb1c44e1191e5e73a5c3,"ZOOKEEPER-558. server ""sent"" stats not being updated


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@833620 13f79535-47bb-0310-9956-ffa450edef68",2009-11-07 00:48:04,Benjamin Reed,Mixed
47c4bdb0c3c40d756ec0ced91a39c771351e826a,"ZOOKEEPER-566. ""reqs"" four letter word (command port) returns no information


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@835515 13f79535-47bb-0310-9956-ffa450edef68",2009-11-12 19:53:07,Benjamin Reed,Not TDD
b7121bb88bab363874309357f9c945c9ed8c75bc,"ZOOKEEPER-550.  Java Queue Recipe. (steven cheng via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@835560 13f79535-47bb-0310-9956-ffa450edef68",2009-11-12 21:27:47,Mahadev Konar,Mixed
72f258cbdd2b5b59a35df8b45e6da6364cd8c915,"ZOOKEEPER-547. Sanity check in QuorumCnxn Manager and quorum communication port.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@881623 13f79535-47bb-0310-9956-ffa450edef68",2009-11-17 23:38:49,Benjamin Reed,Not TDD
788c15be7363e475e8b050260623ec46c9ef8257,"ZOOKEEPER-368. Observers: core functionality (henry robinson via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@881882 13f79535-47bb-0310-9956-ffa450edef68",2009-11-18 19:06:39,Mahadev Konar,Mixed
a62d0245c91f3ed70f0ee0833e3ec3799a24e377,"ZOOKEEPER-582. ZooKeeper can revert to old data when a snapshot is created outside of normal processing (ben reed and mahadev via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@882744 13f79535-47bb-0310-9956-ffa450edef68",2009-11-20 22:28:38,Mahadev Konar,Not TDD
2ed6485e9d503e68c8f9ab3d5655be88ab1e0851,"ZOOKEEPER-614. Improper synchronisation in getClientCnxnCount (henry via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@889848 13f79535-47bb-0310-9956-ffa450edef68",2009-12-11 23:03:33,Mahadev Konar,Not TDD
a8a73362bd9a3967c46011ded1ed831a586acd2e,"ZOOKEEPER-599. Changes to FLE and QuorumCnxManager to support Observers
ZOOKEEPER-506. QuorumBase should use default leader election


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@891034 13f79535-47bb-0310-9956-ffa450edef68",2009-12-15 22:23:55,Benjamin Reed,Not TDD
e8efba3f36b577e7dc41bb6ccfa30b370ae04a27,"ZOOKEEPER-609. ObserverTest failure ""zk should not be connected expected not same""

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@891366 13f79535-47bb-0310-9956-ffa450edef68",2009-12-16 18:26:58,Patrick D. Hunt,Not TDD
c1eb73fd1dd7635b4fcaf1b4ece84b57e7bbc5e6,"ZOOKEEPER-630. Trunk has duplicate ObserverTest.java files

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@891368 13f79535-47bb-0310-9956-ffa450edef68",2009-12-16 18:28:51,Patrick D. Hunt,Not TDD
febdceb87f78038122574985f874af2ad56f1c72,"ZOOKEEPER-627. zkpython arbitrarily restricts the size of a \'get\' to 512 bytes (henry robinson via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@891474 13f79535-47bb-0310-9956-ffa450edef68",2009-12-16 23:27:38,Mahadev Konar,Not TDD
75277a873629db46a61847c3b073d8ad0dbdce2a,"ZOOKEEPER-623. ClientBase in bookkeeper.util requires junit


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@891809 13f79535-47bb-0310-9956-ffa450edef68",2009-12-17 17:36:19,Benjamin Reed,Not TDD
3ba0a5450cb5340a39154f872d920a580648de3c,"ZOOKEEPER-596. The last logged zxid calculated by zookeeper servers could cause problems in leader election if data gets corrupted. (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@892111 13f79535-47bb-0310-9956-ffa450edef68",2009-12-18 02:19:50,Mahadev Konar,Not TDD
3ab8e2e2f87fc730a13181fa0e1e4ddb4ecadad3,"ZOOKEEPER-544. improve client testability - allow test client to access connected server location


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@896143 13f79535-47bb-0310-9956-ffa450edef68",2010-01-05 17:32:35,Benjamin Reed,Mixed
73f0ff946205e6054e72249fc0399c6e94b30a80,"ZOOKEEPER-655. StringBuffer -> StringBuilder - conversion of references as necessary (Kay Kay via henry)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@902690 13f79535-47bb-0310-9956-ffa450edef68",2010-01-25 03:28:40,Henry Robinson,Mixed
5aea0fbbae6fab464b932339c00051f179eb0343,"ZOOKEEPER-572. add ability for operator to examine state of watches currently registered with a server (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@903025 13f79535-47bb-0310-9956-ffa450edef68",2010-01-26 00:17:23,Mahadev Konar,Not TDD
f84a76cec527a895e7bed5e3a75be4e0e5c689a6,"ZOOKEEPER-612. Make Zookeeper C client can be compiled by gcc of early version (qian via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@903032 13f79535-47bb-0310-9956-ffa450edef68",2010-01-26 01:06:33,Mahadev Konar,Not TDD
f0fad0f10e324b64bfafe0981732eecf38dbb3a3,"ZOOKEEPER-593.  java client api does not allow client to access negotiated session timeout (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@903050 13f79535-47bb-0310-9956-ffa450edef68",2010-01-26 02:22:40,Mahadev Konar,Not TDD
ae541ace94f90ca00cd9086e617afb07791e3c76,"ZOOKEEPER-413. two flaws need addressing in the c tests that can cause false positive failures (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@903061 13f79535-47bb-0310-9956-ffa450edef68",2010-01-26 02:56:43,Mahadev Konar,Not TDD
e1a1ee81f1aa930cae20fa3fc76485e45a95f066,"ZOOKEEPER-507. BookKeeper client re-write (Utkarsh and ben via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@903483 13f79535-47bb-0310-9956-ffa450edef68",2010-01-26 23:16:45,Mahadev Konar,Mixed
a48ea12e5c455f3bb20ef42c3fe947561e82aa9c,"ZOOKEEPER-524. DBSizeTest is not really testing anything


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@912052 13f79535-47bb-0310-9956-ffa450edef68",2010-02-20 00:50:08,Benjamin Reed,Not TDD
b8ccc0c5708c11021a647dc4c1508499bc79cca2,"ZOOKEEPER-569. Failure of elected leader can lead to never-ending leader
election (henry via flavio)



git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@912119 13f79535-47bb-0310-9956-ffa450edef68",2010-02-20 14:26:00,Flavio Paiva Junqueira,Not TDD
90dd37368463c49c1415564896d4141cdb674a6b,"ZOOKEEPER-683. LogFormatter fails to parse transactional log files (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@918757 13f79535-47bb-0310-9956-ffa450edef68",2010-03-03 23:07:21,Mahadev Konar,Not TDD
691dfa44b48240a8917883f3065e3b25e633a58c,"ZOOKEEPER-682. Event is not processed when the watcher is set to watch ""/"" if chrooted (Scott Wang via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@918810 13f79535-47bb-0310-9956-ffa450edef68",2010-03-04 01:28:41,Mahadev Konar,Not TDD
a2e02538cd652f8a58bdd738ccfd78b69a9165b7,"ZOOKEEPER-687. LENonterminatetest fails on some machines. (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@919226 13f79535-47bb-0310-9956-ffa450edef68",2010-03-04 22:55:36,Mahadev Konar,Not TDD
9acd61b97abc7ee4153e4670dcf11a80c27b64ed,"ZOOKEEPER-579. zkpython needs more test coverage for ACL code paths (henry via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@919280 13f79535-47bb-0310-9956-ffa450edef68",2010-03-05 03:47:38,Mahadev Konar,Not TDD
f582494d46c662658f81338471acf9c40f8d6996,"ZOOKEEPER-543. Tests for ZooKeeper examples (steven via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@920619 13f79535-47bb-0310-9956-ffa450edef68",2010-03-09 02:09:15,Mahadev Konar,Not TDD
dc9671d387830ccdea3faade5e7f388cb10518ae,"ZOOKEEPER-635. Server supports listening on a specified network address


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@920651 13f79535-47bb-0310-9956-ffa450edef68",2010-03-09 04:44:26,Benjamin Reed,Not TDD
f0da09751b34ad6969656df34bea7201632ef0ba,"ZOOKEEPER-684. Race in LENonTerminateTest


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@921201 13f79535-47bb-0310-9956-ffa450edef68",2010-03-10 01:27:14,Benjamin Reed,Not TDD
0c9ba838da1c3f98a99bbbabb237d5c9cc5e29ba,"ZOOKEEPER-677. c client doesn't allow ipv6 numeric connect string


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@921439 13f79535-47bb-0310-9956-ffa450edef68",2010-03-10 16:32:22,Benjamin Reed,Not TDD
892c491e49f8f2333308f10a6fb4367772625b07,"ZOOKEEPER-693. TestObserver stuck in tight notification loop in FLE

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@921509 13f79535-47bb-0310-9956-ffa450edef68",2010-03-10 18:52:11,Patrick D. Hunt,Not TDD
df20416c08fa0079d96f6327d10c6f102ebabd85,"ZOOKEEPER-696. NPE in the hudson logs, seems nioservercnxn closed twice (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@921683 13f79535-47bb-0310-9956-ffa450edef68",2010-03-11 03:17:04,Mahadev Konar,Not TDD
b99ef6bc93b7d27ee9359bcd1b4d56856445394d,"ZOOKEEPER-601. allow configuration of session timeout min/max bounds (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@922377 13f79535-47bb-0310-9956-ffa450edef68",2010-03-12 18:26:45,Mahadev Konar,Not TDD
e419600dff67353429353aef419d856e3935af8b,"ZOOKEEPER-698. intermittent JMX test failures due to not verifying QuorumPeer shutdown

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@922459 13f79535-47bb-0310-9956-ffa450edef68",2010-03-13 00:06:55,Patrick D. Hunt,Mixed
f4138613a151f0383bf55ea0608708acbe070cc5,"ZOOKEEPER-121. SyncRequestProcessor is not closing log stream during shutdown (3rd attempt)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@923984 13f79535-47bb-0310-9956-ffa450edef68",2010-03-16 21:23:07,Patrick D. Hunt,Not TDD
5749256a08bb3d9cc584a285938bdf14a36dec66,"ZOOKEEPER-121. SyncRequestProcessor is not closing log stream during shutdown


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@924027 13f79535-47bb-0310-9956-ffa450edef68",2010-03-16 22:25:58,Benjamin Reed,Not TDD
fa66a48f63230553060e5024ad8670a315e82a65,"ZOOKEEPER-586. c client does not compile under cygwin


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@924045 13f79535-47bb-0310-9956-ffa450edef68",2010-03-16 23:20:59,Benjamin Reed,Not TDD
8c2d084e9b77bfa10a686c292af4e927de3828ad,"ZOOKEEPER-624. The C Client cause core dump when receive error data from Zookeeper Server (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@924065 13f79535-47bb-0310-9956-ffa450edef68",2010-03-17 00:05:24,Mahadev Konar,Not TDD
27c20471bcef452f4535aa27cce89c94c73dea74,"ZOOKEEPER-591. The C Client cannot exit properly in some situation (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@924147 13f79535-47bb-0310-9956-ffa450edef68",2010-03-17 04:14:52,Mahadev Konar,Not TDD
b3a81ce65a1dca4da19f27817871af4738a6a4dc,"ZOOKEEPER-709. bookkeeper build failing with missing factory

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@924653 13f79535-47bb-0310-9956-ffa450edef68",2010-03-18 06:23:21,Patrick D. Hunt,Not TDD
65fc5e579a1e659a3977808dffe51e2a436afa86,"ZOOKEEPER-436. Bookies should auto register to ZooKeeper


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@924942 13f79535-47bb-0310-9956-ffa450edef68",2010-03-18 18:39:50,Benjamin Reed,Not TDD
b1c614b2ca982b2e029d11605717846af790870f,"ZOOKEEPER-710. permanent ZSESSIONMOVED error after client app reconnects to zookeeper cluster


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@925104 13f79535-47bb-0310-9956-ffa450edef68",2010-03-19 06:46:36,Benjamin Reed,Not TDD
a1a877a468b9bf1adeace989cb0e55d74a1e5d5f,"ZOOKEEPER-724. Improve junit test integration - log harness information (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@929377 13f79535-47bb-0310-9956-ffa450edef68",2010-03-31 04:26:29,Mahadev Konar,Mixed
af80eeedfc5347eb96de33a8f076f2169a7771e2,"ZOOKEEPER-735. cppunit test testipv6 assumes that the machine is ipv6 enabled. (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@932049 13f79535-47bb-0310-9956-ffa450edef68",2010-04-08 18:22:45,Mahadev Konar,Not TDD
318820301c8a377af8eeb126828cfeb361ea0498,"ZOOKEEPER-729. Java client API to recursively delete a subtree. (Kay Kay via henry)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@934312 13f79535-47bb-0310-9956-ffa450edef68",2010-04-15 07:23:44,Henry Robinson,Mixed
6ad91e3ff0b8f6b956c4d5cac596562c46947c96,"ZOOKEEPER-741. root level create on REST proxy fails

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@936621 13f79535-47bb-0310-9956-ffa450edef68",2010-04-22 05:42:51,Patrick D. Hunt,Not TDD
7ecd589c1511770b96bf034a5cd7d322bbe56bc5,"ZOOKEEPER-734. QuorumPeerTestBase.java and ZooKeeperServerMainTest.java do not handle windows path correctly

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@938212 13f79535-47bb-0310-9956-ffa450edef68",2010-04-26 19:58:59,Patrick D. Hunt,Not TDD
dd8f018c05d06ae33f524f45a77bafdd4a64ba11,"ZOOKEEPER-758. zkpython segfaults on invalid acl with missing key

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@939866 13f79535-47bb-0310-9956-ffa450edef68",2010-04-30 22:50:13,Henry Robinson,Not TDD
472c93adc6e4dfc7dbb7b5a95d211dce09cc154f,"ZOOKEEPER-764. Observer elected leader due to inconsistent voting view (henry via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@941473 13f79535-47bb-0310-9956-ffa450edef68",2010-05-05 20:32:33,Mahadev Konar,Not TDD
f781b707210da366de11d3118ff0eb0f1e76f81c,"ZOOKEEPER-763. Deadlock on close w/ zkpython / c client

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@941510 13f79535-47bb-0310-9956-ffa450edef68",2010-05-05 21:53:04,Patrick D. Hunt,Not TDD
38592a9e79e8c5f8ba8d6a709c7c28e7084030fc,"ZOOKEEPER-464. Need procedure to garbage collect ledgers
  (erwin via fpj)



git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@944003 13f79535-47bb-0310-9956-ffa450edef68",2010-05-13 20:23:35,Flavio Paiva Junqueira,Not TDD
001cdf3b5d180c58561940b6fa1b251928181f12,"ZOOKEEPER-464. Need procedure to garbage collect ledgers
(erwin via fpj)

OBS: Adding missing files.



git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@944140 13f79535-47bb-0310-9956-ffa450edef68",2010-05-14 07:04:41,Flavio Paiva Junqueira,Mixed
eef40c00214c2440e3a0e18d6ea1bc707164e32d,"ZOOKEEPER-774. Recipes tests are slightly outdated: they do not compile against JUnit 4.8

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@944515 13f79535-47bb-0310-9956-ffa450edef68",2010-05-14 23:32:20,Patrick D. Hunt,Not TDD
805789eeb13d44d87ea680567fd96c7ddc5c94f0,"ZOOKEEPER-772. zkpython segfaults when watcher from async get children is invoked.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@946047 13f79535-47bb-0310-9956-ffa450edef68",2010-05-19 06:37:49,Patrick D. Hunt,Not TDD
44e2475ed44024f45ed06b9095c832d7750cfff7,"ZOOKEEPER-769: Leader can treat observers as quorum members

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@947063 13f79535-47bb-0310-9956-ffa450edef68",2010-05-21 16:22:52,Henry Robinson,Not TDD
2a8a3063d64fb935ca4136ba10bb15efeb97d52e,"ZOOKEEPER-744. Add monitoring four-letter word

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@960655 13f79535-47bb-0310-9956-ffa450edef68",2010-07-05 18:20:22,Patrick D. Hunt,Not TDD
8953aabcb954bcd8f6827d450f70b77e2a6e81ca,"ZOOKEEPER-719. Add throttling to BookKeeper client


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@962693 13f79535-47bb-0310-9956-ffa450edef68",2010-07-09 20:53:36,Benjamin Reed,Not TDD
29ccd07f651c101d4f6b6de6c9d185da0ab5944d,"ZOOKEEPER-712. Bookie recovery.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@962697 13f79535-47bb-0310-9956-ffa450edef68",2010-07-09 21:17:57,Benjamin Reed,Not TDD
2dc07d7eca5da3e3ab4f7e33789a545db01177fd,"ZOOKEEPER-799. Add tools and recipes for monitoring as a contrib

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@963957 13f79535-47bb-0310-9956-ffa450edef68",2010-07-14 06:39:32,Patrick D. Hunt,Mixed
debd8a0368f8c81af33691c9d402990bb0976fd5,"ZOOKEEPER-790. Last processed zxid set prematurely while establishing leadership (fpj via breed)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@966960 13f79535-47bb-0310-9956-ffa450edef68",2010-07-23 04:22:27,Benjamin Reed,Mixed
957b54a6a0f0b221ef463cf856d2f8d8e0095be2,"ZOOKEEPER-821. Add ZooKeeper version information to zkpython (Rich Schumacher via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@979461 13f79535-47bb-0310-9956-ffa450edef68",2010-07-26 21:48:47,Mahadev Konar,Not TDD
fc6b7c0357344a80a038b8e8c55fce95b1af0214,"ZOOKEEPER-814. monitoring scripts are missing apache license headers (andrei savu via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@979464 13f79535-47bb-0310-9956-ffa450edef68",2010-07-26 22:00:07,Mahadev Konar,Mixed
2678baf5c1e0789d3acead9e91ac7f64e70d7e48,"ZOOKEEPER-790.  Last processed zxid set prematurely while establishing leadership (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@980576 13f79535-47bb-0310-9956-ffa450edef68",2010-07-29 21:10:36,Mahadev Konar,Mixed
b95f1ca96a76ec848519cd9d58b9ea35f8d75a25,"ZOOKEEPER-795. eventThread isn't shutdown after a connection ""session expired"" event coming (Sergey Doroshenko and Ben via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@982485 13f79535-47bb-0310-9956-ffa450edef68",2010-08-05 07:09:02,Mahadev Konar,Not TDD
b4337499e5c2864adcade4fbdab77cef93dad1b1,"ZOOKEEPER-809. Improved REST Interface

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@986215 13f79535-47bb-0310-9956-ffa450edef68",2010-08-17 07:24:09,Patrick D. Hunt,Mixed
09165ab0f7d7992bcf8cc43b734d91c728e42bad,"ZOOKEEPER-808. Web-based Administrative Interface

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@986569 13f79535-47bb-0310-9956-ffa450edef68",2010-08-18 05:47:51,Patrick D. Hunt,Not TDD
30cff66e5efe6b99b7e7a2293061f0eea0def02f,"ZOOKEEPER-733. use netty to handle client connections

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@986575 13f79535-47bb-0310-9956-ffa450edef68",2010-08-18 06:24:08,Patrick D. Hunt,Mixed
c16f5b46bc8ab67fd66d789bddfe5eb092542ea6,"ZOOKEEPER-775. A large scale pub/sub system (Erwin, Ivan and Ben via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@987314 13f79535-47bb-0310-9956-ffa450edef68",2010-08-19 21:25:13,Mahadev Konar,Mixed
a4f6dc7cbc951b9520347a773c09d60721b1cab0,"ZOOKEEPER-854. BookKeeper does not compile due to changes in the ZooKeeper code (Flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@990387 13f79535-47bb-0310-9956-ffa450edef68",2010-08-28 16:10:27,Mahadev Konar,Not TDD
0850cf2fdf8ffd32b61e9b5a2b97955dcc6e8997,"ZOOKEEPER-867. ClientTest is failing on hudson - fd cleanup

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@995178 13f79535-47bb-0310-9956-ffa450edef68",2010-09-08 18:28:56,Patrick D. Hunt,Not TDD
aeee6a849dd7404d76307d60fdb2b573e51aa523,"Zookeeper 3.3.1 shouldn't infinite loop if someone creates a server.0 line (part 2)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@997096 13f79535-47bb-0310-9956-ffa450edef68",2010-09-14 21:05:43,Patrick D. Hunt,Mixed
575dcbb4ece807662af3b38fdffb6ad512025a63,"ZOOKEEPER-870. Zookeeper trunk build broken.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@997192 13f79535-47bb-0310-9956-ffa450edef68",2010-09-15 05:51:44,Patrick D. Hunt,Mixed
e1109ed7d6353fae077e81d2cdb010b570677ee3,"ZOOKEEPER-831. BookKeeper: Throttling improved for reads


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@998200 13f79535-47bb-0310-9956-ffa450edef68",2010-09-17 16:58:07,Benjamin Reed,Not TDD
b6c3c7a94bbe873afcf7e25f98344d5dcb25b2d0,"ZOOKEEPER-844. handle auth failure in java client

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1005101 13f79535-47bb-0310-9956-ffa450edef68",2010-10-06 16:14:43,Patrick D. Hunt,Not TDD
472048297814559b81251dcca98ee662ea09f14d,"ZOOKEEPER-822. Leader election taking a long time to complete

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1005123 13f79535-47bb-0310-9956-ffa450edef68",2010-10-06 17:01:53,Patrick D. Hunt,Mixed
b1d9f0a3ca379d5fbc5543bfd2c4bb875517357e,"ZOOKEEPER-864. Hedwig C++ client improvements


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1021463 13f79535-47bb-0310-9956-ffa450edef68",2010-10-11 19:00:42,Benjamin Reed,Mixed
ac85ac93af08b5292654422459d5ea4fea0373d4,"ZOOKEEPER-888: c-client / zkpython: Double free corruption on node
watcher (Austin Shoemaker via henryr)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1024358 13f79535-47bb-0310-9956-ffa450edef68",2010-10-19 18:57:02,Henry Robinson,Not TDD
51dd9c039f70da96b4a5755f372ffcdc8009824b,"ZOOKEEPER-893. ZooKeeper high cpu usage when invalid requests

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1024438 13f79535-47bb-0310-9956-ffa450edef68",2010-10-19 22:32:09,Patrick D. Hunt,Mixed
d43038a0c8b8881fb4624ef20a7b30b8511e6b24,"ZOOKEEPER-794. Callbacks are not invoked when the client is closed

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1025801 13f79535-47bb-0310-9956-ffa450edef68",2010-10-21 00:44:05,Patrick D. Hunt,Not TDD
519a45264453bf788a166d99e276869ced913daa,"ZOOKEEPER-800. zoo_add_auth returns ZOK if zookeeper handle is in ZOO_CLOSED_STATE (michi mutsuzaki via mahadev konar)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1026159 13f79535-47bb-0310-9956-ffa450edef68",2010-10-21 22:12:50,Mahadev Konar,Not TDD
8030fe25eaa4a8dc50c28f464c448575da4f9ad4,"ZOOKEEPER-904. super digest is not actually acting as a full superuser (Camille Fournier via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1027763 13f79535-47bb-0310-9956-ffa450edef68",2010-10-26 22:30:06,Mahadev Konar,Not TDD
dad9d5791ba9f8db74e9c94ae9a063a7919cf8ef,"ZOOKEEPER-907. Spurious ""KeeperErrorCode = Session moved"" messages


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1031051 13f79535-47bb-0310-9956-ffa450edef68",2010-11-04 16:01:51,Benjamin Reed,Not TDD
9ef18fd3788eb37c90888e2cd12c84251e4db1aa,"ZOOKEEPER-884. Remove LedgerSequence references from BookKeeper documentation and comments in tests


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1031433 13f79535-47bb-0310-9956-ffa450edef68",2010-11-05 05:16:46,Benjamin Reed,Not TDD
c7ab72d2dce6ab4cd8916e3e4105fadf9092a694,"ZOOKEEPER-916. Problem receiving messages from subscribed channels in c++ client


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1031453 13f79535-47bb-0310-9956-ffa450edef68",2010-11-05 06:43:56,Benjamin Reed,Not TDD
6f8b8d2383fedd6fd4d792a40f8fbe85d3a7651c,"ZOOKEEPER-926. Fork Hadoop common's test-patch.sh and modify for Zookeeper. Initial commit. Contributed by nigel.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1032881 13f79535-47bb-0310-9956-ffa450edef68",2010-11-09 07:49:00,Nigel Daley,Not TDD
cf75a4db7318ce00541da31d363ad93e04923a36,"ZOOKEEPER-926. Fork Hadoop common's test-patch.sh and modify for Zookeeper. Updated test-patch.sh and build.xml. Contributed by nigel.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1033130 13f79535-47bb-0310-9956-ffa450edef68",2010-11-09 18:15:26,Nigel Daley,Not TDD
d66faf25479ff3b0f0238fbc06458641126f5f69,"ZOOKEEPER-926. Fork Hadoop common's test-patch.sh and modify for Zookeeper. Remove unneeded params from test-patch.sh.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1033134 13f79535-47bb-0310-9956-ffa450edef68",2010-11-09 18:20:57,Nigel Daley,Not TDD
b67088488ed98f2d21dc374a5a67be622cd8e046,"ZOOKEEPER-909. Extract NIO specific code from ClientCnxn

git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1033770 13f79535-47bb-0310-9956-ffa450edef68",2010-11-10 22:36:34,Patrick D. Hunt,Not TDD
6470dc244bbb3e30162ea12e7fb7d92a6074fd9d,"ZOOKEEPER-930. Hedwig c++ client uses a non thread safe logging library


git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1035727 13f79535-47bb-0310-9956-ffa450edef68",2010-11-16 18:25:49,Benjamin Reed,Mixed
09580032cb9cdcc694d0adae9f1cb897f9a5c215,"ZOOKEEPER-900. FLE implementation should be improved to use non-blocking sockets (vishal via fpj)



git-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@1036071 13f79535-47bb-0310-9956-ffa450edef68",2010-11-17 14:59:29,Flavio Paiva Junqueira,Mixed
18c58fa390c47b74d2af7ffca7b87610568b37f5,"ZOOKEEPER-836. hostlist as string.


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1040752 13f79535-47bb-0310-9956-ffa450edef68",2010-11-30 20:16:35,Benjamin Reed,Mixed
0e604b1006d0edc079004639e63477a800f2f9f5,"ZOOKEEPER-913. Version parser fails to parse ""3.3.2-dev"" from build.xml


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1043627 13f79535-47bb-0310-9956-ffa450edef68",2010-12-08 19:29:34,Benjamin Reed,Mixed
2a6f177a50c84b7998fa831db1ee54a2f6e2349a,"ZOOKEEPER-882. Startup loads last transaction from snapshot (jared via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1052244 13f79535-47bb-0310-9956-ffa450edef68",2010-12-23 12:42:42,Flavio Paiva Junqueira,Not TDD
53e4a8c971b5bbc09c86836dee3183a92251652b,"ZOOKEEPER-921. zkPython incorrectly checks for existence of required ACL elements (Nicholas Knight via henryr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1053490 13f79535-47bb-0310-9956-ffa450edef68",2010-12-29 00:30:01,Henry Robinson,Not TDD
2bf093ec150923624dd7a042d8d9459d589b1ef3,"ZOOKEEPER-962. leader/follower coherence issue when follower is receiving a DIFF


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1062244 13f79535-47bb-0310-9956-ffa450edef68",2011-01-22 19:38:57,Benjamin Reed,Not TDD
4bbdfaf41ee86b55eb19073d1ec848eda1377290,"ZOOKEEPER-902. Fix findbug issue in trunk ""Malicious code vulnerability""

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1068067 13f79535-47bb-0310-9956-ffa450edef68",2011-02-07 19:26:47,Patrick D. Hunt,Not TDD
02e2b883169869522716d591c3a3c9042f074272,"ZOOKEEPER-465. Ledger size in bytes. (flavio via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1069039 13f79535-47bb-0310-9956-ffa450edef68",2011-02-09 19:15:26,Mahadev Konar,Mixed
575c53253bf9f548f342c3371d05bc00d2c2363d,"ZOOKEEPER-985. Test BookieRecoveryTest fails on trunk. (fpj via breed)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1072085 13f79535-47bb-0310-9956-ffa450edef68",2011-02-18 17:54:48,Benjamin Reed,Not TDD
858e308a70a831bcd6e131bae7d72449ec8ee7f8,"ZOOKEEPER-880. QuorumCnxManager$SendWorker grows without bounds


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1082260 13f79535-47bb-0310-9956-ffa450edef68",2011-03-16 18:49:18,Benjamin Reed,Mixed
772297c640f2156c2e61a32f9ce0da1ae824c651,"ZOOKEEPER-1020. Implement function in C client to determine which host you're currently connected to.


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1082362 13f79535-47bb-0310-9956-ffa450edef68",2011-03-17 01:00:44,Benjamin Reed,Not TDD
7faeaa12f4da8dd076e1b7ac2e2c9ce288936e58,"ZOOKEEPER-1038. Move bookkeeper and hedwig code in subversion


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1087133 13f79535-47bb-0310-9956-ffa450edef68",2011-03-30 23:28:20,Benjamin Reed,Mixed
b1dc6a62d4c2fd1144725ed0cb8d7412bbd5de87,"ZOOKEEPER-1018. The connection permutation in get_addrs uses a weak and inefficient shuffle


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1088792 13f79535-47bb-0310-9956-ffa450edef68",2011-04-04 21:06:27,Benjamin Reed,Not TDD
c1eab643af684a89b2ce957f60913c7710f7cf8e,"ZOOKEEPER-1028. In python bindings, zookeeper.set2() should return a stat dict but instead returns None. (Chris Medaglia and Ivan Kelly via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1089617 13f79535-47bb-0310-9956-ffa450edef68",2011-04-06 20:20:32,Mahadev Konar,Not TDD
53a3d5530bd337625374396199ab985e115025ed,"ZOOKEEPER-850: Switch from log4j to slf4j (Olaf Krische via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1091314 13f79535-47bb-0310-9956-ffa450edef68",2011-04-12 07:14:07,Michi Mutsuzaki,Mixed
b5116d920d3a5bac42b1ba08aa5cef4a31801ebf,"ZOOKEEPER-874. FileTxnSnapLog.restore does not call listener (diogo via fpj)




git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1091841 13f79535-47bb-0310-9956-ffa450edef68",2011-04-13 16:10:02,Flavio Paiva Junqueira,Not TDD
2be6b4dc25b55d86d15a68519a8b19630feaa4de,"ZOOKEEPER-975. new peer goes in LEADING state even if ensemble is online. (vishal via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1097865 13f79535-47bb-0310-9956-ffa450edef68",2011-04-29 16:12:44,Flavio Paiva Junqueira,Mixed
7f64942ba8e5ce00948f6e7b23271de0556b668f,"ZOOKEEPER-1059. stat command isses on non-existing node causes NPE. (Bhallamudi Kamesh via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1103811 13f79535-47bb-0310-9956-ffa450edef68",2011-05-16 17:39:01,Mahadev Konar,Mixed
a2763e3cf5cca5301aa8eac25dfb61c9501e4724,"ZOOKEEPER-784. Server-side functionality for read-only mode (Sergey Doroshenko via henryr) - add missing files

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1125179 13f79535-47bb-0310-9956-ffa450edef68",2011-05-19 23:24:52,Henry Robinson,Not TDD
a4414196b310dbe62ee9e6e7e0c2a91fcd85c465,"ZOOKEEPER-1046: Creating a new sequential node results in a ZNODEEXISTS error

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1125581 13f79535-47bb-0310-9956-ffa450edef68",2011-05-20 22:43:41,Camille Fournier,Mixed
b916b3bbb643d6de07b962452685b8c5929f84b6,"ZOOKEEPER-1069: Calling shutdown() on a QuorumPeer too quickly can lead to a corrupt log

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1132489 13f79535-47bb-0310-9956-ffa450edef68",2011-06-05 20:54:36,Camille Fournier,Not TDD
776db7808e27624aa125f1314b7fbb2196837507,"ZOOKEEPER-335. zookeeper servers should commit the new leader txn to their logs.
ZOOKEEPER-1081. modify leader/follower code to correctly deal with new leader
ZOOKEEPER-1082. modify leader election to correctly take into account current epoch


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1135382 13f79535-47bb-0310-9956-ffa450edef68",2011-06-14 05:14:05,Benjamin Reed,Not TDD
68a133174bfffa25940a0289d49bd272f7b4498d,"ZOOKEEPER-1060. QuorumPeer takes a long time to shutdown (Vishal via fpj)




git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1135515 13f79535-47bb-0310-9956-ffa450edef68",2011-06-14 12:11:55,Flavio Paiva Junqueira,Not TDD
1538d107efb36b9f39617d33e883260c1a7e2027,"ZOOKEEPER-1094. Small improvements to LeaderElection and Vote classes


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1136740 13f79535-47bb-0310-9956-ffa450edef68",2011-06-16 23:34:30,Benjamin Reed,Not TDD
d5036dad6041cc0d12d3e2d1d1c49a29c4f731e0,"ZOOKEEPER-1087. ForceSync VM arguement not working when set to ""no""


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1137864 13f79535-47bb-0310-9956-ffa450edef68",2011-06-21 05:34:08,Benjamin Reed,Not TDD
556d062eb7351661acf2aac0f158278247fcc44d,"ZOOKEEPER-1103. In QuorumTest, use the same ""for ( .. try { break } catch { } )"" pattern in testFollowersStartAfterLeaders as in testSessionMove. (Eugene Koontz via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1138213 13f79535-47bb-0310-9956-ffa450edef68",2011-06-21 22:19:04,Patrick D. Hunt,Not TDD
eb51de49f723542a17e722fa817d81605a04c74c,"ZOOKEEPER-1046: Creating a new sequential node results in a ZNODEEXISTS error

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1138957 13f79535-47bb-0310-9956-ffa450edef68",2011-06-23 16:01:47,Camille Fournier,Mixed
80fac0914a891ae495ec79bd32f5606f12365403,"ZOOKEEPER-1097. Quota is not correctly rehydrated on snapshot reload (camille via henryr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1139494 13f79535-47bb-0310-9956-ffa450edef68",2011-06-25 06:13:03,Henry Robinson,Not TDD
0b3d1c6a7b46961e1fc501d66fb52173935306a1,"ZOOKEEPER-965. Need a multi-update command to allow multiple znodes to be updated safely


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1141746 13f79535-47bb-0310-9956-ffa450edef68",2011-06-30 22:53:28,Benjamin Reed,Mixed
6b46e50d8672f2d845911261d6326e4c6242686e,"ZOOKEEPER-1095. Simple leader election recipe (Eric Sammer via henry and phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1144087 13f79535-47bb-0310-9956-ffa450edef68",2011-07-07 22:55:07,Patrick D. Hunt,Mixed
aee36f4d55c093f263547486b1579cba8668eb2a,"ZOOKEEPER-1046: Creating a new sequential node results in a ZNODEEXISTS error

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1146025 13f79535-47bb-0310-9956-ffa450edef68",2011-07-13 13:48:01,Camille Fournier,Mixed
839ecef3ba74e2119dbd177795214d3ae1045bb2,"ZOOKEEPER-1124. Multiop submitted to non-leader always fails due to timeout


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1146961 13f79535-47bb-0310-9956-ffa450edef68",2011-07-15 04:50:24,Benjamin Reed,Not TDD
82eeb94d131cda3018a5179b27d24ea906e0c57e,"ZOOKEEPER-1027. chroot not transparent in zoo_create() (Thijs Terlouw via  mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1150802 13f79535-47bb-0310-9956-ffa450edef68",2011-07-25 17:45:00,Mahadev Konar,Not TDD
6f07f77e16bb3dd48146b9df2b8a5ca429f075b3,"ZOOKEEPER-1090. Race condition while taking snapshot can lead to not restoring data tree correctly.


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1151738 13f79535-47bb-0310-9956-ffa450edef68",2011-07-28 05:49:59,Benjamin Reed,Not TDD
a31d530327851acb231a6bf67e63ae4a8a61c3ad,"ZOOKEEPER-1138. release audit failing for a number of new files. (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1152018 13f79535-47bb-0310-9956-ffa450edef68",2011-07-28 22:02:18,Mahadev Konar,Not TDD
06e55faf96236117930667cfa9bfec26aeefcaaf,"ZOOKEEPER-1076. some quorum tests are unnecessarily extending QuorumBase (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1152141 13f79535-47bb-0310-9956-ffa450edef68",2011-07-29 08:14:59,Mahadev Konar,Not TDD
8eeefcf274c2628633ba6d67f383996afcf5712c,"ZOOKEEPER-1142. incorrect stat output (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1156497 13f79535-47bb-0310-9956-ffa450edef68",2011-08-11 06:00:21,Mahadev Konar,Not TDD
da88e47f755f745f353d81e54162e6ce151e7b37,"ZOOKEEPER-839. deleteRecursive does not belong to the other methods. (mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1157559 13f79535-47bb-0310-9956-ffa450edef68",2011-08-14 16:40:03,Mahadev Konar,Mixed
1d1bac2a715aa13cda6d14d0544bae7f7e00f3e2,"ZOOKEEPER-1055. check for duplicate ACLs in addACL() and create(). (Eugene Koontz via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1157685 13f79535-47bb-0310-9956-ffa450edef68",2011-08-15 00:35:18,Mahadev Konar,Not TDD
530c9d96956c4855c57ddf71c7b6aa76b188fc5e,"ZOOKEEPER-1141. zkpython fails tests under python 2.4. (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1157686 13f79535-47bb-0310-9956-ffa450edef68",2011-08-15 00:39:11,Mahadev Konar,Not TDD
4367c01fd1bf0c6b14a7093b52cc4b79844c06e3,"ZOOKEEPER-1104. CLONE - In QuorumTest, use the same ""for ( .. try { break } catch { } )"" pattern in testFollowersStartAfterLeaders as in testSessionMove. (Eugene Koontz via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1157690 13f79535-47bb-0310-9956-ffa450edef68",2011-08-15 00:54:09,Mahadev Konar,Not TDD
b9b1adb37f49477fe2c7c50cd672f3adb1f67c4d,"ZOOKEEPER-1025: zkCli is overly sensitive to to spaces. (Laxman via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1159389 13f79535-47bb-0310-9956-ffa450edef68",2011-08-18 20:05:25,Camille Fournier,Mixed
f650291795d66491b326856bb7b987b0afd33d02,"ZOOKEEPER-938. Support Kerberos authentication of clients. (Eugene Koontz via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1159432 13f79535-47bb-0310-9956-ffa450edef68",2011-08-18 22:05:35,Mahadev Konar,Not TDD
c17d3501c94d43aaf430216f8a6ea714890eac78,"ZOOKEEPER-1152. Exceptions thrown from handleAuthentication can cause buffer corruption issues in NIOServer.


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1159929 13f79535-47bb-0310-9956-ffa450edef68",2011-08-21 00:53:46,Benjamin Reed,Not TDD
0538ac83ae496cd4a4f29ee4dd957c8643b30e10,"ZOOKEEPER-1165. better eclipse support in tests (Warren Turkal via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1164632 13f79535-47bb-0310-9956-ffa450edef68",2011-09-02 17:02:08,Patrick D. Hunt,Not TDD
d1222313af892252ea0c056418f28f0e194e2b3f,"ZOOKEEPER-1107. automating log and snapshot cleaning (Laxman via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1164708 13f79535-47bb-0310-9956-ffa450edef68",2011-09-02 20:50:38,Patrick D. Hunt,Mixed
27d045af5c6b382fc5c787a5125f63ea730dc9bd,"ZOOKEEPER-1154, ZOOKEEPER-1156: 
Data inconsistency when the node(s) with the highest zxid is not present at the time of leader election
Log truncation truncating log too much - can cause data loss

Vishal Kathuria via camille

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1164758 13f79535-47bb-0310-9956-ffa450edef68",2011-09-02 23:07:00,Camille Fournier,Not TDD
864d055ce287e14a046c50fc2246e29b74e7f89d,"ZOOKEEPER-1160. test timeouts are too small (breed via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1165378 13f79535-47bb-0310-9956-ffa450edef68",2011-09-05 18:31:36,Patrick D. Hunt,Not TDD
a7bcf047f577949e96396588d23fde0107ff3b19,"ZOOKEEPER-1108. Various bugs in zoo_add_auth in C. (Dheeraj Agrawal via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1166970 13f79535-47bb-0310-9956-ffa450edef68",2011-09-09 02:27:19,Mahadev Konar,Mixed
e00dc11065f29e0d431f6a1d9e597d6ce8193c8a,"ZOOKEEPER-1125. Intermittent java core test failures. (Vishar Kher via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1170433 13f79535-47bb-0310-9956-ffa450edef68",2011-09-14 04:32:12,Mahadev Konar,Not TDD
d84dc077d576b7cdfbfd003e3425fab85ca29a44,"ZOOKEEPER-961. Watch recovery after disconnection when connection string contains a prefix. (Matthias Spycher via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1170438 13f79535-47bb-0310-9956-ffa450edef68",2011-09-14 05:43:56,Mahadev Konar,Not TDD
43776e4fa233eeda2bdbbb3ca4db5030d2a51a9d,"ZOOKEEPER-1136. NEW_LEADER should be queued not sent to match the Zab 1.0 protocol on the twiki (breed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1170452 13f79535-47bb-0310-9956-ffa450edef68",2011-09-14 06:56:13,Mahadev Konar,Not TDD
f31947ab7266202c5af695890fbbec5de787b3da,"ZOOKEEPER-1182. Make findbugs usable in Eclipse (Thomas Koch via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1171869 13f79535-47bb-0310-9956-ffa450edef68",2011-09-17 00:13:30,Patrick D. Hunt,Mixed
336888446c310494f1ae1e39b81dc5a60cb5576f,"ZOOKEEPER-1176. Remove dead code and basic cleanup in DataTree (Thomas Koch via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1171879 13f79535-47bb-0310-9956-ffa450edef68",2011-09-17 00:36:31,Patrick D. Hunt,Not TDD
0287aeebaec27fbe7f86365d424aac15dc2a2f17,"ZOOKEEPER-556. Startup messages should account for common error of missing leading slash in config files (Thomas Koch via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1171881 13f79535-47bb-0310-9956-ffa450edef68",2011-09-17 00:42:10,Patrick D. Hunt,Mixed
b182dd4d765e36cacc6128c417ea392285815b84,"ZOOKEEPER-1191. Synchronization issue - wait not in guarded block
ZOOKEEPER-1192. Leader.waitForEpochAck() checks waitingForNewEpoch instead of checking electionFinished


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1173949 13f79535-47bb-0310-9956-ffa450edef68",2011-09-22 05:42:19,Benjamin Reed,Not TDD
05287a9c14db8d145f61ea09ec2c61f4f0221cc6,"ZOOKEEPER-1189. For an invalid snapshot file(less than 10bytes size) RandomAccessFile stream is leaking. (Rakesh R via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1176144 13f79535-47bb-0310-9956-ffa450edef68",2011-09-27 01:05:13,Mahadev Konar,Not TDD
7e64875f9d18cb043adbddc53c73e563886942ea,"ZOOKEEPER-1185. Send AuthFailed event to client if SASL authentication fails. (Eugene Kuntz via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1176159 13f79535-47bb-0310-9956-ffa450edef68",2011-09-27 02:06:24,Mahadev Konar,Not TDD
2dfda92bd1290fe7326191b66c5b7c1db9d7e073,"ZOOKEEPER-1193. Remove upgrade code (Thomas Koch via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1186916 13f79535-47bb-0310-9956-ffa450edef68",2011-10-20 16:48:17,Patrick D. Hunt,Mixed
e04e40167ffe34472435f040f346af06e76ff760,"ZOOKEEPER-1221. Provide accessors for Request.{hdr|txn} (Thomas Koch via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1186967 13f79535-47bb-0310-9956-ffa450edef68",2011-10-20 18:02:18,Patrick D. Hunt,Not TDD
9ac5756b18d377774f49064e6e1de3f39d059b87,"ZOOKEEPER-1216. Fix more eclipse compiler warnings, also in Tests (Thomas Koch via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1188523 13f79535-47bb-0310-9956-ffa450edef68",2011-10-25 06:09:54,Patrick D. Hunt,Mixed
f8d7bafc8797b5feb737064b22ab1401aa6e94e2,"ZOOKEEPER-1254. test correct watch handling with multi ops (Thomas Koch via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1189310 13f79535-47bb-0310-9956-ffa450edef68",2011-10-26 17:00:26,Patrick D. Hunt,Not TDD
2504f4fb30c84af2b46f033f72e51c1eee86caee,"ZOOKEEPER-1220. ./zkCli.sh 'create' command is throwing ArrayIndexOutOfBoundsException (kavita sharma via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1189823 13f79535-47bb-0310-9956-ffa450edef68",2011-10-27 16:11:15,Patrick D. Hunt,Mixed
c81c577efe9046650821c77b3eeeb548899fa9b0,"ZOOKEEPER-1252. remove unused method o.a.z.test.AxyncTest.restart() (Thomas Koch via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1189841 13f79535-47bb-0310-9956-ffa450edef68",2011-10-27 16:25:58,Patrick D. Hunt,Not TDD
16a0008be217ab68ef747b4e2cc76afdcd7b3cb3,"ZOOKEEPER-1256. ClientPortBindTest is failing on Mac OS X (Daniel Gómez Ferro via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1189918 13f79535-47bb-0310-9956-ffa450edef68",2011-10-27 18:23:28,Patrick D. Hunt,Not TDD
d57806527fc3b543d3bf96240db11b15075136eb,"ZOOKEEPER-1200. Remove obsolete DataTreeBuilder (Thomas Koch via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1190043 13f79535-47bb-0310-9956-ffa450edef68",2011-10-27 21:25:49,Patrick D. Hunt,Mixed
3994a2aa08ef1f5b7de7da9ebcbe61554dac07e4,"ZOOKEEPER-1264: FollowerResyncConcurrencyTest failing intermittently (phunt via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1190358 13f79535-47bb-0310-9956-ffa450edef68",2011-10-28 14:33:29,Camille Fournier,Not TDD
466b1f019e45d477798455f669c923559f0a24fc,"ZOOKEEPER-1273. Copy'n'pasted unit test (Thomas Koch via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1195645 13f79535-47bb-0310-9956-ffa450edef68",2011-10-31 20:05:36,Patrick D. Hunt,Not TDD
aa786021bc3939ee79f8fde0a3fbcfbdeff69272,"ZOOKEEPER-1268. problems with read only mode, intermittent test failures and ERRORs in the log (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1195854 13f79535-47bb-0310-9956-ffa450edef68",2011-11-01 07:15:33,Mahadev Konar,Not TDD
50851134a2b4c79f1cd33f0064f2ab641569cdc5,"ZOOKEEPER-1246. Dead code in PrepRequestProcessor catch Exception block (camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1196025 13f79535-47bb-0310-9956-ffa450edef68",2011-11-01 14:41:41,Camille Fournier,Mixed
736e27df12ffab4139aec95207c7fef1ca114509,"ZOOKEEPER-1271. testEarlyLeaderAbandonment failing on solaris - clients not retrying connection (mahadev via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1196819 13f79535-47bb-0310-9956-ffa450edef68",2011-11-02 21:53:46,Patrick D. Hunt,Not TDD
73674f77cc30b9b0ed36f0032193362363c54bdd,"ZOOKEEPER-1270. testEarlyLeaderAbandonment failing intermittently, quorum formed, no serving. (Flavio, Camille and Alexander Shraer via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1197891 13f79535-47bb-0310-9956-ffa450edef68",2011-11-05 06:29:01,Mahadev Konar,Not TDD
f8f15de5fe447409a2987262b8e878be224dab25,"ZOOKEEPER-1264. FollowerResyncConcurrencyTest failing intermittently.
ZOOKEEPER-1282. Learner.java not following Zab 1.0 protocol - setCurrentEpoch should be done upon receipt of NEWLEADER (before acking it) and not upon receipt of UPTODATE.
ZOOKEEPER-1291. AcceptedEpoch not updated at leader before it proposes the epoch to followers.


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1198053 13f79535-47bb-0310-9956-ffa450edef68",2011-11-05 20:57:13,Camille Fournier,Not TDD
fa9e821e91d5c007593f830dcc4553a3f05b1038,"ZOOKEEPER-1208. Ephemeral node not removed after the client session is long gone. (phunt via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1201832 13f79535-47bb-0310-9956-ffa450edef68",2011-11-14 19:18:39,Camille Fournier,Mixed
9553f94271ee3debdf431b33f669f4feade30126,"ZOOKEEPER-1305. zookeeper.c:prepend_string func can dereference null ptr. (Daniel Lescohier via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1212153 13f79535-47bb-0310-9956-ffa450edef68",2011-12-08 21:58:28,Mahadev Konar,Not TDD
22e2d238cdae7ff77ae69bcad3876d2f0fd3dd84,"ZOOKEEPER-1319. Missing data after restarting+expanding a cluster. (phunt and breed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1212578 13f79535-47bb-0310-9956-ffa450edef68",2011-12-09 19:03:26,Mahadev Konar,Not TDD
e44601d1249ea70b5bfa514082c714640c6217dd,"ZOOKEEPER-1269. Multi deserialization issues. (Camille Fournier via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1212663 13f79535-47bb-0310-9956-ffa450edef68",2011-12-09 22:15:30,Mahadev Konar,Not TDD
c85f61aee240e03fdebb31ce094f5b7c07619e34,"ZOOKEEPER-1333. NPE in FileTxnSnapLog when restarting a cluster. (Patrick Hunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1221868 13f79535-47bb-0310-9956-ffa450edef68",2011-12-21 20:39:33,Mahadev Konar,Not TDD
aa52c5de1f5f72eb95d5cc3472a82cc4bd0b6354,"ZOOKEEPER-1292. FLETest is flaky


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1222816 13f79535-47bb-0310-9956-ffa450edef68",2011-12-23 19:46:53,Benjamin Reed,Not TDD
85da85be5383777dbd3fc76fa24a95cd6290d024,"ZOOKEEPER-1326. The CLI commands ""delete"" and ""rmr"" are confusing. Can we have ""rm"" + ""rmr"" instead? (Harsh J via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1225052 13f79535-47bb-0310-9956-ffa450edef68",2011-12-27 23:53:31,Patrick D. Hunt,Mixed
00a6861f922b55cbfeec3eb928be2b57ddf99780,"ZOOKEEPER-1089. zkServer.sh status does not work due to invalid option of nc (Roman Shaposhnik via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1225108 13f79535-47bb-0310-9956-ffa450edef68",2011-12-28 06:07:19,Patrick D. Hunt,Not TDD
6c4b747ea51561d251b3ae9e66276fc7d41bc81c,"ZOOKEEPER-1321: Add number of client connections metric in JMX and srvr (Neha Narkhede via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1225200 13f79535-47bb-0310-9956-ffa450edef68",2011-12-28 14:55:37,Camille Fournier,Not TDD
c95a66de524739896f96e6e69c3ae26577ef922d,"revert ZOOKEEPER-1321

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1225352 13f79535-47bb-0310-9956-ffa450edef68",2011-12-28 21:44:09,Camille Fournier,Not TDD
1a556bd13b9a1e250ec2279fb3ba92dc9ba2d69c,"ZOOKEEPER-1343. getEpochToPropose should check if lastAcceptedEpoch is greater or equal than epoch


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1227000 13f79535-47bb-0310-9956-ffa450edef68",2012-01-04 00:15:03,Benjamin Reed,Not TDD
820f3e6dc2aaa6a15c307368e127c0a5dd8fc555,"ZOOKEEPER-1293. Remove unused readyToStart from Leader.java (Alex Shraer via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1227927 13f79535-47bb-0310-9956-ffa450edef68",2012-01-06 01:32:58,Patrick D. Hunt,Not TDD
06f28609b0c6b206d3b5dcb48895aad98607ddce,"ZOOKEEPER-1294. One of the zookeeper server is not accepting any requests (Kavita Sharma via henryr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1231389 13f79535-47bb-0310-9956-ffa450edef68",2012-01-13 23:28:41,Henry Robinson,Not TDD
d4b27432c8e474218c06ae62d7e1285b0cd4e9ad,"ZOOKEEPER-1358. In StaticHostProviderTest.java, testNextDoesNotSleepForZero tests that hostProvider.next(0) doesn't sleep by checking that the latency of this call is less than 10sec (Alex Shraer via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1231806 13f79535-47bb-0310-9956-ffa450edef68",2012-01-16 02:19:01,Camille Fournier,Not TDD
4ccd368e4fd6982c73b3c18c5eb27d63cc9608d0,"ZOOKEEPER-1351. invalid test verification in MultiTransactionTest (phunt via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1231809 13f79535-47bb-0310-9956-ffa450edef68",2012-01-16 02:32:16,Camille Fournier,Not TDD
73af50a8a91cee9d3d95a373df7ecb12825f5545,"ZOOKEEPER-1367. Data inconsistencies and unexpired ephemeral nodes after cluster restart. (Benjamin Reed via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1238176 13f79535-47bb-0310-9956-ffa450edef68",2012-01-31 06:45:45,Mahadev Konar,Mixed
676fde7642711bc729e0dd00e644f9d6659db97e,"ZOOKEEPER-1353. C client test suite fails consistently. (Clint Byrum via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1240905 13f79535-47bb-0310-9956-ffa450edef68",2012-02-06 07:38:21,Mahadev Konar,Not TDD
f910c936e37505a31ed8c140daa5bbee448c444f,"ZOOKEEPER-1373. Hardcoded SASL login context name clashes with Hadoop security  configuration override. (Eugene Koontz and Thomas Weise via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1240918 13f79535-47bb-0310-9956-ffa450edef68",2012-02-06 08:34:22,Mahadev Konar,Not TDD
97bdb8e94963857be25fd69eada9212c2d6f19d1,"ZOOKEEPER-1352. server.InvalidSnapshotTest is using connection timeouts that are too short. (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1240924 13f79535-47bb-0310-9956-ffa450edef68",2012-02-06 08:47:42,Mahadev Konar,Not TDD
fad4d0ac5221715942304bae0d2ff63cd9bd7afe,"ZOOKEEPER-1337. multi's ""Transaction"" class is missing tests. (camille and phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1240954 13f79535-47bb-0310-9956-ffa450edef68",2012-02-06 09:58:27,Mahadev Konar,Not TDD
e657907115bc2bb53c72e7c696ff949e1db21a02,"ZOOKEEPER-1338. class cast exceptions may be thrown by multi ErrorResult class (invalid equals) (phunt via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1240959 13f79535-47bb-0310-9956-ffa450edef68",2012-02-06 10:13:40,Mahadev Konar,Not TDD
78a36341311f7846d3e78ef748e52fcf9b484114,"ZOOKEEPER-1321. Add number of client connections metric in JMX and srvr. (Neha N. via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1242982 13f79535-47bb-0310-9956-ffa450edef68",2012-02-10 23:34:18,Camille Fournier,Not TDD
257a00aa97cd21c967ad620c3119a86295f1b794,"ZOOKEEPER-1361. Leader.lead iterates over 'learners' set without proper synchronisation (henryr via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1294000 13f79535-47bb-0310-9956-ffa450edef68",2012-02-27 02:41:47,Camille Fournier,Mixed
2ea71df8c6ccc80b3c72c49bc7a180c7485cf854,"ZOOKEEPER-1354: AuthTest.testBadAuthThenSendOtherCommands fails intermittently (phunt via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1296035 13f79535-47bb-0310-9956-ffa450edef68",2012-03-02 02:44:20,Camille Fournier,Not TDD
0ddcea51e8107dee09107d4c09fe049a9ecb5733,"ZOOKEEPER-1161. Provide an option for disabling auto-creation of the data directory (phunt via henry)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1297377 13f79535-47bb-0310-9956-ffa450edef68",2012-03-06 08:20:49,Henry Robinson,Not TDD
ed6fe28fcf23df95009c61b5ed670fa4e6d1d65a,"ZOOKEEPER-1161. Adding missing scripts from last commit

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1297740 13f79535-47bb-0310-9956-ffa450edef68",2012-03-06 21:48:37,Henry Robinson,Not TDD
297517b5e1461400039aa7c4fdbbd246183a133f,"ZOOKEEPER-1277. servers stop serving when lower 32bits of zxid roll over (phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1301079 13f79535-47bb-0310-9956-ffa450edef68",2012-03-15 16:47:29,Patrick D. Hunt,Not TDD
655b2e3f0a047d6b6db9e4cdb581a84a54f5366c,"ZOOKEEPER-1412. java client watches inconsistently triggered on reconnect (phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1301089 13f79535-47bb-0310-9956-ffa450edef68",2012-03-15 17:01:09,Patrick D. Hunt,Not TDD
cbe58afeeccca6acd532968ddb32833ed65021b8,"ZOOKEEPER-1344. ZooKeeper client multi-update command is not considering the Chroot request (Rakesh R via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1301837 13f79535-47bb-0310-9956-ffa450edef68",2012-03-17 00:31:16,Patrick D. Hunt,Not TDD
9ab32ca0dfe9ba49a26c08560d39d444fd775e4a,"ZOOKEEPER-1307. zkCli.sh is exiting when an Invalid ACL exception is thrown from setACL command through client (Kavita Sharma via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1301840 13f79535-47bb-0310-9956-ffa450edef68",2012-03-17 00:39:16,Patrick D. Hunt,Mixed
ddd1481372d49988289f5032777885ae5910b157,"ZOOKEEPER-271. Better command line parsing in ZookeeperMain. (Hartmut Lang via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1302068 13f79535-47bb-0310-9956-ffa450edef68",2012-03-18 06:03:05,Patrick D. Hunt,Mixed
bc38ec61b24cca95757ce31bd37e76919a3d04c2,"ZOOKEEPER-1377. add support for dumping a snapshot file content (similar to LogFormatter) (phunt via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1302213 13f79535-47bb-0310-9956-ffa450edef68",2012-03-18 20:06:46,Camille Fournier,Not TDD
e5a51ead53813843ad8b9448845fd2332757c757,"ZOOKEEPER-1419. Leader election never settles for a 5-node cluster (flavio via camille)
  

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1302736 13f79535-47bb-0310-9956-ffa450edef68",2012-03-20 00:33:49,Camille Fournier,Not TDD
def8600ac25832c72cbf54da2149b11191b5dcc6,"ZOOKEEPER-1433. improve ZxidRolloverTest (test seems flakey) (phunt via henryr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1307191 13f79535-47bb-0310-9956-ffa450edef68",2012-03-30 01:05:18,Henry Robinson,Not TDD
7bf199eb4df4537adca112c7962e200a87d2666d,"ZOOKEEPER-1411. Consolidate membership management, distinguish between static and dynamic configuration parameters


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1328991 13f79535-47bb-0310-9956-ffa450edef68",2012-04-22 23:20:13,Benjamin Reed,Mixed
72d9f30dca729058f645dc027b16c767abc0f479,"ZOOKEEPER-1465. Cluster availability following new leader election 
    takes a long time with large datasets - is correlated to dataset size
    (fpj and Thawan Kooburat via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1357711 13f79535-47bb-0310-9956-ffa450edef68",2012-07-05 16:01:26,Camille Fournier,Not TDD
e2ad1053563537bd815dad63482b61bd34d5143d,"ZOOKEEPER-1427. Writing to local files is done non-atomically (phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1362656 13f79535-47bb-0310-9956-ffa450edef68",2012-07-17 21:19:38,Patrick D. Hunt,Mixed
43eedab16b074f7b87da98ac0af60092bb0c52fd,"ZOOKEEPER-1489. Data loss after truncate on transaction log (phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1362660 13f79535-47bb-0310-9956-ffa450edef68",2012-07-17 21:25:11,Patrick D. Hunt,Not TDD
0679a863ae20345c3b928743a9b42dfbf14a0738,"ZOOKEEPER-1522. intermittent failures in Zab test due to NPE in recursiveDelete test function (phunt via flavio)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1368072 13f79535-47bb-0310-9956-ffa450edef68",2012-08-01 15:53:36,Patrick D. Hunt,Not TDD
13e537edc65866cb019db72c89414537d9d28258,"ZOOKEEPER-1503. remove redundant JAAS configuration code in SaslAuthTest and SaslAuthFailTest ((Eugene Koontz via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1368203 13f79535-47bb-0310-9956-ffa450edef68",2012-08-01 19:21:11,Patrick D. Hunt,Not TDD
6b79710224533848b99c2a0297591d29c06583a0,"ZOOKEEPER-1514. FastLeaderElection - leader ignores the round information when joining a quorum (flavio via henryr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1368737 13f79535-47bb-0310-9956-ffa450edef68",2012-08-02 22:17:58,Henry Robinson,Not TDD
fe34bbf0117245bc99f5dd2fbfba2fa694e14ad6,"ZOOKEEPER-1497. Allow server-side SASL login with JAAS configuration to be programmatically set (rather than only by reading JAAS configuration file) (Matteo Bertozzi via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1378285 13f79535-47bb-0310-9956-ffa450edef68",2012-08-28 19:51:43,Patrick D. Hunt,Not TDD
b962fb16c797dce7db8a08ad0344eee999563a44,"ZOOKEEPER-1328. Misplaced assertion for the test case 'FLELostMessageTest' and not identifying misfunctions. (Rakesh R via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1380130 13f79535-47bb-0310-9956-ffa450edef68",2012-09-03 05:56:41,Mahadev Konar,Not TDD
987635edac8aa374a04ea130dfd81a03a635bf0d,"ZOOKEEPER-1437. Client uses session before SASL authentication complete (Eugene Koontz via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1382555 13f79535-47bb-0310-9956-ffa450edef68",2012-09-09 18:24:07,Mahadev Konar,Not TDD
139d1d9c4b78424708b01f239211ed83e9279fc6,"ZOOKEEPER-1496. Ephemeral node not getting cleared even after client has exited. (Rakesh R via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1386496 13f79535-47bb-0310-9956-ffa450edef68",2012-09-17 07:53:10,Mahadev Konar,Mixed
0b62693cc5f86fc64ecbecebc419f2dd5fc37fdb,"ZOOKEEPER-1540. ZOOKEEPER-1411 breaks backwards compatibility (Andrew Ferguson via breed)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1389711 13f79535-47bb-0310-9956-ffa450edef68",2012-09-25 05:13:27,Benjamin Reed,Not TDD
8c6155afb6df604ff59fa4e4148a809c0740d3b6,"ZOOKEEPER-1550. ZooKeeperSaslClient does not finish anonymous login on OpenJDK (Eugene Koontz via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1391526 13f79535-47bb-0310-9956-ffa450edef68",2012-09-28 16:32:19,Mahadev Konar,Not TDD
ed622598737b8e8d374a4a883ccd9a966377dbff,"ZOOKEEPER-1355. Add zk.updateServerList(newServerList) (Alex Shraer, Marshall McMullen via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1410731 13f79535-47bb-0310-9956-ffa450edef68",2012-11-17 14:03:03,Flavio Paiva Junqueira,Mixed
395b5effc712bb8d960ab0f2c2ee6f6fdb47140c,"ZOOKEEPER-1474. Cannot build Zookeeper with IBM Java: use of Sun MXBean classes (Adalberto Medeiros via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1414566 13f79535-47bb-0310-9956-ffa450edef68",2012-11-28 07:43:26,Patrick D. Hunt,Mixed
e8d3e1d74eab7234d5a31e1201819b8686bf4499,"ZOOKEEPER-1505. Multi-thread CommitProcessor (Jay Shrauner via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1418555 13f79535-47bb-0310-9956-ffa450edef68",2012-12-07 23:38:00,Patrick D. Hunt,Mixed
6c81ec754e6ca43adee1c74db09c1131029759d0,"ZOOKEEPER-1564. Allow JUnit test build with IBM Java (Paulo Ricardo Paz Vital via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1420021 13f79535-47bb-0310-9956-ffa450edef68",2012-12-11 07:42:37,Patrick D. Hunt,Mixed
8052a710bb3373adb5777e3f19037b0ee8c05608,"ZOOKEEPER-1596. Zab1_0Test should ensure that the file is closed (Enis Soztutar via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1420028 13f79535-47bb-0310-9956-ffa450edef68",2012-12-11 08:18:08,Patrick D. Hunt,Not TDD
df984c4c438971f1fea05d9d1cb00742c0eb64e7,"ZOOKEEPER-1513. ""Unreasonable length"" exception while starting a server (Skye W-M via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1420538 13f79535-47bb-0310-9956-ffa450edef68",2012-12-12 06:46:25,Patrick D. Hunt,Not TDD
4ed40f05a649783c855b63d09a1b485eff2b9555,"ZOOKEEPER-1598. Ability to support more digits in the version string (Raja Aluri via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1420547 13f79535-47bb-0310-9956-ffa450edef68",2012-12-12 07:19:53,Patrick D. Hunt,Mixed
848898ee7bdb3f9a4e4f416f7fc64417083fc498,"ZOOKEEPER-1478. Small bug in QuorumTest.testFollowersStartAfterLeader( ) (Alexander Shraer via fpj, breed, phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1421091 13f79535-47bb-0310-9956-ffa450edef68",2012-12-13 07:14:30,Patrick D. Hunt,Not TDD
c84f7ef14542dc1d3291e932932e6b6faf536944,"ZOOKEEPER-1387. Wrong epoch file created (Benjamin Busjaeger via breed, phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1421098 13f79535-47bb-0310-9956-ffa450edef68",2012-12-13 07:25:35,Patrick D. Hunt,Not TDD
e4d07112a6f1f68a6866a27e6bfec9b4e415c743,"ZOOKEEPER-1578. org.apache.zookeeper.server.quorum.Zab1_0Test failed due to  hard code with 33556 port. (Li Ping via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1422772 13f79535-47bb-0310-9956-ffa450edef68",2012-12-17 07:12:29,Mahadev Konar,Not TDD
6206b495e0c7a8ff3bb7a30cbddf2dd8f02f6dfc,"ZOOKEEPER-1504. Multi-thread NIOServerCnxn (Jay Shrauner via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1423990 13f79535-47bb-0310-9956-ffa450edef68",2012-12-19 18:07:14,Patrick D. Hunt,Mixed
97a8c5be83c4468cd67fa412b715cbb4f312885e,"ZOOKEEPER-1297. Add stat information to create() call (Lenni Kuff via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1423996 13f79535-47bb-0310-9956-ffa450edef68",2012-12-19 18:16:50,Patrick D. Hunt,Mixed
dbde0aea20707b945b8852e91a69fe3ff116859f,"ZOOKEEPER-1603. StaticHostProviderTest testUpdateClientMigrateOrNot hangs (Alexander Shraer via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1424336 13f79535-47bb-0310-9956-ffa450edef68",2012-12-20 05:50:19,Patrick D. Hunt,Mixed
21ef61aa9663284e1e8fa82974514c8e84265ae2,"ZOOKEEPER-1324. Remove Duplicate NEWLEADER packets from the Leader to the Follower. (thawan via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1433651 13f79535-47bb-0310-9956-ffa450edef68",2013-01-15 21:13:28,Flavio Paiva Junqueira,Not TDD
9531ec29f4806a1f127e3f02d2333a64090058e4,"Reverting previous commit and going back to revision 1427034.



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1434978 13f79535-47bb-0310-9956-ffa450edef68",2013-01-18 00:08:53,Flavio Paiva Junqueira,Not TDD
bb857582bab316abea48588375df98de51df9115,"ZOOKEEPER-1495. ZK client hangs when using a function not available on the server. (Skye W-M via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1438288 13f79535-47bb-0310-9956-ffa450edef68",2013-01-25 01:17:38,Patrick D. Hunt,Not TDD
620c7766fc99230460a248ba1aa1e17b772c418a,"ZOOKEEPER-1620. NIOServerCnxnFactory (new code introduced in ZK-1504) opens selectors but never closes them (Thawan Kooburat via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1438348 13f79535-47bb-0310-9956-ffa450edef68",2013-01-25 06:46:16,Patrick D. Hunt,Not TDD
3d81f925c585ef252a55ab09b7f3ba838f98a797,"ZOOKEEPER-1619. Allow spaces in URL (Edward Ribeiro via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1438351 13f79535-47bb-0310-9956-ffa450edef68",2013-01-25 06:54:19,Patrick D. Hunt,Mixed
d9dae9ae9d46ef2a29c3457651a71e40969f7256,"ZOOKEEPER-1628. Documented list of allowable characters in ZK doc not in line with code (Gabriel Reid via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1438356 13f79535-47bb-0310-9956-ffa450edef68",2013-01-25 07:08:28,Patrick D. Hunt,Mixed
c35f9b0303b3b4fae62802f43707a06528013906,"ZOOKEEPER-1572. Add an async (Java) interface for multi request (Sijie Guo via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1441922 13f79535-47bb-0310-9956-ffa450edef68",2013-02-03 14:52:11,Camille Fournier,Not TDD
39783d6c8669c8917481153a06bcbfcb4db3f748,"ZOOKEEPER-1648. Fix WatcherTest in JDK7 (Thawan Kooburat via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1447613 13f79535-47bb-0310-9956-ffa450edef68",2013-02-19 07:55:19,Patrick D. Hunt,Not TDD
684549caaa2bf6c741eea713b59336dfd2e9747d,"ZOOKEEPER-1606. intermittent failures in ZkDatabaseCorruptionTest on jenkins (lixiaofeng via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1447618 13f79535-47bb-0310-9956-ffa450edef68",2013-02-19 08:18:05,Patrick D. Hunt,Not TDD
5428cd4bc963c2e653a260c458a8a8edf3fa08ef,"ZOOKEEPER-107. Allow dynamic changes to server cluster membership (Alex Shraer via breed)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1453693 13f79535-47bb-0310-9956-ffa450edef68",2013-03-07 06:01:49,Benjamin Reed,Mixed
541f601a2254a52ff601ae4f74a6a7a8ebdf64df,"ZOOKEEPER-107. Allow dynamic changes to server cluster membership, small bugfix (michi via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1455387 13f79535-47bb-0310-9956-ffa450edef68",2013-03-12 01:48:52,Camille Fournier,Not TDD
925599c72bc35edb5ffa25c6cc839932573b01aa,"ZOOKEEPER-1700. FLETest consistently failing - setLastSeenQuorumVerifier 
  seems to be hanging (phunt via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1481317 13f79535-47bb-0310-9956-ffa450edef68",2013-05-11 12:51:25,Flavio Paiva Junqueira,Not TDD
8b4520f77760b2a7d35708f556dd23a05c95c6f7,"ZOOKEEPER-1324. Remove Duplicate NEWLEADER packets 
from the Leader to the Follower. (Thawan, fpj via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1482318 13f79535-47bb-0310-9956-ffa450edef68",2013-05-14 12:27:11,Flavio Paiva Junqueira,Not TDD
37973fab29cdf4515e8e7c6898c68b9a6490b80b,"ZOOKEEPER-1400. Allow logging via callback instead of raw FILE pointer (Marshall McMullen via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1484357 13f79535-47bb-0310-9956-ffa450edef68",2013-05-19 22:08:08,Michi Mutsuzaki,Not TDD
1b66c34ea897ccd18ffe94d66778e2f208686ec9,"ZOOKEEPER-1417. investigate differences in client last zxid handling btw c and java clients (thawan via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1490358 13f79535-47bb-0310-9956-ffa450edef68",2013-06-06 16:53:06,Camille Fournier,Not TDD
9f102d311e0d68a2e0a212b1c870a6f999a128a5,"ZOOKEEPER-1413. Use on-disk transaction log for learner sync up (thawan)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1497929 13f79535-47bb-0310-9956-ffa450edef68",2013-06-28 21:22:35,Thawan Kooburat,Mixed
baa95e16a9d52fe95f347e242458d0debd14dd13,"ZOOKEEPER-1629. testTransactionLogCorruption occasionally fails. (shralex via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1503045 13f79535-47bb-0310-9956-ffa450edef68",2013-07-14 20:09:45,Camille Fournier,Not TDD
15c32d197968fe41d194ef11f665508ff39ed5d7,"ZOOKEEPER-1379. 'printwatches, redo, history and connect '. client commands always print usage. This is not necessary (edward via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1519515 13f79535-47bb-0310-9956-ffa450edef68",2013-09-02 21:04:12,Flavio Paiva Junqueira,Mixed
62dcea67c7a3d12bdb5fa014936f465fadb1e3df,"ZOOKEEPER-1448. Node+Quota creation in transaction log can crash leader startup (Botond Hejj via fpj)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1520436 13f79535-47bb-0310-9956-ffa450edef68",2013-09-05 21:50:08,Flavio Paiva Junqueira,Mixed
12878387483a4084c5a3beafbfae0172a44e5dcf,"ZOOKEEPER-1750 Race condition producing NPE in NIOServerCnxn.toString
(Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1521308 13f79535-47bb-0310-9956-ffa450edef68",2013-09-09 22:37:13,Michi Mutsuzaki,Mixed
67dd6fc9df3d33e40570095b52cd6858621c3ae0,"ZOOKEEPER-1754. Read-only server allows to create znode (Rakesh R via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1524252 13f79535-47bb-0310-9956-ffa450edef68",2013-09-17 23:14:04,Flavio Paiva Junqueira,Not TDD
885bac190a4e2cb34949fc9f3182200e95fa8d62,"ZOOKEEPER-1657. Increased CPU usage by unnecessary SASL checks (Philip K. Warren via fpj)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1524364 13f79535-47bb-0310-9956-ffa450edef68",2013-09-18 10:58:32,Flavio Paiva Junqueira,Mixed
0b3ea918139583bebec3240194ddbd41b987d486,"ZOOKEEPER-1759. Adding ability to allow READ operations for authenticated users, 
  versus keeping ACLs wide open for READ. (Yuliya Feldman via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1526219 13f79535-47bb-0310-9956-ffa450edef68",2013-09-25 16:18:03,Camille Fournier,Not TDD
72eb405829a9173966d6b29e229c56c95ace0524,"ZOOKEEPER-1096. Leader communication should listen on specified IP, not wildcard address (Jared Cantwell, German Blanco via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1526317 13f79535-47bb-0310-9956-ffa450edef68",2013-09-25 22:13:19,Flavio Paiva Junqueira,Not TDD
eb1cb72922b1e974eadb8936df965d630261bd47,"ZOOKEEPER-87. Follower does not shut itself down if its too far behind the leader. (German Blanco via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1526454 13f79535-47bb-0310-9956-ffa450edef68",2013-09-26 12:05:47,Flavio Paiva Junqueira,Mixed
6177dd957378c5420f19f7eb86dabfcf10be3ff8,"ZOOKEEPER-1759. Adding ability to allow READ operations for authenticated users, 
  versus keeping ACLs wide open for READ. (Yuliya Feldman via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1527398 13f79535-47bb-0310-9956-ffa450edef68",2013-09-29 20:24:03,Camille Fournier,Not TDD
7033e577a54e1df2a766e1cd59836c7c837e6e74,"ZOOKEEPER-1770. NullPointerException in SnapshotFormatter (Germán Blanco via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1528271 13f79535-47bb-0310-9956-ffa450edef68",2013-10-01 23:45:22,Patrick D. Hunt,Not TDD
88b11f243b4a51eba3a6b0522bc58dd4bd34f921,"ZOOKEEPER-1733. FLETest#testLE is flaky on windows boxes (Jeffrey Zhong via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1528586 13f79535-47bb-0310-9956-ffa450edef68",2013-10-02 18:19:30,Patrick D. Hunt,Not TDD
adedc7a421c723f1427cd0034953e1826587d9bb,"ZOOKEEPER-1551. Observers ignore txns that come after snapshot and UPTODATE (thawan, fpj via thawan)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1530029 13f79535-47bb-0310-9956-ffa450edef68",2013-10-07 19:08:55,Thawan Kooburat,Not TDD
28246a44ef4653515708937fc2a9c5d51baa0937,"ZOOKEEPER-1781. ZooKeeper Server fails if snapCount is set to 1 (Takashi Ohnishi via phunt, breed)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1530108 13f79535-47bb-0310-9956-ffa450edef68",2013-10-07 23:35:20,Patrick D. Hunt,Not TDD
b74c78067fc6754f3a56cff0b2b6136f0a973b11,"ZOOKEEPER-1774. QuorumPeerMainTest fails consistently with complains about host"" assertion failure (phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1530157 13f79535-47bb-0310-9956-ffa450edef68",2013-10-08 05:27:30,Patrick D. Hunt,Not TDD
19b0b8f0308d5a5bf80d91b02e7c51ea8cc4bf81,"ZOOKEEPER-877. zkpython does not work with python3.1 (Daniel Enman via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1530166 13f79535-47bb-0310-9956-ffa450edef68",2013-10-08 06:44:54,Patrick D. Hunt,Not TDD
b71191f514a2eec512f795e43a25c64d48f0e4c7,"ZOOKEEPER-1147. Add support for local sessions (Jay Shrauner, thawan via thawan)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1530781 13f79535-47bb-0310-9956-ffa450edef68",2013-10-09 20:21:55,Thawan Kooburat,Mixed
51cd9ed37bea20aeb10c8c80ad3279bbca6f5582,"ZOOKEEPER-1624. PrepRequestProcessor abort multi-operation incorrectly. (thawan via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1531061 13f79535-47bb-0310-9956-ffa450edef68",2013-10-10 18:06:17,Camille Fournier,Not TDD
418eab7b6b84ea4ea0a139bf882a50ddc88f148e,"ZOOKEEPER-1795. unable to build c client on ubuntu (Raul Gutierrez Segales via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1532152 13f79535-47bb-0310-9956-ffa450edef68",2013-10-14 23:56:53,Patrick D. Hunt,Not TDD
c6ee0139d58250ac07ddfa3692c9adec488339bf,"ZOOKEEPER-1732. ZooKeeper server unable to join established ensemble (German Blanco via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1534390 13f79535-47bb-0310-9956-ffa450edef68",2013-10-21 21:36:55,Flavio Paiva Junqueira,Not TDD
10987f3f578d8ca24140dc30c002120e992a542e,"ZOOKEEPER-1799. SaslAuthFailDesignatedClientTest.testAuth fails frequently on SUSE (Jeffrey Zhong via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1534842 13f79535-47bb-0310-9956-ffa450edef68",2013-10-22 23:15:22,Patrick D. Hunt,Not TDD
10abb60db7ca7eed540dc637ecfd638dce4edc40,"ZOOKEEPER-1557. jenkins jdk7 test failure in testBadSaslAuthNotifiesWatch (Eugene Koontz via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1535251 13f79535-47bb-0310-9956-ffa450edef68",2013-10-24 01:09:54,Patrick D. Hunt,Not TDD
4fe97763c2e765c5140071906f7f70d0727abb5d,"ZOOKEEPER-1499. clientPort config changes not backwards-compatible (Alexander Shraer via phunt, breed)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1535280 13f79535-47bb-0310-9956-ffa450edef68",2013-10-24 05:21:13,Patrick D. Hunt,Not TDD
293386c3be43fcd98754ac476385e399b426c02b,"ZOOKEEPER-1798. Fix race condition in testNormalObserverRun (thawan, fpj via thawan)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1535491 13f79535-47bb-0310-9956-ffa450edef68",2013-10-24 18:41:12,Thawan Kooburat,Not TDD
08014e67410fa8a5235e91f57ad302efeedb43a1,"ZOOKEEPER-1666. Avoid Reverse DNS lookup if the hostname in connection string is literal IP address. (George Cao via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1538853 13f79535-47bb-0310-9956-ffa450edef68",2013-11-05 02:02:37,Camille Fournier,Mixed
c56db03e686ab805821896486717123ed84e38a1,"ZOOKEEPER-1783. Distinguish initial configuration from first established configuration (shralex via breed)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1539529 13f79535-47bb-0310-9956-ffa450edef68",2013-11-07 05:41:50,Benjamin Reed,Not TDD
23852655a6d41f675b8a9cca66387fca9bfe4e12,"ZOOKEEPER-1815. Tolerate incorrectly set system hostname in tests (some one via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1543281 13f79535-47bb-0310-9956-ffa450edef68",2013-11-19 01:03:43,Michi Mutsuzaki,Not TDD
65348e6224b802376d88202ed760f6cd472bfca4,"ZOOKEEPER-1459. Standalone ZooKeeperServer is not closing 
  the transaction log files on shutdown (Rakesh R via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1548825 13f79535-47bb-0310-9956-ffa450edef68",2013-12-07 10:16:34,Flavio Paiva Junqueira,Mixed
cdee4002b4b7d14413a5ed447dbbd146c5a99eee,"ZOOKEEPER-1382. Zookeeper server holds onto dead/expired session ids in the watch data structures
  (Germán Blanco and Michael Morello via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1550213 13f79535-47bb-0310-9956-ffa450edef68",2013-12-11 18:22:04,Camille Fournier,Not TDD
59ecde5ed38f0c6701d818841446793214cf702e,"ZOOKEEPER-1388. Client side 'PathValidation' is missing for the multi-transaction api. (Rakesh R via marshallm, phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1551624 13f79535-47bb-0310-9956-ffa450edef68",2013-12-17 16:55:29,Patrick D. Hunt,Not TDD
efdb06a6b401831ee18b31b35b78072b87f43a15,"ZOOKEEPER-1849. Need to properly tear down tests in various cases
  (Germán Blanco via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1552946 13f79535-47bb-0310-9956-ffa450edef68",2013-12-21 21:05:40,Flavio Paiva Junqueira,Not TDD
310f890ff8c4e4977204fb0dd8443bbe6ba3c7a1,"ZOOKEEPER-1179. NettyServerCnxn does not properly close socket on 
  4 letter word requests (Rakesh R, Germán Blanco via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1553681 13f79535-47bb-0310-9956-ffa450edef68",2013-12-27 14:57:20,Flavio Paiva Junqueira,Mixed
772304a191c1ea1dc41185d6ccfca51d41c4d240,"ZOOKEEPER-1852. ServerCnxnFactory instance is not properly cleanedup (Rakesh R via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1554980 13f79535-47bb-0310-9956-ffa450edef68",2014-01-03 00:24:52,Flavio Paiva Junqueira,Not TDD
50f99d983fb877151bcf896549187ae0d02f66ae,"ZOOKEEPER-1414. QuorumPeerMainTest.testQuorum, testBadPackets are failing intermittently (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1556925 13f79535-47bb-0310-9956-ffa450edef68",2014-01-09 19:21:10,Michi Mutsuzaki,Not TDD
90e482b0612a02c53802bdee79a251b2192f91ce,"ZOOKEEPER-1057. zookeeper c-client, connection to offline server fails to successfully fallback to second zk host (Germán Blanco via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1556948 13f79535-47bb-0310-9956-ffa450edef68",2014-01-09 21:01:29,Michi Mutsuzaki,Not TDD
abf9f386c9a2cf4983c00103e3e7d24814296cc4,"ZOOKEEPER-1857. PrepRequestProcessotTest doesn't shutdown ZooKeeper server (Germán Blanco via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1556976 13f79535-47bb-0310-9956-ffa450edef68",2014-01-09 22:56:41,Michi Mutsuzaki,Not TDD
fef1ae2e7b2bf712b315b6907ebef0bf2a988927,"ZOOKEEPER-1691. Add a flag to disable standalone mode (Helen Hastings via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1559916 13f79535-47bb-0310-9956-ffa450edef68",2014-01-21 03:50:01,Michi Mutsuzaki,Mixed
98789ea4876fea771ca761d1c66d44e18d104b8e,"ZOOKEEPER-442. need a way to remove watches that are no longer of interest (Rakesh R, Daniel Gómez Ferro via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1560904 13f79535-47bb-0310-9956-ffa450edef68",2014-01-24 06:18:32,Patrick D. Hunt,Not TDD
8c5689ad175d4cdcb3c350e6964a61bdc50288b5,"ZOOKEEPER-1858. JMX checks - potential race conditions while stopping 
  and starting server (Rakesh R via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1561236 13f79535-47bb-0310-9956-ffa450edef68",2014-01-25 00:17:07,Flavio Paiva Junqueira,Not TDD
4b1e9ecd134cff894d2c1efc6f1c783bd3d8aa0e,"ZOOKEEPER-1867. Bug in ZkDatabaseCorruptionTest (fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1561672 13f79535-47bb-0310-9956-ffa450edef68",2014-01-27 13:37:00,Flavio Paiva Junqueira,Not TDD
523a776780c0af1d15e60667ac3e2532c3779380,"ZOOKEEPER-1573. Unable to load database due to missing parent node (Vinayakumar B via phunt, fpj)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1566739 13f79535-47bb-0310-9956-ffa450edef68",2014-02-10 20:50:54,Patrick D. Hunt,Not TDD
f6752dd0648c8c00cc8cd5dc3333da7760cfb4bb,"ZOOKEEPER-1874 Add proper teardown/cleanups in ReconfigTest to shutdown quorumpeer (Rakesh R and Germán Blanco via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1567488 13f79535-47bb-0310-9956-ffa450edef68",2014-02-12 01:30:48,Michi Mutsuzaki,Not TDD
5d00c83b2a94bf40477651d9b0176e2d7d07012a,"ZOOKEEPER-1844. TruncateTest fails on windows (Rakesh R via fpj)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1567660 13f79535-47bb-0310-9956-ffa450edef68",2014-02-12 16:00:09,Flavio Paiva Junqueira,Mixed
6aaa3b23f708fbbd1c04f58646ba27cb70831e27,"ZOOKEEPER-1755. Concurrent operations of four letter 'dump' ephemeral 
  command and killSession causing NPE (Rakesh R via camille)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1569590 13f79535-47bb-0310-9956-ffa450edef68",2014-02-19 01:31:53,Camille Fournier,Mixed
d289eddfbc700308aa646b3fae3bbbde19a0bbd0,"ZOOKEEPER-1662. Fix to two small bugs in ReconfigTest.testPortChange() (Alexander Shraer via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1576174 13f79535-47bb-0310-9956-ffa450edef68",2014-03-11 01:44:30,Michi Mutsuzaki,Not TDD
ad745010ff099460410ff17abf4150256180c446,"ZOOKEEPER-1883. C client unit test failures (Raul Gutierrez Segales via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1576961 13f79535-47bb-0310-9956-ffa450edef68",2014-03-12 22:25:14,Michi Mutsuzaki,Not TDD
5dec5415968f75ed7938ea47ecdfc8dcbcdd487c,"Revert ""ZOOKEEPER-1883. C client unit test failures (Raul Gutierrez Segales via michim)""


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1577019 13f79535-47bb-0310-9956-ffa450edef68",2014-03-13 01:39:14,Michi Mutsuzaki,Not TDD
ef80ec4cd22280436abd1492e3944b2d7972b310,"ZOOKEEPER-1883. C client unit test failures (Raul Gutierrez Segales via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1577317 13f79535-47bb-0310-9956-ffa450edef68",2014-03-13 20:58:01,Michi Mutsuzaki,Not TDD
f91ae0ca6c047ebb729b91323ecb9447c4955dfc,"KEEPER-1878. Inconsistent behavior in autocreation of dataDir and dataLogDir (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1577750 13f79535-47bb-0310-9956-ffa450edef68",2014-03-14 22:51:29,Michi Mutsuzaki,Not TDD
f636c489c15a257c52659af7c9913883767fc7c1,"ZOOKEEPER-1862. ServerCnxnTest.testServerCnxnExpiry is intermittently failing (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1577756 13f79535-47bb-0310-9956-ffa450edef68",2014-03-14 23:10:35,Michi Mutsuzaki,Not TDD
a6e8a13a2da6df08f4426cc4f623ec5c76078ba9,"ZOOKEEPER-602. log all exceptions not caught by ZK threads (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1580436 13f79535-47bb-0310-9956-ffa450edef68",2014-03-23 03:12:56,Michi Mutsuzaki,Mixed
14c3f3450c34a6b4ce2c63815441204eec512220,"ZOOKEEPER-1263. fix handling of min/max session timeout value initialization (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1581522 13f79535-47bb-0310-9956-ffa450edef68",2014-03-25 21:13:19,Michi Mutsuzaki,Not TDD
183a0c8e527eb588d533ee77fb21a2d3a690c292,"ZOOKEEPER-1904. WatcherTest#testWatchAutoResetWithPending is failing (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1582055 13f79535-47bb-0310-9956-ffa450edef68",2014-03-26 21:13:46,Michi Mutsuzaki,Not TDD
bf399b1cbc94f6d90258be699a3c92525cecfa65,"ZOOKEEPER-1894. ObserverTest.testObserver fails consistently. (michim via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1582572 13f79535-47bb-0310-9956-ffa450edef68",2014-03-28 00:58:20,Camille Fournier,Mixed
0ad01693759ea809bca14597f24a35d0465acf97,"ZOOKEEPER-1408. CLI: sort output of ls command (Hartmut Lang via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1582943 13f79535-47bb-0310-9956-ffa450edef68",2014-03-29 03:33:53,Michi Mutsuzaki,Not TDD
d30292be3cf8e497976352267a7c593a5200f892,"ZOOKEEPER-1219. LeaderElectionSupport recipe is unnecessarily dispatching the READY_START event even if the ELECTED node stopped/expired simultaneously. (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1583083 13f79535-47bb-0310-9956-ffa450edef68",2014-03-29 23:01:40,Michi Mutsuzaki,Mixed
704af2e35ca68a26b72cb5ecdbcb08ff3c177727,"ZOOKEEPER-1728. Better error message when reconfig invoked in standalone mode (Alexander Shraer via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1583492 13f79535-47bb-0310-9956-ffa450edef68",2014-03-31 23:47:08,Michi Mutsuzaki,Not TDD
256f95f52cd94b6b2e0b24bf69799d79b9011ffa,"ZOOKEEPER-1725. Zookeeper Dynamic Conf writes out hostnames when IPs are supplied (Alexander Shraer via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1583495 13f79535-47bb-0310-9956-ffa450edef68",2014-03-31 23:56:32,Michi Mutsuzaki,Not TDD
2b8f98be7407da4417dd192f3de4605a99e3cd15,"ZOOKEEPER-1730. Make ZooKeeper easier to test - support simulating a session expiration (Jordan Zimmerman via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1583513 13f79535-47bb-0310-9956-ffa450edef68",2014-04-01 02:03:02,Michi Mutsuzaki,Not TDD
bc2b5f7460d8c64cc457295f672a9436579f6d43,"ZOOKEEPER-1906. zkpython: invalid data in GetData for empty node (Nikita Vetoshkin via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1583783 13f79535-47bb-0310-9956-ffa450edef68",2014-04-01 20:58:07,Michi Mutsuzaki,Not TDD
1b5e4ddef8979830dd58e86a365c640f298eae3e,"ZOOKEEPER-1830. Support command line shell for removing watches (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1584454 13f79535-47bb-0310-9956-ffa450edef68",2014-04-03 23:03:34,Michi Mutsuzaki,Not TDD
b1befb0c4d51d13081690fcb0994bc306de7cc2f,"Set svn:eol-style property to native.


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1584497 13f79535-47bb-0310-9956-ffa450edef68",2014-04-04 01:24:37,Michi Mutsuzaki,Not TDD
f7c4e5aae7d08fcd093c54fe44490fe3cf3f8554,"ZOOKEEPER-1357. Zab1_0Test uses hard-wired port numbers. Specifically, it uses the same port for leader in two different tests. The second test periodically fails complaining that the port is still in use. (Alexander Shraer via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1587335 13f79535-47bb-0310-9956-ffa450edef68",2014-04-14 21:51:55,Michi Mutsuzaki,Not TDD
1dc931af0614501282db98541b1edf25a4005e7e,"ZOOKEEPER-1887. C implementation of removeWatches (Raul Gutierrez Segales via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1587812 13f79535-47bb-0310-9956-ffa450edef68",2014-04-16 06:15:28,Michi Mutsuzaki,Not TDD
5a882c303de74370c7e57a516b68d07260be9bc3,"ZOOKEEPER-1909. removeWatches doesn't return NOWATCHER when there is
no watch set (Raul Gutierrez Segales via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1588141 13f79535-47bb-0310-9956-ffa450edef68",2014-04-17 06:47:18,Rakesh Radhakrishnan,Not TDD
c0a648f23eb228315fbbab5d0dd59970adaf308c,"ZOOKEEPER-1819. DeserializationPerfTest calls method with wrong arguments (Daniel Knightly via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1590116 13f79535-47bb-0310-9956-ffa450edef68",2014-04-25 19:35:56,Michi Mutsuzaki,Not TDD
686dc0204c46081ddcc64d93c20b46803df56d84,"ZOOKEEPER-1673. Zookeeper don't support cidr in expression in ACL with ip scheme (Craig Condit via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1590157 13f79535-47bb-0310-9956-ffa450edef68",2014-04-25 21:40:28,Michi Mutsuzaki,Not TDD
a6bc130294da3c7473b3d215699b98fac1f2cd7f,"ZOOKEEPER-1843. Oddity in ByteBufferInputStream skip (Bill Havanki via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1590298 13f79535-47bb-0310-9956-ffa450edef68",2014-04-26 21:16:37,Michi Mutsuzaki,Mixed
a1cd9204d298ca9b5b30c2f272d55b306c393271,"ZOOKEEPER-1910. RemoveWatches wrongly removes the watcher if multiple watches 
  exists on a path (Rakesh R via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1590850 13f79535-47bb-0310-9956-ffa450edef68",2014-04-29 00:23:58,Camille Fournier,Mixed
6135724bd1bf98ff7c5716581494f57f6febc131,"ZOOKEEPER-1926. Unit tests should only use build/test/data for data (Enis Soztutar via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1593624 13f79535-47bb-0310-9956-ffa450edef68",2014-05-09 21:37:39,Michi Mutsuzaki,Not TDD
74d8363cd562d4c082ae4bc9120d693def2ddb6b,"ZOOKEEPER-657. Cut down the running time of ZKDatabase corruption (Michi Mutsuzaki via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1594755 13f79535-47bb-0310-9956-ffa450edef68",2014-05-15 01:35:33,Rakesh Radhakrishnan,Not TDD
3f8cc1b8a6c754b992aec568b8e71b84f956ecdf,"ZOOKEEPER-1797. PurgeTxnLog may delete data logs during roll (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1595552 13f79535-47bb-0310-9956-ffa450edef68",2014-05-18 01:01:55,Michi Mutsuzaki,Mixed
903ce8dff71fb53de27ba2c16563e4ed43bf504e,"ZOOKEEPER-1214. QuorumPeer should unregister only its previsously registered MBeans instead of use MBeanRegistry.unregisterAll() method. (César Álvarez Núñez via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1595561 13f79535-47bb-0310-9956-ffa450edef68",2014-05-18 03:49:06,Michi Mutsuzaki,Mixed
a8e0d7ba7d9797be3aa021fe23d5aef52ef39b91,"ZOOKEEPER-1699. Leader should timeout and give up leadership when losing quorum of last proposed configuration (Alexander Shraer via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1596422 13f79535-47bb-0310-9956-ffa450edef68",2014-05-20 21:42:51,Michi Mutsuzaki,Not TDD
7a929407de4704f6ed27958075caddc6cb3f6508,"ZOOKEEPER-1659. Add JMX support for dynamic reconfiguration (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1600481 13f79535-47bb-0310-9956-ffa450edef68",2014-06-04 20:07:23,Michi Mutsuzaki,Not TDD
bce5c62c62b2fc171deee54c9d6d6cb229c597cc,"ZOOKEEPER-1928. add configurable throttling to the number of snapshots concurrently sent by a leader (Edward Carter via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1601516 13f79535-47bb-0310-9956-ffa450edef68",2014-06-09 22:19:02,Flavio Paiva Junqueira,Mixed
7e262c717d4b99972278ee1e112bdd81dd171c02,"ZOOKEEPER-1870. flakey test in StandaloneDisabledTest.startSingleServerTest (Helen Hastings via fpj)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1605380 13f79535-47bb-0310-9956-ffa450edef68",2014-06-25 13:04:27,Flavio Paiva Junqueira,Mixed
d53be91194395c01d5f78361717e03439b8fb942,"ZOOKEEPER-1746. AsyncCallback.*Callback don't have any Javadoc (Hongchao Deng via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1605503 13f79535-47bb-0310-9956-ffa450edef68",2014-06-25 17:06:05,Patrick D. Hunt,Mixed
8cfb9a0efa5c8934eb3c95ca69566c718a37d9ca,"ZOOKEEPER-1576. Zookeeper cluster - failed to connect to cluster if one of the 
  provided IPs causes java.net.UnknownHostException (Edward Ribeiro via camille)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1606254 13f79535-47bb-0310-9956-ffa450edef68",2014-06-27 21:47:49,Camille Fournier,Mixed
6abd85938f450587ec1c8973176261fb60a6838b,"ZOOKEEPER-1900

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1606841 13f79535-47bb-0310-9956-ffa450edef68",2014-06-30 17:11:54,Alexander Shraer,Not TDD
4934b821e0f2c5061f55661626adf50549046451,"ZOOKEEPER-1946. Server logging should reflect dynamically reconfigured address (Niko Vuokko via phunt and Alexander Shraer)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1607525 13f79535-47bb-0310-9956-ffa450edef68",2014-07-03 04:01:51,Patrick D. Hunt,Not TDD
02bec21a44c022ec6f065c5ced17864e58fa1ae8,"ZOOKEEPER-1835. dynamic configuration file renaming fails on Windows(Bruno Freudensprung via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1607774 13f79535-47bb-0310-9956-ffa450edef68",2014-07-04 02:19:59,Rakesh Radhakrishnan,Mixed
dc40617ce0ab9161ca8ad22c6c010d198d9abae8,"ZOOKEEPER-827. enable r/o mode in C client library (rgs via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1608620 13f79535-47bb-0310-9956-ffa450edef68",2014-07-07 21:43:44,Flavio Paiva Junqueira,Not TDD
5a6535bf410ed223aac075241045ccd807b17b81,"ZOOKEEPER-1810. Add version to FLE notifications for trunk Germán Blanco via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1608648 13f79535-47bb-0310-9956-ffa450edef68",2014-07-08 03:25:56,Michi Mutsuzaki,Not TDD
194be4b88e22c017e5649204afa5296128bfbcb5,"ZOOKEEPER-1222. getACL should only call DataTree.copyStat when passed in stat is not null (Michi Mutsuzaki via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1608872 13f79535-47bb-0310-9956-ffa450edef68",2014-07-08 18:18:31,Rakesh Radhakrishnan,Not TDD
524895a2651bc7f2d2d9fe458361c33eaf339573,"ZOOKEEPER-1964. Fix Flaky Test in ReconfigTest.java (Hongchao Deng via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1610468 13f79535-47bb-0310-9956-ffa450edef68",2014-07-14 17:45:38,Flavio Paiva Junqueira,Not TDD
fc71a77591007be0053a6314eca3ebc22602dc3f,"ZOOKEEPER-1863. Race condition in commit processor leading to out of order request completion, xid mismatch on client. (fpj and Dutch T Meyer via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1610861 13f79535-47bb-0310-9956-ffa450edef68",2014-07-15 21:54:32,Camille Fournier,Not TDD
9a97169a433b6eff5c58ff563bbb783c17248fb5,"ZOOKEEPER-1683. ZooKeeper client NPE when updating server list on disconnected client (shralex via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1611474 13f79535-47bb-0310-9956-ffa450edef68",2014-07-17 20:56:43,Michi Mutsuzaki,Mixed
0dff24161455a8ca1ee7c6bcd91798b8d1bcff68,"ZOOKEEPER-1346. Add Jetty HTTP server support for four letter words. (Skye Wanderman-Milne, Bill Havanki via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1611516 13f79535-47bb-0310-9956-ffa450edef68",2014-07-18 00:19:01,Patrick D. Hunt,Mixed
36c82e116c14a63152e7ffaa229d31f55db887e2,"ZOOKEEPER-1969. Fix Port Already In Use for JettyAdminServerTest (Hongchao Deng via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1611714 13f79535-47bb-0310-9956-ffa450edef68",2014-07-18 17:04:25,Patrick D. Hunt,Not TDD
bcf09c846cc68c85479659cb1b7c1a076af068cb,"ZOOKEEPER-1851. Follower and Observer Request Processors Do Not Forward create2 Requests (Chris Chen via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1611732 13f79535-47bb-0310-9956-ffa450edef68",2014-07-18 17:46:51,Rakesh Radhakrishnan,Not TDD
0214cfcdde243e0adf2e81c94bb3d48e25308f2b,"ZOOKEEPER-1807. Observers spam each other creating connections to the election addr (Alex Shraer via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1611765 13f79535-47bb-0310-9956-ffa450edef68",2014-07-18 18:48:56,Flavio Paiva Junqueira,Not TDD
1e4be0b02caa30026499b192c08972ad28b41b52,"ZOOKEEPER-927. there are currently 24 RAT warnings in the build -- address directly or via exclusions (Michi Mutsuzaki via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1611846 13f79535-47bb-0310-9956-ffa450edef68",2014-07-19 04:39:05,Patrick D. Hunt,Not TDD
a6b0e9efbfacb954cf03a7e6ea55920a3e1ab2e2,"ZOOKEEPER-1984. testLeaderTimesoutOnNewQuorum is a flakey test (Alex Shraer via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1612867 13f79535-47bb-0310-9956-ffa450edef68",2014-07-23 16:35:52,Patrick D. Hunt,Not TDD
892e10f6a45cca0464dae4089265511b7d0b9a38,"ZOOKEEPER-1789. 3.4.x observer causes NPE on 3.5.0 (trunk) participants (Alex Shraer via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1612885 13f79535-47bb-0310-9956-ffa450edef68",2014-07-23 17:36:19,Patrick D. Hunt,Mixed
693f81bd103d14c80c38609bbc6cddb356310b3d,"ZOOKEEPER-1877. Malformed ACL Id can crash server with skipACL=yes (Chris Chen via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1613328 13f79535-47bb-0310-9956-ffa450edef68",2014-07-24 23:31:57,Patrick D. Hunt,Not TDD
68bc2d165e8b88f9f352b3b50bbae84bba844657,"ZOOKEEPER-1933. Windows release build of zk client cannot connect to zk server (Orion Hodson via fpj, phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1613474 13f79535-47bb-0310-9956-ffa450edef68",2014-07-25 16:57:45,Patrick D. Hunt,Not TDD
883cd4d446224bccd227acbad8f59f97405fef9e,"ZOOKEEPER-1988. new test patch to verify dynamic reconfig backward compatibility (Alexander Shraer via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1613553 13f79535-47bb-0310-9956-ffa450edef68",2014-07-26 02:11:37,Rakesh Radhakrishnan,Not TDD
bad9ede36559615bb7eafe8e4d333f2c7c353faa,"ZOOKEEPER-1992. Backward compatibility of the static configuration file (Hongchao Deng via Alex Shraer)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1615037 13f79535-47bb-0310-9956-ffa450edef68",2014-08-01 05:38:05,Alexander Shraer,Not TDD
d25cfdf63fb4c7747c65d1f8298b4060b9776ae6,"ZOOKEEPER-1994. Auto-backup configuration files; config version becomes part of filename (Hongchao Deng via shralex)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1617886 13f79535-47bb-0310-9956-ffa450edef68",2014-08-14 06:08:48,Alexander Shraer,Not TDD
135a315933c4899fe0f0d6fe5d89c2fc1f881e4a,"ZOOKEEPER-2008. Missing leader election port in system test. (Kfir Lev-Ari via Alex Shraer).

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1617892 13f79535-47bb-0310-9956-ffa450edef68",2014-08-14 07:32:06,Alexander Shraer,Not TDD
0b585528c8d8c36715b3489900e77c9198301102,"ZOOKEEPER-2006. Standalone mode won't take client port from dynamic config. (Hongchao Deng via Alex Shraer)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1618977 13f79535-47bb-0310-9956-ffa450edef68",2014-08-19 20:50:41,Alexander Shraer,Not TDD
3c4a30ee13ac127ca97bbe375bbc555125b3ab3e,"ZOOKEEPER-2000. Fix ReconfigTest.testPortChange (Alexander Shraer via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1619030 13f79535-47bb-0310-9956-ffa450edef68",2014-08-20 04:07:16,Michi Mutsuzaki,Not TDD
55d178451ac9d58f31f4910dc08f6cda22aaae68,"ZOOKEEPER-2017 New tests for reconfig failure cases (Alexander Shraer and Hongchao Deng via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1620111 13f79535-47bb-0310-9956-ffa450edef68",2014-08-24 05:42:45,Michi Mutsuzaki,Mixed
55d9130276ecf172490259c662c96dc0d65f91bc,"ZOOKEEPER-2032. Cleaning up resources in ReconfigBackupTest (Hongchao Deng via shralex)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1623916 13f79535-47bb-0310-9956-ffa450edef68",2014-09-10 07:00:31,Alexander Shraer,Not TDD
ac76ee731ac65e06e78219b25aed0d8abe15a276,"ZOOKEEPER-2047 testTruncationNullLog fails on windows (flavio via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1627923 13f79535-47bb-0310-9956-ffa450edef68",2014-09-27 06:20:31,Rakesh Radhakrishnan,Not TDD
3a3014ad265095bea004bcccea0f28dd960d2234,"ZOOKEEPER-2026 Startup order in ServerCnxnFactory-ies is wrong (Stevo Slavic via rakeshr)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1628086 13f79535-47bb-0310-9956-ffa450edef68",2014-09-28 17:15:05,Rakesh Radhakrishnan,Not TDD
2eca451820cbf158cfff3a49214b9a108c69f925,"ZOOKEEPER-2054 test-patch.sh: don't set ulimit -n (michim via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1630026 13f79535-47bb-0310-9956-ffa450edef68",2014-10-08 08:16:28,Rakesh Radhakrishnan,Not TDD
783382d89c58561a9ac8b3d886b4b564a7b211c9,"ZOOKEEPER-2052 Unable to delete a node when the node has no children (Hongchao Deng and Yip Ng via rakeshr)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1634776 13f79535-47bb-0310-9956-ffa450edef68",2014-10-28 04:35:14,Rakesh Radhakrishnan,Mixed
4bfe04276f2219b93904b710a2b003e2f817949f,"ZOOKEEPER-2069 Netty Support for ClientCnxnSocket (Hongchao via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1646985 13f79535-47bb-0310-9956-ffa450edef68",2014-12-20 14:29:07,Flavio Paiva Junqueira,Mixed
a95add82db688000a7dc2ceb15464c368e7702fb,"ZOOKEEPER-2072 Netty Server Should Configure Child Channel Pipeline By Specifying ChannelPipelineFactory(Hongchao via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1655910 13f79535-47bb-0310-9956-ffa450edef68",2015-01-30 02:23:50,Rakesh Radhakrishnan,Mixed
2789d1df02e697ea511867546dc569ff6b405ece,"ZOOKEEPER-1366 Zookeeper should be tolerant of clock adjustments (Hongchao Deng via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1657745 13f79535-47bb-0310-9956-ffa450edef68",2015-02-06 05:17:31,Michi Mutsuzaki,Mixed
640f63f8010f96b9a52c5a872e6af9d6b6a35e8c,"ZOOKEEPER-1907 Improve Thread handling (Rakesh R via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1665089 13f79535-47bb-0310-9956-ffa450edef68",2015-03-08 22:07:59,Michi Mutsuzaki,Mixed
125d3b4dac1aad83f6acf059a02d7e56904ac021,"ZOOKEEPER-2137 Make testPortChange() less flaky (Hongchao Deng via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1666764 13f79535-47bb-0310-9956-ffa450edef68",2015-03-14 22:47:06,Michi Mutsuzaki,Not TDD
22ccb2e0fe3f93a7b904c7d3d24f514fe9e7562b,"ZOOKEEPER-1865 Fix retry logic in Learner.connectToLeader() (Edward Carter via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1666784 13f79535-47bb-0310-9956-ffa450edef68",2015-03-15 07:54:59,Michi Mutsuzaki,Mixed
2ba2ae309e6d11f224bab84e68e0d23f963b3aaa,"ZOOKEEPER-2107 zookeeper client should support custom HostProviders(Robert Kamphuis via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1666908 13f79535-47bb-0310-9956-ffa450edef68",2015-03-16 08:09:04,Rakesh Radhakrishnan,Not TDD
af814bd812c1bad13f413004895de5ea1c781f78,"ZOOKEEPER-2125 SSL on Netty client-server communication (Hongchao, Ian Dimayuga via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1667358 13f79535-47bb-0310-9956-ffa450edef68",2015-03-17 17:06:07,Rakesh Radhakrishnan,Not TDD
75928cb8af4dfda71d99e35e232a2075f3c7b923,"ZOOKEEPER-2146 BinaryInputArchive readString should check length before allocating memory (Hongchao Deng via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1669060 13f79535-47bb-0310-9956-ffa450edef68",2015-03-25 07:38:44,Michi Mutsuzaki,Mixed
809ebb2a300005265617ac7ce92694f688342ff4,"ZOOKEEPER-2123 Provide implementation of X509 AuthenticationProvider(Ian Dimayuga via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1669825 13f79535-47bb-0310-9956-ffa450edef68",2015-03-28 19:08:52,Rakesh Radhakrishnan,Mixed
b92709ede9bce52f7b1061fe660ed6322d876f26,"ZOOKEEPER-2174 JUnit4ZKTestRunner logs test failure for all exceptions

JUnit4ZKTestRunner logs test failure for all exceptions, even if the test
method is annotated with an expected exception (Chris Nauroth via rgs).

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1677460 13f79535-47bb-0310-9956-ffa450edef68",2015-05-03 17:55:28,Raúl Gutiérrez Segalés,Not TDD
c88423a925b69e7446b75bc127e2fd2dac30eee7,"ZOOKEEPER-2062 RemoveWatchesTest takes forever to run (Chris Nauroth via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1677724 13f79535-47bb-0310-9956-ffa450edef68",2015-05-05 02:38:36,Rakesh Radhakrishnan,Not TDD
bd2a1bc422f1a555bb8a4af23cf07bf67ae0459b,"ZOOKEEPER-2171 avoid reverse lookups in QuorumCnxManager (rgs via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1678529 13f79535-47bb-0310-9956-ffa450edef68",2015-05-09 22:27:47,Michi Mutsuzaki,Mixed
16c91abe606aa84fa84747313b7fa3a5485ce3ce,"ZOOKEEPER-2182 Several test suites are not running during pre-commit, because their names do not end with ""Test"". (Chris Nauroth via hdeng)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1678645 13f79535-47bb-0310-9956-ffa450edef68",2015-05-10 21:29:15,Hongchao Deng,Not TDD
692bfe67ad63fb7cf2e1b901f06f1787c74e5f8d,"ZOOKEEPER-2186 QuorumCnxManager#receiveConnection may crash with random input (rgs via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1679313 13f79535-47bb-0310-9956-ffa450edef68",2015-05-14 05:10:01,Michi Mutsuzaki,Mixed
a358280fb2b3cc7852cded3fe67769765a519beb,"ZOOKEEPER-2183 Concurrent Testing Processes and Port Assignments (Chris Nauroth via hdeng)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1679400 13f79535-47bb-0310-9956-ffa450edef68",2015-05-14 16:40:52,Hongchao Deng,Mixed
4dae58c3ced30b570c3d9da57240178d9a598f5e,"ZOOKEEPER-2190 fix StandaloneDisabledTest#testReconfig

In StandaloneDisabledTest, testReconfig() shouldn't take leaving servers
as joining servers (Hongchao Deng via rgs).

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1679444 13f79535-47bb-0310-9956-ffa450edef68",2015-05-14 19:53:44,Raúl Gutiérrez Segalés,Not TDD
891b12d004842e6ea09509765eaa2a18eca727c4,"ZOOKEEPER-2198 Set default test.junit.threads to 1 (Chris Nauroth via michim)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1682701 13f79535-47bb-0310-9956-ffa450edef68",2015-05-31 09:21:07,Michi Mutsuzaki,Not TDD
feb90fabcab3a14b075eb56f2618e6483acfebfb,"ZOOKEEPER-2204: LearnerSnapshotThrottlerTest.testHighContentionWithTimeout
fails occasionally (Donny Nadolny via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1683602 13f79535-47bb-0310-9956-ffa450edef68",2015-06-04 17:37:26,Raúl Gutiérrez Segalés,Not TDD
78b84f3ae01ca477fb94404c78bf3a098b0fcba4,"ZOOKEEPER-2163: Introduce new ZNode type: container
(Jordan Zimmerman via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1683605 13f79535-47bb-0310-9956-ffa450edef68",2015-06-04 17:51:16,Raúl Gutiérrez Segalés,Mixed
71dd96a232cb590e90601fde4bfafcd4eef1f82a,"ZOOKEEPER-2201: Network issues can cause cluster to hang due to near-deadlock
(Donny Nadolny via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1683878 13f79535-47bb-0310-9956-ffa450edef68",2015-06-06 01:48:52,Raúl Gutiérrez Segalés,Mixed
9bee4674c015a71785daeb7a6da93676a3450699,"ZOOKEEPER-2213: Empty path in Set crashes server and prevents restart
(Hongchao Deng via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1684956 13f79535-47bb-0310-9956-ffa450edef68",2015-06-11 18:09:19,Raúl Gutiérrez Segalés,Mixed
2d94a794d33a27567b37b772c08316277ee4e547,"ZOOKEEPER-706: Large numbers of watches can cause session re-establishment to fail
(Chris Thunes via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1685200 13f79535-47bb-0310-9956-ffa450edef68",2015-06-13 00:42:49,Raúl Gutiérrez Segalés,Not TDD
352022265deb93110b7370e0fc2df6809985a60a,"ZOOKEEPER-2140: NettyServerCnxn and NIOServerCnxn code should be improved
(Arshad Mohammad via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1688041 13f79535-47bb-0310-9956-ffa450edef68",2015-06-28 19:09:49,Raúl Gutiérrez Segalés,Not TDD
9a9d587861606884cca5b4a532078f925b50e40c,"ZOOKEEPER-2224: Four letter command hangs when network is slow (Arshad Mohammad via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1689211 13f79535-47bb-0310-9956-ffa450edef68",2015-07-05 04:05:33,Rakesh Radhakrishnan,Not TDD
3c9c66ac68e430a435b6bd02a9ab5cde03f31e11,"ZOOKEEPER-2223: support method-level JUnit testcase
(Akihiro Suda via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1689571 13f79535-47bb-0310-9956-ffa450edef68",2015-07-07 05:11:49,Raúl Gutiérrez Segalés,Not TDD
359fa97e5888e4e209128f0d26edaa7125bc20e6,"ZOOKEEPER-1423: 4lw and jmx should expose the size of the datadir/datalogdir
(Edward Ribeiro via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1690207 13f79535-47bb-0310-9956-ffa450edef68",2015-07-10 06:19:22,Raúl Gutiérrez Segalés,Not TDD
1c715735d4386ee9b01f2fddb5fe04e78135a452,"ZOOKEEPER-2245: SimpleSysTest test cases fails
(Arshad Mohammad via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1697227 13f79535-47bb-0310-9956-ffa450edef68",2015-08-23 17:12:03,Raúl Gutiérrez Segalés,Not TDD
cfc9f24934f920ad45b8c522f0bd05220e5aaf74,"ZOOKEEPER-2264: Wrong error message when secureClientPortAddress is configured but secureClientPort is not configured (Arshad Mohammad via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1701505 13f79535-47bb-0310-9956-ffa450edef68",2015-09-06 18:02:42,Rakesh Radhakrishnan,Mixed
239556e2344f75626b5c6c3f656508e797093011,"ZOOKEEPER-2269: NullPointerException in RemotePeerBean
(Arshad Mohammad via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1702163 13f79535-47bb-0310-9956-ffa450edef68",2015-09-10 04:35:52,Raúl Gutiérrez Segalés,Mixed
fe2b9019c535c9e4c8cb6a5d73ec6afcebb445e6,"ZOOKEEPER-2253: C asserts ordering of ping requests, while Java client does not
(Chris Chen via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1705482 13f79535-47bb-0310-9956-ffa450edef68",2015-09-26 20:22:25,Raúl Gutiérrez Segalés,Not TDD
b2f66fae04438602ee9b0092ac0c6657177e10e1,"ZOOKEEPER-2244: On Windows zookeeper fails to restart (Arshad Mohammad via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1705794 13f79535-47bb-0310-9956-ffa450edef68",2015-09-29 01:56:44,Rakesh Radhakrishnan,Not TDD
08cc9187d9eb327b2a71bc9a8c62636815dfe9e5,"ZOOKEEPER-1460: IPv6 literal address not supported for quorum members (Joseph Walton via cnauroth)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1709293 13f79535-47bb-0310-9956-ffa450edef68",2015-10-18 17:00:41,Chris Nauroth,Not TDD
500dea711a6bc214d35183c8ae6b92e70c006ee4,"ZOOKEEPER-2302: Some test cases are not running because wrongly named (Arshad Mohammad via fpj)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1711151 13f79535-47bb-0310-9956-ffa450edef68",2015-10-28 21:54:09,Flavio Paiva Junqueira,Not TDD
e65986980ee173e19b36cd8f5a3dd4dae786ca30,"ZOOKEEPER-1872: QuorumPeer is not shutdown in few cases
(Rakesh R. via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1712218 13f79535-47bb-0310-9956-ffa450edef68",2015-11-03 07:11:27,Raúl Gutiérrez Segalés,Not TDD
ee0daa7a8223dad09071893ef2e2c3a1aeb8eec9,"ZOOKEEPER-2211: PurgeTxnLog does not correctly purge when snapshots and
logs are at different locations (Arshad Mohammad via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1713296 13f79535-47bb-0310-9956-ffa450edef68",2015-11-08 21:21:38,Raúl Gutiérrez Segalés,Mixed
80803034aabb68229730b9d7429525bd460c3183,"ZOOKEEPER-2227: stmk four-letter word fails execution at server while
reading trace mask argument (Chris Nauroth via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1713300 13f79535-47bb-0310-9956-ffa450edef68",2015-11-08 21:36:17,Raúl Gutiérrez Segalés,Not TDD
df7e637a4d073c75270c32b107b7c1ceab29d148,"ZOOKEEPER-1853: zkCli.sh can't issue a CREATE command containing
spaces in the data (Ryan Lamore via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1713303 13f79535-47bb-0310-9956-ffa450edef68",2015-11-08 21:54:06,Raúl Gutiérrez Segalés,Mixed
31b61db08a87b5939ea3fce5328d7ce69df536e6,"ZOOKEEPER-1371: Remove dependency on log4j in the source code
(Arshad Mohammad via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1715577 13f79535-47bb-0310-9956-ffa450edef68",2015-11-21 21:18:10,Raúl Gutiérrez Segalés,Not TDD
28573d112600863f6918a963cb3583a09d69aa1e,"ZOOKEEPER-2306: Remove file delete duplicate code from test code
(Arshad Mohammad via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1718212 13f79535-47bb-0310-9956-ffa450edef68",2015-12-06 20:30:07,Raúl Gutiérrez Segalés,Not TDD
5bcdb84bda57b06d0d4a38ce587ab91cd010e9a2,"ZOOKEEPER-2301: QuorumPeer does not listen on passed client IP in the constructor
(Arshad Mohammad via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1718251 13f79535-47bb-0310-9956-ffa450edef68",2015-12-07 04:59:37,Raúl Gutiérrez Segalés,Mixed
8d11ef90f71733a59b28828ee84e9955f297d1e2,"ZOOKEEPER-2299: NullPointerException in LocalPeerBean for ClientAddress
(Arshad Mohammad via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1718253 13f79535-47bb-0310-9956-ffa450edef68",2015-12-07 05:06:45,Raúl Gutiérrez Segalés,Mixed
b2a953f15101eceb302992cdfb46ced79fadcf72,"ZOOKEEPER-2300: Expose SecureClientPort and SecureClientAddress JMX properties
(Arshad Mohammad via rgs)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1718255 13f79535-47bb-0310-9956-ffa450edef68",2015-12-07 05:26:27,Raúl Gutiérrez Segalés,Mixed
fe1ac5d508c90943c34ec5c77aa9594ebf25edd7,"ZOOKEEPER-2252: Random test case failure in org.apache.zookeeper.test.StaticHostProviderTest (Timothy Ward via cnauroth)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1719204 13f79535-47bb-0310-9956-ffa450edef68",2015-12-10 20:42:50,Chris Nauroth,Not TDD
b286cccd5a56aed88a7d74cffff87a09790ac97d,"ZOOKEEPER-2297: NPE is thrown while creating ""key manager"" and ""trust manager"" (Arshad Mohammad via rakeshr)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1725872 13f79535-47bb-0310-9956-ffa450edef68",2016-01-21 06:07:04,Rakesh Radhakrishnan,Not TDD
94e26732af2c3a2bf51c2e4e5bb4f86fbc9ca0fc,"Revert ZOOKEEPER-2297

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1726354 13f79535-47bb-0310-9956-ffa450edef68",2016-01-23 05:06:58,Rakesh Radhakrishnan,Not TDD
f7eb9fcad397722eb678d82d301793490a3a8e61,"ZOOKEEPER-2388 Unit tests failing on Solaris (Arshad Mohammad via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1735369 13f79535-47bb-0310-9956-ffa450edef68",2016-03-17 06:13:02,Patrick D. Hunt,Not TDD
a3d24843bcc298fa635cf447d35f901116b06cda,"ZOOKEEPER-2141. ACL cache in DataTree never removes entries
(Adam Milne-Smith via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1736259 13f79535-47bb-0310-9956-ffa450edef68",2016-03-22 23:30:42,Camille Fournier,Mixed
6380270281f9bb79b7ccfff6cfedbce22f734ca4,"ZOOKEEPER-2141 ACL cache in DataTree never removes entries (Adam Milne-Smith via camille)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1738012 13f79535-47bb-0310-9956-ffa450edef68",2016-04-06 18:06:30,Camille Fournier,Mixed
b7a03643afda3306accd4c58e39daeb31870dc6e,"ZOOKEEPER-2139: Support multiple ZooKeeper client with different configurations in a single JVM (Arshad Mohammad via fpj)



git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1742002 13f79535-47bb-0310-9956-ffa450edef68",2016-05-02 16:15:28,Flavio Paiva Junqueira,Mixed
9fc632c4f0a340b0a00ec6dff39c7b454c802822,"ZOOKEEPER-2024 Major throughput improvement with mixed workloads (Kfir Lev-Ari via shralex)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1743978 13f79535-47bb-0310-9956-ffa450edef68",2016-05-15 21:31:54,Alexander Shraer,Mixed
3496911f7fb14294483640ab29f4e8c089dd8283,"ZOOKEEPER-2410: add time unit to 'ELECTION TOOK' log.info message (Christine Poerschke via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1746511 13f79535-47bb-0310-9956-ffa450edef68",2016-06-01 22:59:24,Patrick D. Hunt,Not TDD
5ccea64951f9e6ffa6a6bf4d0f273861948559da,"ZOOKEEPER-2137: Make testPortChange() less flaky (Michael Han via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1748608 13f79535-47bb-0310-9956-ffa450edef68",2016-06-15 17:11:39,Patrick D. Hunt,Not TDD
aa4a217ca85966ee135adb27804992e97ec18cbc,"ZOOKEEPER-2297: NPE is thrown while creating ""key manager"" and ""trust manager"" (Arshad Mohammad via fpj)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1749951 13f79535-47bb-0310-9956-ffa450edef68",2016-06-23 17:42:11,Flavio Paiva Junqueira,Mixed
2cea41e38e7597a1d5901381f2fc72fce8625b7e,"ZOOKEEPER-2380: Deadlock between leader shutdown and forwarding ACK to the leader. (Arshad Mohammad via cnauroth)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1750022 13f79535-47bb-0310-9956-ffa450edef68",2016-06-23 21:25:34,Chris Nauroth,Not TDD
01aea04fe49e0e218e06a898780758c1bb0f2600,"ZOOKEEPER-2366: Reconfiguration of client port causes a socket leak. (fpj via cnauroth)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1750025 13f79535-47bb-0310-9956-ffa450edef68",2016-06-23 21:45:43,Chris Nauroth,Not TDD
fade262a8a4fa744bd768dc7569d8f4c9d84f275,"ZOOKEEPER-1898: ZooKeeper Java cli shell always returns 0 as exit code (Abraham Fine via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1754188 13f79535-47bb-0310-9956-ffa450edef68",2016-07-26 23:33:27,Patrick D. Hunt,Mixed
beb1dd6afeadb8ec2d00ae4b3efdf66380f4949a,"ZOOKEEPER-1256: ClientPortBindTest is failing on Mac OS X (Camille via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1754582 13f79535-47bb-0310-9956-ffa450edef68",2016-07-29 23:02:27,Patrick D. Hunt,Not TDD
c0a5d8ba561cf8f9ad8fece964f5cf8894c154ee,"ZOOKEEPER-2074: Incorrect exit codes for './zkCli.sh cmd arg' (Abraham Fine via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1755786 13f79535-47bb-0310-9956-ffa450edef68",2016-08-10 17:32:22,Patrick D. Hunt,Not TDD
a9a0624823d0704b766e5208079c232dce8f25ea,"ZOOKEEPER-2247: Zookeeper service becomes unavailable when leader fails to write transaction log (Rakesh via fpj)


git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1756262 13f79535-47bb-0310-9956-ffa450edef68",2016-08-13 13:01:51,Flavio Paiva Junqueira,Mixed
685a5268056a92159875dd58daa27817b69fa1c4,"ZOOKEEPER-2508: Many ZooKeeper tests are flaky because they proceed with zk operation without connecting to ZooKeeper server. (Arshad Mohammad via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1757452 13f79535-47bb-0310-9956-ffa450edef68",2016-08-23 23:36:09,Patrick D. Hunt,Mixed
ffe4dbd9d0726315473bfdaed5bc74115e5de267,"ZOOKEEPER-2152: Intermittent failure in TestReconfig.cc (Michael Han via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1757564 13f79535-47bb-0310-9956-ffa450edef68",2016-08-24 18:33:36,Patrick D. Hunt,Not TDD
32c709c0f0d69a34377cc934796869e80ebc6741,"ZOOKEEPER-2507: C unit test improvement: line break between 'ZooKeeper server started' and 'Running' (Michael Han via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1759839 13f79535-47bb-0310-9956-ffa450edef68",2016-09-08 14:33:59,Patrick D. Hunt,Not TDD
10dc80a2929862c2b1a20656354e435ec696b45e,"ZOOKEEPER-1962: Add a CLI command to recursively list a znode and children (Gautam Gopalakrishnan, Hongchao Deng, Enis Soztutar via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1759904 13f79535-47bb-0310-9956-ffa450edef68",2016-09-08 20:52:26,Patrick D. Hunt,Not TDD
c38787f355b6dcd612fc57db0202fc68a01108f7,"ZOOKEEPER-2172: Cluster crashes when reconfig a new node as a participant (Arshad Mohammad via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1759907 13f79535-47bb-0310-9956-ffa450edef68",2016-09-08 20:59:36,Patrick D. Hunt,Not TDD
12efc9f88705796cb905b46159e1d519323b1d9c,"ZOOKEEPER-2484: Flaky Test: org.apache.zookeeper.test.LoadFromLogTest.testLoadFailure (Michael Han via phunt)

git-svn-id: https://svn.apache.org/repos/asf/zookeeper/trunk@1759917 13f79535-47bb-0310-9956-ffa450edef68",2016-09-08 22:10:09,Patrick D. Hunt,Not TDD
8c4082647f89b0a92fa00a2af8de84b3c7314e23,"ZOOKEEPER-2576: After svn to git migration ZooKeeper Precommit jenkins job is failing
(Patrick Hunt via rgs)",2016-09-12 10:13:42,Raul Gutierrez S,Not TDD
ec20c5434cc8a334b3fd25e27d26dccf4793c8f3,"ZOOKEEPER-2579: ZooKeeper server should verify that dataDir and snapDir are writeable before starting (Abraham Fine via phunt)

Change-Id: I2cf47cfa304057423650c0a30eab47e7acd10223",2016-09-18 14:21:51,Patrick Hunt,Not TDD
0a4971d5efb12a35a00cf794dce1efb3f08a998c,ZOOKEEPER-2169. Enable creation of nodes with TTLs. (Jordan Zimmerman via camille),2016-10-07 15:51:52,Camille Fournier,Mixed
f78061aafb19b102c37cb6d744ec6258d5f5b66e,"ZOOKEEPER-2611: zoo_remove_watchers - can remove the wrong watch
(Eyal Leshmem via rgs)",2016-10-09 13:40:36,Raul Gutierrez Segales,Not TDD
422058c222a8a31ec7cfd4113fbdc036181f751d,ZOOKEEPER-2467: NullPointerException when redo Command is passed negative value (Rakesh Kumar Singh via rakeshr),2016-10-16 17:51:43,Rakesh Radhakrishnan,Mixed
bcb07a09b06c91243ed244f04a71b8daf629e286,ZOOKEEPER-2556: peerType not removed from static config file (Rakesh Kumar Singh via shralex).,2016-11-03 11:07:36,Alexander Shraer,Not TDD
440e0923dd9e3be533a196fdd6ada960860ca7f6,"ZOOKEEPER-2624: Add test script for pull requests

(fpj via rgs)",2016-11-06 10:50:03,Raul Gutierrez Segales,Not TDD
881256ea97a19e51b1c6e9a114e6e61ad83bd4ec,"ZOOKEEPER-2631: Make issue extraction in the git pull request script
more robust (Flavio P. Junqueira via rgs)",2016-11-12 19:53:43,Raul Gutierrez Segales,Not TDD
73e102a58d01b27bc6208bbfbde2d12f0deba1f4,"ZOOKEEPER-2014: Only admin should be allowed to reconfig a cluster.

This PR implements ZOOKEEPER-2014. For details, please refer to

JIRA: https://issues.apache.org/jira/browse/ZOOKEEPER-2014
Review board: https://reviews.apache.org/r/51546/

Author: Michael Han <hanm@cloudera.com>

Reviewers: fpj <fpj@apache.org>, breed <breed@apache.org>, rgs <rgs@itevenworks.net>

Closes #96 from hanm/ZOOKEEPER-2014",2016-11-13 11:59:29,Michael Han,Mixed
179c8db6df20beccd64fac2c99ca77dbe8a3242c,"ZOOKEEPER-1525: Plumb ZooKeeperServer object into auth plugins

Based on patch work from https://issues.apache.org/jira/browse/ZOOKEEPER-1525

Created ServerAuthenticationProvider which has a method to accept the ZooKeeper
server so that auth can be done using values in the ZK database. As this is a new
interface, existing implementations aren't affected helping backward compatibility

Author: randgalt <jordan@jordanzimmerman.com>

Reviewers: fpj <fpj@apache.org>, Allan Lyu <lvfangmin@gmail.com>

Closes #84 from Randgalt/ZOOKEEPER-1525",2016-11-15 21:21:09,randgalt,Not TDD
482ce218d815b7a613ed9728b82602ddecc61996,"ZOOKEEPER-761: Remove *synchronous* calls from the *single-threaded* C client API

JIRA: https://issues.apache.org/jira/browse/ZOOKEEPER-761

Author: breed <breed@apache.org>

Reviewers: fpj <fpj@apache.org>, hanm <hanm@cloudera.com>, rgs <rgs@apache.org>",2016-12-16 10:43:47,fpj,Not TDD
8616a9ec8ce4bc8ac2987b7417a6f0c4b7333658,"ZOOKEEPER-2479: Add 'electionTimeTaken' value in LeaderMXBean and FollowerMXBean

Author: Rakesh Radhakrishnan <rakeshr@apache.org>

Reviewers: Edward Ribeiro <edward.ribeiro@gmail.com>, fpj <fpj@apache.org>

Closes #98 from rakeshadr/ZK-2479 and squashes the following commits:

2c9eadf [Rakesh Radhakrishnan] ZOOKEEPER-2479: avoids duplicate code
5af1314 [Rakesh Radhakrishnan] ZOOKEEPER-2479: Fixed Raul's review comments
cc011a0 [Rakesh Radhakrishnan] ZOOKEEPER-2479: Add 'electionTimeTaken' value in LeaderMXBean and FollowerMXBean",2016-12-20 13:47:25,Rakesh Radhakrishnan,Not TDD
eac693cc76a34f96b9116ef33d1e92af7129416d,"ZOOKEEPER-2383: Startup race in ZooKeeperServer

Author: Rakesh Radhakrishnan <rakeshr@apache.org>

Reviewers: fpj <fpj@apache.org>, rgs <rgs@apache.org>, hanm <hanm@apache.org>

Closes #101 from rakeshadr/ZK-2383 and squashes the following commits:

4faa761 [Rakesh Radhakrishnan] ZOOKEEPER-2383: Startup race in ZooKeeperServer
d2078d0 [Rakesh Radhakrishnan] ZOOKEEPER-2383",2016-12-21 22:32:01,Rakesh Radhakrishnan,Not TDD
ef0a8ae686c100f1dc71d7526af962c635696466,"ZOOKEEPER-2470: ServerConfig#parse(String[]) ignores tickTime

Author: Edward Ribeiro <edward.ribeiro@gmail.com>

Reviewers: Michael Han <hanm@apache.org>, Rakesh Radhakrishnan <rakeshr@apache.org>

Closes #125 from eribeiro/ZOOKEEPER-2470

(cherry picked from commit 5de4fa3d8acdfdac353bb54fcaa8c8e732432891)
Signed-off-by: Michael Han <hanm@apache.org>",2016-12-21 19:11:20,Edward Ribeiro,Mixed
de5c0e9abeb87721f4157662210dfcd38a7c15ea,"ZOOKEEPER-2517: jute.maxbuffer is ignored

ZOOKEEPER-2517:jute.maxbuffer is ignored

Author: arshadmohammad <arshad.mohammad.k@gmail.com>

Reviewers: Michael Han <hanm@apache.org>, Rakesh Radhakrishnan <rakeshr@apache.org>

Closes #113 from arshadmohammad/ZOOKEEPER-2517",2016-12-30 14:01:55,arshadmohammad,Mixed
7c51b01e89acb38165553366f7e3b2a46c00aa27,"ZOOKEEPER-2325: Data inconsistency if all snapshots empty or missing

Author: Benjamin Reed <br33d@fb.com>
Author: Benjamin Reed <breed@apache.org>

Reviewers: Raúl Gutiérrez Segalés <rgs@apache.org>, Michael Han <hanm@apache.org>, Allan Lyu <lvfangmin@gmail.com>

Closes #117 from breed/ZOOKEEPER-2325 and squashes the following commits:

35ce7e2 [Benjamin Reed] address comments from rgs1
68433ae [Benjamin Reed] ZOOKEEPER-2325: Data inconsistency if all snapshots empty or missing",2017-01-06 16:09:54,Benjamin Reed,Not TDD
c2434883dcdd85450ac73b7e69f3deed83fa5bf4,"ZOOKEEPER-2511: Implement AutoCloseable in ZooKeeper.java

Author: Abraham Fine <afine@apache.org>

Reviewers: Edward Ribeiro <edward.ribeiro@gmail.com>, Michael Han <hanm@apache.org>

Closes #143 from afine/ZOOKEEPER-2511

(cherry picked from commit df1e50bbd7d826ca28705bf9e5cdfc883b0bb4b4)
Signed-off-by: Michael Han <hanm@apache.org>",2017-01-09 13:49:58,Abraham Fine,Not TDD
8773ecb78a4bbd5ed066493a09adf7f1a73fa74e,"ZOOKEEPER-261: Reinitialized servers should not participate in leader election

Author: Brian Nixon <nixon@fb.com>

Reviewers: Michael Han <hanm@apache.org>, Edward Ribeiro <edward.ribeiro@gmail.com>, benjamin reed <breed@apache.org>

Closes #120 from enixon/ZOOKEEPER-261",2017-01-13 10:29:52,Brian Nixon,Mixed
762f4af65bb1056a582a6f36183a9e28fe0ccab8,"ZOOKEEPER-2574: PurgeTxnLog can inadvertently delete required txn log files

… files

This fix includes patch from Ed Rowe for ZOOKEEPER-2420, which is the same
issue as ZOOKEEPER-2574.

Author: Abhishek Rai <abhishek@thoughtspot.com>

Reviewers: Rakesh Radhakrishnan <rakeshr@apache.org>, Arshad Mohammad <mohammad.arshad@huawei.com>, Abraham Fine <abe@abrahamfine.com>, Allan Lyu <lvfangmin@gmail.com>, Michael Han <hanm@apache.org>

Closes #111 from abhishekrai/ZOOKEEPER-2574",2017-01-22 17:13:37,Abhishek Rai,Mixed
8771ffdaacb87126a485ae740558f6a288ab980b,"ZOOKEEPER-2573: Modify Info.REVISION to adapt git repo

rakeshadr Hi, I have created this PR. The commit can be cherry picked on master too. In fact, I guess when you merge this then #137 will be automatically closed. I tested quickly and was able to cherry-pick this commit on branch-3.4 too, so you may want to give it a try. :smiley:

Author: Edward Ribeiro <edward.ribeiro@gmail.com>
Author: Edward Ribeiro <eribeiro@users.noreply.github.com>

Reviewers: Mohammad Arshad <arshad@apache.org>, Michael Han <hanm@apache.org>

Closes #155 from eribeiro/ZOOKEEPER-2573-3.5

(cherry picked from commit 41da3c8e3c39f81aa0f667199c5f4eb3d5a28adc)
Signed-off-by: Rakesh Radhakrishnan <rakeshr@apache.org>",2017-01-25 17:30:56,Edward Ribeiro,Mixed
26aee2228451257f3b0b5093bc0c101822e06bc8,"ZOOKEEPER-2680: Correct DataNode.getChildren() inconsistent behaviour.

DataNode.getChildren() API behavior should be changed and it should always return empty set if the node does not have any child. Currently this API returns some times null some times empty set.

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Edward Ribeiro <edward.ribeiro@gmail.com>, Abraham Fine <afine@apache.org>, Michael Han <hanm@apache.org>

Closes #160 from arshadmohammad/ZOOKEEPER-2680-DataNode-getChildren and squashes the following commits:

ff9f105 [Mohammad Arshad] Revert back few changes form DataTree
f2691ca [Mohammad Arshad] Removed Null check from all references of getChildren
7c4592d [Mohammad Arshad] Review comment fix
0dbf350 [Mohammad Arshad] separated test cases
01459c8 [Mohammad Arshad] ZOOKEEPER-2680:Correct DataNode.getChildren() inconsistent behaviour.",2017-02-04 22:22:51,Mohammad Arshad,Mixed
bbfd0169417c316bbdd22ff7a38176845aa0efc6,"ZOOKEEPER-2678: Discovery and Sync can take a very long time on large DBs (master)

This is the master version of #157

Author: Robert (Bobby) Evans <evans@yahoo-inc.com>

Reviewers: Flavio Junqueira <fpj@apache.org>, Edward Ribeiro <edward.ribeiro@gmail.com>, Abraham Fine <afine@apache.org>, Michael Han <hanm@apache.org>

Closes #159 from revans2/ZOOKEEPER-2678-master and squashes the following commits:

69fbe19 [Robert (Bobby) Evans] ZOOKEEPER-2678: Addressed review comments
a432642 [Robert (Bobby) Evans] ZOOKEEPER-2678:  Improved test to verify snapshot times
742367e [Robert (Bobby) Evans] Addressed review comments
f4c5b0e [Robert (Bobby) Evans] ZOOKEEPER-2678: Discovery and Sync can take a very long time on large DBs",2017-02-11 15:12:00,Robert (Bobby) Evans,Not TDD
c5df1c9acec07036da225b1251cb30be60301224,"ZOOKEEPER-2642: rename ZooKeeper reconfig API to reconfigure API.

Was #122

Author: randgalt <jordan@jordanzimmerman.com>

Reviewers: Michael Han <hanm@apache.org>

Closes #152 from Randgalt/ZOOKEEPER-2642",2017-02-11 15:34:24,randgalt,Mixed
201cac20e1a66e7d4180a6c7e18834c0ca6094dc,"ZOOKEEPER-2683: RaceConditionTest is flaky

RaceConditionTest assertion is wrong, It fails when old leader becomes leader again.

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Michael Han <hanm@apache.org>

Closes #175 from arshadmohammad/ZOOKEEPER-2683-03",2017-02-13 13:09:59,Mohammad Arshad,Not TDD
15e3f7fccc770783786e8097f7a6618509bfee0f,"ZOOKEEPER-2617: correct a few spelling typos

Hi - this PR contains corrections for some spelling typos.  Most of them appear in comments, but a few appear in documentation and program output.  Thank you for considering it.

Author: tony mancill <tmancilldebian.org>

Reviewers: Flavio Junqueira <fpjapache.org>, Edward Ribeiro <edward.ribeirogmail.com>, Rakesh Radhakrishnan <rakeshrapache.org>

Closes #87 from tmancill/tmancill/spelling-typos

Author: Edward Ribeiro <edward.ribeiro@gmail.com>

Reviewers: Rakesh Radhakrishnan <rakeshr@apache.org>

Closes #174 from eribeiro/ZOOKEEPER-2617

(cherry picked from commit 0816970930bb9565f13d310a1f55636e62cdfd19)
Signed-off-by: Rakesh Radhakrishnan <rakeshr@apache.org>",2017-02-14 13:54:22,Edward Ribeiro,Not TDD
5fe68506f217246c7ebd96803f9c78e13ec2f11a,"ZOOKEEPER-2693: DOS attack on wchp/wchc four letter words (4lw)

The previous patch is not valid anymore as design has changed. Update patch based on phunt 's feedback.
See ZOOKEEPER-2693 JIRA for details. This patch is still targeting for branch-3.5 / master. Patch for branch-3.4 will be created shortly.

The gist of the patch is:
* Introduced a new configuration option which encodes a white list of 4lw commands. A 4lw command that is not on the white list will not be enabled on server side.
* For branch-3.5, the default value of the configuration option is empty. We want users to use the alternative AdminServer anyway.

Author: Michael Han <hanm@apache.org>

Reviewers: Rakesh Radhakrishnan <rakeshrapache.org>, Mohammad Arshad <arshad@apache.org>, Flavio Junqueira <fpj@apache.org>, Edward Ribeiro <edward.ribeiro@gmail.com>, Abraham Fine <afine@apache.org>

Closes #179 from hanm/ZOOKEEPER-2693 and squashes the following commits:

1ffd114 [Michael Han] Tweak tests.
b4c421d [Michael Han] ZOOKEEPER-2693: DOS attack on wchp/wchc four letter words (4lw). Introduce a new configuration option 4lw.commands.whitelist that disables all 4lw (except srvr) by default to avoid the exploits reported on wchp/wchc commands.",2017-03-04 10:22:03,Michael Han,Not TDD
63577ba52a829391ded3ae11c62c0e996865b5c7,"ZOOKEEPER-2725: Promote local session to global when ephemeral created in multi-op

Patch and unit test for issue.

Author: Brian Nixon <nixon@fb.com>

Reviewers: Abraham Fine <afine@apache.org>, Michael Han <hanm@apache.org>

Closes #195 from enixon/ZOOKEEPER-2725 and squashes the following commits:

0a32b9a [Brian Nixon] fill diamond operators
7f2fd37 [Brian Nixon] add direct testing of checkUpgradeSession in addition to integration style test
5cbca58 [Brian Nixon] ZOOKEEPER-2725: Promote local session to global when ephemeral created in multi-op",2017-03-21 09:49:56,Brian Nixon,Not TDD
3946f0b1dfaa847eaa73cae5634d7d28da94eec9,"ZOOKEEPER-2722: fix flaky testSessionEstablishment test.

Make sure client is connected to a quorum before issuing a write operation to avoid possible race condition between connected to a RO server and forming a new quorum.

Author: Michael Han <hanm@apache.org>

Reviewers: Rakesh Radhakrishnan <rakeshr@apache.org>, Camille Fournier <camille@apache.org>

Closes #191 from hanm/ZOOKEEPER-2722 and squashes the following commits:

99bf87f [Michael Han] Make sure syncConnected flag is set to false in read only connected state.
9969979 [Michael Han] ZOOKEEPER-2722: fix flaky test testSessionEstablishment.

(cherry picked from commit 212201131f8eb01dd2209deb37656ccc4096de77)
Signed-off-by: Michael Han <hanm@apache.org>",2017-04-17 16:37:32,Michael Han,Not TDD
425fdbb8fa64ea839072701187fa7a24bfe10bda,"ZOOKEEPER-2662: Export a metric for txn log sync times

Author: Edward Ribeiro <edward.ribeiro@gmail.com>

Reviewers: Michael Han <hanm@apache.org>

Closes #241 from eribeiro/ZOOKEEPER-2662 and squashes the following commits:

1d24e06 [Edward Ribeiro] Addressed review comments
7ce89d7 [Edward Ribeiro] ZOOKEEPER-2662: Export a metric for txn log sync times",2017-04-27 22:14:08,Edward Ribeiro,Mixed
acfc471eca0aab57707b59ed8d19221360d19b85,"ZOOKEEPER-2697: Handle graceful stop of ZookKeeper client

Add a ZooKeeper.close(int timeout) method which waits for internal resources to be released

Author: eolivelli <eolivelli@apache.org>

Reviewers: Michael Han <hanm@apache.org>

Closes #222 from eolivelli/ZOOKEEPER-2697-close-with-timeout",2017-05-01 08:19:15,eolivelli,Not TDD
a680655a3569bfc546712cb85eeaea8c9b7de3ad,"ZOOKEEPER-1932: Remove deprecated LeaderElection class.

The motivation of removing LeaderElection class:
* It has been long deprecated and no one uses it.
* Tests around it is flaky.

Author: Michael Han <hanm@cloudera.com>

Reviewers: Flavio Junqueira <fpj@apache.org>, Allan Lyu <fangmin@apache.org>, Mohammad Arshad <arshad@apache.org>

Closes #106 from hanm/ZOOKEEPER-1932",2017-05-11 22:59:42,Michael Han,Not TDD
3824da0b649c6a6a698cfe6c79ca3d44a9e94f29,"ZOOKEEPER-2797: Defend against bad TTLs from misbehaving clients

Validate the TTL before it makes it to the commit processor to prevent blowing up ZK

Author: Patrick White <patrick@patrickwhite.org>

Reviewers: Jordan Zimmerman <jordan@jordanzimmerman.com>, Abraham Fine <afine@apache.org>, Michael Han <hanm@apache.org>

Closes #267 from packysauce/protect_from_bad_ttl",2017-05-31 20:45:49,Patrick White,Not TDD
1038966e8289c09a6f3b863dd2713b9f1c83b4cf,"ZOOKEEPER-2798: Fix flaky test: org.apache.zookeeper.test.ReadOnlyModeTest.testConnectionEvents

See https://github.com/apache/zookeeper/pull/270 for a description of the bug.

Author: Abraham Fine <afine@apache.org>

Reviewers: Michael Han <hanm@apache.org>

Closes #271 from afine/ZOOKEEPER-2798_3.5

(cherry picked from commit 643e551eacc1fb76c40e04b5d857aaac77089343)
Signed-off-by: Michael Han <hanm@apache.org>",2017-06-08 08:51:19,Abraham Fine,Not TDD
fa1dc109d4c1bb7913fee43170ed6131e3dc1b1f,"ZOOKEEPER-2775: ZK Client not able to connect with Xid out of order error

Once client enters into Xid out of order issue, It never comes to normal state. It keeps trying to connect and  fail with the same error.  Recreating/Restarting is the only solution as of now. This happens because of bug in the ZK client code. This MR provides the fix.

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Michael Han <hanm@apache.org>, Rakesh Radhakrishnan <rakeshr@apache.org>, Abe Fine <afine@apache.org>

Closes #254 from arshadmohammad/ZOOKEEPER-2775-XidOutOfOrder",2017-06-08 08:59:05,Mohammad Arshad,Not TDD
111ae5a5b67999925f1921736a14fcfbdb1b7348,"ZOOKEEPER-2808: fix miss-referenced ACL count issue when upgrading the ZooKeeper

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: Michael Han <hanm@apache.org>

Closes #284 from lvfangmin/ZOOKEEPER-2808",2017-06-18 10:23:04,Fangmin Lyu,Mixed
fb267672d219c73c0cf2527fafebc1a0b17d3bee,"ZOOKEEPER-1782: Let a SASL super user be super

Author: Robert Evans <evans@yahoo-inc.com>

Reviewers: Michael Han <hanm@apache.org>, Mohammad Arshad <arshad@apache.org>

Closes #282 from revans2/ZOOKEEPER-1782",2017-06-23 09:39:05,Robert Evans,Not TDD
69710181042a8c1f0461c1739b96171d88f2b126,"ZOOKEEPER-2355: Ephemeral node is never deleted if follower fails while reading the proposal packet

ZOOKEEPER-2355:Ephemeral node is never deleted if follower fails while reading the proposal packet

Author: arshadmohammad <arshad.mohammad.k@gmail.com>
Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Michael Han <hanm@apache.org>, Rakesh Radhakrishnan <rakeshr@apache.org>, Flavio Junqueira <fpj@apache.org>, Jiang Jiafu <jiangjiafu1989@gmail.com>

Closes #112 from arshadmohammad/ZOOKEEPER-2355",2017-07-03 22:39:58,arshadmohammad,Not TDD
ddf0364903bf7ac7cd25b2e1927f0d9d3c7203c4,"ZOOKEEPER-2819: Changing membership configuration via rolling restart …

…does not work on 3.5.x.

This patch disables the creation of dynamic config files (zoo.cfg.dynamic) and static config back up files (zoo.cfg.bak) when the dynamic reconfig feature flag (reconfigEnabled) is disabled. With this patch the membership information (such as server list) will be stored in static zoo.cfg file and such information would not go through quorum and leader / follower sync phase, which makes it possible for users to continue using the old rolling restart approach.

shralex PTAL.

Author: Michael Han <hanm@apache.org>

Reviewers: Alexander Shraer <shralex@gmail.com>, asdf2014 <1571805553@qq.com>

Closes #292 from hanm/ZOOKEEPER-2819",2017-07-06 09:48:47,Michael Han,Not TDD
32794ca5d5a233abc6e019b07aadbfd375060bbd,"ZOOKEEPER-2577: Fix flaky testDuringLeaderSync test.

testDuringLeaderSync uses the presence of intermediate zoo.cfg.dynamic file to decide if the reconfig operation was succeeded or not. This is not a problem and is logically correct, however in tests that provisions QuorumPeer directly through MainThread, the configFile will be null and the resulted intermediate dynamic reconfig file will has a name of ""null.cfg.dynamic"". This causes problem because multiple test cases use MainThread to provision QuorumPeer so these tests will share a single ""null.cfg.dynamic"" file, as opposed to the zoo.cfg.dynamic file in their specific test folder when configFile was not null. Since we support running concurrent ant unit tests in apache build infrastructure, it is highly likely that multiple tests that rely on this shared null.cfg.dynamic file will execute simultaneously which create all sorts of failure cases (this also explains why if one tries to reproduce the test failures in a standalone fashion the test will always pass, with the absence of the file sharing.).

This is problematic in multiple test cases and in particular cause this testDuringLeaderSync fail fairly frequently. There are multiple solutions to this problem:

* Implement retry with timeout logic when detecting the presence of intermediate config files in testDuringLeaderSync. This will fix this specific test but the fix is non-deterministic and other tests might still fail because of sharing of null.cfg.dynamic file.

* Always make sure to to feed a real config file when provision QuorumPeer. This however is an overkill as some cases a pure artificial QuorumPeer w/o real config file fit the use case well.

The approach taking here is to for this specific test, making sure we always have a configured confFileName, and it is pretty trivial to do so. For other tests, where the intermediate config file name is not important or irrelevant (e.g. FLE related tests), they will still have null confFileName because they directly provision QuorumPeer during test.

Testing done: running this patch on apache jenkins for the past week with 500 runs. Not only this test is fixed but overall stability of entirely unit tests are improved.

Author: Michael Han <hanm@apache.org>

Reviewers: Alexander Shraer <shralex@gmail.com>

Closes #315 from hanm/working",2017-07-27 14:10:51,Michael Han,Not TDD
0706b40afad079f19fe9f76c99bbb7ec69780dbd,"ZOOKEEPER-2872: Interrupted snapshot sync causes data loss

This requires the fix in ZOOKEEPER-2870: Improve the efficiency of AtomicFileOutputStream

Author: Brian Nixon <nixon@fb.com>

Reviewers: Michael Han <hanm@apache.org>

Closes #333 from enixon/snap-sync",2017-08-17 21:32:43,Brian Nixon,Not TDD
d7c192c1829cc657d3312f47ecb5b97519d1b30d,"ZOOKEEPER-2804: Node creation fails with NPE if ACLs are null

1) Handled Null case in server. Client will get InvalidACLException
2) Handled null check in create and setACL APIs in client side as mentioned in their javadoc
throws KeeperException.InvalidACLException if the ACL is invalid, null, or empty
3) Not handling any validation for async API of create and setACL in this JIRA because these API doesn't throw KeeperException explicitly. So can not throw InvalidACLExceptin from Client.  If we throw IllegalArgumentException then it will not be consistent with other sync APIs.  So Let server throw InvalidACLException for async API.

Please review and provide suggestion.

Author: bhupendra jain <bhupendra.jain@huawei.com>

Reviewers: Mohammad Arshad <arshad@apache.org>, Michael Han <hanm@apache.org>

Closes #279 from jainbhupendra24/ZOOKEEPER-2804-new",2017-08-18 14:35:24,bhupendra jain,Not TDD
1165794be9587acccc02782dbff95bc482222528,"ZOOKEEPER-2630: Use interface type instead of implementation type whe…

Use interface type instead of implementation type when appropriate.

There are a couple of places in code base where we declare a field / variable as implementation type (i.e. HashMap, HashSet) instead of interface type (i.e. Map, Set), while in other places we do the opposite by declaring as interface type. A quick check indicates that most if not all of these places could be updated so we have a consistent style over the code base (prefer using interface type), which is also a good coding style to stick per best practice.

Checked and fixed Set, Map and List interface usages.

Author: Tamas Penzes <tamaas@cloudera.com>

Reviewers: Abe Fine <afine@apache.org>, Michael Han <hanm@apache.org>

Closes #354 from tamaashu/ZOOKEEPER-2630",2017-09-11 09:55:05,Tamas Penzes,Mixed
1392a8b3d8ac3d042a51dac18e33e144674b1b5b,"y

We wish to fix this long-standing issue in the code.
Note that the previous commit processor algorithm had the same approach (as the one suggested in this fix) when dealing with a request that has a different cxid than session's expected one (see [here](https://github.com/apache/zookeeper/commit/9fc632c4f0a340b0a00ec6dff39c7b454c802822#diff-5cc688a027068714af01b0ad4d292fe5L238)).

This fix is based on the code from https://github.com/apache/zookeeper/pull/167, following the discussion in https://issues.apache.org/jira/browse/ZOOKEEPER-2684 .

Author: Kfir Lev-Ari <klevari@apple.com>

Reviewers: Alexander Shraer <shralex@apache.org>, Abraham Fine <afine@apache.org>

Closes #411 from kfirlevari/ZOOKEEPER-2684",2017-11-02 21:04:56,Kfir Lev-Ari,Not TDD
f299303add79250ec2181f6c03b15e3754825284,"ZOOKEEPER-2931: WriteLock recipe: Fix bug in znode ordering when the sessionId is part of the znode name

This PR solves a bug in the WriteLock recipe related to the ordering the znodes.

In the original version when the nodes are sorted in WriteLock.java using a TreeSet the whole znode path is taken into account and not just the sequence number.

This causes an issue when the sessionId is included in the znode path because a znode with a lower sessionId will appear as lower than other znode with a higher sessionId even if its sequence number is bigger. In specific situations this ended with two clients holding the lock at the same time.

Author: Javier Cacheiro <alcachi@gmail.com>

Reviewers: phunt@apache.org

Closes #413 from javicacheiro/fix_writelock and squashes the following commits:

ed0e6648 [Javier Cacheiro] Secondary sort znodes with the same sequence number by prefix
b382648d [Javier Cacheiro] Add unit tests
f9c581d4 [Javier Cacheiro] Fix bug in znode ordering when the sessionId is part of the znode name

Change-Id: Id384ce6079bbdfef10054fabb8bb93378d86024f",2017-11-15 15:21:33,Javier Cacheiro,Mixed
75411ab34a3d53c43c2d508b12314a9788aa417d,"ZOOKEEPER-2935: [QP MutualAuth]: Port ZOOKEEPER-1045 implementation from branch-3.5 to trunk

Author: Abraham Fine <afine@apache.org>

Reviewers: phunt@apache.org

Closes #417 from afine/ZOOKEEPER-2935 and squashes the following commits:

99bfbe94 [Abraham Fine] Add debugging line and improve ivy.xml by removing unnecessary excludes
1d6c7de5 [Abraham Fine] Fix missing test.data.kerberos.dir in build.xml
06d0b6fa [Abraham Fine] ZOOKEEPER-2935: [QP MutualAuth]: Port ZOOKEEPER-1045 implementation from  branch-3.5 to trunk.

Change-Id: I2b88221c0006e4336a39f74fd5a87d1aded68c90",2017-11-27 15:10:13,Abraham Fine,Mixed
4d629d289fc4b1079fff2244b92a337e4068e240,"ZOOKEEPER-2249: CRC check failed when preAllocSize smaller than node data

This bug is caused by an issue in our file padding logic. We calculate an incorrect position to add padding when appending to the transaction log, this often corrupts a transaction. When the log is read the CRC check will correctly fail.

Author: Abraham Fine <afine@apache.org>

Reviewers: phunt@apache.org

Closes #436 from afine/ZOOKEEPER-2249 and squashes the following commits:

f3bc06c1 [Abraham Fine] Improve testing and respond to phunt's comment
44ad0575 [Abraham Fine] ZOOKEEPER-2249: CRC check failed when preAllocSize smaller than node data

Change-Id: Id8ba9ad730760cb78672127b8c0e02db60b4e87d",2018-01-18 15:43:11,Abraham Fine,Mixed
aefb13f2b289e19e32c0fcc5714711b07989d67f,"ZOOKEEPER-2939: Added last/min/max proposal size JMX beans

https://issues.apache.org/jira/browse/ZOOKEEPER-2939
- Refactor proposal serialization logic to a common place (SerializeUtils),
- Add JMX metric to monitor jute.maxbuffer setting
- Add JMX metric to monitor min/max/last size of generated proposals
- Add proposal stats info to 'stat' 4lw command
- Add proposal stats resetting to 'srst' 4lw command
- Unit tests

Author: Andor Molnár <andor@cloudera.com>
Author: Andor Molnar <andor@cloudera.com>

Reviewers: Patrick Hunt <phunt@apache.org>, Abraham Fine <afine@apache.org>

Closes #415 from anmolnar/ZOOKEEPER-2933 and squashes the following commits:

cf6ea5ecb [Andor Molnar] ZOOKEEPER-2933. Added proposal size statistics to 'mntr' command
cb28df6d6 [Andor Molnár] ZOOKEEPER-2939. Fixed findbugs issue: newline in format string
8e6b65f9f [Andor Molnár] ZOOKEEPER-2939: Added last/min/max proposal size JMX beans",2018-02-06 16:05:18,Andor Molnár,Mixed
bebe4162bc915b15b4fd90df9446bdf9f83ef3a8,"ZOOKEEPER-2967: Add check to validate dataDir and dataLogDir parameters at startup

ZOOKEEPER-2967: Add check to validate dataDir and dataLogDir parameters at startup

This PR adds a check to protect ZK against configuring dataDir and dataLogDir opposingly.

When FileTxnSnapLog is created, it checks if transaction log directory contains snapshot files or vice versa, snapshot directory contains transaction log files. If so, the check throws LogdirContentCheckException or SnapdirContentCheckException, respectively, which translates to DatadirException at ZK startup in QuorumPeerMain and ZooKeeperServerMain.

If the two directories are the same, then no check is done.

For testing, I've added 4 new unit tests which cover the following cases:

1. transaction log and snapshot directories are different and they are used correctly (no Exception)
2. transaction log and snapshot directories are the same (in this case no check is done)
3. transaction log and snapshot directories are different and transaction log directory contains snapshot files (LogdirContentCheckException -> ZK quits)
4. transaction log and snapshot directories are different and snapshot directory contains transaction log files (SnapdirContentCheckException -> ZK quits)

Author: Mark Fenes <mfenes@cloudera.com>

Reviewers: Andor Molnár <andor@cloudera.com>, Abraham Fine <afine@apache.org>

Closes #450 from mfenes/ZOOKEEPER-2967 and squashes the following commits:

3f2ce609a [Mark Fenes] Re-run checks
3dba7f14a [Mark Fenes] ZOOKEEPER-2967: Add check to validate dataDir and dataLogDir parameters at startup
50e7150b3 [Mark Fenes] Trigger notification
5f8ada87f [Mark Fenes] ZOOKEEPER-2967: Add check to validate dataDir and dataLogDir parameters at startup
36fc5bd46 [Mark Fenes] ZOOKEEPER-2967: Add check to validate dataDir and dataLogDir parameters at startup
eb76730cb [Mark Fenes] ZOOKEEPER-2967: Add check to validate dataDir and dataLogDir parameters at startup
81c026fe8 [Mark Fenes] ZOOKEEPER-2967: Add check to validate dataDir and dataLogDir parameters at startup",2018-02-14 12:23:30,Mark Fenes,Mixed
722ba9409a44a35d287aac803813f508cff2420a,"ZOOKEEPER-2845: Apply commit log when restarting server.

I will be creating a patch/pull request for 3.4 and 3.5 too, but I wanted to get a pull request up for others to look at ASAP.

I have a version of this based off of #310 at https://github.com/revans2/zookeeper/tree/ZOOKEEPER-2845-orig-test-patch but the test itself is flaky.  Frequently leader election does not go as planned on the test and it ends up failing but not because it ended up in an inconsistent state.

I am happy to answer any questions anyone has about the patch.

Author: Robert Evans <evans@yahoo-inc.com>

Reviewers: Abraham Fine <afine@apache.org>, Mark Fenes <mfenes@cloudera.com>, Andor Molnár <andor@cloudera.com>, Kishor Patil <kpatil@yahoo-inc.com>

Closes #453 from revans2/ZOOKEEPER-2845-master and squashes the following commits:

28c074a26 [Robert Evans] Addressed review comments
583e34435 [Robert Evans] Using framework APIs for test
f26a21ad6 [Robert Evans] Addressed review comments
93168d716 [Robert Evans] Added in a modified version of the test
3d042f981 [Robert Evans] ZOOKEEPER-2845: Apply commit log when restarting server.",2018-02-23 14:49:00,Robert Evans,Not TDD
fbd21329d32f185d198344f2d394175c92a82f9e,"ZOOKEEPER-3006: Potential NPE in ZKDatabase#calculateTxnLogSizeLimit

LJ1043041006 found a potential NPE in ZKDatabase#calculateTxnLogSizeLimit: https://issues.apache.org/jira/browse/ZOOKEEPER-3006

```
//ZKDatabase
public long calculateTxnLogSizeLimit() {
    long snapSize = 0;
    try {
        snapSize = snapLog.findMostRecentSnapshot().length();
     } catch (IOException e) {
        LOG.error(""Unable to get size of most recent snapshot"");
    }
    return (long) (snapSize * snapshotSizeFactor);
}
```

 in FileTxnSnapLog#findMostRecentSnapshot(), it will return the result of  FileSnap#findMostRecentSnapshot:

```
// called by FileTxnSnapLog#findMostRecentSnapshot()
public File findMostRecentSnapshot() throws IOException {
        List<File> files = findNValidSnapshots(1);
        if (files.size() == 0) {
            return null;
        }
        return files.get(0);
}
```

So it will return null when the files sizes is 0, but ZKDatabase#calculateTxnLogSizeLimit has no null checker.

Author: Edward Ribeiro <edward.ribeiro@gmail.com>

Reviewers: Andor Molnár <andor@cloudera.com>, Michael Han <hanm@apache.org>, maoling <maoling199210191@sina.com>

Closes #493 from edwardoliveira/zk-3006-potential-npe",2018-04-05 21:04:07,Edward Ribeiro,Not TDD
154f9c536f7c696b774361937c6b4b08603d16cf,"ZOOKEEPER-2994: Tool required to recover log and snapshot entries with CRC errors

https://issues.apache.org/jira/browse/ZOOKEEPER-2994

In the event  of ZooKeeper transaction log becomes corrupted and fail CRC checks (preventing startup) we should have a mechanism to get the cluster running again.

Previously we achieved this by loading the broken transaction log with a modified version of ZK with disabled CRC check and forced it to write new txn log files.

It has proven that once you end up with the corrupt txn log there is no way to recover except manually modifying the crc check. That's basically why the tool is needed.

It's called TxnLogToolkit, a new console application similar to LogFormatter and SnapshotFormatter, but it's intentionally separated to keep backward compatibility in the existing tools.

This PR contains TXN log tool only.

You probably also notice a refactoring to extract file padding logic from FileTxnLog to reuse in the new tool. Related code changes can be reviewed alone in a separate commit if preferred.

Author: Andor Molnar <andor@cloudera.com>

Reviewers: phunt@apache.org

Closes #487 from anmolnar/ZOOKEEPER-2994 and squashes the following commits:

221760ccc [Andor Molnar] ZOOKEEPER-2994. Added documentation and startup scripts
a69d7297b [Andor Molnar] ZOOKEEPER-2994. Fix findbugs warning
0b95efefd [Andor Molnar] ZOOKEEPER-2994. Fix for unit test
15fa45c68 [Andor Molnar] ZOOKEEPER-2994. Added padding, tool renamed to TxnLogToolkit, interactive mode, etc.
6a1ad0ec4 [Andor Molnar] ZOOKEEPER-2994. Refactor FileTxnLog's padding logic to separate class for reusability
0d089ccdd [Andor Molnar] ZOOKEEPER-2994. Added new tool TxnLogTool for txn log file recovery

Change-Id: I7560362633a7bc919ae6d3ca7e3588e196a1919c",2018-04-23 15:20:26,Andor Molnar,Mixed
2c0168ad37b529447ac8cb1bf866d014f8a97981,"ZOOKEEPER-3007: Potential NPE in ReferenceCountedACLCache#deserialize

LJ1043041006 found a potential NPE in ZK

Author: gongleigl.gong <gongleigl.gong@qunar.com>
Author: brettkk <1099446733@qq.com>

Reviewers: phunt@apache.org

Closes #495 from brettKK/master and squashes the following commits:

7eb9e1c9b [gongleigl.gong] fix RTE message in ReferenceCountedACLCache class
0b858826d [gongleigl.gong] del logger error and fix error message
a12b13ff7 [brettkk] fix format
f7da9b9fa [brettkk] change ZOOK3007 to compare with apache master
cf9fb5f9a [brettkk] recover code
c4db5e25d [brettkk] recover zookeeper master same with apache:master
700dfb7f4 [gongleigl.gong] fix NPE bug
7d8d5230c [gongleigl.gong] d

Change-Id: I012c242e8566fcd54c1ebde1a30ec785b6aa31b0",2018-04-26 15:21:36,gongleigl.gong,Mixed
5c96887643b2465caabbfd4763c7ebb3cd1aa024,"ZOOKEEPER-3027: Accidently removed public API of FileTxnLog.setPreallocSize()

In my latest commit regarding TxnLogToolkit there's a refactor to outsource file padding logic from FileTxnLog to a separate class:

https://github.com/apache/zookeeper/commit/126fb0f22d701cad58bf3123bf7d8f2219e60387#diff-89717124564925d61d29dd817bcdd915L147

Unfortunately public static method setPreallocSize(int) has also been moved to the new class, but it's being actively used by hadoop-common project too:

https://github.com/apache/hadoop/blob/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/ClientBaseWithFixes.java#L384

I'd like to submit a patch to revert the deleted method which is going to call the new one, but will keep backward compatibility with Hadoop.

Author: Andor Molnar <andor@cloudera.com>

Reviewers: phunt@apache.org

Closes #509 from anmolnar/ZOOKEEPER-3027

Change-Id: I7333b5e24c2a78d10a5c5a74c181633050bd225d",2018-04-27 11:28:15,Andor Molnar,Mixed
2022766ec907f63b1b43fc5455e9e7761cd332f6,"ZOOKEEPER-2988: NPE triggered if server receives a vote for a server …

…id not in their voting view

Author: Brian Nixon <nixon@fb.com>

Reviewers: Abraham Fine <afine@apache.org>, Michael Han <hanm@apache.org>, Edward Ribeiro <edward.ribeiro@gmail.com>

Closes #476 from enixon/ZOOKEEPER-2988",2018-04-29 21:34:57,Brian Nixon,Not TDD
ceaeccd6e310983d37e685a9d5fff3d7e75cf125,"ZOOKEEPER-2901: TTL Nodes don't work with Server IDs > 127

There was a major oversight when TTL nodes were implemented. The session ID generator for each server is seeded with the configured Server ID in the high byte. TTL Nodes were using the highest bit to denote a TTL node when used in the ephemeral owner. This meant that Server IDs > 127 that created ephemeral nodes would have those nodes always considered TTL nodes (with the TTL being essentially a random number).

This PR fixes the issue by disabling TTL Nodes by default. They must now be enabled in zoo.cfg. When TTL Nodes are enabled, the max Server ID changes from 255 to 254. This allows the high byte of a session ID stored in the ephemeral owner to use 0xFF to denote a TTL node.

About this change:

- The doc has been updated to note that TTL nodes are disabled by default and must be enabled via config. Also, the docs explains that when TTL nodes are enabled the max Server ID becomes 254
- The TTL implementation has been updated to use 0xFF in the high byte of the ephemeralOwner to denote a TTL node. This decreases the max TTL by an insignificant amount
- PrepRequestProcessor now throws `KeeperException.UnimplementedException` when an attempt to create a TTL node is made but the server has not been configured to enable TTL Nodes.
- QuorumPeer throws a `RuntimeException` if TTL Nodes are enabled but the Server ID > 254
- Tests have been added to validate all of this

IMPORTANT NOTE: TTL Nodes created in 3.5.3 will revert to EPHEMERAL with this change. We need to discuss the impact of this and consider workarounds, etc.

Author: randgalt <jordan@jordanzimmerman.com>
Author: Abraham Fine <afine@apache.org>

Reviewers: phunt@apache.org

Closes #377 from Randgalt/ZOOKEEPER-2901

Change-Id: I6923a22ecf847710d4e7151daf8c044734873f6b",2018-05-09 14:57:41,randgalt,Mixed
088dfdf188663f6bad79b0e87b710737b318537d,ZOOKEEPER-2959: ignore accepted epoch and LEADERINFO ack from observers,2018-05-09 21:00:15,Alexander Shraer,Not TDD
6e64125f2aafc29253904c43ee44233c907e5fca,"ZOOKEEPER-3038: Cleanup some nitpicks in TTL implementation

A few nitpicks which needs to be cleaned up:

1. Rename OldEphemeralType --> EphemeralTypeEmulate353
2. Remove unused method: getTTL()
3. Remove unused import from QuorumPeer

Author: Andor Molnar <andor@cloudera.com>

Reviewers: phunt@apache.org

Closes #516 from anmolnar/ZOOKEEPER-3038

Change-Id: Iec537706a35863d53daa593da2b01f6e523ef466",2018-05-09 21:13:16,Andor Molnar,Not TDD
2fa315b7d0ed65828479fcdcc9e76ca8552fba4a,"ZOOKEEPER-3039: TxnLogToolkit uses Scanner badly

Fixed by creating a single Scanner for all queries in the main() method.

Author: Andor Molnar <andor@cloudera.com>

Reviewers: phunt@apache.org

Closes #517 from anmolnar/ZOOKEEPER-3039 and squashes the following commits:

a35e2e280 [Andor Molnar] ZOOKEEPER-3039. Optimize imports
a196443cb [Andor Molnar] ZOOKEEPER-3039. Use the same Scanner for all queries

Change-Id: Icf66888d4e6ad902615ed8ffde58a5a8fdd41237",2018-05-10 13:14:24,Andor Molnar,Mixed
9c4bd4d335c52beb44f303b8b6e0abfe03cb9241,"ZOOKEEPER-1919 Update the C implementation of removeWatches to have it match ZOOKEEPER-1910

Existing patch on Jira has been rebased and applied to master.

Replaces #511

Author: Andor Molnar <andor@cloudera.com>

Reviewers: phunt@apache.org

Closes #522 from anmolnar/ZOOKEEPER-1919 and squashes the following commits:

f81a7608a [Andor Molnar] ZOOKEEPER-1919. Fixed indentation
d6455b062 [Andor Molnar] ZOOKEEPER-1919. Test fixes
769677693 [Andor Molnar] ZOOKEEPER-1919. Changes in C code

Change-Id: I2597854e4b28196a5dc5dc89553ced41537663eb",2018-05-29 16:27:43,Andor Molnar,Not TDD
fa34d0d01e33a40465ebd72497f37d62f0a4bce0,"ZOOKEEPER-3043: QuorumKerberosHostBasedAuthTest fails on Linux box: Unable to parse:includedir /etc/krb5.conf.d/

Fixes QuorumKerberosHostBasedAuthTest, see ZOOKEEPER-3043

 - upgrade Kerby to 1.0.0
 - upgrade commons-io to 2.5, needed by Kerby
 - fix test dir in KerberosTestUtils

This should be also cherry-picked to 3.5 branch

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: phunt@apache.org

Closes #524 from eolivelli/fix/ZOOKEEPER-3043 and squashes the following commits:

b4f31ad67 [Enrico Olivelli] upgrade libs
e224e823e [Enrico Olivelli] QuorumKerberosHostBasedAuthTest fails on Linux box: Unable to parse:includedir /etc/krb5.conf.d/  - upgrade Kerby to 1.0.0  - upgrade commons-io to 2.5, needed by Kerby  - fix test dir in KerberosTestUtils

Change-Id: Idaa0c05d1212c936b60fa2aa5ccb9dee114cce49",2018-05-29 17:02:56,Enrico Olivelli,Not TDD
a2623a625a4778720f7d5482d0a66e9b37ae556f,"ZOOKEEPER-3019: add metric for slow fsyncs count

Added metric to count fsyncWarningThresholdMS exceed in FileTxnLog.commit(). Both jmx bean and Command can be used to get the stat.

Also updated the python standalone client and documentation.

Tested the py script, i.e.:
src/contrib/monitoring/check_zookeeper.py -o cacti -s ""localhost:2181"" -k zk_num_alive_connections
localhost_2181:1

rc/contrib/monitoring/check_zookeeper.py -o cacti -s ""localhost:2181"" -k zk_fsync_threshold_exceed_count
localhost_2181:0

mntr command now returns:
zk_version	3.6.0-SNAPSHOT-13c9f899ff62be6a2eacb28e522d06703f1dab08, built on 04/04/2018 12:09 GMT
zk_avg_latency	0
zk_max_latency	0
zk_min_latency	0
zk_packets_received	7
zk_packets_sent	6
zk_num_alive_connections	1
zk_outstanding_requests	0
zk_server_state	standalone
zk_znode_count	5
zk_watch_count	0
zk_ephemerals_count	0
zk_approximate_data_size	44
zk_open_file_descriptor_count	61
zk_max_file_descriptor_count	10240
zk_fsync_threshold_exceed_count	0

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: Andor Molnar <andor@apache.org>

Closes #501 from nkalmar/ZOOKEEPER-3019 and squashes the following commits:

067edf6a [Norbert Kalmar] ZOOKEEPER-3019 remove redundant log
7430dbce [Norbert Kalmar] ZOOKEEPER-3019 remove metric from 4ltr command as no longer supported
1916a418 [Norbert Kalmar] ZOOKEEPER-3019 add extra warning log
761450f9 [Norbert Kalmar] ZOOKEEPER-3019 remove fsync from py script stat check
3b22bb7b [Norbert Kalmar] ZOOKEEPER-3019 remove fsyncEsceed from stats
0be003a8 [Norbert Kalmar] ZOOKEEPER-3019 exclude serverStats IS chec from findbugs
b48d2958 [Norbert Kalmar] ZOOKEEPER-3019 add unit test and fix PR comments
fb4c7a31 [Norbert Kalmar] ZOOKEEPER-3019 add metric to track slow fsyncs count + update py script and docs",2018-06-08 16:52:58,Norbert Kalmar,Mixed
2a951868bda3b7343069f9155f6404c3d9d5aa8e,"[ZOOKEEPER-2368] Send a watch event is when a client is closed

Currently, if the client is closed (rather than being remotely disconnected) there is no notification to the watcher. This means that asynchronous clients can end up waiting indefinitely for events that will never come. Watchers need to be aware that the client is closed for good.

Signed-off-by: Tim Ward <timothyjwardapache.org>

Note that this is a variation on a patch I produced some time ago, which was broadly accepted as a good idea, and didn't cause any problems for Curator, but was deemed by some to be too risky because it reused an existing KeeperState. This patch is therefore updated to use a new `Closed` KeeperState. Fixing this would allow me to avoid maintaining a separate fork of Zookeeper just to support this one feature!

Author: Tim Ward <timothyjward@apache.org>

Reviewers: Andor Molnar <andor@apache.org>

Closes #529 from timothyjward/ZOOKEEPER-2368 and squashes the following commits:

d7196d19 [Tim Ward] Review comments from @anmolnar
088056b4 [Tim Ward] Review comments from @enixon
7fad1d36 [Tim Ward] [ZOOKEEPER-2368] Send a watch event is when a client is closed

(cherry picked from commit 6748a0e3f58f2a398dec4c6988bc70ea4363b807)
Signed-off-by: Andor Molnar <andor@cloudera.com>",2018-06-20 15:22:30,Tim Ward,Mixed
1fb644662b8e0530dec2c5668a3e49b3f614e9de,"ZOOKEEPER-3059: EventThread leak in case of Sasl AuthFailed

Since authFailed is similar to session expired and is considered a fatal event, we should clean up after ourselves once we get a AuthFailed, other wise this results in an unavoidable and un-cleanable thread leak  of EventThread since the close operation is also a no-op (we return after checking for isAlive).

Author: Abhishek Singh Chouhan <abhishekchouhan121@gmail.com>

Reviewers: Andor Molnar <andor@apache.org>

Closes #541 from abhishek-chouhan/master and squashes the following commits:

c54a83a4 [Abhishek Singh Chouhan] ZOOKEEPER-3059 EventThread leak in case of Sasl AuthFailed. Adding testcase for the scenario
c1d9d7af [Abhishek Singh Chouhan] ZOOKEEPER-3059 EventThread leak in case of Sasl AuthFailed",2018-06-25 12:30:19,Abhishek Singh Chouhan,Not TDD
3465e0ced5edda2e1299662f6b75a1979b6bdc6e,"ZOOKEEPER-3066: Expose on JMX of Followers the id of the current leader

Expose a new JMX attribute ""isLeader"" in RemotePeerBean and LocalPeerBean

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: Andor Molnar <andor@apache.org>

Closes #546 from eolivelli/fix/ZOOKEEPER-3066-leader-jmx and squashes the following commits:

bf09e37d [Enrico Olivelli] clean up spaces
ded4ce20 [Enrico Olivelli] reorder imports
81d7bb1c [Enrico Olivelli] split tests into LocalPeerBeanTest and QuorumPeerTest
a1984ef1 [Enrico Olivelli] fix typo
eb8d1bea [Enrico Olivelli] split tests
86b116b0 [Enrico Olivelli] enhance tests
b5000efc [Enrico Olivelli] clean up test
43782fe5 [Enrico Olivelli] introduce mockito tests
2778e742 [Enrico Olivelli] revert ""ZOOKEEPER-3066 add servers restart to test case""
5f120631 [Enrico Olivelli] ZOOKEEPER-3066 add servers restart to test case
067aed9e [Enrico Olivelli] ZOOKEEPER-3066 Expose on JMX of Followers the id of the current leader Enhance RemotePeerMXBean and LocalPeerMXBean by adding information about leadership",2018-06-26 11:18:38,Enrico Olivelli,Mixed
25fd549dcd4e01de073a2e25ef07c170389b28ea,"ZOOKEEPER-2873: abort startup on invalid ports

This change will check each server.x config if the client and election port are the same. Currently, ZK will startup and a race for the ports will take place. There will be an error, but ZK will keep running (without the ability to elect a leader). Now, ZK will fail on startup.

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: Andor Molnar <andor@apache.org>

Closes #549 from nkalmar/ZOOKEEPER-2873 and squashes the following commits:

022c8b70 [Norbert Kalmar] ZOOKEEPER-2873 modify test case to expect exception
60b8128d [Norbert Kalmar] ZOOKEEPER-2873 fix old test - ReconfigTest.testUnspecifiedClientAddress
3d747c08 [Norbert Kalmar] ZOOKEEPER-2873 abort startup on invalid ports",2018-07-04 17:11:39,Norbert Kalmar,Not TDD
b593a8de1cc48534661526685e39d812aa680d36,"ZOOKEEPER-2886: Permanent session moved error in multi-op only conne…

…ctions

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: Andor Molnár <andor@apache.org>, Benjamin Reed <breed@apache.org>

Closes #353 from lvfangmin/ZOOKEEPER-2886",2018-07-10 03:46:36,Fangmin Lyu,Not TDD
5fdd70ac49c7a5334bdcae309719ac4ada352dde,"ZOOKEEPER-3073: fix couple of typos

Author: Christine Poerschke <cpoerschke@bloomberg.net>

Reviewers: Norbert Kalmar <nkalmar@cloudera.com>, 毛蛤丝 <maoling199210191@sina.com>, Benjamin Reed <breed@apache.org>

Closes #554 from cpoerschke/master-ZOOKEEPER-3073",2018-07-10 04:29:20,Christine Poerschke,Not TDD
328b9de0152f987429534c8adcb2ce2866c5733e,"ZOOKEEPER-2940: Deal with maxbuffer as it relates to large requests from clients

https://issues.apache.org/jira/browse/ZOOKEEPER-2940

This PR covers the other part of Jute buffer monitoring which relates to client response sizes.

`jute.maxbuffer` is often set too small or the default (4MB) value is not enough to receive large responses from the server which causes the client unable to operate. e.g. `getChildren()` on a node which has lots of children or execution of a large multi.

These new metrics lets operators to monitor the size of generated responses to get an idea on how to properly set client's `jute.maxbuffer`.

The other part of monitoring which relates to proposal size has already been merged https://github.com/apache/zookeeper/pull/415

Author: Andor Molnar <andor@cloudera.com>

Reviewers: phunt@apache.org

Closes #466 from anmolnar/ZOOKEEPER-2940 and squashes the following commits:

29224d021 [Andor Molnar] ZOOKEEPER-2940. Test fixes
486d4961d [Andor Molnar] ZOOKEEPER-2940. Removed support of 4lw commands, because master is targeted
60916e09e [Andor Molnar] ZOOKEEPER-2940. Code review fixes
b39c4c815 [Andor Molnar] ZOOKEEPER-2940. Code review: variable names renamed to proposalStats
87e72ff31 [Andor Molnar] ZOOKEEPER-2940. Some code review cleanups
6f0adb124 [Andor Molnar] ZOOKEEPER-2940. Code review fixes: stats class renamed, added comments to unit test asserts, updated docs
bcb6d4ca5 [Andor Molnar] ZOOKEEPER-2940. Added new metrics to python files
77a5f0aa8 [Andor Molnar] ZOOKEEPER-2940. Fixed failing unit tests
2def61c30 [Andor Molnar] ZOOKEEPER-2940. Track size of client responses

Change-Id: I68df371097cc355b1f41b8dbb0168da4fa5dee43",2018-07-11 16:35:55,Andor Molnar,Mixed
28de451aa8b45e94d1261d5e0e369f86bf3815da,"ZOOKEEPER-3033: MAVEN MIGRATION - Step 1.2 - create zk-recipes maven structure

Create the zk-recipes maven structure for the maven migration.
Tested the recipes build with the new directory structure.

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: andor@apache.org

Closes #564 from nkalmar/ZOOKEEPER-3033 and squashes the following commits:

c8c2e986 [Norbert Kalmar] ZOOKEEPER-3033 rename sub directories as well
d2b7f18d [Norbert Kalmar] ZOOKEEPER-3033 create zk-recipes maven structure",2018-07-13 14:58:03,Norbert Kalmar,Mixed
0a311873deb1847703c9b62716c626ce43d4ba48,"ZOOKEEPER-2184: Zookeeper Client should re-resolve hosts when connection attempts fail

This is the master/3.5 port of #451

Author: Andor Molnar <andor@cloudera.com>
Author: Andor Molnar <andor@apache.org>

Reviewers: Michael Han <hanm@apache.org>, Flavio Junqueira <fpj@apache.org>, Edward Ribeiro <edward.ribeiro@gmail.com>, Mark Fenes <mfenes@cloudera.com>, Abraham Fine <afine@apache.org>

Closes #534 from anmolnar/ZOOKEEPER-2184_master",2018-07-15 20:45:45,Andor Molnar,Mixed
ed4689fbf81c56f09be26cf32ede66ad191f4aed,"ZOOKEEPER-3068: Improve C client logging of IPv6 hosts

Author: Brian Nixon <nixon@fb.com>
Author: enixon <brian.nixon.cs@gmail.com>

Reviewers: andor@apache.org

Closes #547 from enixon/ZOOKEEPER-3068 and squashes the following commits:

63eb18ef [enixon] Merge branch 'master' into ZOOKEEPER-3068
e3cf7f83 [Brian Nixon] change boolean from int to char
cd404534 [Brian Nixon] ZOOKEEPER-3068: Improve C client logging of IPv6 hosts",2018-07-20 17:40:42,Brian Nixon,Not TDD
9f82798415351a20136ceb1640b1781723e51cc1,"ZOOKEEPER-2251: Add Client side packet response timeout to avoid infinite wait.

Add Client side packet response timeout to avoid infinite wait.

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Michael Han <hanm@apache.org>, nrico Olivelli <eolivelli@gmail.com>

Closes #119 from arshadmohammad/ZOOKEEPER-2251",2018-07-26 20:16:04,Mohammad Arshad,Not TDD
ba8932dccb227b5b52de98e33c46054014f951b7,"ZOOKEEPER-3057: Fix IPv6 literal usage

This patch contains fixes for IPv6 literal usage and corresponding unit test changes.

As per discussion in ZOOKEEPER-3057 - The issue/problem is the same as ZOOKEEPER-2989, but we changed the code to pass IPv6 literal [%s]:%s, also we changed the logging and the LocalPeerBean to show this IPv6 literal as well, which makes it easier to check when using Ipv6 and we added detailed tests for this change, sending out for review to see if it's better or not.

ZKPatch: 88e94e6f3665353446bf70a042c8f0cd50834f7c (extract)

Author: Mohamed Jeelani <mjeelani@fb.com>
Author: Jeelani Mohamed Abdul Khader <mjeelani@devvm3360.prn2.facebook.com>

Reviewers: breed@apache.org, andor@apache.org

Closes #548 from mjeelanimsft/fix-ipv6-literal and squashes the following commits:

69c60b74 [Mohamed Jeelani] Fix method rename from splitServerConfig(s) to getHostAndPort(s)
47f7a854 [Mohamed Jeelani] Incorporating review feedback from @maoling
ff470498 [Mohamed Jeelani] Incorporating Review Feedback - Adding Unit Tests
f932e16e [Mohamed Jeelani] Added Unit Test and JavaDoc for splitServerConfig()
43e19e93 [Mohamed Jeelani] Incorporating code review comments
33f695f2 [Jeelani Mohamed Abdul Khader] Fix IPv6 literal usage",2018-07-27 12:32:45,Mohamed Jeelani,Mixed
01132edbd4df3df4472a2f8d3077fe585035cce1,"ZOOKEEPER-3067: Optionally disable client environment logging.

Although logging the client environment at initialization can be
helpful for filing bug reports, it tends not to be that helpful
for internal applications. It also introduces a dependency on UID
lookups (via getlogin) that application otherwise may not desire.

Author: James Peach <jpeach@apache.org>

Reviewers: breed@apache.org, andor@apache.org

Closes #565 from jpeach/ZOOKEEPER-3067",2018-07-27 12:40:33,James Peach,Not TDD
932fee861001c158343c0bc64dbe80f253f0bb6d,"ZOOKEEPER-3095: Connect string fix for non-existent hosts

ZKPatch: eda58d9970c76831046ddc45251c9b110856836e (extract)

Author: Jeelani Mohamed Abdul Khader <mjeelani@devvm3360.prn2.facebook.com>

Reviewers: Benjamin Reed <breed@apache.org>

Closes #579 from mjeelanimsft/connect-string-fix-for-non-existent-hosts",2018-07-27 19:46:31,Jeelani Mohamed Abdul Khader,Not TDD
78e4a1047c701006dd4ec8d09065eda0e7adedb5,"ZOOKEEPER-3082: Fix server snapshot behavior when out of disk space

Author: Brian Nixon <nixon@fb.com>

Reviewers: Benjamin Reed <breed@apache.org>, Michale Han <hanm@apache.org>

Closes #560 from enixon/ZOOKEEPER-3082",2018-07-29 21:22:23,Brian Nixon,Not TDD
7cf8035c3a5ca05bce2d183b41bf410709a5f6ee,"ZOOKEEPER-3062: mention fsync.warningthresholdms in FileTxnLog LOG.warn message

https://issues.apache.org/jira/browse/ZOOKEEPER-3062

Author: Christine Poerschke <cpoerschke@bloomberg.net>

Reviewers: phunt@apache.org

Closes #566 from cpoerschke/master-ZOOKEEPER-3062 and squashes the following commits:

2bcccf62d [Christine Poerschke] Action code review feedback.
a2dc484d4 [Christine Poerschke] ZOOKEEPER-3062: mention fsync.warningthresholdms in FileTxnLog LOG.warn message

Change-Id: Id675e61a9ef0b247d65eaa36bb88c8569d177c49",2018-08-01 12:19:34,Christine Poerschke,Mixed
148c2cd6ba73e66b1879a2e10ecda4ce4e0e2c7b,"ZOOKEEPER-3104: Fix data inconsistency due to NEWLEADER being sent too early

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: Benjamin Reed <breed@apache.org>, Norbert Kalmar <nkalmar@yahoo.com>

Closes #583 from lvfangmin/ZOOKEEPER-3104",2018-08-03 09:52:08,Fangmin Lyu,Not TDD
b0df8fe1e10e63aa2b268e126d109cc61ea2d33c,"ZOOKEEPER-3030: MAVEN MIGRATION - Step 1.3 - move contrib directories

Move the contrib projects according to new directory structure.
In the PR src/contrib/zkperl/build/check_zk_version.c and .h looks like I removed the file. but everything looks good on my local (I just moved them, did not modify anything). Will investigate further.

DO-NOT-MERGE-YET: Checking if creating the maven structure of directories now will break anything other then the already different directory structure in build/zookeeper-[version]/src/ (I will write an e-mail about this on dev list)

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: andor@apache.org

Closes #574 from nkalmar/ZOOKEEPER-3030 and squashes the following commits:

49b7519b [Norbert Kalmar] ZOOKEEPER-3030 create maven dir structure
9f19ab06 [Norbert Kalmar] ZOOKEEPER-3030 fix releaseaudit license missing exclusions
59d9d17d [Norbert Kalmar] ZOOKEEPER-3030 add missing files in dist.dir
165d4dc5 [Norbert Kalmar] ZOOKEEPER-3030 - MAVEN MIGRATION - move contrib directories",2018-08-06 14:13:17,Norbert Kalmar,Mixed
cd209456b67cde5aba771b1a240ebe5607398459,"ZOOKEEPER-2926: Fix potential data consistency issue due to the session management bug

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: Michael Han <hanm@apache.org>, Andor Molnar <andor@cloudera.com>

Closes #447 from lvfangmin/ZOOKEEPER-2926",2018-08-07 21:21:37,Fangmin Lyu,Mixed
2584625cdf4bb917192479f637222d6e64518336,"ZOOKEEPER-3033: MAVEN MIGRATION - fix directory structure

I reopened step 1.2 to fix the directory structure of the recipes, as it is better to do every directory change at once. (As it has been done in step 1.3 already - first step, docs is irrelevant in this manner).

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: andor@apache.org

Closes #599 from nkalmar/ZOOKEEPER-3033_fix",2018-08-17 11:56:09,Norbert Kalmar,Mixed
290f1fc4b907c7d51ec81985e87ef46b8528b8f7,"ZOOKEEPER-3117: Correct the LeaderBean.followerInfo to only return the followers list

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: andor@apache.org

Closes #595 from lvfangmin/ZOOKEEPER-3117",2018-08-17 14:40:02,Fangmin Lyu,Mixed
176bd68222f3a3bddac9deb412eee7f538cb01ca,"ZOOKEEPER-3031: MAVEN MIGRATION - Step 1.4 - move client dir

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: andor@apache.org

Closes #597 from nkalmar/ZOOKEEPER-3031",2018-08-21 07:30:53,Norbert Kalmar,Not TDD
4d7b9e8f34775261fed517d232094f0247a4d3cf,"ZOOKEEPER-3109: Avoid long unavailable time due to voter changed mind during leader election

For more details, please check descriptions in https://issues.apache.org/jira/browse/ZOOKEEPER-3109

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: breed, hanm

Closes #588 from lvfangmin/ZOOKEEPER-3109",2018-08-28 21:26:58,Fangmin Lyu,Not TDD
b7181d2c5a48accbd47e30430ccfe1291a91d900,"ZOOKEEPER-3080: MAVEN MIGRATION - Step 1.5 - move jute dir

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: andor@apache.org

Closes #609 from nkalmar/ZOOKEEPER-3080",2018-09-03 11:57:50,Norbert Kalmar,Mixed
687ea7e7cecf1449687e05819502be28cb49cb66,"ZOOKEEPER-3116: Make the DataTree.approximateDataSize more efficient

Cache the approximate data tree size, and update it when txns applied to data tree, this could make this query not that expensive.

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: andor@apache.org

Closes #594 from lvfangmin/ZOOKEEPER-3116 and squashes the following commits:

ad2ce216 [Fangmin Lyu] move to synchronize when visiting node.data
2e0cbb17 [Fangmin Lyu] add test case to test cached approximate data tree size
21243f5e [Fangmin Lyu] cache the approximate data size in DataTree",2018-09-04 11:54:23,Fangmin Lyu,Mixed
e501d9cc67fbaa6e825292fd838711259b6c9789,"ZOOKEEPER-3127: Fixing potential data inconsistency due to update last processed zxid with partial multi-op txn

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: Benjamin Reed <breed@apache.org>, Michael Han <hanm@apache.org>

Closes #606 from lvfangmin/ZOOKEEPER-3127",2018-09-05 13:35:38,Fangmin Lyu,Not TDD
95557a30edbdfdf4479a1cb142e0d82a4ba6061d,"ZOOKEEPER-3131: Remove watcher when session closed in NettyServerCnxn

Currently, it doesn't remove itself from ZK server when the cnxn is closed, which
will leak watchers, close it to make it align with NIO implementation.

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: hanm, anmolnar, nkalmar

Closes #612 from lvfangmin/ZOOKEEPER-3131",2018-09-06 17:34:55,Fangmin Lyu,Mixed
4ad2341c18020ecb08e7e26b79cacc3569b9d31e,"ZOOKEEPER-2261: When only secureClientPort is configured connections, configuration, connection_stat_reset, and stats admin commands throw NullPointerException

Root cause of the issue is that property getter returns the non-secure ServerCnxnFactory instance always. When Quorum SSL is enabled, we set a separate field which is the secure instance.

Property getter should detect the scenario and return the proper instance.

First commit contains some refactoring: shuffling the existing ZooKeeperServer tests to relevant places.
Second commit is the actual fix + new unit tests.

Sorry about indentation changes, but `FileTxnLogTest.java` was indented by 2 spaces instead of 4.

Author: Andor Molnar <andor@apache.org>
Author: Andor Molnar <andor@cloudera.com>

Reviewers: breed, hanm, nkalmar

Closes #545 from anmolnar/ZOOKEEPER-2261",2018-09-10 15:17:45,Andor Molnar,Mixed
ef8b5ab263270e41504dddc5fcc8c6b3419e5b4b,"ZOOKEEPER-3123: MetricsProvider Lifecycle in ZooKeeper Server

Manage the lifecycle of a MetricsProvider inside a ZooKeeper server.
- handle configuration
- start and configure the MetricsProvider
- notify shutdown to the MetricsProvider

This is an early preview, because there are some points to discuss:
- We have to throw an IOException in case of failure (in order not to change the current signature of main methods used to start the server)
- The patch only provides the lifecycle, it introduces some dead fields (root metrics context), this is expected as the real instrumentation will be done in a further step, is it okay ?
- Test cases cover only standalone mode, do we need to add a new suite for testing configuration and boot errors on QuorumPeer mode ? (the answer should be YES)
- MetricsProvider configuration is not subject to dynamic 'reconfig'

Configuration to the MetricsProvider is not yet handled, the idea is to let the user configure properties like
metricsProvider.className=o.a.z.metrics.prometheus.PrometheusMetricsProvider
metricsProvider.customParam1=value1
metricsProvider.customParam2=value2

in this case the MetricsProvider will receive {customParam1=value1, customParam2=value2} as parameter in configure()

is it okay ?

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #601 from eolivelli/fix/boot-provider and squashes the following commits:

8964ed17 [Enrico Olivelli] Fix tests, use getters in order to support Mock QuorumPeerConfig
93749f6a [Enrico Olivelli] fix imports
7ad552db [Enrico Olivelli] Add testcases around QuorumPeerMain
22f79eb8 [Enrico Olivelli] clean up
c92450e4 [Enrico Olivelli] implement MetricsProvider configuration, fix some review comments
f4f66ecb [Enrico Olivelli] ZOOKEEPER-3123 MetricsProvider Lifecycle in ZooKeeper Server",2018-09-11 15:23:32,Enrico Olivelli,Mixed
6651a126cd85ced8b26786875b81be140ad97c80,"ZOOKEEPER-3125: Fixing pzxid consistent issue when replaying a txn for a deleted node

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: breed@apache.org, andor@apache.org

Closes #605 from lvfangmin/ZOOKEEPER-3125",2018-09-12 13:29:13,Fangmin Lyu,Not TDD
71630081262f4b05e6a86beb7c0c10924e2f04d3,"ZOOKEEPER-3137: add a utility to truncate logs to a zxid

Author: Brian Nixon <nixon@fb.com>

Reviewers: Michael Han <hanm@apache.org>, Andor Molnár <andor@apache.org>

Closes #615 from enixon/add-chop",2018-09-14 15:03:48,Brian Nixon,Mixed
b58791016424e662c816e2253de96f3771f5d301,"ZOOKEEPER-3144: Fix potential ephemeral nodes inconsistent due to global session inconsistent with fuzzy snapshot

There is a race condition between update the lastProcessedZxid and the actual session change in DataTree, which could cause global session inconsistent, which then could cause ephemeral inconsistent.

For more details, please check the description in JIRA ZOOKEEPER-3144.

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: Michael Han <hanm@apache.org>

Closes #621 from lvfangmin/ZOOKEEPER-3144",2018-09-14 15:08:19,Fangmin Lyu,Not TDD
f4cbb689ad7bb03ca6da0d5de3ecb344165f379a,"ZOOKEEPER-3098: Add additional server metrics

This patch adds several new server-side metrics as well as makes it easier to add new metrics in the future. This patch also includes a handful of other minor metrics-related changes.

Here's a high-level summary of the changes.

1. This patch extends the request latency tracked in `ServerStats` to
   track `read` and `update` latency separately. Updates are any request
   that must be voted on and can change data, reads are all requests that
   can be handled locally and don't change data.

2. This patch adds the `ServerMetrics` logic and the related `AvgMinMaxCounter`
   and `SimpleCounter` classes. This code is designed to make it incredibly easy to
   add new metrics. To add a new metric you just add one line to `ServerMetrics` and
   then directly reference that new metric anywhere in the code base. The `ServerMetrics`
   logic handles creating the metric, properly adding the metric to the JSON output of
   the `/monitor` admin command, and properly resetting the metric when necessary.

   The motivation behind `ServerMetrics` is to make things easy enough that it encourages
   new metrics to be added liberally. Lack of in-depth metrics/visibility is a long-standing
   ZooKeeper weakness. At Facebook, most of our internal changes build on `ServerMetrics` and
   we have nearly 100 internal metrics at this time -- all of which we'll be upstreaming
   in the coming months as we publish more internal patches.

3. This patch adds 20 new metrics, 14 which are handled by `ServerMetrics`.

4. This patch replaces some uses of `synchronized` in `ServerStats` with atomic operations.

Here's a list of new metrics added in this patch:

- `uptime`: time that a peer has been in a stable leading/following/observing state
- `leader_uptime`: uptime for peer in leading state
- `global_sessions`: count of global sessions
- `local_sessions`: count of local sessions
- `quorum_size`: configured ensemble size
- `synced_observers`: similar to existing `synced_followers` but for observers
- `fsynctime`: time to fsync transaction log (avg/min/max)
- `snapshottime`: time to write a snapshot (avg/min/max)
- `dbinittime`: time to reload database -- read snapshot + apply transactions (avg/min/max)
- `readlatency`: read request latency (avg/min/max)
- `updatelatency`: update request latency (avg/min/max)
- `propagation_latency`: end-to-end latency for updates, from proposal on leader to committed-to-datatree on a given host (avg/min/max)
- `follower_sync_time`: time for follower to sync with leader (avg/min/max)
- `election_time`: time between entering and leaving election (avg/min/max)
- `looking_count`: number of transitions into looking state
- `diff_count`: number of diff syncs performed
- `snap_count`: number of snap syncs performed
- `commit_count`: number of commits performed on leader
- `connection_request_count`: number of incoming client connection requests
- `bytes_received_count`: similar to existing `packets_received` but tracks bytes

Author: Joseph Blomstedt <jdb@fb.com>

Reviewers: Allan Lyu <fangmin@apache.org>, Andor Molnár <andor@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, Michael Han <hanm@apache.org>

Closes #580 from jtuple/ZOOKEEPER-3098",2018-09-17 16:00:15,Joseph Blomstedt,Mixed
e116d32b63039fe9f0677f0af76c0a77fe74c82b,"ZOOKEEPER-2847: Cannot bind to client port when reconfig based on old static config

Fixed the issue where clientPortAddress in the static config is not correctly saved in QuorumVerifier. This can cause zookeeper attempting to re-bind to a port already in use during dynamic reconfiguration, failing to recognize that the new port and the current port are identical.

Author: Yisong Yue <yisongyue@fb.com>

Reviewers: hanm@apache.org

Closes #620 from yisong-yue/ZOOKEEPER-2847",2018-09-21 21:43:45,Yisong Yue,Mixed
4ebb847bceb5ebd5c9fa53574f266c204f6f8ab7,"ZOOKEEPER-3146: Limit the maximum client connections per IP in NettyServerCnxnFactory

Add similar max cnxn per ip throttling logic to Netty implementation.

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: hanm@apache.org

Closes #623 from lvfangmin/ZOOKEEPER-3146",2018-09-21 21:48:13,Fangmin Lyu,Not TDD
fdde8b006458f7b989c894af0eac7e124d271a1e,"ZOOKEEPER-1177: Add the memory optimized watch manager for concentrate watches scenario

The current HashSet based WatcherManager will consume more than 40GB memory when
creating 300M watches.

This patch optimized the memory and time complexity for concentrate watches scenario, compared to WatchManager, both the memory consumption and time complexity improved a lot. I'll post more data later with micro benchmark result.

Changed made compared to WatchManager:
* Only keep path to watches map
* Use BitSet to save the memory used to store watches
* Use ConcurrentHashMap and ReadWriteLock instead of synchronized to reduce lock retention
* Lazily clean up the closed watchers

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: Andor Molnár <andor@apache.org>, Norbert Kalmar <nkalmar@yahoo.com>, Michael Han <hanm@apache.org>

Closes #590 from lvfangmin/ZOOKEEPER-1177",2018-09-28 14:38:24,Fangmin Lyu,Mixed
78f8b814d2855430b7917dffb5c989195cdb2630,"ZOOKEEPER-1908: setAcl should be have a recursive function

Let setAcl support recursive option, a UT is included.

Author: Reid Chan <reidchan@apache.org>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #650 from Reidddddd/ZOOKEEPER-1908 and squashes the following commits:

2d0b33fd [Reid Chan] ZOOKEEPER-1908: Address review comments
9c9c1bb9 [Reid Chan] ZOOKEEPER-1908: Add unit test for setAcl recursive
9ec3d837 [Reid Chan] ZOOKEEPER-1908: setAcl should be have a recursive function",2018-10-04 15:46:28,Reid Chan,Not TDD
faa7cec71fddfb959a7d67923acffdb67d93c953,"ZOOKEEPER-3032: MAVEN MIGRATION - move java server, client

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: hanm@apache.org, andor@apache.org

Closes #633 from nkalmar/ZOOKEEPER-3032 and squashes the following commits:

3f9a0eca [Norbert Kalmar] ZOOKEEPER-3032 fix flaky QuorumPeerMainTest.testLeaderElectionWithDisloyalVoter_stillHasMajority
27295ed6 [Norbert Kalmar] ZOOKEEPER-3032 - MAVEN MIGRATION - move java server, client",2018-10-05 14:25:43,Norbert Kalmar,Mixed
effa016c621aea5debd640181b3e07b86fc14e0d,"ZOOKEEPER-3106: Zookeeper client supports IPv6 address and document the ""IPV6 feature""

The related UTs in the `ConnectStringParserTest` have all passed,I also tested it in the real IPv6 ENV.
More details in [ZOOKEEPER-3106](https://issues.apache.org/jira/browse/ZOOKEEPER-3106)

Author: maoling <maoling199210191@sina.com>

Reviewers: andor@apache.org

Closes #587 from maoling/ZOOKEEPER-3106 and squashes the following commits:

22e20252 [maoling] fix a flaky test:ClientPortBindTest.testBindByAddress
4bb31f6f [maoling] rebase to solve the conflict in the zookeeperAdmin.xml
45091b91 [maoling] reuse the ConfigUtils.getHostAndPort()
fa984b51 [maoling] remove useless tab & add some annotations
bafc542a [maoling] ZOOKEEPER-3106: Zookeeper client supports IPv6 address and document the IPV6 feature",2018-10-08 14:33:38,maoling,Mixed
7b679bc9dd98f06ee10bbb0978cfee5dab7b74dc,"ZOOKEEPER-236: SSL Support for Atomic Broadcast protocol (master)

Cherry-picked from branch-3.5.

Author: Andor Molnar <andor@apache.org>
Author: Abraham Fine <afine@apache.org>

Reviewers: hanm@apache.org, breed@apache.org

Closes #655 from anmolnar/ZOOKEEPER-236_master and squashes the following commits:

8c3aa11e [Andor Molnar] ZOOKEEPER-3165: Java 9: X509UtilTest.testCreateSSLContextWithoutTrustStorePassword fails
eb272749 [Abraham Fine] ZOOKEEPER-236: SSL Support for Atomic Broadcast protocol",2018-10-16 16:22:07,Andor Molnar,Mixed
cb9f303bda9137d1aebe8eff3eab85c8a59f3cdd,"ZOOKEEPER-3032: MAVEN MIGRATION - zookeeper-server

Separating the java code is not feasible. Moving common and client back to server.

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: andor@apache.org

Closes #672 from nkalmar/ZOOKEEPER-3032r",2018-10-19 14:39:50,Norbert Kalmar,Mixed
83fd6e298dda420125f8be35fda68cb226b0ee05,"ZOOKEEPER-3156: Add in option to canonicalize host name

This is the master and 3.5 version of #648.  It should apply cleanly to both lines, but if you want a separate pull request for each I am happy to do it.

Author: Robert Evans <evans@yahoo-inc.com>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #652 from revans2/ZOOKEEPER-3156",2018-11-05 10:40:55,Robert Evans,Not TDD
e5fc1228104410728646982eff84d4fb21b361ca,"ZOOKEEPER-3155: Remove Forrest XMLs and their build process from the …

…project

In this commit I've removed the forrest XML files and their result from the repository.
I've also removed the process to generate HTML and PDF files from the forrest files, since it's not needed anymore.

It also effects the test-github-pr.sh and test-patch.sh, since we do have less parameters for them (FORREST_HOME).

Change-Id: I30ecdb181f19eed05d86838b12c75e0c03e33710

Author: Tamas Penzes <tamaas@cloudera.com>

Reviewers: andor@apache.org

Closes #671 from tamaashu/ZOOKEEPER-3155",2018-11-06 09:50:15,Tamas Penzes,Not TDD
03286f29d29f4c1d3496ce87d1441df91422220e,"ZOOKEEPER-3173: Quorum TLS - support PEM trust/key stores

Add support for loading key and trust stores from PEM files.

Unfortunately, this PR includes 2 JIRAs, because it was quite difficult
to untangle the two features as they were developed at the same time
originally:

- ZOOKEEPER-3173: Quorum TLS - support PEM trust/key stores
- ZOOKEEPER-3175: Quorum TLS - test improvements

## Added support for PEM formatted key stores and trust stores
- key store and trust store files can now be in PEM format as well as JKS.
- Added config properties to tell ZK what type of trust/key store to load:
- `zookeeper.ssl.keyStore.type` and `zookeeper.ssl.trustStore.type` for ClientX509Util
- `zookeeper.ssl.quorum.keyStore.type` and `zookeeper.ssl.quorum.trustStore.type` for QuorumX509Util
- store type properties could have the values ""JKS"", ""PEM"", or not set
- leaving the type properties unset will cause auto-detection of the store type based on the file extension ("".jks"" or "".pem"")

## Added test utilities for easily creating X509 certs and using them in unit tests
- added new class `X509TestContext` and its friend, `X509TestHelpers`
- rewrote some existing unit tests to use these classes, and added new tests that use them
- some existing tests (i.e. `QuorumSSLTest`) should probably be ported to use this as well, haven't got around to it yet

Author: Ilya Maykov <ilyam@fb.com>

Reviewers: andor@apache.org

Closes #678 from ivmaykov/ZOOKEEPER-3173",2018-11-06 17:29:49,Ilya Maykov,Mixed
477fa0724fa66cc41d14e8a974ab4ac2a1b68433,"ZOOKEEPER-3162: Broken lock semantics in C client lock-recipe.

This PR fixes a few issues with the C client lock-recipe, as documented in more detailed in [ZOOKEEPER-3162](https://issues.apache.org/jira/browse/ZOOKEEPER-3162) on JIRA.

Details are also provided in the individual commits, but in short:
- Fix a bug in the choice of the predecessor node while trying to acquire the lock
- Fix a possible deadlock in zkr_lock_operation
- Fix the return value of zkr_lock_lock to abide to the prescribed semantics.

Author: Andrea Reale <realean2@ie.ibm.com>

Reviewers: andor@apache.org

Closes #662 from andreareale/ZOOKEEPER-3162 and squashes the following commits:

09f7ff4ed [Andrea Reale] Fixes deadlock in zoo_lock_operation
670d25a8e [Andrea Reale] Fix return semantics of zkr_lock_lock
2a1d66c4b [Andrea Reale] Bugfix on zookeeper-recipes-lock C implementation
a9b6a1a09 [Andrea Reale] Fix wrong include path for C recipes",2018-11-07 15:54:43,Andrea Reale,Not TDD
fe25fed9390a159b24f4c4fa31e3a7911f2c3b81,"ZOOKEEPER-3071: Add a config parameter to control transaction log size

Author: Suyog Mapara <suyogm@fb.com>
Author: Suyog Mapara <suyogm@devvm30625.prn1.facebook.com>

Reviewers: breed@apache.org, andor@apache.org

Closes #567 from suyogmapara/ZOOKEEPER-3071 and squashes the following commits:

0a2899994 [Suyog Mapara] Addressing comments
9d5765181 [Suyog Mapara] Update documentation per comments.
5201329bc [Suyog Mapara] Updating documentation
6d2b72058 [Suyog Mapara] Addressing comments
9386e2b6c [Suyog Mapara] ZOOKEEPER-3071: Updating comment to include more details about the feature
5a28efd72 [Suyog Mapara] ZOOKEEPER-3071: Addressing comments and fixing incorrect merge.
1aa12f9d3 [Suyog Mapara] ZOOKEEPER-3071: Add a config parameter to control transaction log size",2018-11-12 13:36:32,Suyog Mapara,Mixed
caca062767c36525e6ecead2ae0f34c447394809,"ZOOKEEPER-3152: Port ZK netty stack to netty4

Summary: Ported the client connection netty stack from netty3 to netty4. This includes both the server side (NettyServerCnxn and friends) and the client side (ClientCnxnSocketNetty).

Test Plan: Modified `FourLetterWordsTest` and `NettyServerCnxnTest`, plus manual testing on a regional ensemble.

FB Reviewers: nixon

Author: Ilya Maykov <ilyam@fb.com>

Reviewers: andor@apache.org

Closes #669 from ivmaykov/ZOOKEEPER-3152",2018-11-22 17:56:01,Ilya Maykov,Mixed
c3babb94275ad667dc71c10dcb08a383a3c154c2,"ZOOKEEPER-1441: JAVA 11 - Some test cases are failing because Port bind issue.

Fixes the Java 11 build issue.

**Issue**

`NIOServerCnxnFactory` doesn't properly close the socket when the shutdown() is called before the factory has even started. This is mostly the case in tests which use `QuorumUtil` that creates multiple QuorumPeers when instantiated without starting them and when `startAll()` gets called it shuts down the previous ones.

**Reason**

`Selectors` which have been registered with the socket must be closed in order to properly release the socket. `NIOServerCnxnFactory` registers selectors on instantiation, but only releases them in the thread run() method. So, if factory doesn't get started, it won't release the registered selectors.

This wasn't the issue before Java 11 and probably caused by:
https://www.oracle.com/technetwork/java/javase/11-relnote-issues-5012449.html#JDK-8198562

Also this is not an issue when ZooKeeper is used as a separate process (not embedded), because on shutdown the entire JVM stops anyway.

**Resolution**

I decided to try fixing the issue in the connection factory instead of fixing the tests only, because originally it's a bug in the way factory works. Resolution is to open selectors in lazy way: only when accept and selector thread starts, so they don't need to be released if the thread was not even started.

Author: Andor Molnar <andor@apache.org>

Reviewers: hanm@apache.org

Closes #700 from anmolnar/ZOOKEEPER-1441",2018-11-23 11:51:32,Andor Molnar,Mixed
64104eaeaa6508f052edfd39c24243a8e26039dc,"ZOOKEEPER-3172: Quorum TLS - fix port unification to allow rolling upgrades

Fix numerous problems with UnifiedServerSocket, such as hanging the accept() thread when the client doesn't send any data or crashing if less than 5 bytes are read from the socket in the initial read.

Re-enable the ""portUnification"" config option.

## Fixed networking issues/bugs in UnifiedServerSocket

- don't crash the `accept()` thread if the client closes the connection without sending any data
- don't corrupt the connection if the client sends fewer than 5 bytes for the initial read
- delay the detection of TLS vs. plaintext mode until a socket stream is read from or written to. This prevents the `accept()` thread from getting blocked on a `read()` operation from the newly connected socket.
- prepending 5 bytes to `PrependableSocket` and then trying to read >5 bytes would only return the first 5 bytes, even if more bytes were available. This is fixed.

Author: Ilya Maykov <ilyam@fb.com>

Reviewers: andor@apache.org

Closes #679 from ivmaykov/ZOOKEEPER-3172",2018-11-27 10:02:24,Ilya Maykov,Mixed
b7403b790ff8729f817680afcdef38cb98b87720,"ZOOKEEPER-1818: Correctly handle potential inconsistent zxid/electionEpoch and peerEpoch during leader election

This is similar to the 3.4 implementation in Jira ZOOKEEPER-1817, main differences with that:

1. removed bcVote, in Vote.equals it will skip compare peerEpoch when one of the version is 0x0.
2. added detailed scenarios which we tried to solve with peerEpoch update and the change in Vote.equals.
3. removed ooePredicate with inlined one, since master code is tracking voteSet..
4. improved the tests to make it cleaner.

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: hanm@apache.org, andor@apache.org

Closes #703 from lvfangmin/ZOOKEEPER-1818 and squashes the following commits:

022fcbb78 [Fangmin Lyu] update the comment in the test
b51e124c4 [Fangmin Lyu] update comment about the JIRA references
ccccac2aa [Fangmin Lyu] Correctly handle potential inconsitent zxid/electionEpoch and peerEpoch during leader election",2018-12-06 10:56:21,Fangmin Lyu,Not TDD
6ea3c0b6897ec3a833f5b86fe8612bc9b2ac672c,"ZOOKEEPER-2778: QuorumPeer: address potential reconfiguration deadlocks

* QuorumPeer: encapsulate quorum/election/client addresses in an AddressTuple held through an AtomicReference
* QuorumPeer/QuorumCnxManager: address deadlock and visibility issues
* QuorumPeer: add fast path for already-non-null quorum/election address
* QuorumPeer: fix access to newly private data members from ReconfigTest
* LeaderBeanTest: set up mock QuorumVerifier so that addresses get set
* QuorumPeer: warn when clobbering existing election algorithm
* QuorumPeer: halt old QCM when clobbering existing election algorithm

Author: Michael Edwards <medwards@bitpusher.com>

Reviewers: andor@apache.org

Closes #719 from mkedwards/ZOOKEEPER-2778-for-master",2018-12-07 12:41:50,Michael Edwards,Not TDD
b2513c114931dc377bac5e1d39e2f81c6e8cf17e,"ZOOKEEPER-3140: Allow Followers to host Observers

Creates a new abstraction, LearnerMaster, to represent the portions of the Leader logic that are used in LearnerHandler. Leader implements LearnerMaster and a new class ObserverMaster implements LearnerMaster. Followers have the option of instantiating a ObserverMaster thread when they assume their role and so support Learner traffic.

A new parameter 'observerMasterPort' is used to control which Follower instances host Observers.

Author: Brian Nixon <nixon@fb.com>

Reviewers: fangmin@apache.org, hanm@apache.org, eolivelli@gmail.com

Closes #628 from enixon/learner-master",2018-12-08 18:16:58,Brian Nixon,Mixed
b1fd480b2c8e0cc1429345ee04510d3849001c5c,"ZOOKEEPER-1636: cleanup completion list of a failed multi request

(from Thawan Kooburat)

Author: Michael Edwards <Michael Edwards>

Reviewers: andor@apache.org

Closes #717 from mkedwards/ZOOKEEPER-1636-for-master",2018-12-10 15:28:57,Michael Edwards,Not TDD
a5ffb4c8dd49d1d6b03904d457eea62a3009c91a,"ZOOKEEPER-3207: Removing the unexpected WatchManager.java introduced by mistake during maven migration

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: andor@apache.org

Closes #729 from lvfangmin/ZOOKEEPER-3207",2018-12-11 14:03:37,Fangmin Lyu,Mixed
e043c322f12d56da0fc88131628edf0731c0f8e4,"ZOOKEEPER-3174: Quorum TLS - support reloading trust/key store

Allow reloading SSL trust stores and key stores from disk when the files on disk change.

## Added support for reloading key/trust stores when the file on disk changes
- new property `sslQuorumReloadCertFiles` which controls the behavior for reloading the key and trust store files for `QuorumX509Util`. Reloading of key and trust store for `ClientX509Util` is not in this PR but could be added easily
- this allows a ZK server to keep running on a machine that uses short-lived certs that refresh frequently without having to restart the ZK process.

Author: Ilya Maykov <ilyam@fb.com>

Reviewers: andor@apache.org

Closes #680 from ivmaykov/ZOOKEEPER-3174",2018-12-15 07:34:54,Ilya Maykov,Mixed
05b774a1b05374618300f657c9c91b0d5c6ddf71,"ZOOKEEPER-3029: add pom.xml for jute, client and server

Work In Progress
Creating the maven build for zookeeper-server, zookeeper-jute and zookeeper-client (which only contains C client right now, and it hasn't been implemented yet - maven is not calling make or autoconf)

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: andor@apache.org

Closes #708 from nkalmar/ZOOKEEPER-3029r and squashes the following commits:

4b1354f41 [Norbert Kalmar] ZOOKEEPER-3029 - add java clover coverage
9c4591ce5 [Norbert Kalmar] ZOOKEEPER-3029 - fix pom issues and clover classpath
5b9350abd [Norbert Kalmar] ZOOKEEPER-3029 - fix C maven test classpath issues
69a2c51b6 [Norbert Kalmar] ZOOKEEPER-3029 - change git-wip-us git to gitbox
daf273a7e [Norbert Kalmar] ZOOKEEPER-3029 - remove build.xml from c-client, use maven
e328cb812 [Norbert Kalmar] ZOOKEEPER-3029 - fix cppunit tests
5133abe46 [Norbert Kalmar] ZOOKEEPER-3029 - fix portAssigment bug with maven
eb7b4abfb [Norbert Kalmar] ZOOKEEPER-3029 - fix jute dependency import
d786b90a2 [Norbert Kalmar] ZOOKEEPER-3029 - Build C library and fix tests
438cd43de [Norbert Kalmar] ZOOKEEPER-3029 - add pom.xml for jute, client and server",2018-12-20 07:24:17,Norbert Kalmar,Not TDD
db53d02869faa7c9819689315daa3933125c89a8,"ZOOKEEPER-3125: Only patching the pzxid when it's larger than the current pzxid

This previous fix in #605 has a corner case which might revert the pzxid, it's being fixed when port to 3.5 in #647, update on master as well.

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: eolivelli@gmail.com

Closes #701 from lvfangmin/ZOOKEEPER-3125-Update",2018-12-20 22:17:52,Fangmin Lyu,Mixed
f4667d6fdf6e29ed7ec3c3ea18e0f4cd956cd360,"ZOOKEEPER-3205: Add test cases for jute

Adding some test cases for o.a.jute BinaryInputArchive .  Issue ZOOKEEPER-3205 contains the patch as well.

Author: Karthik K <karthiknetworklink@gmail.com>

Reviewers: fangmin@apache.org, eolivelli@apache.org

Closes #726 from akkumar/jutetest",2019-01-02 22:10:02,Karthik K,Not TDD
bc992480ec938a3fad4b90f75a52dd186e1b968a,"ZOOKEEPER-2641: AvgRequestLatency metric improves to be more accurate

- some original review historys were included [here ](https://github.com/apache/zookeeper/pull/629)
- more details in [ZOOKEEPER-2641](https://issues.apache.org/jira/browse/ZOOKEEPER-2641)

Author: maoling <maoling199210191@sina.com>

Reviewers: andor@apache.org

Closes #748 from maoling/ZOOKEEPER-2641 and squashes the following commits:

e0d4fc890 [maoling] fix the flaky test in the FourLetterWordsTest.testValidateStatOutput
1739dbf1c [maoling] fix the flaky test in the CommandsTest.testMonitor
01af4002e [maoling] ZOOKEEPER-2641:AvgRequestLatency metric improves to be more accurate",2019-01-07 14:39:13,maoling,Mixed
9e309557c02315344d6b39012ff4c9633b54c3d3,"ZOOKEEPER-3203: Tracking the number of non voting followers in ZK

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: andor@apache.org

Closes #722 from lvfangmin/ZOOKEEPER-3203",2019-01-07 14:55:43,Fangmin Lyu,Mixed
9828685d20bc99272ec0689a590d27b0f8f7ebb6,"ZOOKEEPER-3180: Add response cache to improve the throughput of read …

…heavy traffic

Introduces a ResponseCache that interacts with ServerCnxn to cache the serialized response for getData requests.

Author: Brian Nixon <nixon@fb.com>

Reviewers: hanm@apache.org, fangmin@apache.org, andor@apache.org

Closes #684 from enixon/response-cache and squashes the following commits:

c264b88f8 [Brian Nixon] fix the types in ResponseCacheTest::checkCacheStatus to match the recent change
5e36b396a [Brian Nixon] add documentation
e413de1a6 [Brian Nixon] remove JMX use from ResponseCacheTest
c7a3f8eb0 [Brian Nixon] ZOOKEEPER-3180: Add response cache to improve the throughput of read heavy traffic",2019-01-14 11:38:53,Brian Nixon,Mixed
38fab85ab476ffea3dd9668eac6fd6e09a190a09,"ZOOKEEPER-3195: TLS - disable client-initiated renegotiation

Summary: client-initiated renegotiation is insecure and is vulnerable to MITM attacks.
Unfortunately, the feature is enabled in Java by default. This disables it.
See https://bugs.openjdk.java.net/browse/JDK-7188658 and
https://www.oracle.com/technetwork/java/javase/documentation/tlsreadme-141115.html

Test Plan: manually tested by running a secure ZK server and probing the listening port
with python's sslyze tool (using `sslyze --reneg ...`). Tested on Java 8, 9, 10, and 11.

Author: Ilya Maykov <ilyam@fb.com>

Reviewers: andor@apache.org

Closes #710 from ivmaykov/ZOOKEEPER-3195",2019-01-14 11:40:19,Ilya Maykov,Mixed
d149b134049dc8527ba81a9546836942fcabc5b6,"ZOOKEEPER-2284: LogFormatter and SnapshotFormatter does not handle FileNotFoundException gracefully

- More details in [ZOOKEEPER-2284](https://issues.apache.org/jira/browse/ZOOKEEPER-2284) .Thanks [arshad.mohammad](https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arshad.mohammad) for original work!

Author: maoling <maoling199210191@sina.com>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #630 from maoling/ZOOKEEPER-2284 and squashes the following commits:

393cccdc5 [maoling] git rebase the code again
92c855f30 [maoling] rebase the code
5042a65bc [maoling] ZOOKEEPER-2284:LogFormatter and SnapshotFormatter does not handle FileNotFoundException gracefully",2019-01-14 11:43:00,maoling,Mixed
2eb8dd0baf91a1a7c09d76f22ff658009898ca0b,"ZOOKEEPER-3209: New `getEphemerals` api to get all the ephemeral nodes created by the session

See https://issues.apache.org/jira/browse/ZOOKEEPER-3209 for details about the API.

New API `getEphemerals()` to get all the ephemeral nodes created by the session by providing the prefix path.

* Get the prefix path as a input parameter and return a list of string (ephemeral nodes)
* If the prefix path is `/` or empty return all the ephemeral nodes created by the session
* Provide synchronous and asynchronous API's with same functionality

Author: Dinesh Appavoo <dappavoo@twitter.com>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #735 from dineshappavoo/ZOOKEEPER-3209",2019-01-16 06:21:28,Dinesh Appavoo,Mixed
668828503389f3e542b846019bace8b9842fa428,"ZOOKEEPER-3242: Add server side connecting throttling

Author: Jie Huang <jiehuang@fb.com>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #769 from jhuan31/ZOOKEEPER-3242 and squashes the following commits:

c3ec81f4e [Jie Huang] refactoring
86cad39c4 [Jie Huang] Use a mock random number generator to make the unit test flaky-proof
a278504d4 [Jie Huang] Add unit tests for server-side connection throttling
fd966502b [Jie Huang] update doc for server-side connection throttling
2f1ed0b87 [Jie Huang] Fix FindBugs Warnings
a48b0fcb1 [Jie Huang] ZOOKEEPER-3242: Add server side connecting throttling",2019-01-23 14:00:13,Jie Huang,Mixed
0f44fd9629704e32cc9719eb26d14ecf11e61e90,"ZOOKEEPER-3176: Quorum TLS - add SSL config options

Add  SSL config options for enabled protocols and client auth mode.
Improve handling of SSL config options for protocols and cipher suites - previously these came from system properties, now they can come from ZKConfig which means they are easier to isolate in tests, and now we don't need to parse system properties every time we create a secure socket.

## Added more options for ssl settings to X509Util and encapsulate them better
- previously, some SSL settings came from a `ZKConfig` and others came from global `System.getProperties()`. This made it hard to isolate certain settings in tests.
- now all SSL-related settings come from the `ZKConfig` object used to create the SSL context
- new settings added:
- `zookeeper.ssl(.quorum).enabledProtocols` - list of enabled protocols. If not set, defaults to a single-entry list with the value of `zookeeper.ssl(.quorum).protocol`.
- `zookeeper.ssl(.quorum).clientAuth` - can be ""NONE"", ""WANT"", or ""NEED"". This controls whether the server doesn't want / allows / requires the client to present an X509 certificate.
- `zookeeper.ssl(.quorum).handshakeDetectionTimeoutMillis` - timeout for the first read of 5 bytes to detect the transport mode (TLS or plaintext) of a client connection made to a `UnifiedServerSocket`

Author: Ilya Maykov <ilyam@fb.com>

Reviewers: andor@apache.org

Closes #681 from ivmaykov/ZOOKEEPER-3176",2019-01-24 11:53:00,Ilya Maykov,Mixed
045833b795a7041607337b192fa3dbcf2cc3f291,"ZOOKEEPER-3160: Custom User SSLContext

This is a master branch version of: https://github.com/apache/zookeeper/pull/654

The previous PR was for branch 3.5, and couldn't be merged as that branch is closed for new features.

The Zookeeper libraries currently allow you to set up your SSL Context via system properties such as ""zookeeper.ssl.keyStore.location"" in the X509Util. This covers most simple use cases, where users have software keystores on their harddrive.

There are, however, a few additional scenarios that this doesn't cover. Two possible ones would be:

1. The user has a hardware keystore, loaded in using PKCS11 or something similar.
2. The user has no access to the software keystore, but can retrieve an already-constructed SSLContext from their container.

For this, I would propose that the X509Util be extended to allow a user to set a property ""zookeeper.ssl.client.context"" to provide a class which supplies a custom SSL context. This gives a lot more flexibility to the ZK client, and allows the user to construct the SSLContext in whatever way they please (which also future proofs the implementation somewhat).

I added a few simple tests to this class around setting the SSLContext, and setting an invalid one. I'm not testing the actual functionality of the SSLContext, etc.

Author: Alex Rankin <davelister@gmail.com>
Author: Alex Rankin <alex.rankin@mastercard.com>

Reviewers: andor@apache.org

Closes #728 from arankin-irl/ZOOKEEPER-3160 and squashes the following commits:

a20c62feb [Alex Rankin] Merge branch 'master' into ZOOKEEPER-3160
5a9b8fcb4 [Alex Rankin] Merge pull request #7 from apache/master
3c3dfdd70 [Alex Rankin] Re-ordering imports.
69e0b6c93 [Alex Rankin] Updating custom SSLContext supplier with review comments
874529ba0 [Alex Rankin] Using supplier interface instead of custom interface, and renaming property
ec272607d [Alex Rankin] Merge branch 'master' into ZOOKEEPER-3160
75a010e34 [Alex Rankin] Merge pull request #6 from apache/master
838f61c1a [Alex Rankin] Merge branch 'master' into ZOOKEEPER-3160
f85d7e5cb [Alex Rankin] Merge pull request #5 from apache/master
31d8dd5a4 [Alex Rankin] Extracting SSLContext creation from config to new method.
400839a60 [Alex Rankin] Adding ability to specify custom SSLContext for client
7ae74851b [Alex Rankin] Merge pull request #4 from apache/master",2019-01-25 14:32:24,Alex Rankin,Mixed
bc24f7c01a7060267c99ef3201fbe96be9a12835,"ZOOKEEPER-3249: Avoid reverting the cversion and pzxid during replaying txns with fuzzy snapshot

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: andor@apache.org

Closes #780 from lvfangmin/ZOOKEEPER-3249",2019-01-30 16:28:55,Fangmin Lyu,Mixed
3302031ee6040fbcbb8f0c54eb37e5e161c7afd2,"ZOOKEEPER-3251: Add new server metric types: percentile counter and c…

…ounter set

Author: Jie Huang <jiehuang@fb.com>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #781 from jhuan31/ZOOKEEPER-3251 and squashes the following commits:

c3f4f7f40 [Jie Huang] Make new unit test classes extend ZKTestCase
50a631f54 [Jie Huang] Add Apache license header
e9b7c9500 [Jie Huang] ZOOKEEPER-3251: Add new server metric types: percentile counter and counter set",2019-01-30 16:43:22,Jie Huang,Mixed
f0f75d81087a2140e7f150bbb45a9fcec3d6644b,"ZOOKEEPER-3269: Add queueEvent to the Testable facade

Add queueEvent to the Testable facade to enabled inserting events into the clients queue.

For testing and other reasons it would be very useful to add a way to inject an event into ZooKeeper's event queue. ZooKeeper already has the Testable for features such as this (low level, backdoor, testing, etc.). This queueEvent method would be particularly helpful to Apache Curator and we'd very much appreciate its inclusion.

Author: randgalt <jordan@jordanzimmerman.com>

Reviewers: andor@apache.org

Closes #799 from Randgalt/ZOOKEEPER-3269 and squashes the following commits:

0e3ab80a0 [randgalt] ZOOKEEPER-3269 - use explicit imports
f77574be1 [randgalt] ZOOKEEPER-3269 remove IDE introduced spacing changes
8b5222daf [randgalt] ZOOKEEPER-3269",2019-02-06 09:46:37,randgalt,Not TDD
af741cb319d4760cfab1cd3b560635adacd8deca,ZOOKEEPER-1392: Request READ or ADMIN permission for getAcl(),2019-02-06 12:36:37,Andor Molnar,Mixed
bd09fda553cf9b9334039a7b3bd9dbc7bab70602,"ZOOKEEPER-3167: add an API and the corresponding CLI to get total count of recursive sub nodes under a specific path

- Thanks the original patch from [TyqITstudent ](https://github.com/TyqITstudent).
- the `getAllChildrenNumber` api supports `sync` and `async`, don't support `watch`.
  since` getChildren()` can get the number of the first level,to keep the api short and clean,don't use a boolean flag to let this api get the number of the first level child.
- the implements using the` parallelStream()` which have the almost `4x` speed up than `forEach`(I test),it will return at once even a millons of keys.
- `getAllChildrenNumber` doesn't have a `synchronized `lock, to avoid holding the `nodes` for a long time,so when too many concurrent writes, the number will be not very precise.
- about `getAllChildrenNumber` CLI:

    > [zk: localhost:2181(CONNECTED) 6] getAllChildrenNumber /zookeeper
    > 	2
    > 	[zk: localhost:2181(CONNECTED) 7] getAllChildrenNumber /zookeeper/quota
    > 	0

- there is no good place to document the new api, I create a seperate jira-[ZOOKEEPER-3259](https://issues.apache.org/jira/projects/ZOOKEEPER/issues/ZOOKEEPER-3259).

Author: maoling <maoling199210191@sina.com>

Reviewers: andor@apache.org

Closes #790 from maoling/ZOOKEEPER-3167",2019-02-07 11:26:08,maoling,Mixed
c2b63926c1249c454319bffe15a7b9f340e0526f,"ZOOKEEPER-3272: Clean up netty4 code per Norman Maurer's review comments

Netty4 code clean-up per the discussion in PR #753.

Author: Ilya Maykov <ilyam@fb.com>

Reviewers: norman_maurer@apple.com, andor@apache.org

Closes #809 from ivmaykov/ZOOKEEPER-3272 and squashes the following commits:

26d2b338f [Ilya Maykov] Merge branch 'master' into ZOOKEEPER-3272
201449641 [Ilya Maykov] Address code review comments
a162c54b0 [Ilya Maykov] ZOOKEEPER-3272: Clean up netty4 code per Norman Maurer's review comments",2019-02-12 15:25:17,Ilya Maykov,Mixed
8f3fbf25c63af54e00bad927a606f79ef0bf7fbf,"ZOOKEEPER-974: Allow a configurable ZooKeeper server socket listen ba…

…cklog

Introduces configuration property ""clientPortBacklog"". Amendment of
original patch from ""Hoonmin Kim"".

Author: Josh Elser <elserj@apache.org>

Reviewers: andor@apache.org

Closes #784 from joshelser/974-master and squashes the following commits:

fe5f66a5a [Josh Elser] Add some documentation for the new property
be61d1c5f [Josh Elser] Feedback from Andor
3ed36f824 [Josh Elser] Update 'conf' 4lw for clientPortListenBacklog
fd249939c [Josh Elser] ZOOKEEPER-974: Allow a configurable ZooKeeper server socket listen backlog",2019-02-13 13:12:00,Josh Elser,Mixed
dc909724700e39145c2ca71cee5864fe6c074e3e,"ZOOKEEPER-3239: Adding EnsembleAuthProvider to verify the ensemble name

Author: Jie Huang <jiehuang@fb.com>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #768 from jhuan31/ZOOKEEPER-3239 and squashes the following commits:

7e17e1b8a [Jie Huang] add doc for EnsembleAuthProvider
878bfb543 [Jie Huang] ZOOKEEPER-3239: Adding EnsembleAuthProvider to verify the ensemble name",2019-02-13 13:19:28,Jie Huang,Mixed
dafc40d59f3d4ed1d2586bf93fc340d20fb6f6c4,"ZOOKEEPER-3267: Add watcher metrics

Author: Jie Huang <jiehuang@fb.com>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #796 from jhuan31/ZOOKEEPER-3267 and squashes the following commits:

4dafb7e94 [Jie Huang] refactor/de-flaky unit tests
9bdc93a04 [Jie Huang] fix ADD_DEAD_WATCHERS_STALL_TIME measurement
8e45fc253 [Jie Huang] add unit tests for the watcher metrics
2d786e455 [Jie Huang] ZOOKEEPER-3267: Add watcher metrics",2019-03-04 17:04:10,Jie Huang,Mixed
e10c93a590cc1b73eebad48d18cfcbceb3ec0d4d,"ZOOKEEPER-3253: client should not send requests with cxid=-4, -2, or -1

- Add test for cxid rollover to 1
- Modify ClientCnxn.SendThread.getXid() to increment from MAX to 1.

Author: Samuel Just <sjust@salesforce.com>

Reviewers: phunt@apache.org

Closes #787 from athanatos/forupstream/ZOOKEEPER-3253

Change-Id: Ib3d111170bb086d6982f2cf0ee5cf8afd5157588",2019-03-05 18:32:04,Samuel Just,Mixed
c000f96504198d999daee2b0ccb3c4217f16dc97,"ZOOKEEPER-2474: add a way for client to reattach to a session when using ZKClientConfig

- Thanks the original work from [arshad.mohammad](https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arshad.mohammad) and [timothyjward](https://github.com/timothyjward). Plz call me code-carrier(:D).
- more details in [ZOOKEEPER-2474](https://issues.apache.org/jira/browse/ZOOKEEPER-2474).if cannot backport to branch-3.5 successfully,I will give another hit.

Author: maoling <maoling199210191@sina.com>

Reviewers: andor@apache.org

Closes #825 from maoling/ZOOKEEPER-2474 and squashes the following commits:

f782b16d3 [maoling] add the version info
8238dc488 [maoling] ZOOKEEPER-2474:add a way to reattach to a session when using ZKClientConfig",2019-03-12 11:08:39,maoling,Mixed
9fba2f6c93a78928df4841a66185f51e242653aa,"ZOOKEEPER-2168: Add C APIs for new createContainer Methods

I rebased and addressed the comments of https://github.com/apache/zookeeper/pull/33 by Randgalt

Author: randgalt <jordan@jordanzimmerman.com>
Author: Balazs Meszaros <balazs.meszaros@cloudera.com>

Reviewers: andor@apache.org

Closes #838 from meszibalu/my/container and squashes the following commits:

c6c9dc0a6 [Balazs Meszaros] ZOOKEEPER-2168 - added test case for containers
ed4b842e6 [Balazs Meszaros] ZOOKEEPER-2168 - rebase and review comment fixes
f0f144129 [randgalt] ZOOKEEPER-2168 - fixed typo
4cea8d412 [randgalt] ZOOKEEPER-2168 - first pass at C changes for containers",2019-03-18 17:12:03,Balazs Meszaros,Not TDD
07c3aaf3d723fb3144c0aedc0c2b655325df70e9,"ZOOKEEPER-3327: Add unrecoverable error metric

Author: Jie Huang <jiehuang@fb.com>

Reviewers: andor@apache.org, eolivelli@apache.org, fangmin@apache.org

Closes #862 from jhuan31/ZOOKEEPER-3327",2019-03-21 11:15:06,Jie Huang,Not TDD
3b93f7671464bef1824288b13ee66dec547bb97e,"ZOOKEEPER-2609: Add TTL Node APIs to C client

* added zoo_acreate_ttl, zoo_acreate2_ttl, zoo_create_ttl,
  zoo_create2_ttl methods, where ttl (int64_t) can be defined.
* renamed flags to mode in zoo_*create* because it is not a bitmask on the
  server side.
* added Create mode contants to match CreateMode.java enum fields.
  ZOO_SEQUENCE is kept for backward compatibility.
  ZOO_EPHEMERAL|ZOO_SEQUENCE is still usable, but ZOO_EPHEMERAL_SEQUENTIAL
  is preferred.
* added / fixed doxygen comments for create methods.
* modified tests/zkServer.sh to pass system properties to ZK.
* added +t, +c shell commands to zookeeper cli.
* added a test case for create ttl.

Author: Balazs Meszaros <balazs.meszaros@cloudera.com>

Reviewers: andor@apache.org

Closes #891 from meszibalu/my/ttl",2019-04-09 11:36:55,Balazs Meszaros,Not TDD
57e8318bc98dd3563085e08b0fcfcbc6a1c5fbcc,"ZOOKEEPER-3335: Improve the usage of Collections

Author: Beluga Behr <dam6923@gmail.com>

Reviewers: andor@apache.org

Closes #870 from BELUGABEHR/ZOOKEEPER-3335 and squashes the following commits:

2a1d80347 [Beluga Behr] Reverted variable name change to lessen diff
384d46755 [Beluga Behr] ZOOKEEPER-3335: Improve the usage of Collections",2019-04-09 15:35:40,Beluga Behr,Not TDD
73cdd09051df33189351f7c42131724e3270eeac,"ZOOKEEPER-3179: Add snapshot compression to reduce the disk IO

Author: Yisong Yue <yisongyue@fb.com>

Reviewers: andor@apache.org

Closes #690 from yisong-yue/ZOOKEEPER-3179",2019-04-10 13:19:02,Yisong Yue,Mixed
ff132ab9dd3dd83df1dbfae5bc9f0cc53f6a4d45,"ZOOKEEPER-3324: Add read/write metrics for top level znodes

another example of Set metrics.

Author: Jie Huang <jiehuang@fb.com>

Reviewers: andor@apache.org

Closes #860 from jhuan31/ZOOKEEPER-3324",2019-04-12 12:29:32,Jie Huang,Mixed
f69ad1b0fed88da3c1b67fd73031e7248c0564f7,"ZOOKEEPER-3143: Pluggable metrics system for ZooKeeper - Data Collection on Server

- Make ServerMetrics a class, not an enum.
- Make ServerMetrics use MetricsProvider
- After the bootstrap of the MetricsProvider reconfigure ServerMetrics in order to push data to the provider.
- Introduce a default implementation of MetricsProvider, based on current implementation
- Change MetricsContext interface in order to support several types of Metrics, in order to cover current metrics facilities,

The MetricsProvider API will allow ZooKeeper users to integrate ZooKeeper with other metrics systems, like Prometheus.io/Dropwizard.....

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #854 from eolivelli/fix/metrics-provider-port-static and squashes the following commits:

c5714ee66 [Enrico Olivelli] Fix dump and reset for SummarySets
ed6230e51 [Enrico Olivelli] Fix build
8e8d87bdd [Enrico Olivelli] Merge branch 'master' into fix/metrics-provider-port-static
02722b55b [Enrico Olivelli] Fix tests
7ebc091e6 [Enrico Olivelli] Use toString in Monitor Command
49a5c801a [Enrico Olivelli] Add Metrics to 4lw interface - mntr command
137bda23a [Enrico Olivelli] A few nits
80396915f [Enrico Olivelli] Introduce MetricsUtils
9f28747bc [Enrico Olivelli] Fix after merge master
e380607ae [Enrico Olivelli] Fix imports
c2d0c358c [Enrico Olivelli] Introduce SummarySet
4674d2350 [Enrico Olivelli] Fix trailing spaces
6580b4a53 [Enrico Olivelli] Use a global static variable
ad8d44241 [Enrico Olivelli] Make DefaultMetricsProvider the default
d455a1c8c [Enrico Olivelli] Fix test
f997c30f3 [Enrico Olivelli] Fix spotbugs
228c1d268 [Enrico Olivelli] ZOOKEEPER-3143 Pluggable metrics system for ZooKeeper - Data Collection on Server",2019-04-12 19:01:37,Enrico Olivelli,Mixed
bbc39c42bba74add9a625adca3ee52fb1cd02335,"ZOOKEEPER-3310: Add metrics for prep processor

Author: Jie Huang <jiehuang@fb.com>

Reviewers: andor@apache.org

Closes #855 from jhuan31/ZOOKEEPER-3310 and squashes the following commits:

5875158b4 [Jie Huang] remove sleep in tests
2033456bb [Jie Huang] Reconstructed unit test. Add left out metric
245663d88 [Jie Huang] ZOOKEEPER-3310: Add metrics for prep processor",2019-04-14 16:05:59,Jie Huang,Not TDD
3d2a30f5fed9cc77f84c0d27d80020656f21fc06,"Revert ""ZOOKEEPER-3310: Add metrics for prep processor""

This reverts commit bbc39c42bba74add9a625adca3ee52fb1cd02335.",2019-04-14 20:00:14,Andor Molnar,Not TDD
e57e7a371da9ba6161fa06c29683679f4271e346,"ZOOKEEPER-3310: Add metrics for prep processor

Author: Jie Huang <jiehuang@fb.com>

Reviewers: andor@apache.org

Closes #855 from jhuan31/ZOOKEEPER-3310 and squashes the following commits:

5875158b4 [Jie Huang] remove sleep in tests
2033456bb [Jie Huang] Reconstructed unit test. Add left out metric
245663d88 [Jie Huang] ZOOKEEPER-3310: Add metrics for prep processor

(cherry picked from commit bbc39c42bba74add9a625adca3ee52fb1cd02335)
Signed-off-by: Andor Molnar <andor@apache.org>",2019-04-17 11:06:19,Jie Huang,Not TDD
8cc3d5e2a9b0900984f09b873aa810c563399069,"Revert ""ZOOKEEPER-3310: Add metrics for prep processor""

This reverts commit e57e7a371da9ba6161fa06c29683679f4271e346.",2019-04-17 12:26:53,Andor Molnar,Not TDD
ff47fc3dfda3487ca3a5aca2ea16831b2aebc7e2,"ZOOKEEPER-3310: Add metrics for prep processor

Author: Jie Huang <jiehuang@fb.com>

Reviewers: andor@apache.org

Closes #855 from jhuan31/ZOOKEEPER-3310 and squashes the following commits:

ab0b81c2b [Jie Huang] move to the new metric framework
8f4d53942 [Jie Huang] remove sleep in tests
9cf1fc064 [Jie Huang] Reconstructed unit test. Add left out metric
b07aa8c24 [Jie Huang] ZOOKEEPER-3310: Add metrics for prep processor",2019-04-17 14:16:17,Jie Huang,Not TDD
e9adf6ee09ef18258653d65c851fa84c3cd1a51d,"ZOOKEEPER-3037: Add JVMPauseMonitor

https://issues.apache.org/jira/browse/ZOOKEEPER-3037

Author: Norbert Kalmar <nkalmar@yahoo.com>

Reviewers: andor@apache.org

Closes #904 from nkalmar/ZOOKEEPER-3037 and squashes the following commits:

a6105324b [Norbert Kalmar] ZOOKEEPER-3037 - add serviceStop() and improve unit tests
7d0baaa46 [Norbert Kalmar] ZOOKEEPER-3037 - refactor unit tests
97d2c6103 [Norbert Kalmar] ZOOKEEPER-3037 - cite hadoop-common as source
3661389e4 [Norbert Kalmar] ZOOKEEPER-3037 - Add unit test and various improvements
f30975765 [Norbert Kalmar] ZOOKEEPER-3037 - Add JvmPauseMonitor",2019-04-18 19:17:48,Norbert Kalmar,Mixed
d8db88914e7af7c11a2588be202d90b925791d31,"ZOOKEEPER-3326: Add session/connection related metrics

Author: Jie Huang <jiehuang@fb.com>

Reviewers: eolivelli@apache.org, fangmin@apache.org

Closes #861 from jhuan31/ZOOKEEPER-3326",2019-04-22 10:15:22,Jie Huang,Not TDD
cb9727dc5b6f37984fef5f62473ae4064a9f15cb,"ZOOKEEPER-3268: Add commit processor metrics

Author: Jie Huang <jiehuang@fb.com>

Reviewers: fangmin@apache.org, evolivelli@aparche.org, andor@apache.org

Closes #800 from jhuan31/ZOOKEEPER-3268",2019-04-24 17:11:50,Jie Huang,Not TDD
46b2018dbe008e010462e0dc06ddb73981d19d2a,"ZOOKEEPER-3306: Fixing node not accessible issue due the inconsistent ACL reference map after SNAP sync

Please check the Jira for more details of the bug.

Need more opinion on this fix to see if there is other corner cases or side effect we didn't handle properly.

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: andor@apache.org

Closes #848 from lvfangmin/ZOOKEEPER-3306",2019-04-29 16:49:30,Fangmin Lyu,Not TDD
36bca12d5e70f96de4701aa2fd41979ff8128a1f,"ZOOKEEPER-3319: Add metrics for follower and observer

Author: Jie Huang <jiehuang@fb.com>

Reviewers: eolivelli@apache.org, fangmin@apache.org

Closes #856 from jhuan31/ZOOKEEPER-3319",2019-05-02 15:44:08,Jie Huang,Not TDD
bee2ef8da3c4a7a2a1925ac8fc5375a7dee702ae,"ZOOKEEPER-3350: Remove CommonNames

Remove `CommonNames`.

- Delete unused `DATA_TREE_KEY`(superseded by `DataTreeBean#getName`)
- Delete unused `STANDALONE_SERVER_KEY `(superseded by `ZooKeeperServerBean#getName`)
- Move `DOMAIN` into `MBeanRegistry` where it is actually used.

Author: tison <wander4096@gmail.com>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #914 from TisonKun/ZOOKEEPER-3350",2019-05-03 17:37:55,tison,Not TDD
3a25fe4b6c07937dc6859cafd94f3532b3a0befe,"ZOOKEEPER-3305: Add Quorum Packet metrics

Author: Jie Huang <jiehuang@fb.com>

Reviewers: eolivelli@apache.org, fangmin@apache.org

Closes #849 from jhuan31/ZOOKEEPER-3305",2019-05-06 08:48:57,Jie Huang,Mixed
c67760523492b8da033c7bc0ea3076ab4acf1a93,"ZOOKEEPER-3331: Automatically add IP authorization for Netty connections

Author: Brian Nixon <nixon@fb.com>

Reviewers: eolivelli@apache.org, fangmin@apache.org

Closes #867 from enixon/netty-ip-auth",2019-05-06 09:32:30,Brian Nixon,Not TDD
999c834714aba859a96ba32d02e66fb63e70ab35,"ZOOKEEPER-3364: Compile with strict options in order to check code quality

- Add extra compiler arguments in order to achieve better code quality.
- Fix some minor issues reported by javac
- Extra checks are not enabled in ""contrib"" module.

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: andor@apache.org

Closes #910 from eolivelli/fix/ZOOKEEPER-3364-javac-strict and squashes the following commits:

9660aff82 [Enrico Olivelli] Fix tests and fix warnings on JDK12
52895ec9d [Enrico Olivelli] ZOOKEEPER-3364 Compile with strict options in order to check code quality",2019-05-08 21:54:42,Enrico Olivelli,Not TDD
4243b95f4c1a0c6c6e9a6d78a789fae647d43b20,"ZOOKEEPER-3383: Improve prep processor metric accuracy and de-flaky u…

…nit test

Author: Jie Huang <jiehuang@fb.com>

Reviewers: andor@apache.org

Closes #937 from jhuan31/ZOOKEEPER-3383",2019-05-10 12:22:34,Jie Huang,Not TDD
31e92e0a4f287ca840e0c9418e3a9b706e9721db,"ZOOKEEPER-3244: Add option to snapshot based on log size

Author: Brian Nixon <nixon@fb.com>

Reviewers: fangmin@apache.org, nkalmar@apache.org, andor@apache.org

Closes #770 from enixon/snap-on-size and squashes the following commits:

3911f984a [Brian Nixon] allow admin to disable snapSizeLimitInKb feature
315404a12 [Brian Nixon] Change property name from zookeeper.snapSize to zookeeper.snapSizeLimitInKb
f13e7d327 [Brian Nixon] add documentation for zookeeper.snapSize and extend RestoreCommittedLogTest to support it
0d4666d2d [Brian Nixon] address sync issue with FileTxnLog::getTotalLogSize exposed by findbugs
20e9ccc44 [Brian Nixon] ZOOKEEPER-3244: Add option to snapshot based on log size",2019-05-14 17:11:14,Brian Nixon,Not TDD
7ca06c2cbb77695ec33a3d3d2f04e005bbbb63ad,"ZOOKEEPER-3237: Allow IPv6 wildcard address in peer config

Author: Brian Nixon <nixon@fb.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #761 from enixon/wildcard and squashes the following commits:

c2f12462e [Brian Nixon] refactor QuorumServerTest for greater clarity
311cc1732 [Brian Nixon] move new ServerDuplicateTest tests to QuorumServerTest
1aa517a45 [Brian Nixon] replace use of ReconfigTest with a new class ServerDuplicateTest
5e00c03f1 [Brian Nixon] add a slight delay to remove flakiness
82c73bae9 [Brian Nixon] add ReconfigTest::testWildcards
c483c948f [Brian Nixon] ZOOKEEPER-3237: Allow IPv6 wildcard address in peer config",2019-05-16 16:25:32,Brian Nixon,Not TDD
1264e9f2ba8e8724a9352387b22e784716816722,"ZOOKEEPER-3396: Flaky test in RestoreCommittedLogTest

Adjusting parameters of RestoreCommittedLogTest to avoid failures caused by threshold configured to be below the minimum allowed file size

Author: Brian Nixon <nixon@fb.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #949 from enixon/patch-snap-size",2019-05-20 12:24:52,Brian Nixon,Not TDD
777f0c15e73a8401a648c3cff93d20b3d3e4ee17,"ZOOKEEPER-3263: JAVA9/11 Warnings: Illegal reflective access in zookeer's kerberosUtil

Fixes warning messages of JDK 9/11 by upgrading libraries and refactoring `KerberosUtils` based on experiences of [HADOOP-10848](https://issues.apache.org/jira/browse/HADOOP-10848)

Reviewers please run unit tests with various JDK versions including 9 and 11, because CI only runs on JDK 8. Thanks.

Target branches are master and 3.5

Author: Andor Molnar <andor@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #950 from anmolnar/ZOOKEEPER-3263",2019-05-20 17:18:31,Andor Molnar,Not TDD
d08f51ad1514bfa512597b1ce4bbc2e8144be576,"ZOOKEEPER-3323: Add TxnSnapLog metrics

Author: Jie Huang <jiehuang@fb.com>

Reviewers: anmolnar@apache.org, eolivelli@apache.org, fangmin@apache.org

Closes #859 from jhuan31/ZOOKEEPER-3323",2019-05-21 14:34:38,Jie Huang,Not TDD
e2bb6e80f598415bba975edcff166ff1bd750340,"ZOOKEEPER-2694: sync CLI command does not wait for result from server

- Thanks the original work from [arshad.mohammad ](https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arshad.mohammad)
- more details in [ZOOKEEPER-2694](https://issues.apache.org/jira/browse/ZOOKEEPER-2694)

Author: maoling <maoling199210191@sina.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #823 from maoling/ZOOKEEPER-2694 and squashes the following commits:

41723cdca [maoling] print the resultCode when sync has failed
95123c003 [maoling] make the Sync more user-friendly
a3ce1704d [maoling] SYNC_TIMEOUT & use the TimeUnit.SECONDS.toMillis & a responsible way of handling the InterruptedException
df0bf7371 [maoling] CliWrapperException
52c3ad0ac [maoling] change CountDownLatch to CompletableFuture
0cc1edd98 [maoling] add the wait_timeout: 30s
cf01294f4 [maoling] ZOOKEEPER-2694:sync CLI command does not wait for result from server",2019-05-23 18:42:39,maoling,Not TDD
ea8536982c39fd1127a4e6e7a8229b64a5798447,"ZOOKEEPER-3392: Add admin command to display last snapshot information

Author: Brian Nixon <nixon@fb.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #947 from enixon/cmd-last-snap",2019-05-27 10:54:58,Brian Nixon,Mixed
bb94aa44de61bfb2ecd5bbd12b4eb390c2cf39c1,"ZOOKEEPER-3401: Fix metric PROPOSAL_ACK_CREATION_LATENCY

Author: Jie Huang <jiehuang@fb.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #957 from jhuan31/ZOOKEEPER-3401",2019-05-28 15:55:11,Jie Huang,Not TDD
d3dbe787f37eb9e17402e4a3d55a441ca43b2160,"ZOOKEEPER-1426: add version command to the zookeeper server

Adding a version command to the zkServer.sh.
This is an open/unresolved issue, however, a really nice feature to have. The implementation is already provided by Eli Reisman on the issue page and got several +1 back then, but has not been committed. I just rebased the patch.

Author: szepet <szepet95@gmail.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #923 from szepet/ZOOKEEPER-1426 and squashes the following commits:

d9108bda1 [szepet] test-scripts.sh improved to work with ant build as well
cd6a0bf7d [szepet] ZOOKEEPER-1426: add version command to the zookeeper server",2019-05-31 22:16:29,szepet,Not TDD
0d41fe80cd9218a44cd606f7bc0be61eaf696029,"ZOOKEEPER-3409: Compile Java code with -Xdoclint

Add -Xdoclint option and clean up Javadocs

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: Norbert Kalmar <nkalmar@apache.org>

Closes #965 from eolivelli/fix/xdoclint",2019-06-03 19:40:34,Enrico Olivelli,Mixed
6af151a7e44760c33165e58d3b33a4d2760283a4,"ZOOKEEPER-3366: Pluggable metrics system for ZooKeeper - move remaining metrics to MetricsProvider

Migrate all remaining metrics to MetricsProvider.
We are introducing now *Gauges* which are callbacks to be called when the Provider needs to publish current values, a Gauge is a numeric value that can go up and down.

As during the lifecycle of a ZK server process we can have several ZooKeeperServer instances (we have several subclasses), depending on the role of the local peer, sometimes we have to clean up unused Gauges.
The old approach  in 4lw and on http admin  API was to hard code metrics, with multiple 'instanceof' conditions.
So we introduce ZooKeeperServer#registerMetrics and ZooKeeperServer#unregisterMetrics: these overridable functions enable each  ZooKeeperServer subclass to declare specific Gauges.
We are also introducing ZooKeeperServer#collectMonitorValues in order to push non-metrics to monitor commands (admin and 4lw), like ""server state"" or ""version"".

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: Norbert Kalmar <nkalmar@apache.org>

Closes #918 from eolivelli/fix/other-metrics",2019-06-04 10:55:09,Enrico Olivelli,Mixed
d98a692ff4482f1d97774f25a158ca5473c455e0,"ZOOKEEPER-3388: Allow client port to support plaintext and encrypted …

…connections simultaneously

Author: Brian Nixon <nixon@fb.com>

Reviewers: Enrico Olivelli <eolivelli@gmail.com>, Michael Han <hanm@apache.org>

Closes #944 from enixon/client-port-uni",2019-06-04 15:29:24,Brian Nixon,Not TDD
5cb10bb5c0e341d65471b70572654756ba088a1d,"ZOOKEEPER-3309: Add sync processor metrics

Author: Jie Huang <jiehuang@fb.com>

Reviewers: fangmin@apache.org, andor@apache.org, eolivelli@apache.org

Closes #850 from jhuan31/ZOOKEEPER-3309",2019-06-04 15:46:58,Jie Huang,Not TDD
e732d3703137b4c3c4cacd680ed8388f8bf5e677,"ZOOKEEPER-3321: Add metrics for Leader

Author: Jie Huang <jiehuang@fb.com>

Reviewers: andor@apache.org, fangmin@apache.org, eolivelli@apache.org

Closes #858 from jhuan31/ZOOKEEPER-3321",2019-06-05 14:57:36,Jie Huang,Not TDD
39c40bea3a04cda70a6f9e8caad64b26d4d046e6,"ZOOKEEPER-3354: Improve efficiency of DeleteAllCommand

Author: Brian Nixon <nixon@fb.com>

Reviewers: andor@apache.org, szepet95@gmail.com, eolivelli@apache.org

Closes #899 from enixon/delete-all",2019-06-05 15:01:42,Brian Nixon,Not TDD
89e7e55811b7115a9155f25cd572520055af00fc,"ZOOKEEPER-3416: Remove redundant ServerCnxnFactoryAccessor.

We have two ways to access the private zkServer inside ServerCnxnFactory, and there is really no need to keep maintaining both. We could remove ServerCnxnFactoryAccessor when we added the public accessor for ServerCnxnFactory in ZOOKEEPER-1346, but we did not.

The solution is to consolidate all access of the zkServer through the public accessor of ServerCnxnFactory. The end result is cleaner code base and less confusion.

Author: Michael Han <lhan@twitter.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #969 from hanm/twitter/91216a8821e3aac9ab56f8cc51bd30d425eebae8",2019-06-07 14:13:24,Michael Han,Not TDD
3f4d0cda0f9688baa7ad0718e46c4ba95653dbfa,"ZOOKEEPER-3091: Prometheus.io Metrics Provider

Implement a MetricsProvider that exports data to Prometheus.io.
- introduce a new Maven module zookeeper-metrics-providers
- introduce an implementation of the MetricProvider that uses the Java library provided by Prometheus.io
- add the Provider to the binary tar ball
- add LICENSE files for Prometheus.io jars (it is ASL 2.0)
- add docs about configuration parameters
- change zoo_sample.cfg with the available configuration options (commented out by default)

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: Norbert Kalmar <nkalmar@apache.org>

Closes #977 from eolivelli/fix/ZOOKEEPER-3091-prometheus",2019-06-12 10:25:14,Enrico Olivelli,Mixed
5874a0f355417024ce8ebe03ab2f6eaf5b9a228c,"ZOOKEEPER-3296: Explicitly closing the sslsocket when it failed handshake to prevent issue where peers cannot join quorum

The quorum connection manager is handling connections sequentially with a default listen backlog queue size 50, during the network loss, there are socket read timed out, which is syncLimit * tickTime, and almost all the following connect requests in the backlog queue will timed out from the other side before it's being processed.

Those timed out learners will try to connect to a different server, and leaves the connect requests on server side without sending the close_notify packet. The server is slowly consuming from these queue with syncLimit * tickTime timeout for each of those requests which haven't sent notify_close packet. Any new connect requests will be queued up again when there is spot in the listen backlog queue, but timed out before the server handles it, and it can never successfully finish any new connection, and it failed to join the quorum.

Please check the Jira for more details.

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnár <andor@apache.org>

Closes #843 from lvfangmin/ZOOKEEPER-3296",2019-06-14 09:06:42,Fangmin Lyu,Mixed
92257ef143ac94c37941600474d30fe22e1a1a6e,"ZOOKEEPER-3391: Drop unused RecFormat(CSV/XML)

As described in

http://zookeeper-user.578899.n2.nabble.com/Deprecated-CSVInputArchive-and-XMLInputArchive-td7584086.html

these 2 input archives(CSV/XML) are not actively maintained and we probably don't have test coverage for them either, so keeping them in the codebase could be questionable.

Without input archives, output archives are also meaningless. Thus transitive removals of `CSVOutputArchive` and `XMLOutputArchive`.

One problem is we also use `CSVOutputArchive` for record `toString` method. For backward compatibility, I rename it to `ToStringOutputArchive` and remain almost all methods. We might discuss another `toString` gen path but it should work as now.

Author: tison <wander4096@gmail.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #983 from TisonKun/ZOOKEEPER-3391",2019-06-20 20:25:44,tison,Mixed
5627cd4a5a35b31b5b8143eec2a18940d914a7d4,"ZOOKEEPER-3365: Use Concurrent HashMap with Counter in NettyServerCnxnFactory

This PR includes improvements related with the Java 8 concurrent package to provide better locking control and less code.

Author: Beluga Behr <dam6923@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>, Andor Molnar <andor@apache.org>

Closes #912 from BELUGABEHR/ZOOKEEPER-3365-Counter",2019-06-24 11:05:25,Beluga Behr,Mixed
2711d69297ce45cb6fc5beab482e4ec36d07249f,"ZOOKEEPER-3433: zkpython build broken after maven migration

Fixed the build and test infrastructure for zkpython.

Verified the build and tests all passing under both ubuntu and macos.

Change-Id: I3c80774a2712f280d1f14739d1eb78baa066fdc6

Author: Patrick Hunt <phunt@apache.org>

Reviewers: Norbert Kalmar <nkalmar@apache.org>

Closes #991 from phunt/zk3433",2019-06-25 15:47:58,Patrick Hunt,Not TDD
1b074d6a8a448e1d3d50383a7d6f2e21d5cf1dfc,"ZOOKEEPER-3402: Add multiRead operation

So, the possibility of the multi version of getChildren, getData, and a common multiRead interface was already mentioned and briefly discussed in the conversation thread of #922.
This patch introduces the concept of multiRead operation.
Note: This is a 'work-in-progress', not every comment is added, and test cases should be extended as well. Currently, the aim is to decide whether this direction is something that the community would get behind or should fin.
I've faced more design decision while implementing this (note: I wanted to keep the backward compatibility at all cost), the more important ones were the following:
1. Whether the new read operations should be part of Op or should we create new descendant classes of `Op` like `ReadOp` and `WriteOp`. In this case, I believe it would be unnecessary to create new classes since it would create a lot of code duplication (despite the common ancestor) and the flow of the processing would not be as clean as in the initial state. However, by simply adding an OpKind enum to the class enables us to ensure the type-safety behavior (read and write operations should not mix) and still preserve the clean processing flow.
2. At which point of request processing should we capture the mixed (transaction and read operation) multi requests? It seems pretty clear to catch them client side and not create extra work for the server.
3. Do we even need a `multiRead` operation or this whole improvement could be just part of multi? Well, the main problem is the following: currently, on server side (and in general, everywhere in ZooKeeper) the fact that multi only contains transactions is a heavily used and built upon it. The whole `multi` processing flow should be rewritten from zero and also the server would get a significant extra work for that. So yeah, it seems pretty clear to me that introducing the `multiRead` operation is beneficial.

Hope these thoughts make sense! Any observations, questions are welcome!

Author: szepet <szepet95@gmail.com>
Author: Peter Szecsi <szepet95@gmail.com>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #959 from szepet/ZOOKEEPER-3402 and squashes the following commits:

2f128ef11 [szepet] rephrase exception
660351cce [Peter Szecsi] Rename MultiTransactionRecord to MultiOperationRecord
71a6d2e22 [Peter Szecsi] address some review comments
3cec54850 [szepet] make sure not to expose the internal representation in GetDataResult
d4c6764ee [szepet] ZOOKEEPER-3402: Add multiRead operation",2019-06-26 10:57:46,szepet,Mixed
02c203fa486ac24553d9584768fe97960b6dec24,"ZOOKEEPER-3421: Better insight into Observer connections

Author: Brian Nixon <nixon@fb.com>

Reviewers: Enrico Olivelli <eolivelli@gmail.com>, Michael Han <hanm@apache.org>

Closes #978 from enixon/observer-cmds-and-metrics",2019-06-28 15:33:38,Brian Nixon,Mixed
96eefafce7ed036d3ab4a7a6d43792ce433bbfad,"ZOOKEEPER-3240: Close socket on Learner shutdown to avoid dangling so…

…cket

Author: Brian Nixon <nixon@fb.com>

Reviewers: hanm@apache.org, eolivelli@apache.org, andor@apache.org

Closes #996 from enixon/learner-close-socket and squashes the following commits:

57f5e891 [Brian Nixon] delete ReconfigFailureCasesTest::testLeaderTimesoutOnNewQuorum as it relies on the fixed buggy behavior
1598b3ad [Brian Nixon] remove extraneous check on socket status
381889da [Brian Nixon] ZOOKEEPER-3240: Close socket on Learner shutdown to avoid dangling socket",2019-07-02 07:34:21,Brian Nixon,Not TDD
9bee98bd06f50a2085785406a1084f75c652ada1,"ZOOKEEPER-3439: Observability improvements on client / server connection close.

Currently when server closes a client connection there is not enough information recorded (except few exception logs) which makes it hard to do postmortems. On the other side, having a complete view of the aggregated connection closing reason will provide more signals based on which we can better operate the clusters (e.g. predicate an incident might happen based on the trending of the connection closing reasons).

Server metrics was not added in this PR as we internally use a different metrics system - so some work needed to migrate to ServerMetrics. Want to submit first to get community feedback on this.

Author: Michael Han <lhan@twitter.com>

Reviewers: Enrico Olivelli <eolivelli@gmail.com>, maoling <maoling199210191@sina.com>, enixon

Closes #997 from hanm/twitter/cc6d87505d9745caace2c86acf58d6ffa085281e",2019-07-02 15:44:25,Michael Han,Mixed
4cadbb1a649b70a2243bc4c1e5f736df4d35c462,"ZOOKEEPER-2418: txnlog diff sync can skip sending some transactions t…

…o followers

Author: Brian Nixon <nixon@fb.com>

Reviewers: Michael Han <hanm@apache.org>

Closes #972 from enixon/diff-sync-skip",2019-07-03 11:54:12,Brian Nixon,Mixed
7b3de52cdb15068aa343879ae283f4e456c68f39,"ZOOKEEPER-3243: Add server-side request throttling

Author: Jie Huang <jiehuang@fb.com>
Author: Joseph Blomstedt <jdb@fb.com>

Reviewers: Michael Han <hanm@apache.org>

Closes #986 from jhuan31/ZOOKEEPER-3243",2019-07-08 14:26:11,Jie Huang,Mixed
f9610cc80173342bbe9766889a1aab1bfd840d1e,"ZOOKEEPER-2894: Memory and completions leak on zookeeper_close

If I call `zookeeper_close()` when the call-stack does not pass through any of zookeeper mechanics (for example, some of completion handler called back by zookeeper) the following happens:
1. If there are requests waiting for responses in `zh.sent_requests` queue, they all are removed from this queue and each of them is ""completed"" with personal fake response having status `ZCLOSING`. Such fake responses are put into `zh.completions_to_process` queue. It's Ok
2. But then, `zh.completions_to_process` queue is left unhandled. **Neither completion callbacks are called, nor dynamic memory allocated for fake responses is freed**
3. Different structures within `zh` are dismissed and finally `zh` is freed

Consequently we have a tiny **memory leak** and, which is much more important, **completions leak**. I.e. completions are not called at all.

This is not the case if I call `zookeeper_close()` when the call-stack does pass through some of zookeeper mechanics. Here, zookeeper client handles completions properly.

Proposed changes remove this defects.

For more details see: https://issues.apache.org/jira/browse/ZOOKEEPER-2894

Author: Alexander A. Strelets <streletsaa@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@gmail.com>, Michael Han <hanm@apache.org>

Closes #1000 from xoiss/ZOOKEEPER-2894",2019-07-08 17:30:08,Alexander A. Strelets,Not TDD
43ce772db000721546fcd13dd8523002dfa97741,"ZOOKEEPER-3398: Learner.connectToLeader() may take too long to time-out

After leader election happens, the followers will connect to the leader which is facilitated by the Learner.connectToLeader() method.

Learner.connectToLeader() is relying on the initLimit configuration value to time-out in case the network connection is unreliable. This config may have a high value that could leave the ensemble retrying and waiting in the state of not having quorum for too long. The follower will retry up to 5 times.

This patch introduces a new configuration directive that will allow Zookeeper to use different time-out value `connectToLeaderLimit` which then could be set to lower value than `initLimit`.

Test plan:
- ant clean
- ant test-core-java

NOTE: Lots of whitespace changes, hope it helps.

Author: Vladimir Ivic <vladimir.ivic@me.com>

Reviewers: eolivelli@apache.org, hanm@apache.org, andor@apache.org

Closes #953 from vladimirivic/ZOOKEEPER-3398 and squashes the following commits:

da4ecd055 [Vladimir Ivic] Removed redundant test, chaning LearnerTest.connectToLearnerMasterLimitTest() params and assertions
6c413311c [Vladimir Ivic] Updating the tests with the new timeout parameter
5a89cbd7e [Vladimir Ivic] Rewriting timeout logic inside Leader.connectToLeader
99c065616 [Vladimir Ivic] Adding config connectToLearnerMasterLimit to prevent long connect timeout",2019-07-12 17:01:44,Vladimir Ivic,Mixed
1c83846615701e88749690f06993a6e77452b83c,"ZOOKEEPER-3443: Add support of PKCS12 trust/key stores

This commit adds support of PKCS12 trust store and key store type.
The existing mechanism for trust/key store types that support JKS and
PEM were extended with PKCS12.

The implementations of JKSFileLoader and PKCS12FileLoader were almost
identical so most of it were abstracted away in
StandardTypeFileKeyStoreLoader.

Author: Ivan Yurchenko <ivanyu@aiven.io>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1003 from ivanyu/ZOOKEEPER-3443",2019-07-15 14:46:48,Ivan Yurchenko,Mixed
a6c36b69cc72d7d67e392dab5360007d6f737bef,"ZOOKEEPER-2563: A revisit to setquota

- remove some useless methods in the `ZooKeeperMain.java`
- cannot set the quota on the path under` /zookeeper/quota`, because this path is reserved for storing the quota info. if we do something like this:
`setquota -n 5 /zookeeper/quota`
which will let us only have five chances to use the setquota, that violates the quota semantics.
- handle the Exception when users set a quota on the parent/child node.([ZOOKEEPER-2565](https://issues.apache.org/jira/browse/ZOOKEEPER-2565)).
- more detail in the [ZOOKEEPER-2563](https://issues.apache.org/jira/browse/ZOOKEEPER-2563)

Author: maoling <maoling199210191@sina.com>

Reviewers: andor@apache.org

Closes #936 from maoling/ZOOKEEPER-2563 and squashes the following commits:

9d46e862c [maoling] strength the doc,especially for the concept:namespaces
3777359bd [maoling] ZOOKEEPER-2563: A revisit to setquota",2019-07-17 13:42:32,maoling,Not TDD
ce33b7faed60ea0b7c6f2eb1edbf56eec20a8bc2,"ZOOKEEPER-3356: Implement advanced Netty flow control based on feedback from ZK

The current implementation of enable/disable recv logic may cause the direct buffer OOM because we may enable read a large chunk and disabled again after consume a single ZK request.

This implementation disabled AUTO_READ and controls the READ depends on whether the SslHandler has issued a READ and what's the queuedBuffer status.

With this implementation, the max Netty queued buffer size (direct memory usage) will be 2 * recv_buffer size. It's not the per message size because in EPoll ET mode it will try to read until the socket is empty, and because of SslHandler will trigger another read when it's not a full encrypt packet and haven't issued any decrypt message.

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <andor@apache.org>

Closes #919 from lvfangmin/ZOOKEEPER-3356",2019-07-23 15:55:47,Fangmin Lyu,Mixed
513df3da671c9937417bb7d92a55402520ba1292,"ZOOKEEPER-1634: hardening security by teaching server to enforce client authentication.

## Motivation
Previously ZooKeeper server is open to the world as the server does not enforce client authentication - anonymous clients are allowed to establish session with server. This behavior raises a couple of issues from the perspective of performance and security for example:
* It is easy to launch a DDoS attack to server, by having a fleet of anonymous clients connect to the ensemble, as each session would consume valuable resources (socket, memory, etc) from server.
* It is cumbersome to enforce certain security models with the presence of anonymous clients login - for example as clients are not trusted the root ACL has to be disabled for writes to world, among other configurations an admin has to do to secure a cluster in a multi-tenant environment.

So the goal here is to address such issue by hardening ZooKeeper security to provide a more confined access option that user could opt-in, which in addition to the existing ACLs together could lead to more secured / resource optimal ensemble.

## Design Abstract
* Introduce a new server side Java property that if set, ZooKeeper server will only accept connections and requests from clients that have authenticated with server via SASL.
* Clients that are not configured with SASL authentication, or configured with SASL but fail authentication (i.e. with invalid credential) will not be able to establish a session with server. A typed error code (-124) will be delivered in such case, both Java and C client will close the session with server thereafter, without further attempts on retrying to reconnect.
* This feature overrules the server property ""zookeeper.allowSaslFailedClients"". So even if server is configured to allow clients that fail SASL authentication to login, client will not be able to establish a session with server if this feature is enabled.
* Only support SASL because only SASL authentication has the property that no operations will happen until SASL authentication process finished. Thus, the decision of whether to close the session or not can be quickly made on server side upon receiving a client connection request. We could later add support for other auth scheme via add_auth_info if that's desired (if we do, then a session has to be maintained until add_auth_info is invoked.).
* As a side benefit, this PR fixes an issue mentioned in ZOOKEEPER-2346 by correctly propagate events from server to client side so a SASL auth failure will manifest as an auth / config failure rather than generic ConnectionLoss event.

JIRA: https://issues.apache.org/jira/browse/ZOOKEEPER-1634
The PR also covers (or part of):
https://issues.apache.org/jira/browse/ZOOKEEPER-2462
https://issues.apache.org/jira/browse/ZOOKEEPER-2526
https://issues.apache.org/jira/browse/ZOOKEEPER-2346

Author: Michael Han <lhan@twitter.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <andor@apache.org>

Closes #118 from hanm/ZOOKEEPER-1634",2019-07-24 18:00:02,Michael Han,Not TDD
f38905e58e4961ae04d876e1855d6ccb372a706b,"ZOOKEEPER-3437: Improve sync throttling on a learner master

Author: Jie Huang <jiehuang@fb.com>

Reviewers: Michael Han <lhan@twitter.com>, Enrico Olivelli <eolivelli@apache.org>, Fangmin Lyu <fangmin@apache.org>

Closes #995 from jhuan31/ZOOKEEPER-3437",2019-07-25 21:41:50,Jie Huang,Mixed
05ee9413e7a31703395b81fb8d72baf1cb09a46d,"ZOOKEEPER-3320: Leader election port stop listen when hostname unresolvable for some time

Author: Igor Skokov <igor.skokov@cinarra.com>
Author: Igor Skokov <lagrang09@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #863 from Lagrang/ZOOKEEPER-3320",2019-07-29 11:49:27,Igor Skokov,Mixed
fed6cdad1e7a4fb83b568e8bf3ba3cf1da492db9,"ZOOKEEPER-3371: Port unification for Jetty admin server

Summary:
Jetty does not have support for port unification. Subclassing
of some Java networking libraries is necessary for ZooKeeper to serve
both HTTP and HTTPS traffic on the same port.

Note: The traffic is encrypted, but the authentication isn't right because the certificates are not set up correctly for HTTP requests. This will be fixed soon.

Test Plan:
```
[ericlee123  ~/zookeeper] (admin-PU) > ant -Dtestcase=JettyAdminServerTest test-core-java
...
junit.run-concurrent:
     [echo] Running 1 concurrent JUnit processes.
    [junit] Running org.apache.zookeeper.server.admin.JettyAdminServerTest
    [junit] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.394 sec

fail.build.on.test.failure:

junit.run:

test-core-java:

BUILD SUCCESSFUL
Total time: 9 seconds
```

Author: Eric Lee <ericlee123@fb.com>
Author: Eric Lee <ericlee123@gmail.com>

Reviewers: fangmin@apache.org, eolivelli@apache.org, andor@apache.org

Closes #924 from ericlee123/ZOOKEEPER-3371 and squashes the following commits:

74ca00d33 [Eric Lee] Merge branch 'ZOOKEEPER-3371' of https://github.com/ericlee123/zookeeper into ZOOKEEPER-3371
be4d9c263 [Eric Lee] cleaned up print statements from testing
8cda69cfb [Eric Lee] Merge branch 'master' into ZOOKEEPER-3371
329efe204 [Eric Lee] cleaned up unused imports, handles different types of key/trust store loading, and cleaned up TLS detection
2e5c2e5d9 [Eric Lee] updated jetty version + fixed deprecation warnings
39279a554 [Eric Lee] small lint
4e21f6a6a [Eric Lee] Fixed build failure + added docs
c55a0193c [Eric Lee] [AdminPU] Port unification for Jetty admin server",2019-07-29 17:09:35,Eric Lee,Mixed
35f4aa227463ca95941b9045f9c554aa1696782f,"ZOOKEEPER-3468: Enable BookKeeper checkstyle configuration on zookeeper-jute

This pr is based on #1022

cc eolivelli maoling anmolnar

also locally test that add a 'author' tag would cause build failure.

Author: tison <wander4096@gmail.com>

Reviewers: Norbert Kalmar <nkalmar@apache.org>, Enrico Olivelli <eolivelli@apache.org>

Closes #1023 from TisonKun/ZOOKEEPER-3468",2019-07-29 17:15:26,tison,Mixed
a6b38f83218791f8d9fabc52c865dcccf07026cc,"ZOOKEEPER-3359: Batch commits in the CommitProcessor

Author: Brian Nixon <nixon@fb.com>

Reviewers: Michael Han <hanm@apache.org>, Norbert Kalmar <nkalmar@yahoo.com>, Enrico Olivelli <eolivelli@gmail.com>

Closes #905 from enixon/commit-proc-batch",2019-07-29 17:31:09,Brian Nixon,Not TDD
a89c0942e45bb16e5282eee9d3a56ebbddbaae15,"Revert ""ZOOKEEPER-3320: Leader election port stop listen when hostname unresolvable for some time""

This reverts commit 05ee9413e7a31703395b81fb8d72baf1cb09a46d.",2019-07-31 11:02:00,Andor Molnar,Mixed
ee04684b259fe00fe3dd8d3b697ba011c71e120b,"ZOOKEEPER-3150: Add tree digest check and verify data integrity when loading from disk

Jira ZOOKEEPER-3114 will be divided into two parts:

1. data integrity check when loading snapshot/txns from disk
2. real time data consistency check when syncing and following leader

This is the first part, which is going to check the data integrity by calculating the hash value of data tree, and compare the value when reload the snapshot/txns from disk.

Author: Fangmin Lyu <fangmin@apache.org>
Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: Michael Han <hanm@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, Edward Ribeiro

Closes #632 from lvfangmin/ZOOKEEPER-3150",2019-07-31 10:06:04,Fangmin Lyu,Mixed
6d636025d1c6a10840a27caee9e8933f1dbcbaf0,"ZOOKEEPER-3430: Observability improvement: provide top N read / write path queries.

We would like to have a better understanding of the type of workloads hit ZK, and one aspect of such understanding is to be able to answer queries of top N read and top N write request path. Knowing the hot request paths will allow us better optimize for such workloads, for example, enabling path specific caching, or change the path structure (e.g. break a long path to hierarchical paths).

This commit adds a RequestPathMetricsCollector which will collect path requests stats and answers such queries. There are also a set of new Java system properties that make this collector highly configurable, including disable it totally (the default option is on.).

The stats can also be queried through commands, which I will add in a different pull request once this landed, since this one is already big.

Author: Michael Han <lhan@twitter.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #989 from hanm/twitter/065e164bfbbf467a28602da76e9443faacaec1c8",2019-08-01 07:28:24,Michael Han,Mixed
b2f5548bd5757edbf1887838a487a90523ed2b52,"ZOOKEEPER-3418: Improve quorum throughput through eager ACL checks of requests on local servers.

Serving write requests that change the state of the system requires quorum operations, and in some cases, the quorum operations can be avoided if the requests are doomed to fail. ACL check failure is such a case. To optimize for this case, we elevate the ACL check logic and perform eager ACL check on local server (where the requests are received), and fail fast, before sending the requests to leader.

As with any features, there is a feature flag that can control this feature on, or off (default). This feature is also forward compatible in that for new any new Op code (and some existing Op code we did not explicit check against), they will pass the check and (potentially) fail on leader side, instead of being prematurely filtered out on local server.

The end result is better throughput and stability of the quorum for certain workloads.

Author: Michael Han <lhan@twitter.com>

Reviewers: Andor Molnar <andor@apache.org>, Enrico Olivelli <eolivelli@apache.org>

Closes #971 from hanm/twitter/5c6bbfac811d29228fd97a4621fd6ba547fed178",2019-08-01 07:31:29,Michael Han,Not TDD
49354f581f3b88316177492ef28823b50a5b33f7,"ZOOKEEPER-3474: Enable BookKeeper checkstyle configuration on zookeeper-prometheus-metrics

Subtasks of ZOOKEEPER-3431. Enable BookKeeper checkstyle configuration on zookeeper-promethus-metrics.

Author: tison <wander4096@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1028 from TisonKun/ZOOKEEPER-3474",2019-08-05 15:29:50,tison,Mixed
6692d7a5b4bc3f0dbd36677c06e782ef5240153a,"ZOOKEEPER-3320: Leader election port stop listen when hostname unresolvable for some time

Improvements and fixes of #863

Author: Igor Skokov <igor.skokov@cinarra.com>
Author: Igor Skokov <lagrang09@gmail.com>

Reviewers: nkalmar@apache.org, andor@apache.org

Closes #1033 from Lagrang/ZOOKEEPER-3320 and squashes the following commits:

50d64659e [Igor Skokov] ZOOKEEPER-3320: doc fix, rename config property 'zookeeper.electionPortBindRetry' to 'electionPortBindRetry'
fb9cdc57c [Igor Skokov] Merge remote-tracking branch 'lagrang/ZOOKEEPER-3320' into ZOOKEEPER-3320
f95ee187b [Igor Skokov] ZOOKEEPER-3320: CnxManagerTest.testCnxManagerListenerThreadConfigurableRetry fix
1af098d33 [Igor Skokov] ZOOKEEPER-3320: support custom socket bind error handler in QuorumCnxManager.Listener
7b222efbe [Igor Skokov] ZOOKEEPER-3320: handle 0 value for zookeeper.electionPortBindRetry as infinite, fix CnxManagerTest. testCnxManagerListenerThreadConfigurableRetry to prevent JVM exit during testing
5051b4cdf [Igor Skokov] ZOOKEEPER-3320: fix of test compilation
eeb5c4155 [Igor Skokov] ZOOKEEPER-3320: use existing scheme to stop server when QuorumCnxManager.Listener fails to bind to election port
587fd95a0 [Igor Skokov] ZOOKEEPER-3320: QuorumCnxManager.Listener extends ZookeeperCriticalThread, add test to CnxManagerTest to check configurable retries of leader election port bind
0888a2953 [Igor Skokov] ZOOKEEPER-3320: add documentation for zookeeper.electionPortBindRetry property
a9a934254 [Igor Skokov] ZOOKEEPER-3320: add validation and logging of zookeeper.electionPortBindRetry value
da33c1d3a [Igor Skokov] ZOOKEEPER-3320: configurable retry count for election port bind in QuorumCnxManager.Listener
e25b44551 [Igor Skokov] ZOOKEEPER-3320: support custom socket bind error handler in QuorumCnxManager.Listener
b4abdc7f2 [Igor Skokov] ZOOKEEPER-3320: handle 0 value for zookeeper.electionPortBindRetry as infinite, fix CnxManagerTest. testCnxManagerListenerThreadConfigurableRetry to prevent JVM exit during testing
c1afdf933 [Igor Skokov] Merge branch 'master' into ZOOKEEPER-3320
e9db1e445 [Igor Skokov] ZOOKEEPER-3320: fix of test compilation
a541ee902 [Igor Skokov] Merge branch 'master' into ZOOKEEPER-3320
bb0c77f7a [Igor Skokov] ZOOKEEPER-3320: use existing scheme to stop server when QuorumCnxManager.Listener fails to bind to election port
914295895 [Igor Skokov] ZOOKEEPER-3320: QuorumCnxManager.Listener extends ZookeeperCriticalThread, add test to CnxManagerTest to check configurable retries of leader election port bind
883d35eb0 [Igor Skokov] ZOOKEEPER-3320: add documentation for zookeeper.electionPortBindRetry property
b448f3603 [Igor Skokov] ZOOKEEPER-3320: add validation and logging of zookeeper.electionPortBindRetry value
706e1f058 [Igor Skokov] ZOOKEEPER-3320: configurable retry count for election port bind in QuorumCnxManager.Listener",2019-08-06 12:52:07,Igor Skokov,Mixed
9fa18ab0e1ce07b3cc61e8758e27d393253b81fb,"ZOOKEEPER-3470: fix flaky LearnerMetricsTest

This PR is about fixing the flaky unit test: `LearnerMetricsTest`.
The code changes are:
- Replacing the `Thread.sleep(200)` with polling the metrics until the assertion succeed or timeout (this seems help in some flaky scenario)
- Fixing the `ZKTestCase.waitFor` method
- We are also logging the 0 millisec latency values now on the server side. We calculate these latency values between different hosts (as the difference between the server wall time and the wall time in the request header), so 0 values are possible. And in case of unittests (where all the hosts are using the same clock) it can happen relatively frequently. This situation also caused some of the flakiness. In the previous implementation the 0 latency values were not counted, so the assertion on these counters values were failing in the end of the testcase.

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1040 from symat/ZOOKEEPER-3470 and squashes the following commits:

65a8b5795 [Mate Szalay-Beko] ZOOKEEPER-3470: implement PR comments
7fdf78041 [Mate Szalay-Beko] ZOOKEEPER-3470: fix flaky LearnerMetricsTest",2019-08-06 17:11:26,Mate Szalay-Beko,Not TDD
04cc5cae1e7d4b007490e68109a676b88ce790a3,"ZOOKEEPER-3347: Improve PathTrie Consistency

Author: Beluga Behr <dam6923@gmail.com>
Author: apache <dam6923@gmail.com>

Reviewers: hanm@apache.org, andor@apache.org

Closes #888 from belugabehr/ZOOKEEPER-3347 and squashes the following commits:

bb9efee81 [apache] Added unit tests
4f8dc4b04 [apache] Fixed double-locking
34b61838d [Beluga Behr] Simplified further
6c6ec6c18 [Beluga Behr] ZOOKEEPER-3347: Improve PathTrie Consistency",2019-08-09 16:15:20,Beluga Behr,Mixed
fe940cdd8fb23ba09684cefb73233d570f4a20fa,"ZOOKEEPER-3475: Enable Checkstyle configuration on zookeeper-server

- [x] org/apache/zookeeper
- [x] org/apache/zookeeper/admin
- [x] org/apache/zookeeper/cli
- [x] org/apache/zookeeper/client
- [x] org/apache/zookeeper/common
- [x] org/apache/zookeeper/jmx
- [x] org/apache/zookeeper/metrics
- [x] org/apache/zookeeper/metrics/impl
- [x] org/apache/zookeeper/server
- [x] org/apache/zookeeper/server/admin
- [x] org/apache/zookeeper/server/auth
- [x] org/apache/zookeeper/server/command
- [x] org/apache/zookeeper/server/metric
- [x] org/apache/zookeeper/server/persistence
- [x] org/apache/zookeeper/server/quorum
- [x] org/apache/zookeeper/server/quorum/auth
- [x] org/apache/zookeeper/server/quorum/flexible
- [x] org/apache/zookeeper/server/util
- [x] org/apache/zookeeper/server/watch
- [x] org/apache/zookeeper/test
- [x] org/apache/zookeeper/util
- [x] org/apache/zookeeper/version/util

Author: tison <wander4096@gmail.com>

Reviewers: Brian Nixon <nixon@fb.com>, Enrico Olivelli <eolivelli@gmail.com>, Michael Han <hanm@apache.org>

Closes #1049 from TisonKun/ZOOKEEPER-3475",2019-08-17 08:13:15,tison,Mixed
b5817fbb12b88bc28be72f109c695ebf51bebf3b,"ZOOKEEPER-3448: Introduce MessageTracker to assist debug leader and leaner connectivity issues.

We want to have better insight on the state of the world when learners lost connection with leader, so we need capture more information when that happens. We capture more information through MessageTracker which will record the last few sent and received messages at various protocol stage, and these information will be dumped to log files for further analysis.

Author: Michael Han <lhan@twitter.com>
Author: Michael Han <hanm@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Fangmin Lyu <fangmin@apache.org>

Closes #1007 from hanm/twitter/2765eb0629d2f63f07d112270b582e8e931f734f",2019-08-23 19:43:02,Michael Han,Mixed
b8d5d9c1c163f3be4f6ec7d2eb520d37d9352c73,"ZOOKEEPER-3517: Turn on BookKeeper checkstyle configuration at project level

Turn on BookKeeper checkstyle configuration at project level.

In zookeeper-contrib we still use checkstyle-simple because there are lots of conflicts which is not worth to fix.

Author: tison <wander4096@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1060 from TisonKun/ZOOKEEPER-3517",2019-08-27 09:23:11,tison,Mixed
68c21988d55c57e483370d3ee223c22da2d1bbcf,"ZOOKEEPER-3056: Fails to load database with missing snapshot file but with valid transaction log file.

ZOOKEEPER-2325 introduced a check on snapshot and transaction log files during recovery, which will treat empty or missing snapshot files with the presence of transaction log files illegal state, and abort start up process.

For old versions of ZooKeeper, it's possible to have valid transaction log files but no snapshot. For example, if snap count set too low, or server crashes before the first snapshot was taken. For new versions of ZooKeeper with ZOOKEEPER-2325, this is not a problem as ZooKeeper will make sure the presence of at least one snapshot file (e.g. on a fresh start with empty local data, ZooKeeper will create one snapshot file as part of the start up.).

So we need provide a smooth upgrade path for users with old version of ZooKeeper. This patch introduces a system property flag, once set, will skip the empty snapshot validation during start up. The default value of this flag is false, as we don't want to disable the features introduced in ZOOKEEPER-2325. We also want the flag to be explicitly set by admin, as ZooKeeper itself is not able to tell when to trust missing snapshot or not.

Author: Michael Han <lhan@twitter.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Brian Nixon <nixon@fb.com>

Closes #1069 from hanm/ZOOKEEPER-3056",2019-09-02 08:23:06,Michael Han,Not TDD
eecd9e7ce046083bd40cd6134bdb2b405d01fe67,"ZOOKEEPER-3492: Add weights to server side connection throttling

Author: Jie Huang <jiehuang@fb.com>

Reviewers: Michael Han <hanm@apache.org>, Enrico Olivelli <eolivelli@gmail.com>

Closes #1037 from jhuan31/ZOOKEEPER-3492",2019-09-05 14:12:50,Jie Huang,Mixed
f01d01ce3ba86baf9bd623f91d97a560703260e4,"ZOOKEEPER-3495: fix SnapshotDigestTest to work with JDK12+

The problem with the test `SnapshotDigestTest.testDifferentDigestVersion` was that it used reflection to change a final static value in `DigestCalculator`, what is no longer supported with JDK 12+ (see [JDK-8210522](https://bugs.openjdk.java.net/browse/JDK-8210522))

I think there are still some hacky solutions to go behind these limitations (with [PowerMock](https://github.com/powermock/powermock) maybe or using [VarHandle as suggested here](https://stackoverflow.com/questions/56039341/get-declared-fields-of-java-lang-reflect-fields-in-jdk12)), but I think the best is to avoid the situation when we need to poke the static final field.

I changed the fully static `DigestCalculator`, converting it to a static singleton object with non-static methods / fields. The fields of the singleton object can not be modified from production code, but we can change them from the tests even in JDK 12 / 13 (as they are not static final fields).

I tested it locally using openjdk, I hope it will also work in jenkins.

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>
Author: Mate Szalay-Beko <mszalay@cloudera.com>

Reviewers: fangmin@apache.org, eolivelli@apache.org, andor@apache.org

Closes #1056 from symat/ZOOKEEPER-3495 and squashes the following commits:

fa2a3b3c4 [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into HEAD
67c5532c8 [Mate Szalay-Beko] ZOOKEEPER-3495 move digestEnabled to the ZooKeeperServer class
c58a88c4f [Mate Szalay-Beko] ZOOKEEPER-3495: implement code-review comments
1a8cc2b96 [Mate Szalay-Beko] Merge remote-tracking branch 'origin/master' into ZOOKEEPER-3495
90da4c41e [Mate Szalay-Beko] ZOOKEEPER-3495: NodeHashMap use the same DigestCalculator instance as DataTree
e1f659cc8 [Mate Szalay-Beko] Merge remote-tracking branch 'origin/master' into ZOOKEEPER-3495
dbbf38fc6 [Mate Szalay-Beko] ZOOKEEPER-3495: fix checkstyle errors
07741ae18 [Mate Szalay-Beko] Merge remote-tracking branch 'origin/master' into ZOOKEEPER-3495
d0d886dc6 [Mate Szalay-Beko] ZOOKEEPER-3495: change implementation according to code review comments
2a80c3216 [Mate Szalay-Beko] ZOOKEEPER-3495: fix SnapshotDigestTest to work with JDK12+",2019-09-10 15:21:05,Mate Szalay-Beko,Mixed
8460f4ed48c5f9018d882bee2be748de42e965f9,"ZOOKEEPER-3540: Avoid client port unavailable by skip binding the same client port during reconfig

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #1083 from lvfangmin/ZOOKEEPER-3540",2019-09-10 18:50:37,Fangmin Lyu,Mixed
42ea26b75105484ef0504396332c276952224158,"ZOOKEEPER-3145: Fix potential watch missing issue due to stale pzxid when replaying CloseSession txn with fuzzy snapshot

Currently, the CloseSession txn is not idempotent, executing the CloseSession twice won't get the same result, which could cause pzxid inconsistent, which in turn cause watches missing.

For more details, please check the description in ZOOKEEPER-3145.

Author: Fangmin Lyu <allenlyu@fb.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnár <andor@apache.org>

Closes #622 from lvfangmin/ZOOKEEPER-3145",2019-09-11 10:27:28,Fangmin Lyu,Mixed
1ca627b5a3105d80ed4d851c6e9f1a1e2ac7d64a,"ZOOKEEPER-3503: Add server side large request throttling

With this change, a ZooKeeper server has two new settings:
zookeeper.largeRequestThreshold
zookeeper.largeRequestMaxBytes

Any request that is larger than largeRequestThreshold is considered a large request, and will only be allowed if the number of bytes associated with inflight large requests is currently below the largeRequestMaxBytes limit.

This check is performed in the connection layer based on the length header of a request, before allocating the necessary byte buffer and reading data off the TCP socket. This ensures the limit is enforced before allocating data that's ultimately just going to discarded.

Whenever a large request is allowed, its size is added to an atomic counter which represents the number of large request bytes inflight and this counter is the one tested against the max. Whenever a large request is completed or dropped, the counter is decremented as necessary.

Author: Jie Huang <jiehuang@fb.com>
Author: Joseph Blomstedt <jdb@fb.com>

Reviewers: Michael Han <hanm@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1051 from jhuan31/ZOOKEEPER-3503",2019-09-16 14:26:05,Jie Huang,Mixed
7b8b37617bd86989f94510acac32e7fa94058a6b,"ZOOKEEPER-3523: Replace dummy watcher with a unified singleton

Revisit subclasses of `Watcher` and replace dummy implement with a global singleton `Watcher.DUMMY_WATCHER`.

A followup could be use separated `Watcher` in tests instead of implement `Watcher` for `XXXTests`. It would be better to keep test case ""class"" alone IMO.

Author: tison <wander4096@gmail.com>

Reviewers: Michael Han <hanm@apache.org>, Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1064 from TisonKun/ZOOKEEPER-3523",2019-09-18 11:20:31,tison,Mixed
a179caa668882d6129ebb000ee60455de749d34f,"ZOOKEEPER-3501: unify the method:op2String()

- delete the duplicated method `op2String()` in the `TraceFormatter.java `
- there're 30 ops in the `ZooDefs.OpCode` and they're the same order with the `Request#op2String` for reading
- more details in the [ZOOKEEPER-3501](https://issues.apache.org/jira/browse/ZOOKEEPER-3501)

Author: maoling <maoling199210191@sina.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1050 from maoling/ZOOKEEPER-3501",2019-09-20 10:06:43,maoling,Not TDD
4279758ead655aff34cdff21c9f2c71d66030d14,"ZOOKEEPER-3496: Transaction larger than jute.maxbuffer makes ZooKeeper service unavailable

Author: Mohammad Arshad <arshad.mohammad.k@gmail.com>
Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Michael Han <hanm@apache.org>

Closes #1096 from arshadmohammad/ZOOKEEPER-3496-master",2019-09-26 08:55:31,Mohammad Arshad,Mixed
1e7fae31af634ccfb85cde17fa634d188145b9b7,"ZOOKEEPER-2282: C Client: chroot not stripped in asynchronous callbacks

This is related to ZOOKEEPER-1027, which adjusted the result of `create` calls to account for the chroot path.  It did not, however, correct the problem for asynchronous calls:

    $ cli_st $ENSEMBLE_HOSTS/rt-46444

    create /x/fred
    Creating [/x/fred] node (mode: 0)
    [/x/fred]: rc = 0
            name = /rt-46444/x/fred

    create2 /x/wilma
    Creating [/x/wilma] node (mode: 0)
    [/x/wilma]: rc = 0
            name = /rt-46444/x/wilma
            ctime = Wed Aug 28 18:14:16 2019
            czxid=1f00000041
            mtime=Wed Aug 28 18:14:16 2019
            mzxid=1f00000041
            version=0	aversion=0
            ephemeralOwner = 0

(It turns out that there was already a ticket, with a patch, for this issue.  I am mentioning Andrew Grasso as a co-author.  This commit also avoids the test failure, however.)

Co-authored-by: Andrew Grasso <andrew-grassousers.noreply.github.com>

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1066 from ztzg/ZOOKEEPER-2282-c-client-async-chroot-paths",2019-09-27 15:43:19,Damien Diederen,Not TDD
0d7be16b86830f4bacc4fea9389e0dff760d38e0,"ZOOKEEPER-1467: Make server principal configurable at client side.

Make server principal configurable at the client side

Author: sujithsimon22 <sujith.abraham.simon@huawei.com>

Reviewers: Mohammad Arshad <arshad@apache.org>, enixon

Closes #1099 from sujithsimon22/ZOOKEEPER-1467",2019-10-01 01:56:26,Sujith Simon,Not TDD
f4c7b698bd239bcd15ee380d2ee38814dba432cd,"ZOOKEEPER-3531: Synchronization on ACLCache cause cluster to hang whe…

…n network/disk issues happen during datatree serialization

Author: Mcfatealan <louchang_new@163.com>

Reviewers: fangmin@apache.org, andor@apache.org

Closes #1077 from mcfatealan/ZOOKEEPER-3531 and squashes the following commits:

60109185e [Mcfatealan] minor
951dd5cac [Mcfatealan] fix checkstyle issue
96ea4a066 [Mcfatealan] finer-synchronization for deserialize
b79446a6f [Mcfatealan] minor fix for checkstyle
d5f7d04ab [Mcfatealan] ZOOKEEPER-3531: Synchronization on ACLCache cause cluster to hang when network/disk issues happen during datatree serialization",2019-10-09 16:38:44,Mcfatealan,Not TDD
4951a090d7c946f57ac5ab09b5d48a5d7831001d,"ZOOKEEPER-3471: Fix potential lock unavailable due to dangling ephemeral nodes left during local session upgrading

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: andor@apache.org

Closes #1025 from lvfangmin/ZOOKEEPER-3471",2019-10-09 16:49:02,Fangmin Lyu,Not TDD
11c07921c15e2fb7692375327b53f26a583b77ca,"ZOOKEEPER-3509: Revisit log format

1. Always wrap `.trace` with `isTraceEnabled`. It is because that some of trace calls are a bit complex.
2. Never wrap other levels with `isXXXEnabled`. Logger already checks log level and we don't make side effect or expensive operation in log statement.
3. Always use `{}` instead of string concatenation or `String.format`. Just for unification and it is what is recommended.
4. Always log throwable in warn or error level or debug if omit
5. Always log throwable as the last arg and never log `throwable.getMessage` since Logger already log stack trace.

Author: tison <wander4096@gmail.com>

Reviewers: enixon@apache.org, andor@apache.org

Closes #1100 from TisonKun/ZOOKEEPER-3509 and squashes the following commits:

0c3a4ded8 [tison] Address comment
dcb68eb61 [tison] ZOOKEEPER-3509: Revisit log format",2019-10-10 14:37:45,tison,Mixed
e41cac853de416026e0c2011e0429e858e5823b8,"ZOOKEEPER-3605: connThrottle needs to be assigned in alternate consructor

`connThrottle` needs to be assigned in alternate consructor to avoid NPEs

Author: randgalt <jordan@jordanzimmerman.com>

Reviewers: Enrico Olivelli, Andor Molnár

Closes #1132 from Randgalt/ZOOKEEPER-3605",2019-11-06 15:21:19,randgalt,Not TDD
553639378d5cf86c2488afff4586e5e4cce38061,"ZOOKEEPER-1416 - Persistent, recursive watchers

### Background

Note: this is a port of https://github.com/apache/zookeeper/pull/136

Implementation for a persistent, recursive watch addition for ZK. These watches are set via a new method, addPersistentWatch() and are removed via the existing watcher removal methods. Persistent, recursive watches have these characteristics: a) Once set, they do not auto-remove when triggered; b) they trigger for all event types (child, data, etc.) on the node they are registered for and any child znode recursively; c) they are efficiently implemented by using the existing watch internals. A new class PathIterator walks up the path parent-by-parent when checking if a watcher applies.

### Implementation Details

- A new enum manages the different ""modes"" for watchers: `WatcherMode`.
- For traditional, ""standard"" watchers, the code path is almost exactly the same. There is very little overhead other than a bit of extra checks in `WatchManager`
- Given how this is implemented it was difficult to add support when `WatchManagerOptimized` is used. I'm open to adding it for that version but it will take work. We should consider not supporting persistent/recursive watchers when WatchManagerOptimized is used. I notice that `WatchManagerOptimized` is not even mentioned in the docs.
- The mode for a given watcher/path pair is held in a map inside of `WatcherModeManager`. The absence of an entry means Standard. This way, there's no overhead for old, standard watchers.
- `PathParentIterator` is the ""meat"" of the implementation. Rather than set watchers on every ZNode implied by a recursive watcher. WatchManager passes any paths it processes through PathParentIterator which iterates up each parent znode looking for watchers.
- The remainder of the changes are scaffolding to match how other watchers are used as well as Jute/API changes to set persistent/recursive watchers

### Testing

The tests were written years ago. I think they're comprehensive but reviewers should pay attention to anything that was missed. There is much ZooKeeper knowledge that's only in the heads of ZK committers.

- `PersistentWatcherTest` - tests persistent, non-recursive watchers
- `PersistentRecursiveWatcherTest` - tests persistent, recursive watchers
- `PathParentIteratorTest`- exercises edges of PathParentIterator

Author: randgalt <jordan@jordanzimmerman.com>

Reviewers: Enrico Olivelli <eolivelli@apache,org>, Norbert Kalmar <nkalmar@apache.org>, Andor Molnár <andor@apache.org>, Justin Mao Ling <maoling199210191@sina.com>

Closes #1106 from Randgalt/ZOOKEEPER-1416",2019-11-08 17:30:25,randgalt,Mixed
79f99af81842f415b97e1c3c18c953df5bd129b2,"ZOOKEEPER-3598: Fix potential data inconsistency issue due to CommitProcessor not gracefully shutdown

Note: use exit code 16 for SHUTDOWN_UNGRACEFULLY, since internally we've already using 15 for other exit code, which will be upstreamed later.

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Michael Han <hanm@apache.org>

Closes #1130 from lvfangmin/ZOOKEEPER-3598",2019-11-11 13:55:55,Fangmin Lyu,Mixed
794adf11220151496a1ff877df3d2627719c9505,"ZOOKEEPER-1260: Audit logging in ZooKeeper servers.

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <andor@apache.org>

Closes #1133 from arshadmohammad/ZOOKEEPER-1260-AuditLog-master",2019-11-11 13:59:08,Mohammad Arshad,Mixed
cd465947949f64d4258184d7b493a7e8747c6262,"ZOOKEEPER-3340: Introduce CircularBlockingQueue in QuorumCnxManager.java

There are many caveats and comments regarding Exception thrown 'which is safe to ignore'.  Added a new data structure that removes all of these comments and will perform without generating exceptions while more clearly implementing the desired behavior without the caveats.

Author: Beluga Behr <dam6923@gmail.com>
Author: David Mollitor <dam6923@gmail.com>
Author: David Mollitor <dmollitor@apache.org>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #880 from belugabehr/ZOOKEEPER-3340 and squashes the following commits:

7b74dac27 [David Mollitor] Changed comment from conrete ArrayBlockingQueue to BlockingQueue
38d7e3f05 [David Mollitor] Shutdown ExecutorService in test
f5ea2b6b1 [David Mollitor] Updated to fix checkstyle ImportOrder: Extra separation
b3ac3cc44 [David Mollitor] Rebased to master
c63ab852c [Beluga Behr] Added updates from code review
d8877803b [Beluga Behr] Introduce new class CircularBlockingQueue
2793db2f1 [Beluga Behr] Added additional logging
ce96b7071 [Beluga Behr] ZOOKEEPER-3340: Improve Queue Usage in QuorumCnxManager.java",2019-11-13 20:41:47,Beluga Behr,Mixed
df267929322c5e83bb8d57bbed65978b0159ec8b,"ZOOKEEPER-2238: Support limiting the maximum number of connections/clients to a zookeeper server

Support limiting the maximum number of connections/clients to a zookeeper server

Author: sujithsimon22 <sujith.abraham.simon@huawei.com>

Reviewers: Justin Mao Ling <maoling199210191@sina.com>, Brian Nixon <enixon@apache.org>, Edward Ribeiro <edward.ribeiro@gmail.com>, Enrico Olivelli <eolivelli@apache.org>, Mohammad Arshad <arshad@apache.org>

Closes #1108 from sujithsimon22/ZOOKEEPER-2238",2019-11-14 08:24:09,Sujith Simon,Not TDD
aeb9f78c454c59d5d258f0a99bb5e57ed2cbaebe,"ZOOKEEPER-3571: Ensure test base directory before tests

Ensure `build.test.dir` is present as a directory. Otherwise many times it suffers from

```
java.io.IOException: No such file or directory

	at java.io.UnixFileSystem.createFileExclusively(Native Method)
	at java.io.File.createTempFile(File.java:2024)
	at org.apache.zookeeper.test.ClientBase.createTmpDir(ClientBase.java:371)
	at org.apache.zookeeper.test.ClientBase.setUpWithServerId(ClientBase.java:514)
	at org.apache.zookeeper.test.ClientBase.setUp(ClientBase.java:491)
```

Author: tison <wander4096@gmail.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1112 from TisonKun/ZOOKEEPER-3571",2019-11-14 16:44:36,tison,Not TDD
9f13268567dfcc26a5f59a7449aeec21fb5e16b3,"Revert ""ZOOKEEPER-3598: Fix potential data inconsistency issue due to CommitProcessor not gracefully shutdown""

This reverts commit 79f99af81842f415b97e1c3c18c953df5bd129b2.",2019-11-15 10:56:42,Andor Molnar,Mixed
945167c338d4a26c18bdaf49fb9000186a5f7025,"ZOOKEEPER-3560: Add response cache to serve get children (2) requests.

ZOOKEEPER-3180 introduces response cache but it only covers getData requests. This commit is to extend the response cache based on the infrastructure set up by ZOOKEEPER-3180 to so the response of get children requests can also be served out of cache. Some design decisions:

* Only OpCode.getChildren2 is supported, as OpCode.getChildren does not have associated stats and current cache infra relies on stats to invalidate cache.

* The children list is stored in a separate response cache object so it does not pollute the existing data cache that's serving getData requests, and this separation also allows potential separate tuning of each cache based on workload characteristics.

* As a result of cache object separation, new server metrics is added to measure cache hit / miss for get children requests, that's separated from get data requests.

Similar as ZOOKEEPER-3180, the get children response cache is enabled by default, with a default cache size of 400, and can be disabled (together with get data response cache.).

Author: Michael Han <lhan@twitter.com>
Author: Michael Han <hanm@apache.org>

Reviewers: eolivelli@apache.org, andor@apache.org, enixon@apache.org

Closes #1098 from hanm/cache",2019-11-18 09:05:38,Michael Han,Mixed
ae68c7d50e4057ef3f9b99ac0cd0200a8bd5f235,"ZOOKEEPER-3570: make the special client xid constant

- more details in the [ZOOKEEPER-3570](https://issues.apache.org/jira/browse/ZOOKEEPER-3570)

Author: maoling <maoling199210191@sina.com>

Reviewers: Fangmin Lyu <fangmin@apache.org>, Brian Nixon <enixon@apache.org>

Closes #1136 from maoling/ZOOKEEPER-3570",2019-11-20 20:58:30,maoling,Not TDD
dded710d07892c6b42380267cd1bb896b852a7ee,"ZOOKEEPER-2122: add SSL support for C-client

This PR is based on the works of Asnish Amarnath and Suhas Dantkale. Most of the kudos should go to them and those who were reviewing all the previous PRs.

**The PR includes the following changes from PR#639:**
- OPENSSL 1.1.1 version support in C-client

**The PR includes the following changes from PR#990:**
- also supporting OPENSSL 1.0.2
- SSL connection on non-blocking socket is handled correctly
- Support of Certificate Chains
- Fix Memory leaks
- Dynamically generated test certificates

**The following new changes were added into the PR:**
- fix CMake + VisualStudio2019 build with windows
- fix C CLI to compile / work both with windows and linux (I tested them manually)
- fix (and simplify) the way how the server is started with C unit tests, so it is compatible with maven build now
- the test case `testReadOnly` was failing with the previous PR because there was a bug in the C-client code, I fixed that
- I also added new test case: `testReadOnlyWithSSL`

**Testing this PR on linux:**
```
git clean -xdf

# compile ZooKeeper server plus the C-client code
mvn clean install -DskipTests -Pfull-build

# compile and execute C-client unit tests
cd zookeeper-client/
mvn clean install -Pfull-build
```

**Compile the code on windows (only cmake is supported):**
- download C-Make:  https://cmake.org/download/
- Install community edition of Visual Studio: https://visualstudio.microsoft.com/downloads/
- Download OpenSSL (e.g. 1.0.2): https://slproweb.com/products/Win32OpenSSL.html (e.g. install it to `c:\OpenSSL-Win64`)
- compile the java code using: `mvn clean install -DskipTests`
- go to the Client folder: `cd zookeeper-client\zookeeper-client-c`
- configure the project:  `cmake . -D WITH_OPENSSL=c:\OpenSSL-Win64`
- build the project: `cmake --build .`

**Testing the C-client with SSL manually:**
- run the `zookeeper-client/zookeeper-client-c/ssl/gencerts.sh` to generate certificate files (e.g. copy it to an empty folder like `/tmp/ssl/` and start is)
- start a ZooKeeper server, using some config file like this one:
```
tickTime=3000
initLimit=10
syncLimit=5
dataDir=/tmp/zkdata

secureClientPort=22281
serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory
ssl.keyStore.location=/tmp/ssl/server.jks
ssl.keyStore.password=password
ssl.trustStore.location=/tmp/ssl/servertrust.jks
ssl.trustStore.password=password
```
- start the command line client (cli.exe on windows, cli_mt or cli_st on linux): `./cli_mt --host localhost:22281 --ssl /tmp/ssl/server.crt,/tmp/ssl/client.crt,/tmp/ssl/clientkey.pem,password`

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>
Author: Mate Szalay-Beko <mszalay@cloudera.com>

Reviewers: andor@apache.org

Closes #1107 from symat/ZOOKEEPER-2122 and squashes the following commits:

08294ce91 [Mate Szalay-Beko] ZOOKEEPER-2122: update readme + use FQDN in SSL certs during testing
17e504a98 [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-2122
317241d13 [Mate Szalay-Beko] ZOOKEEPER-2122: minor fix in SSL certificates used for testing
6f37b6653 [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into HEAD
980914313 [Mate Szalay-Beko] ZOOKEEPER-2122: add SSL support for C-client",2019-11-21 09:54:01,Mate Szalay-Beko,Not TDD
804095c060e3b11c33b201a304031dc3ac18cfb6,"ZOOKEEPER-3473: Improving successful TLS handshake throughput with concurrent control

When there are lots of clients trying to re-establish sessions, there might be lots of half finished handshake timed out, and those failed ones keep reconnecting to another server and restarting the handshake from beginning again, which caused herd effect.

And the number of total ZK sessions could be supported within session timeout are impacted a lot after enabling TLS.

To improve the throughput, we added the TLS concurrent control to reduce the herd effect, and from out benchmark this doubled the sessions we could support within session timeout.

E2E test result:

Tested performance and correctness from E2E. For correctness, tested both secure and insecure
connections, the outstandingHandshakeNum will go to 0 eventually.

For performance, tested with 110k sessions with 10s session timeout, there is no session expire when leader election triggered, while before it can only support 50k sessions.

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <andor@apache.org>

Closes #1027 from lvfangmin/ZOOKEEPER-3473",2019-11-23 17:08:23,Fangmin Lyu,Mixed
4132b64b36ea43909888fdaf34268a243f2c7420,"ZOOKEEPER-3546 - Allow optional deletion of never used Container Nodes

Edge cases can cause Container Nodes to never be deleted. i.e. if the container node is created and then the client that create the node crashes the container will not get deleted unless another client creates a node inside of it. This is because the initial implementation does not delete container nodes with a cversion of 0. This PR adds a new system property, ""znode.container.maxNeverUsedIntervalMs"", that can be set to delete containers with a cversion of 0 that have been retained for a period of time. This is a backward compatible change as the default value for this is Long.MAX_VALUE - i.e. never.

Author: randgalt <jordan@jordanzimmerman.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Fangmin Lyu <fangmin@apache.org>

Closes #1138 from Randgalt/ZOOKEEPER-3546-allow-delete-of-never-used-containers",2019-11-25 15:37:51,randgalt,Not TDD
8e8905069f4bff670c0492fe9e28ced0f86bca00,"ZOOKEEPER-3620: Allow to override calls to System.exit in server side code

- Introduce a way to override calls to System.exit
- enable DM_EXIT spotbugs rule

see https://issues.apache.org/jira/browse/ZOOKEEPER-3620 for more context.

Author: Enrico Olivelli <enrico.olivelli@diennea.com>
Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: andor@apache.org

Closes #1147 from eolivelli/fix/ZOOKEEPER-3620-no-systemexit and squashes the following commits:

a234f85f1 [Enrico Olivelli] Fix checkstyle
4c4fec49e [Enrico Olivelli] Fix spotbugs warning
ae339b724 [Enrico Olivelli] Revert changes to VerGen.java
0e5ee07c5 [Enrico Olivelli] Enable DM_EXIT spotbugs rule for the full code base
b05a4bf38 [Enrico Olivelli] ZOOKEEPER-3620 Allow to override calls to System.exit in server side code: - Use a common utility to call System.exit - Override calls to System.exit to a NO-OP function in tests",2019-11-28 12:24:36,Enrico Olivelli,Not TDD
815c8f2130b8b43e11abe52b226707f707a93581,"ZOOKEEPER-3188: Improve resilience to network

This PR is the rebase of the [previous pull request](https://github.com/apache/zookeeper/pull/730), so all the kudos should go to the original authors...

In [ZOOKEEPER-3188](https://issues.apache.org/jira/browse/ZOOKEEPER-3188) we add ability to specify several addresses for quorum operations. Also added reconnection attempts if connection to leader lost.

In this PR I rebased the changes on the current master, resolving some minor conflicts with:
- [ZOOKEEPER-3296](https://issues.apache.org/jira/browse/ZOOKEEPER-3296): Explicitly closing the sslsocket when it failed handshake to prevent issue where peers cannot join quorum
- [ZOOKEEPER-3320](https://issues.apache.org/jira/browse/ZOOKEEPER-3320): Leader election port stop listen when hostname unresolvable for some time
- [ZOOKEEPER-3385](https://issues.apache.org/jira/browse/ZOOKEEPER-3385): Add admin command to display leader
- [ZOOKEEPER-3386](https://issues.apache.org/jira/browse/ZOOKEEPER-3386): Add admin command to display voting view
- [ZOOKEEPER-3398](https://issues.apache.org/jira/browse/ZOOKEEPER-3398): Learner.connectToLeader() may take too long to time-out

I still want to test the feature manually (e.g. using docker containers with multiple virtual networks / interfaces). The steps to the manual test could be recorded in the [google docs](https://docs.google.com/document/d/1iGVwxeHp57qogwfdodCh9b32P2_kOQaJZ2GDo7j36fI/edit?usp=sharing) as well.

Also I think we could add a few more unit tests where we are using multiple addresses. The current tests are using a single address only.

Also the Zookeeper documentation needs to be changed (e.g. by a follow-up Jira?) to promote the new feature and the new config format (possibly including also the admin command documentation in relation with [ZOOKEEPER-3386](https://issues.apache.org/jira/browse/ZOOKEEPER-3386) and [ZOOKEEPER-3461](https://issues.apache.org/jira/browse/ZOOKEEPER-3461))

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>
Author: Mate Szalay-Beko <mszalay@cloudera.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1048 from symat/ZOOKEEPER-3188 and squashes the following commits:

3c6fc52d7 [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3188
356882d46 [Mate Szalay-Beko] ZOOKEEPER-3188: document new configuration format for using multiple addresses
45b6c0fdb [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3188
4b6bcea48 [Mate Szalay-Beko] ZOOKEEPER-3188: MultiAddress unit tests for Quorum TLS and Kerberos/Digest authentication
40bc44c23 [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3188
f875f5c67 [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3188
31805e79b [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3188
0f95678ca [Mate Szalay-Beko] ZOOKEEPER-3188: skip unreachable addresses when Learner connects to Leader
e232c55da [Mate Szalay-Beko] ZOOKEEPER-3188: fix flaky unit MultiAddress unit test
e892d8d8e [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3188
6f2ab755f [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3188
2eedf2687 [Mate Szalay-Beko] ZOOKEEPER-3188: fix PR commits; handle case when Leader can not bind to port on startup
483d2fc9c [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3188
a5d6bcb97 [Mate Szalay-Beko] ZOOKEEPER-3188: support for dynamic reconfig + add more unit tests
ed31d2ce9 [Mate Szalay-Beko] ZOOKEEPER-3188: better shutdown for executors (following PR comments)
8713a5bbf [Mate Szalay-Beko] ZOOKEEPER-3188: add fixes for PR comments
05eae83c0 [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3188
e823af4b1 [Mate Szalay-Beko] Merge remote-tracking branch 'origin/master' into ZOOKEEPER-3188
de7bad2a6 [Mate Szalay-Beko] Merge remote-tracking branch 'origin/master' into ZOOKEEPER-3188
da98a8da6 [Mate Szalay-Beko] ZOOKEEPER-3188: fix JDK-13 warning
5bd1f4e2c [Mate Szalay-Beko] ZOOKEEPER-3188: supress spotbugs warning
42a52a688 [Mate Szalay-Beko] ZOOKEEPER-3188: improve based on code review comments
6c4220a0d [Mate Szalay-Beko] ZOOKEEPER-3188: fix SendWorker.asyncValidateIfSocketIsStillReachable
5b22432c1 [Mate Szalay-Beko] ZOOKEEPER-3188: fix LeaderElection to work with multiple election addresses
7bfbe7e5c [Mate Szalay-Beko] ZOOKEEPER-3188: Improve resilience to network",2019-11-29 14:49:13,Mate Szalay-Beko,Mixed
01e198aec9ceae52f160ddcf2e45cd234823e505,"ZOOKEEPER-3633: AdminServer commands throw NPE when only secure client port is used

When only secureClientPort is defined in the config and there is no regular clientPort,
then both the stat and the conf commands on the AdminServer result in 500 Server Error caused by
NullPointerExceptions. The problem is that no serverCnxFactory is defined in the
ZooKeeperServer in this case, we have only secureServerCnxnFactory.

In the fix we return info about both the secure and unsecure connections.
Example of the stat command output for secure-only configuration:
```
{
  ""version"" : ""3.6.0-SNAPSHOT-8e8905069f4bff670c0492fe9e28ced0f86bca00, built on 11/29/2019 08:04 GMT"",
  ""read_only"" : false,
  ""server_stats"" : {
    ""packets_sent"" : 1,
    ""packets_received"" : 1,
    ""fsync_threshold_exceed_count"" : 0,
    ""client_response_stats"" : {
      ""last_buffer_size"" : -1,
      ""min_buffer_size"" : -1,
      ""max_buffer_size"" : -1
    },
    ""data_dir_size"" : 671094270,
    ""log_dir_size"" : 671094270,
    ""last_processed_zxid"" : 20,
    ""outstanding_requests"" : 0,
    ""server_state"" : ""standalone"",
    ""avg_latency"" : 5.0,
    ""max_latency"" : 5,
    ""min_latency"" : 5,
    ""num_alive_client_connections"" : 1,
    ""provider_null"" : false,
    ""uptime"" : 15020
  },
  ""client_response"" : {
    ""last_buffer_size"" : -1,
    ""min_buffer_size"" : -1,
    ""max_buffer_size"" : -1
  },
  ""node_count"" : 6,
  ""connections"" : [ ],
  ""secure_connections"" : [ {
    ""remote_socket_address"" : ""127.0.0.1:57276"",
    ""interest_ops"" : 1,
    ""outstanding_requests"" : 0,
    ""packets_received"" : 1,
    ""packets_sent"" : 1
  } ],
  ""command"" : ""stats"",
  ""error"" : null
}
```

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>

Reviewers: Andor Molnar <andor@apache.org>, Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1161 from symat/ZOOKEEPER-3633",2019-12-03 10:01:22,Mate Szalay-Beko,Mixed
b0556c20a4331de29476faf845e8fca18e8820fe,"ZOOKEEPER-3595: restore the handling of the fsync parameter

Author: Jingguo Yao <yaojingguo@gmail.com>

Reviewers: enixon@apache.org, eolivelli@apache.org, maoling199210191@sina.com, fangmin@apache.org

Closes #1146 from yaojingguo/ZOOKEEPER-3595",2019-12-03 10:12:30,Jingguo Yao,Mixed
a5d67c8ffcc18289aa89c892d948ad7c75a317b4,"ZOOKEEPER-3644: Data loss after upgrading standalone ZK server 3.4.14 to 3.5.6 with snapshot.trust.empty=true

We didn't replay transactions during recovery when snapshot files are missing and snapshot.trust.empty is set to true; this leads to no actual data being applied to the deserialized in memory data tree. We should make sure always replay the transactions after snapshot loading is done.

Author: Michael Han <hanm@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #1177 from hanm/ZOOKEEPER-3644",2019-12-13 08:51:38,Michael Han,Not TDD
19d85670a3c87565bc63a5f84169e4c6c72e2915,"ZOOKEEPER-2307: ZooKeeper not starting because acceptedEpoch is less than the currentEpoch

Update acceptedEpoch and currentEpoch in file first then in memory.

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: andor@apache.org

Closes #1145 from arshadmohammad/ZOOKEEPER-2307-epochUpdate and squashes the following commits:

b05bc1f1c [Mohammad Arshad] review comment fix
c8d620f39 [Mohammad Arshad] ZOOKEEPER-2307:ZooKeeper not starting because acceptedEpoch is less than the currentEpoch",2019-12-17 13:48:25,Mohammad Arshad,Not TDD
7c9a1e4e9ae9e3a17c4766b34787e39ca1e42794,"ZOOKEEPER-3653: Audit Log feature fails in a stand alone zookeeper setup

Author: sujithsimon22 <sujith.abraham.simon@huawei.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>,Mohammad Arshad <arshad@apache.org>

Closes #1185 from sujithsimon22/master",2019-12-19 14:21:41,Sujith Simon,Not TDD
2805e8982c0e8964e5f8d86f4b01a293d75d4aed,"ZOOKEEPER-3512: Real time data consistency check during broadcast time

This is the 2nd part of data consistency based on digest, it checks the DataTree digest on every txn during broadcast time.

Author: Fangmin Lyu <fangmin@apache.org>
Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <andor@apache.org>, Michael Han <hanm@apache.org>

Closes #1059 from lvfangmin/ZOOKEEPER-3512",2019-12-27 22:33:26,Fangmin Lyu,Mixed
d784e4dc8e042bd622500f861163bb315fa856fe,"ZOOKEEPER-3582: refactor the async api call to lambda style

Author: ZWShuai91 <17610028856@163.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1142 from ZWShuai91/ZOOKEEPER-3582",2019-12-28 16:17:54,ZWShuai91,Not TDD
27b92caefd57a60309af06ebce29e56954ca9aac,"ZOOKEEPER-3411: Remove deprecated ls2 and rmr command

Removed Ls2Command.java, DeleteAllCommand.printdeprecatedwarning(), statements creating new objects for ls2 and rmr in ZookeeperMain.java. Updated zookeeperCLI.md and ZookeeperTest.java.

Please do let me know if any additional changes are needed

Author: ravowlga123 <ravowlga@gmail.com>

Reviewers: andor@apache.org

Closes #1175 from ravowlga123/ZOOKEEPER-3411",2020-01-09 22:56:39,ravowlga123,Mixed
49ad75b18bfe26e853050f5add6f10f567399058,"ZOOKEEPER-3667: Setting jute.maxbuffer value in hexadecimal throws Exception

Author: sujithsimon22 <sujith.abraham.simon@huawei.com>

Reviewers: Mohammad Arshad <arshad@apache.org>

Closes #1222 from sujithsimon22/3667",2020-01-20 13:09:29,Sujith Simon,Not TDD
dcef1a6f33d8120a93f011da1870a503aafb0312,"ZOOKEEPER-3613: ZKConfig fails to return proper value on getBoolean()when user accidentally includes spaces at the end of the value

Author: sujithsimon22 <sujith.abraham.simon@huawei.com>

Reviewers: Allan Lyu <fangmin@apache.org>,Justin Mao Ling <maoling199210191@sina.com>,Mohammad Arshad <arshad@apache.org>

Closes #1190 from sujithsimon22/3613",2020-01-20 13:36:59,Sujith Simon,Mixed
ee69a5565215bb95fe10d88f52dba80a7a7fb929,"ZOOKEEPER-3663: Clean Up ZNodeName Class

Author: David Mollitor <dmollitor@apache.org>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1193 from belugabehr/ZOOKEEPER-3663",2020-01-21 18:14:37,David Mollitor,Mixed
97f89ceb2ac22a45d886e0430e2bcbf4d337094d,"ZOOKEEPER-3666: remove the deprecated LogFormatter tool

As per [ZOOKEEPER-3666](https://issues.apache.org/jira/browse/ZOOKEEPER-3666), we need to remove the deprecated LogFormatter tool. For this I made the following changes:
- Removed LogFormatter class
- Removed testLogFormatter test from InvalidSnapshotTest
- Changed zookeeperAdmin.md file

Please let me know if additional changes are required.

Author: Nishanth Entoor <entoor.nishanth@gmail.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1200 from nishanth-entoor/ZOOKEEPER-3666",2020-01-21 18:18:51,Nishanth Entoor,Not TDD
b7dd0e49c5b25fffc1be8e619a3164bc680ef8bd,"ZOOKEEPER-3482: add unit tests for client SASL authentication over SSL

We had some issues about configuring Kerberos authentication with SSL, so I created some unit tests to verify that these features work together. The problem was originally reported on 3.5.5. There was some conflicts to backport the tests to 3.5, I will prepare a separate PR on that branch.

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>
Author: Mate Szalay-Beko <mszalay@cloudera.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1204 from symat/ZOOKEEPER-3482-master and squashes the following commits:

53194f564 [Mate Szalay-Beko] ZOOKEEPER-3482: update SASL related documentation
576ac0b21 [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3482-master
28da105c2 [Mate Szalay-Beko] ZOOKEEPER-3482: reload SASL and Kerberos configs before executing the tests
396c73e8a [Mate Szalay-Beko] ZOOKEEPER-3482: add unit tests for client SASL authentication over SSL",2020-01-22 11:08:42,Mate Szalay-Beko,Not TDD
c234848caef0cc920f19befd1b0b14251b17da92,"ZOOKEEPER-1112: Add (Cyrus) SASL authentication support to C client library

This is a ""respin"" of https://github.com/apache/zookeeper/pull/1054, which I withdrew due to some annoying shortcomings.

This changeset allows C clients to use SASL to authenticate with the ZooKeeper server.  It is loosely based on patches #1 and #2 by Tom Klonikowski, at https://reviews.apache.org/r/2252/, but the result has been extensively reworked to follow the semantics of the Java client:

  * No SASL operations are exposed through the API;

  * The configuration is provided, and stored, at ""handle init time"";

  * SASL authentication is automatically performed after each (re)connect.

It introduces an optional dependency on the Cyrus SASL library, which can either be autodetected (default) or configured using the `--without-sasl`/`--with-sasl[=DIR]` flags, or -DWITH_CYRUS_SASL for CMake/Windows.

`TestServerRequireClientSASLAuth.cc` has been renamed to `TestSASLAuth.cc`, and a test has been added which successfully (re)authenticates using the `DIGEST-MD5` mechanism.  The code has also been used to successfully authenticate clients via `GSSAPI`/Kerberos.

This commit also adds SASL support to the `cli.c` client.

Co-authored-by: Tom Klonikowski <klonik_tinformatik.haw-hamburg.de>

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Mate Szalay-Beko <szalay.beko.mate@gmail.com>, Norbert Kalmar <nkalmar@apache.org>

Closes #1134 from ztzg/ZOOKEEPER-1112-c-client-sasl-support-v2",2020-01-22 12:53:55,Damien Diederen,Not TDD
b4c5a7fdd0f97aa5a9bf18a345b1cee5b0da967a,"ZOOKEEPER-3698: fixing NoRouteToHostException when starting large cluster locally

When we tested RC 3.6.0, we had a problem of starting ZooKeeper cluster with large
number (11+) of ensemble members locally on mac. We found exceptions in the logs
when the new MultiAddress feature tries to filter the unreachable hosts from the
address list. This involves the calling of the InetAddress.isReachable method with
a default timeout of 500ms, which goes down to a native call in java and basically
try to do a ping (an ICMP echo request) to the host. Naturally, the localhost should
be always reachable.

The problem was that on mac we have the ICMP rate limit set to 250 by default.

In this patch we:
- changed the reachability check behavior by disabling the check if there is only
a single address provided (so we wouldn't be able to filter the unreachable
addresses anyway).
- added and documented a configuration parameter to disable the reachability check
for testing. (default: enabled)
- added and documented a configuration parameter to set the timeout for the
reachability checks. (default: 1000ms)

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1228 from symat/ZOOKEEPER-3698-branch-3.6

(cherry picked from commit 8352f78e752a019387c1eb6095085152e7d1d4ad)
Signed-off-by: Andor Molnar <andor@apache.org>",2020-01-23 13:43:52,Mate Szalay-Beko,Mixed
7c1251dbcf6a314466024f71ae5757bde34bb3fd,"ZOOKEEPER-3575: Moving sending packets in Learner to a separate thread

Author: Jie Huang <jiehuang@fb.com>

Reviewers: eolivelli@apache.org, fangmin@apache.org

Closes #1116 from jhuan31/ZOOKEEPER-3575",2020-01-25 09:48:36,Jie Huang,Not TDD
e4758ba70b35dd38ff0bba9e534790391f53b050,"ZOOKEEPER-3567: add SSL support for zkpython

This PR is about adding SSL support for zkPython, based on the C-binding. I also fixed the zkpython ant build to work with the current maven top-level build. I also added a new python test case to try to connect to ZooKeeper with SSL.

You can test this patch in the following way:
```
# cleanup everything, just to be on the safe side:
git clean -xdf

# on ubuntu 16.4 make sure you have the following packages installed
apt-get install -y libcppunit-dev openssl libssl-dev python-setuptools python2.7 python2.7-dev

# make a full build (incl. C-client)
mvn clean install -DskipTests -Pfull-build

# we only support python2, so e.g. on ubuntu 18.4 you need to switch to python2
update-alternatives --install /usr/bin/python python /usr/bin/python2.7 1

# compile and test zkpython
cd zookeeper-contrib/zookeeper-contrib-zkpython/
ant compile
ant test
```

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>

Reviewers: andor@apache.org

Closes #1121 from symat/ZOOKEEPER-3567 and squashes the following commits:

a5839cb56 [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into ZOOKEEPER-3567
d25d61024 [Mate Szalay-Beko] ZOOKEEPER-3567: fix build issues after top-level ant removal
a8869c969 [Mate Szalay-Beko] Merge remote-tracking branch 'apache/master' into HEAD
b92f686e8 [Mate Szalay-Beko] ZOOKEEPER-3567: fix license check issue
0150986da [Mate Szalay-Beko] ZOOKEEPER-3567: removing code duplication: re-use test SSL certificate generator from C-client tests
7d91359d3 [Mate Szalay-Beko] ZOOKEEPER-3567: add SSL support for zkpython",2020-01-27 11:26:15,Mate Szalay-Beko,Not TDD
a4bc9857e19b6fa3832813d7e47f683b582565b8,"ZOOKEEPER-3701: Split brain on log disk full

Issue described here:
https://issues.apache.org/jira/browse/ZOOKEEPER-3701

Proposing a fix with catching `IOException` within the truncate method to properly return with `false` if truncate fails.

Author: Andor Molnar <andor@apache.org>
Author: Andor Molnar <andor@cloudera.com>

Reviewers: Ivan Kelly <ivank@apache.org>, Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1233 from anmolnar/ZOOKEEPER-3701",2020-01-28 17:26:14,Andor Molnar,Not TDD
2abdfbc261d4ba2f9d17b51f2b46ab748a7d451f,"ZOOKEEPER-3231: Purge task may lost data when the recent snapshots are all invalid

- Purge task uses `FileTxnSnapLog#findNRecentSnapshot`, which's likely to lost data when the recent 3 snapshots are all invalid(a new valid snapshot has not generated yet) and at the same time, Purge task(`e.g ./zkCleanup.sh -n 3`) has started a new round work to clean up the preceding snapshots. we will lose all the data.that's a small probability events, but it's reproducible.
- Overall, using `snaplog.findNValidSnapshots` to make sure the purge task tries to retain N valid snapshots(rather than N snapshots) to avoid a risk of data loss.
- For the unit test, it's not easy to use the `mock` way for the following reasons:
   - when we want to test the `dataDir` which some Snapshots are valid, others not.Just writing a little data contents to the snapshot to make it valid/invalid has a better flexibility.
   - too much code changes in the `PurgeTxnTest.java`(pass the original UT) and `FileTxnSnapLog.java`(have some handles)
- more details in the [ZOOKEEPER-3231](https://issues.apache.org/jira/browse/ZOOKEEPER-3231)

Author: maoling <maoling199210191@sina.com>

Reviewers: enixon@apache.org, andor@apache.org

Closes #1079 from maoling/ZOOKEEPER-3231 and squashes the following commits:

674175bef [maoling] setUp() & tearDown().
472dfd33c [maoling] ZOOKEEPER-3231:Purge task may lost data when the recent snapshots are all invalid",2020-01-30 09:43:09,maoling,Mixed
3aa922c5737c9ef0879f290181cb281261c965e0,"ZOOKEEPER-3720: Fix rolling upgrade failure (invalid protocol version)

The multi-address feature introduced in ZOOKEEPER-3188 required
changes in the Quorum protocol as we had to send all addresses in
the connection initiation message to enable the receiving side to
choose a reachable address in case of network failure.

The new code can handle both the old and the new protocol versions to
avoid 'invalid protocol' error e.g. during rolling restarts. However,
the new protocol version still can not be used during rolling upgrade
if the old servers are not supporting this protocol. In this case the
old and the new servers would form two distinct partitions until all
the servers get upgraded. To support rolling upgrades too, we want to
disable the MultiAddress feature by default and use the old protocol.

If the user would like enable the MultiAddress feature on a 3.6.0
cluster, she/he can do it either by 1) starting the cluster from
scratch (without rolling upgrade), or 2) performing a rolling upgrade
without the MultiAddress feature enabled then doing a rolling restart
with a new configuration where the MultiAddress feature is enabled.
During the rolling restart there will be no partitions, as all the
servers in the cluster now will run ZooKeeper version 3.6.0 which
understands now both protocols.

The changes in this patch:
- introducing new config property: multiAddress.enabled, disabled
by default
- updating QuorumCnxManager to be able to use both protocol versions
and to use the old one if MultiAddress is disabled
- failing with ConfigException if the user provides multiple
addresses in the config while having MultiAddress disabled
- updating the existing MultiAddress related tests to enable the
feature first
- add some new tests
- update the documentation

Testing:
- I ran all the unit tests
- Using https://github.com/symat/zk-rolling-upgrade-test
  - I tested rolling upgrade from 3.5.6
  - I tested rolling restart to enable the MultiAddress feature
- Using https://github.com/symat/zookeeper-docker-test
  - I tested the MultiAddress feature by disabling some virtual
    interfaces and waiting for the cluster to recover

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>, Andor Molnar <andor@apache.org>

Closes #1251 from symat/ZOOKEEPER-3720",2020-02-16 10:25:14,Mate Szalay-Beko,Mixed
d3e72c659d20e109b2ba60c1fe277e5d14ba8e6b,"ZOOKEEPER-3706: ZooKeeper.close() would leak SendThread when the netw…

…ork is broken

- add unit test to verify the bug
- bypass the SendThread.startConnect() by throw RuntimeExcepth if state.isAlive is false

Author: Fangxi Yin <yinfangxikuaishou.com>

Author: yinfangxi <yinfangxi@kuaishou.com>

Reviewers: Michael Han <hanm@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, maoling

Closes #1235 from yfxhust/ZOOKEEPER-3706",2020-03-02 18:12:30,yinfangxi,Not TDD
0287c95726e66aa6723f0f91f8d85f9973dbbb60,"ZOOKEEPER-2164: Quorum members can not rejoin after restart

Ever since ZOOKEEPER-107 (released in 3.5.0) the servers are sending
their addresses during initial connection requests. The receiving
server can potentially use these addresses to send back a new
connection request if the challenge is won by the receiver.

If the server config contains wildcard address (e.g. 0.0.0.0 in case
of IPv4) then the first connection request sent by A to B will contain
this address. If the ID of A is smaller than the ID of B, then A will
lose the challenge and the second connection request sent back by B
will never reach A, as B will send the initial message to 0.0.0.0.

So in any 3.5+ ZooKeeper, if wildcard addresses are used in the configs,
then there might be some servers never able to rejoin to the quorum
after they got restarted.

In 3.5+ for backward compatibility reasons (needed during rolling
upgrade) there is a version of the QuorumCnxManager.connectOne()
method that needs no election address but use the last known address
to initiate the connection. In this commit, we simply call this method
if the address is a wildcard address.

I also added a few restart realted tests, to make sure that restart
still works when we don't use wildcard addresses. We can not test
the original error with unit tests, as it would require to start
the quorum on multiple hosts.

I also tested the patch for rolling restart manually both with and
without wildcard addresses in the config.

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1254 from symat/ZOOKEEPER-2164",2020-03-12 14:47:27,Mate Szalay-Beko,Mixed
b1105ccc47685c64d1cca7ccb0b2bb66c194374a,"ZOOKEEPER-3758: Leader reachability check fails with single address

Since ZooKeeper 3.6.0 we can specify multiple addresses for each ZooKeeper server instance
(this can increase availability when multiple physical network interfaces can be used parallel
in the cluster). ZooKeeper will perform ICMP ECHO requests or try to establish a TCP connection
on port 7 (Echo) of the destination host in order to find the reachable addresses. This should
happen only if the user provide multiple addresses in the configuration, in a single address is
used then ZooKeeper shouldn’t send any ICMP requests.

This works as we expected for the leader election connections, but in this Jira issue we found
a bug when the reachability check was performed even with a single address when the Follower
tries to connect to the newly elected Leader.

The fix follows the same approach we discussed for the election protocol before (see
ZOOKEEPER-3698). We avoid the reachability check for single addresses. Also when we have
multiple addresses and none of them can be reached, we still start to connect to all addresses
in parallel.

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1288 from symat/ZOOKEEPER-3758",2020-03-19 17:09:38,Mate Szalay-Beko,Mixed
4d8caf9851f63073145996fd4a535278014d01be,"ZOOKEEPER-3756: Members slow to rejoin quorum using Kubernetes

Whenever we close the current master ZooKeeper server, a new leader election
is triggered. During the new election, a connection will be established between
all the servers, by calling the synchronized 'connectOne' method in
QuorumCnxManager. The method will open the socket and send a single small
initial message to the other server, usually very quickly. If the destination
host is unreachable, it should fail immediately.

However, when we use Kubernetes, then the destination host is always reachable
as it points to Kubernetes services. If the actual container / pod is not
available then the 'socket.connect' method will timeout (by default after 5 sec)
instead of failing immediately with NoRouteToHostException. As the 'connectOne'
method is synchronized, this timeout will block the creation of other
connections, so a single unreachable host can cause timeout in the leader
election protocol.

One workaround is to decrease the socket connection timeout with the
'-Dzookeeper.cnxTimeout' stystem property, but the proper fix would be to
make the connection initiation fully asynchronous, as using very low timeout can
have its own side effect. Fortunately most of the initial message sending
is already made async: the SASL authentication can take more time, so the
second (authentication + initial message sending) part of the initiation protocol
is already called in a separate thread, when Quorum SASL authentication is enabled.

In the following patch I made the whole connection initiation async, by
always using the async executor (not only when Quorum SASL is enabled) and
also moving the socket.connect call into the async thread.

I also created a unit test to verify my fix. I added a static socket factory that can be
changed by the tests using a packet private setter method. My test failed (and
produced the same error logs as we see in the original Jira ticket) before I applied
my changes and a time-outed as no leader election succeeded after 15 seconds.
After the changes the test runs very quickly, in 1-2 seconds.

Note: due to the multiAddress changes, we will need different PRs to the branch 3.5
and to the 3.6+ branches. I will submit the other PR once this got reviewed.

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>
Author: Mate Szalay-Beko <mszalay@cloudera.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1289 from symat/ZOOKEEPER-3756-master",2020-03-23 16:20:05,Mate Szalay-Beko,Not TDD
e87bad6774e7269ef21a156aff9dad089ef54794,"ZOOKEEPER-3683: Discard requests that are delayed longer than a confi…

…gured threshold

Author: Jie Huang <jiehuang@fb.com>
Author: Ivailo Nedelchev <nedelchev@fb.com>

Reviewers: Michael Han <hanm@apache.org>, Allan Lyu <fangmin@apache.org>, Damien Diederen <dd@crosstwine.com>

Closes #1211 from jhuan31/ZOOKEEPER-3683",2020-03-24 19:38:46,Jie Huang,Not TDD
64863119bf92893f3c72350fd37005083b587327,"ZOOKEEPER-3654: Incorrect *_CFLAGS handling in Automake

The `Makefile.am` distributed with the C client defines some per-target `*_CFLAGS` and `*_CXXFLAGS` variables.  These however, do not reference `AM_CFLAGS` (resp. AM_CXXFLAGS`, which means that some options (notably `-Wall`) are missing when building subsets of the code.

Dixit the [Automake docs](https://www.gnu.org/software/automake/manual/html_node/Program-and-Library-Variables.html):

> In compilations with per-target flags, the ordinary ‘AM_’ form of
> the flags variable is _not_ automatically included in the
> compilation (however, the user form of the variable _is_ included).
> So for instance, if you want the hypothetical ‘maude’ compilations
> to also use the value of ‘AM_CFLAGS’, you would need to write:
>
>      maude_CFLAGS = ... your flags ... $(AM_CFLAGS)

Restoring the flags, however, causes compilation failures (in the library) and a slew of new warnings (in the tests) which had not been noticed because of the missing options.

This series of patches (all ""tagged"" ZOOKEEPER-3654) fix these warnings and errors before re-enabling `-Wall` and friends for all targets.

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <andor@apache.org>

Closes #1186 from ztzg/ZOOKEEPER-3654-incorrect-automake-flags",2020-03-25 12:08:54,Damien Diederen,Not TDD
1ff1b779b70dd794c9e45f35f8ca305229df10e0,"ZOOKEEPER-3755: Use maven to create fatjar

- replace ant build.xml with maven pom.xml for zookeeper-contrib-fatjar module
- create maven profile ""fatjar"" to build a fatjar file.
- update readme files

Author: Sushant Mane <sushant.mane@sjsu.edu>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Benjamin Reed <breed@apache.org>

Closes #1284 from sushantmane/master",2020-03-26 22:20:51,Sushant Mane,Not TDD
7e6386aa9b404dd236b6bdc3b5c714116f3986db,"ZOOKEEPER-3581: Use factory design pattern to refactor ZooKeeperMain

Using a factory design pattern to refactor ZooKeeperMain, making the code more elegant.

Author: Jono <jono.morris@xtra.co.nz>

Reviewers: andor@apache.org

Closes #1255 from jono-morris/ZOOKEEPER-3581 and squashes the following commits:

556e1763e [Jono] Fix style errors with import statements.
e10dfb872 [Jono] Add licence text.
4957d89b5 [Jono] 1. Reinstate missing imports to ZooKeeperMain.
ed76f14da [Jono] Minor Javadoc updates.
cc8de4920 [Jono] Add Factory to create CliCommand classes.  Initial Commit.",2020-04-01 17:02:20,Jono,Mixed
a548253408384d9e943b151c942d795017dca70c,"ZOOKEEPER-3769: handling malformed Leader Election notification messages

Using ZooKeeper with JDK 12.0.2 on CentOS 7 when the current leader is killed, we saw a few times that some partial Leader Election notification (vote) messages were delivered to the other ZooKeeper servers. The malformed / partial messages are causing different exceptions in the WorkerReceiver thread of FastLeaderElection which were not handled before. This was leading to the death of the WorkerReceiver thread, which caused that the given ZooKeeper Server was unable to receive leader election messages anymore and was not able to re-join to any quorum until it got restarted.

In the proposed fix I created unit tests to simulate certain error cases with regards to partial leader election messages, and fixed the error handling in FastLeaderElection.

Author: Mate Szalay-Beko <szalay.beko.mate@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1300 from symat/ZOOKEEPER-3769-master",2020-04-07 09:07:50,Mate Szalay-Beko,Not TDD
f9a08032c5cdf6ca4dc4649992436207576fbe9e,"ZOOKEEPER-3786: Simplify version generation

Simplify generation of VersionInfoMain.java and Info.java by using
maven-resource-plugin's built-in resource filtering at build time.

This eliminates the need to use VerGen to generate java source files
during the build.

Also make other slight pom improvements:
1. Remove trailing tab character in Ted's name in pom.xml
2. Simplify spotbugs skipping in contrib pom.xml
3. Add m2e configuration for build plugin executions to be ignored by
   Eclipse, for developers (like me) using Eclipse IDE
4. Format build time in a more international-friendly and less ambiguous
   way (year first, then month, then day, using UTC instead of GMT)

Link to issue: https://issues.apache.org/jira/browse/ZOOKEEPER-3786

Author: Christopher Tubbs <ctubbsii@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1310 from ctubbsii/use-resource-filtering-for-version-info",2020-04-09 10:59:02,Christopher Tubbs,Mixed
726f6843eba75bb3673284b52d8ca3801c5431d3,"ZOOKEEPER-3726: invalid ipv6 address comparison in C client

Fix for https://issues.apache.org/jira/browse/ZOOKEEPER-3726

sockaddr_storage can contain ipv4 or ipv6 address. If address is ipv6, then we need to compare more bytes.

In this PR correct comparison of sockaddr_storage was added.

Author: Vladislav Tyulbashev <vtyulb@vtyulb.ru>

Reviewers: Norbert Kalmar <nkalmar@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1252 from vtyulb/ZOOKEEPER-3726",2020-04-11 06:19:04,Vladislav Tyulbashev,Not TDD
4d32f6cf39f76d606b436bd4c04a8d1bc9c60148,"ZOOKEEPER-3793: Request throttling is broken when RequestThrottler is disabled or configured incorrectly..

When RequestThrottler is not enabled or is enabled but configured incorrectly, ZooKeeper server will stop throttling. This is a serious bug as without request throttling, it's fairly easy to overwhelm ZooKeeper which leads to all sorts of issues.

This is a regression introduced in ZOOKEEPER-3243, where the total number of queued requests in request processing pipeline is not taking into consideration when deciding whether to throttle or not, or only taken into consideration conditionally based on RequestThrottler's configurations. We should make sure always taking into account the number of queued requests in request processing pipeline before making throttling decisions.

Author: Michael Han <hanm@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #1316 from hanm/ZOOKEEPER-3793",2020-04-12 11:14:45,Michael Han,Not TDD
f44937ec6a23aa5cb98e3121b4de85d3d42093ed,"ZOOKEEPER-3790: zkpython compilation and testing issues

This series makes the zkpython ""contrib"" compile cleanly, and makes the tests runnable out of the box with Python 3:

  * Defined `THREADED`, as zkpython uses the sync API

    Without this, compilation produces a number of warnings about undefined functions (and misleading suggestions!) as it only sees the async API:

        src/c/zookeeper.c:1080:13: warning: implicit declaration of function 'zoo_delete'; did you mean 'zoo_adelete'? [-Wimplicit-function-declaration]
           int err = zoo_delete(zh, path, version);
                     ^~~~~~~~~~
                     zoo_adelete

  * Define `HAVE_OPENSSL_H`, as the extension calls zookeeper_init_ssl

    The flag is unconditionally defined for now, as the function is unconditionally called.

        src/c/zookeeper.c:646:10: warning: implicit declaration of function 'zookeeper_init_ssl'; did you mean 'zookeeper_init2'? [-Wimplicit-function-declaration]
             zh = zookeeper_init_ssl( host, cert_str, watcherfn != Py_None ? watcher_dispatch : NULL,

                  ^~~~~~~~~~~~~~~~~~
                  zookeeper_init2

  * Make SSL support optional (but on by default)

  * Raise `MemoryError` if module initialization fails

  * Allow for version/ABI information in shared object name

    In some versions of the Python framework, native extensions encode the interpreter version and some ABI information in the filename, giving e.g. `zookeeper.cpython-37m-x86_64-linux-gnu.so` instead of `zookeeper.so`.  Take this into account when setting up test runs.

  * Make sure test failures are detected

  * `async` is a keyword in Python 3.5+

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Mate Szalay-Beko <szalay.beko.mate@gmail.com>, Norbert Kalmar <nkalmar@apache.org>

Closes #1312 from ztzg/ZOOKEEPER-3790-zkpython-compilation-and-testing-issues

(cherry picked from commit 21221ac692405962bdda3e9ceb63186ef0f180ef)
Signed-off-by: Norbert Kalmar <nkalmar@apache.org>",2020-04-27 10:58:43,Damien Diederen,Not TDD
92f23ecd8159fd8d9c2fb8f34dd94f680ee6f712,"ZOOKEEPER-3791: Miscellaneous Maven fixes

* Fix fatjar and full-build profile problems with redundant module
  activation
* Remove ""activeByDefault"" profiles that don't do anything useful
* Make javadoc a bit quieter
* Fix assembly plugin warning about `/`
* Fix antrun warnings about tasks config renamed to target
* Fix docs module packaging (doesn't need to be jar)
* Fix zookeeper-it module by moving classes into standarad Maven
  directory layout and configuring surefire plugin to find the tests

Author: Christopher Tubbs <ctubbsii@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1314 from ctubbsii/misc-maven-fixes",2020-05-04 14:20:27,Christopher Tubbs,Not TDD
44de549657a539dcedba58d56e67b8c906c89580,"ZOOKEEPER-3772: JettyAdminServer should not allow Http TRACE method

A nessus scan pinged the cluster after I upgrade my zookeeper cluster, because the 8080 port of JettyAdminServer allows Http TRACE method.

Author: lingjinjiang <lingjinjiang@gmail.com>

Reviewers: Mate Szalay-Beko <symat@apache.org>, Andor Molnar <andor@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1296 from lingjinjiang/master",2020-05-05 09:18:18,lingjinjiang,Mixed
05cd214a0cc9c870de373b54cfeb47a2a75efd28,"ZOOKEEPER-3796: Skip Learner Request made to ObserverMaster from going

... to next processor

Author: mayank99 <mayank99@devvm2541.prn3.facebook.com>
Author: mayank99fb <63824268+mayank99fb@users.noreply.github.com>

Reviewers: Andor Molnar <andor@apache.org>, Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1322 from mayank99fb/ZOOKEEPER-3796",2020-05-05 19:20:35,Mayank Tuteja,Mixed
45bc3ece8964a24feb808926f18f6e53319aa683,"ZOOKEEPER-3721: Making the boolean configuration parameters consistent

Author: ctest-team <ctest.team@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>, Justin Ling Mao <maoling199210191@sina.com>

Closes #1266 from ctest-team/ZOOKEEPER-3721",2020-05-14 18:18:28,ctest-team,Mixed
a14bd54f7112df96622c04fe6951bb25d6eddcf0,"[ZOOKEEPER-3690] Improving leader efficiency via not processing learner forwarded requests in commit processor

Author: Fangmin Lyu <fangmin@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Michael Han <hanm@apache.org>

Closes #1223 from lvfangmin/ZOOKEEPER-3690",2020-05-15 09:10:25,Fangmin Lyu,Not TDD
d99c9e8b701ebdbd3f0098d4d81696df97432262,"ZOOKEEPER-837: Eliminate cycle dependency between ClientCnxn and ZooKeeper

1. Extract ZKWatchManager to single file
2. Move ZKWatchManager instance to ClientCnxn in order to eliminate cycle dependency
3. let `ZooKeeper` syncs a copy of default watcher, in order to reduce dependencies to `getWatchManager()`

Author: tison <wander4096@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <andor@apache.org>

Closes #1095 from TisonKun/ZOOKEEPER-837",2020-05-17 15:13:37,tison,Not TDD
a908001be9641d78040b1954acb0cd3a8e9e42c2,"ZOOKEEPER-1998: Allow C client to throttle host name resolutions

Some environments experience high DNS load because of the name resolutions introduced by [ZOOKEEPER-1355](https://issues.apache.org/jira/browse/ZOOKEEPER-1355).

This patch allows clients to set a minimum delay to observe between ""routine"" resolutions using a `zoo_set_servers_resolution_delay` API function.

An application can influence the rate of polling via its `delay_ms` parameter: when set to a value greater than zero, the client skips most ""routine"" resolutions which would have happened in a window of that many milliseconds since the last successful one.

Setting `delay_ms` to `0` disables the new logic, reverting to the default behavior.  Setting it to `-1` disables network resolutions during normal operation (but not, e.g., on connection loss).

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>, Suhas Dantkale

Closes #1068 from ztzg/ZOOKEEPER-1998-throttle-dns-resolutions",2020-05-17 15:15:54,Damien Diederen,Not TDD
5820d10d9dc58c8e12d2e25386fdf92acb360359,"ZOOKEEPER-3832: ZKHostnameVerifier rejects valid certificates with subjectAltNames

This issue has been reported by a user who wanted to use a cert that contains SAN entries that are not of type DNS or IP.
I've come across the following ticket in http client project which seems to be related:
https://issues.apache.org/jira/browse/HTTPCLIENT-1906

This is the backport of the fix.

Original patch: https://github.com/apache/httpcomponents-client/commit/56cc24525e5ba2a5ef8fa0de2385687e83589a71

Target versions: 3.5, 3.6, 3.7

Author: Andor Molnar <andor@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1353 from anmolnar/ZOOKEEPER-3832",2020-05-21 14:13:32,Andor Molnar,Mixed
e91455c1e3c50405666cd8afad71d99dceb7b340,"ZOOKEEPER-3829: fix rolling restart when dynamic reconfig is disabled

In four different Jira tickets (ZOOKEEPER-3829, ZOOKEEPER-3830, ZOOKEEPER-3814, ZOOKEEPER-3842) we saw different errors when dynamic reconfig was disabled and we used rolling restart to change the quorum membership configuration. These rolling restart sequences was working fine on 3.4 but caused errors in 3.5 or 3.6.

In worst case the rolling restart leads to the scenario that we had an elected leader which was up but unable to commit any changes. This happens, when the quorum is extended with a new member in the following sequence:
* start server.1, server.2, server.3 (with config: 1,2,3)
* start server.4 (with config 1,2,3,4)
* stop server.1, then restart it with config 1,2,3,4
* stop server.2, then restart it with config 1,2,3,4
* stop server.3, then restart it with config 1,2,3,4
* at this point leader is server.4, but it can not commit any transaction

An other error we saw was when we changed a host name of an existing member (removing server.5 and add a new host as server.6). In this case we found in the logs of the new server (server.6) that it is still tried to connect to the old invalid server (server.5), although it was missing from it's config. The same problem remained even after making a full rolling-restart on all the nodes.

In this patch I try to fix these issues without breaking anything. The patch contains the following changes:
* We are making sure that neither the committed, nor the last seen config gets updated if dynamic reconfig is disabled.
* It is not possible now to start the leader without the ability of committing transaction, when dynamic reconfig is disabled (this is only needed to avoid a reconfig edge-case).
* I added a testcase simulating the enablement of dynamic reconfig using rolling restart
* I added a few more unit tests to cover rolling restart scenarios. (the tests are failing without the patch but succeeding after applying it).
* The enablement / disablement of reconfig is getting initialized now in the QuorumPeer and gets propagated to the other classes. This was needed for the rolling restart tests to be able to enable/disable reconfig only for the newly created servers without affecting the servers running already in the same JVM.

I also tested the changes with docker, using: https://github.com/symat/zookeeper-docker-test

target branches: 3.5, 3.6, master

Author: Mate Szalay-Beko <symat@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1356 from symat/ZOOKEEPER-3829",2020-05-29 14:59:47,Mate Szalay-Beko,Mixed
79a99ac97cea942967a2a08e7873a0cea9a2e046,"ZOOKEEPER-3831: add a compatibility test module

ZooKeeper has many external libraries that are dependent on staying compatible. For example, Apache Curator. This new module will be used to add compatibility tests for any third party library, tool, etc. that we want to ensure maintains compatibility. The module is configured with Maven not to install/deploy so it's only for testing purposes. An initial test using Apache Curator is added.

Author: Jordan Zimmerman <jordan@jordanzimmerman.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1369 from Randgalt/ZOOKEEPER-3831-add-compatibility-test-module",2020-06-08 13:07:12,Jordan Zimmerman,Not TDD
6ab1822ec431bb3309021c1ddc613a5eaa28d83b,"ZOOKEEPER-3852: Upgrade jUnit in ZooKeeper-Jute

Sub-task of ZOOKEEPER-3732, updating jUnit to 5.6.2 in zookeeper-it sub-component.

Change-Id: I495a1516c07bc597558719030a0d585bc7d4f7eb

Author: Tamas Penzes <tamaas@cloudera.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1386 from tamaashu/ZOOKEEPER-3852",2020-06-30 15:01:07,Tamas Penzes,Not TDD
f362313860401024b7141489e66ee76af442eb76,"ZOOKEEPER-3878: Client connection fails if IPV6 is not enclosed in square brackets

Author: Mohammad Arshad 72626 <mohammad.arshad@huawei.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #1398 from arshadmohammad/ZOOKEEPER-3878-master",2020-07-13 12:10:05,Mohammad Arshad 72626,Mixed
8a72a6e6c30db7dd66203dc2def1ede54882856b,"ZOOKEEPER-3891: ZKCli commands give wrong error message ""Authenticati…

…on is not valid"" for insufficient permissions

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1404 from arshadmohammad/ZOOKEEPER-3891-master",2020-07-29 12:00:37,Mohammad Arshad,Not TDD
ce523e01938e26ad92d613bd28b59501e9a853df,"ZOOKEEPER-3895: Client side NullPointerException in case of empty Multi operation

https://issues.apache.org/jira/browse/ZOOKEEPER-3895

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: tison <wander4096@gmail.com>, Mate Szalay-Beko <symat@apache.org>

Closes #1407 from eolivelli/fix/ZOOKEEPER-3895",2020-07-29 16:55:45,Enrico Olivelli,Not TDD
c42c8c94085ed1d94a22158fbdfe2945118a82bc,"ZOOKEEPER-3872: Upgrade jUnit in ZooKeeper-server

Sub-task of ZOOKEEPER-3732, updating jUnit to 5.6.2 in zookeeper-server sub-component.

Change-Id: I1fc2a7f860eae0f1d285cb278f6eca7a3b947695

Author: Tamas Penzes <tamaas@cloudera.com>

Reviewers: Mate Szalay-Beko <symat@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1417 from tamaashu/ZOOKEEPER-3872",2020-08-04 15:01:52,Tamas Penzes,Mixed
531aae3edcf88819f90a324de3171276ecfaba25,"ZOOKEEPER-3855: Upgrade jUnit in ZooKeeper-Metrics-providers

Change-Id: I511cb610e269b502e946f52d152db7dcf6d2f2d4

Author: Tamas Penzes <tamaas@cloudera.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1421 from tamaashu/ZOOKEEPER-3855",2020-08-06 16:53:00,Tamas Penzes,Not TDD
08ae49dee4d698fb8c926f3842acdcb0f5b3c58e,"ZOOKEEPER-3854: Upgrade jUnit in ZooKeeper-Recipes

Author: Tamas Penzes <tamaas@cloudera.com>

Reviewers: Norbert Kalmar <nkalmar@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1423 from tamaashu/ZOOKEEPER-3854",2020-08-07 12:46:45,Tamas Penzes,Not TDD
b86899ec9ced35c895f9c0a8a54f2396e94a76c0,"ZOOKEEPER-3905: Race condition causes sessions to be created for clients even though their certificate authentication has failed

Netty channel doesn't get closed if authentication fails after a successful SSL handshake. We need a custom authentication provider in order to trigger this, because the default implementation does the same check as for the SSL handshake. Hence it never fails.

Unit test added to make sure client is not able to connect.

Target branches: master, 3.6, 3.5 (will create separate PR for 3.5)

Author: Andor Molnar <andor@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1422 from anmolnar/ZOOKEEPER-3905",2020-08-08 11:51:43,Andor Molnar,Not TDD
0b386e4579645761e341510b185899d060e51c82,"ZOOKEEPER-3862: Re-enable deprecation check after finishing jUnit upg…

…rade

Last changes on sub-components which need to be build every time and re-enable deprecation check for the builds.

Change-Id: Iebf83d7727d9d7535b367613d262800ad6331fa7

Author: Tamas Penzes <tamaas@cloudera.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1424 from tamaashu/ZOOKEEPER-3862",2020-08-12 11:46:50,Tamas Penzes,Not TDD
c47ef905e077184bc5b7f555a3e2dfeb6dc046e1,"ZOOKEEPER-3863: Do not track global sessions in ReadOnlyZooKeeperServer

Author: Jie Huang <jiehuang@fb.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Michael Han <hanm@apache.org>

Closes #1380 from jhuan31/ZOOKEEPER-3863",2020-09-17 07:35:11,Jie Huang,Not TDD
56dfde5da4e441b139e85930291729d6b77a18ac,"ZOOKEEPER-3937: C client: avoid out-of-order packets during SASL negotiation

This patch prevents SASL-enabled C clients from sending request packets for as long as the SASL negociation is not complete.

""Ideally,"" applications should wait for `ZOO_CONNECTED_STATE` or `ZOO_READONLY_STATE` events before issuing requests, but this is not what happens in the wild.

Without this patch, it was easy to cause a desynchronization by creating a handle and blasting requests right away.  (The added test simply avoids doing a `ctx.waitForConnected()`.)

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1457 from ztzg/ZOOKEEPER-3937-c-client-out-of-order-packets",2020-09-28 07:22:15,Damien Diederen,Not TDD
ec1503bb00945471baa248f392eed51064bb48ab,"ZOOKEEPER-3950: Add support for BCFKS key/trust store format

The BCFKS key store format is widely used in the industry, as it provides an open source alternative if someone has to use FIPS compliant key stores due to some regulatory constraints.

Currently in the ZooKeeper java client, only PEM, JKS and PEM12 is supported. I extend the list of supported key store formats with BCFKS.

I also tested this patch on a real FIPS compliant cluster, having the appropriate java security configs, security providers and also running a RedHat-based Linux distro (Centos 7.8) with FIPS mode enabled.

I tested both the client and the quorum SSL too. If someone wants to test this patch, and the keystore/truststore file names are not ending with "".bckfs"", then (beside the usual SSL configs) make sure to also set the following parameters in the zoo.cfg:
```
ssl.keyStore.type=bcfks
ssl.trustStore.type=bcfks
ssl.quorum.keyStore.type=bcfks
ssl.quorum.trustStore.type=bcfks
```

and also provide the following parameters for the command line java client:
```
 -Dzookeeper.ssl.keyStore.type=bcfks -Dzookeeper.ssl.trustStore.type=bcfks
```

This patch doesn't contain any modification for the c-client (that can be handled with a separate Jira, but I don't plan to work on that part right now).

Author: Mate Szalay-Beko <symat@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>, Andor Molnar <andor@apache.org>

Closes #1480 from symat/zookeeper-3950",2020-10-06 09:29:46,Mate Szalay-Beko,Mixed
83d79d16d683dbf07a8a1b52ed97558530f92f89,"ZOOKEEPER-3956: Remove json-simple from ZooKeeper

JSON-Simple was only used in SnapshotFormatter in one place and also in Contrib's LogGraph component.
It's development has discontinued since 2012, so it's time to remove it.
I have replaced it with Jackson2, which we use in ZooKeeper anyway.
Added some unit tests to LogGraph as it didn't have any.

Author: Tamas Penzes <tamaas@cloudera.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1484 from tamaashu/ZOOKEEPER-3956",2020-10-08 20:03:51,Tamas Penzes,Mixed
4432f5b44359f56007f1ea5be5de2a9829c97e5c,"ZOOKEEPER-3948: Introduce a deterministic runtime behavior injection framework for ZooKeeperServer testing.

We'd like to understand how applications built on top of ZooKeeper behave under various faulty conditions, which is important to build resilient end to end solutions and avoid ZooKeeper being single point of failure. We'd also like to achieve this in both unit tests (in process) and integration tests (in and out of process). Traditional methods of using external fault injection mechanisms are non deterministic and requires non trivial set up and hard to integrate with unit tests, so here we introduce the ZooKeeperController service which solves both.

The basic idea here is to create a controllable ZooKeeperServer which accepts various control commands (such as - delay request, drop request, eat request, expire session, shutdown, trigger leader election, and so on), and reacting based on incoming commands. The controllable server and production server share the same underlying machineries (quorum peers, ZooKeeper server, etc) but code paths are separate, thus this feature has no production impact.

This controller system is currently composed of following pieces:

CommandClient: a convenient HTTP client to send control commands to controller service.
CommandListener: an embed HTTP server listening incoming commands and dispatch to controller service.
Controller Service: the service that's responsible to create controllable ZK server and the controller.
ZooKeeperServerController: the controller that changes the behavior of ZK server runtime.
Controllable Cnx / Factory: controllable connection that accept behavior change requests.
In future more control commands and controllable components can be added on top of this framework.

This can be used in either unit tests / integration tests as an in process embedded controllable ZooKeeper server, or as an out of process stand alone controllable ZooKeeper process.

Author: Michael Han <hanm@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1467 from hanm/ZOOKEEPER-3948",2020-10-13 14:43:12,Michael Han,Mixed
1af3dcc633d4829864da74ca6b030428448fcc16,"ZOOKEEPER-3561: Generalize target authentication scheme for ZooKeeper authentication enforcement.

Added enforce.auth.enabled and enforce.auth.scheme to enforce any authentication scheme.

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Michael Han <hanm@apache.org>, Damien Diederen <dd@crosstwine.com>, Enrico Olivelli <eolivelli@gmail.com>, Andor Molnár <andor@apache.org>

Closes #1500 from arshadmohammad/ZOOKEEPER-3561-master",2020-10-20 19:41:38,Mohammad Arshad,Not TDD
a6ca5f307e20df1e62ce5415d84235ec00f57286,"ZOOKEEPER-3969: Add whoami API and Cli command

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Damien Diederen <dd@crosstwine.com>, Mate Szalay-Beko <symat@apache.org>

Closes #1504 from arshadmohammad/whoami-master",2020-10-25 15:02:24,Mohammad Arshad,Mixed
b59bf6b40d9948e4a9034b6342b7f98a71d8d616,"ZOOKEEPER-3926: Remove hardcoded comparisons to more maintainable an…

…d readable comparisons.

There are many more such instances in some tests etc but didn't change them here as the coding guidelines suggested to only make changes related to what is asked in the jira. Can take those up in a new Jira if this is accepted by the maintainers as worthwhile.

Author: Ghatage <ghatageanup@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Damien Diederen <ddiederen@apache.org>

Closes #1497 from Ghatage/ZOOKEEPER-3926",2020-10-28 10:18:26,Anup Ghatage,Not TDD
8654e7ed37717df79eb06f75de43eafe4f47b175,"ZOOKEEPER-3342: Use StandardCharsets

> Encodes this String into a sequence of bytes using the platform's default charset, storing the result into a new byte array.  The behavior of this method when this string cannot be encoded in the default charset is unspecified.

https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#getBytes--

1.  Since this is a distributed system, it is always possible that different nodes have different default charsets defined.  I think it's most safe to specify it explicitly across all nodes for safety sake.  You could for example see a situation where an upgrade JVM uses a different default and during a rolling upgrade of the JVM, different nodes now have a different default.
2.  The default charset is usually ""ISO-8859-1"".  UTF-8 covers more of our international friends.
3. Explicitly specifying the CharSet yields slight performance gains
4. Explicitly specifying the CharSet removes the need for try/catch blocks of UnsupportedEncodingException

https://blog.codecentric.de/en/2014/04/faster-cleaner-code-since-java-7/

Author: David Mollitor <dmollitor@apache.org>
Author: Beluga Behr <dam6923@gmail.com>
Author: David Mollitor <dam6923@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <anmolnar@apache.org>

Closes #882 from belugabehr/ZOOKEEPER-3342",2020-10-30 12:03:41,David Mollitor,Not TDD
13fe0d0ffb9fd2c379b9b430aaaf9ee75acfceba,"ZOOKEEPER-3958: Update dependency versions and eliminate java docs wa…

…rnings

We have quite many outdated dependency which can be updated and also a few warnings during the build of JavaDocs.

Author: Tamas Penzes <tamaas@cloudera.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <anmolnar@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1485 from tamaashu/ZOOKEEPER-3958",2020-10-30 13:16:09,Tamas Penzes,Not TDD
392846c534c51a57aa678691d411ad7d8d68e29a,"ZOOKEEPER-3696: Support alternative algorithms for ACL digest

- [SHA1](https://shattered.io/) can be cracked now and it's not safe enough to use it, `SHA2` shares the the same algorithm idea with `SHA1`, its broken would be only a matter of time, so they created `SHA3` which's safe up to now.

- The default value is: `SHA1` which will be deprecated in the future for security issues. Set this property the same value in all the servers.

- How to support other more algorithms?

    - modify the `java.security` configuration file under `$JAVA_HOME/jre/lib/security/java.security` by specifying:
             `security.provider.<n>=<provider class name>`.

             ```
             For example:
             set zookeeper.DigestAuthenticationProvider.digestAlg=RipeMD160
             security.provider.3=org.bouncycastle.jce.provider.BouncyCastleProvider
             ```

    - copy the jar file to `$JAVA_HOME/jre/lib/ext/`.

             ```
             For example:
             copy bcprov-jdk15on-1.60.jar to $JAVA_HOME/jre/lib/ext/
             ```

- For the same digest algorithm and input, the output of digest is the constant. You can use some online tools to play with it. Some UTs had covered it.

- The unit cases have tested three algorithms: `SHA1`, `SHA-256`, `SHA3-256`(other algorithms share the same principle, so ignore them), and I also do a manual test to `RipeMD160`

- For the invalid algorithm parameter
```
 Caused by: java.lang.RuntimeException: don't support this ACL digest algorithm: SHA3-996 in the current environment
	at org.apache.zookeeper.server.auth.DigestAuthenticationProvider.<clinit>(DigestAuthenticationProvider.java:52)
	... 6 more
```

- How to migrate from one digest algorithm to another? For example: migrate from SHA1 to SHA3
```
# Before I have SHA1 for digest
superDigest=super:D/InIHSb7yEEbrWz8b9l71RjZJU="" //super:test

[zk: 127.0.0.1:2180(CONNECTED) 0] addauth digest username1:password1
[zk: 127.0.0.1:2180(CONNECTED) 2] setAcl /myapp-1 auth:username1:password1:crwad

# After I transfer to SHA3, you will get Auth Exception when getData of a
znode which already had a digest auth of old algorithm.

Step ONE:  Regenerate `superDigest` when migrating to new algorithm which is always a good practice for users to survive from any uncomfortable auth issue.
reset my superDigest to super:cRy/KPYuDpW/dtsepniTMpuiuupnWgdU9txltIfv3hA=
[zk: 127.0.0.1:2180(CONNECTED) 0] addauth digest super:test
[zk: 127.0.0.1:2180(CONNECTED) 1] get /myapp-1
null

Step TWO: re-setACl for that znode.
[zk: 127.0.0.1:2180(CONNECTED) 0] addauth digest super:test
[zk: 127.0.0.1:2180(CONNECTED) 1] addauth digest username1:password1
# sometime use setAcl -R to setAcl recursively or you can also set ACL to 'world,'anyone
(open to anyone)
[zk: 127.0.0.1:2180(CONNECTED) 2] setAcl /myapp-1 auth:username1:password1:crwad
```

- [TODO]: `ZOOKEEPER-3976: write a script to encapsulate DigestAuthenticationProvider#main as a tool to generate the digest with the algorithm users appoint`

- more details in the [ZOOKEEPER-3696](https://issues.apache.org/jira/browse/ZOOKEEPER-3696)

Author: maoling <maoling199210191@sina.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <andor@apache.org>, Mate Szalay-Beko <symat@apache.org>

This patch had conflicts when merged, resolved by
Committer: Mate Szalay-Beko <symat@apache.org>

Closes #1318 from maoling/ZOOKEEPER-3696",2020-11-02 16:58:08,maoling,Mixed
c9a1b595f9afd07ce6359810a5ca8e4f4088c5a2,"ZOOKEEPER-3992: addWatch api should check the null watch

```
public void addWatch(String basePath, Watcher watcher, AddWatchMode mode)
        throws KeeperException, InterruptedException {
    PathUtils.validatePath(basePath);
    String serverPath = prependChroot(basePath);

    RequestHeader h = new RequestHeader();
    h.setType(ZooDefs.OpCode.addWatch);
    AddWatchRequest request = new AddWatchRequest(serverPath, mode.getMode());
    ReplyHeader r = cnxn.submitRequest(h, request, new ErrorResponse(),
```
we need to validateWatcher(watcher) to avoid the case:
```
zk.addWatch(""/a/b"", null, PERSISTENT_RECURSIVE);
```

Author: Matteo Minardi <matteo.minardi@diennea.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Damien Diederen <ddiederen@apache.org>

Closes #1529 from mino181295/fix/ZOOKEEPER-3992/addwatch-check-null",2020-11-09 11:20:11,Matteo Minardi,Not TDD
3bbf08da066c7a904ef5d3aaddd64da1a8b031da,"ZOOKEEPER-3959: Add support for multiple SASL-authenticated super users

This implements a simple variant of the ""multiple SASL-authenticated super users"" functionality discussed on ticket ZOOKEEPER-3959.

With this patch, properties matching `zookeeper.superUser.*` are considered, in addition to `zookeeper.superUser`, to determine whether an authenticated ID should be given `super` privileges.

As before, `super` privileges remain a sharp tool and should be avoided where possible--but where necessary, allowing multiple IDs makes audit logs more useful.

(Many thanks to eolivelli and symat for their comments and suggestions.)

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #1503 from ztzg/ZOOKEEPER-3959-multiple-superusers",2020-11-09 13:53:27,Damien Diederen,Not TDD
7f66c7680f7b79eb1ba1cf253b4534de88ad3404,"ZOOKEEPER-3836: Use Commons and JDK Functions in ClientBase

Related to #1357

Author: David Mollitor <dmollitor@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1358 from belugabehr/ZOOKEEPER-3836",2020-11-09 15:33:15,David Mollitor,Not TDD
b978dfb949e4ac4d703e956c6ef811415c831bcd,"ZOOKEEPER-3911: Data inconsistency caused by DIFF sync uncommitted log

Problem:

During DIFF sync, followers will persist the proposals from leader only after receiving the UPTODATE message. Leader will start serve client requests once receive a quorum of NEWLEADER ACK from followers, and NEWLEADER ACKs are sent from followers before receiving UPTODATE. So it's possible that when leader starting serving, followers might not persistent all of the DIFF sync proposals from leader. If at a certain point in time (e.g. once receiving UPTODATE from leader) all quorum servers crash, then these proposals, where leader they are quorum committed, will lost if the old leader can't come back and the followers form a new quorum. The end result is inconsistent view of the data from client before / after quorum recovers.

Solution:

Make sure follower to persist all DIFF proposals before they ACK NEWLEADER. When leader receives a quorum of NEWLEADER ACK, it's guaranteed that all DIFF sync proposals are quorum persistent and can survive after the recovery.

Author: Michael Han <hanm@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1445 from hanm/ZOOKEEPER-3911",2020-11-12 16:03:25,Michael Han,Not TDD
d8561f620fa8611e9a6819d9879b0f18e5a404a9,"ZOOKEEPER-3979: Clean up/robustify audit logs

This is a minimally disruptive mitigation for the issue reported in ZOOKEEPER-3979, ""Clients can corrupt the audit log.""

A new property allows disabling the ""legacy"" `digest` authentication mechanism, which could be used by ""an attacker"" to inject unsanitized data into audit logs.

In general, ZooKeeper administrators should disable unused authentication providers, and ensure that the ones which remain enabled to not produce user IDs susceptible to confuse audit log parsers.

The rest of the patch is made of assorted small cleanups which should not have any impact on operation or security.

(Note that the patch *series* attached to https://github.com/apache/zookeeper/pull/1519 contains additional measures, such as filtering audit user IDs by authentication scheme, but those seem to be overkill for typical deployment scenarios.  That code could still be fished out and polished if the circumstances evolved.)

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1533 from ztzg/ZOOKEEPER-3979-robustify-audit-logs",2020-11-16 08:03:48,Damien Diederen,Not TDD
b842cd4b463a7c3674963f6f66fc392293c1334c,"ZOOKEEPER-3978: Adding additional security metrics to zookeeper

This is same as https://github.com/apache/zookeeper/pull/1513 for master branch with additional changes using junit5 jupiter lib.

The changes include adding 3 metrics for security for zookeeper for better monitoring

Monitoring all authN and AuthZ errors
Monitoring all local non mtls local connections counts
Monitoring all remote non mtls connection counts.

Author: Pooja Malik <pmalik@salesforce.com>

Reviewers: Michael Han <hanm@apache.org>, Enrico Olivelli <eolivelli@apache.org>, Damien Diederen <ddiederen@apache.org>

Closes #1523 from p-malik/zk_sec_master",2020-11-16 10:00:18,Pooja Malik,Mixed
b2b06dca8ecffcfaa35ba5797d3c8d82045cbe08,"ZOOKEEPER-3994: Disconnect reason is wrong for NOT_READ_ONLY_CLIENT and CLIENT_ZXID_AHEAD

Author: huangwenbo04 <huangwenbo04@meituan.com>

Reviewers: eolivelli@apache.org, andor@apache.org

Closes #1525 from nsnhuang/ZOOKEEPER-3994 and squashes the following commits:

578c4d730 [huangwenbo04] checkstyle
aaa5430b9 [huangwenbo04] use assertThrows() method instead of try-catch
0c35eb487 [huangwenbo04] make ServerCnxn.CloseRequestException public
fb4a18eeb [huangwenbo04] add approved licenses And fix checkstyle errors
dfe0c576f [huangwenbo04] DisconnectReason.CLIENT_ZXID_AHEAD test case
406af2279 [huangwenbo04] add comments
2f4efae70 [huangwenbo04] add test case
61a815af6 [huangwenbo04] disconnect reason wrong",2020-11-16 16:37:16,huangwenbo04,Mixed
6dfdf14a637d853bd77236dfbdd347912808074f,"ZOOKEEPER-3691: Use JDK String Join Method in ZK StringUtils

Author: David Mollitor <dmollitor@apache.org>
Author: belugabehr <12578579+belugabehr@users.noreply.github.com>

Reviewers: maoling <maoling199210191@sina.com>, Enrico Olivelli <eolivelli@apache.org>, Damien Diederen <ddiederen@apache.org>

Closes #1217 from belugabehr/ZOOKEEPER-3691",2020-11-17 17:24:51,David Mollitor,Mixed
12b4e6821997534e1ff58e2e29b9df0beab817d3,"ZOOKEEPER-3874: Official API to start ZooKeeper server from Java

Create an Official API to start a ZooKeeper server node from Java code.
The idea is not to run ZooKeeper server inside the same process of an application, but only to have a standard Launcher that can be used from Java and not a bash script.

See more context here
https://issues.apache.org/jira/browse/ZOOKEEPER-3874

This is how a Java launcher will look like for tests:
```
        int clientPort = PortAssignment.unique();
        final Properties configZookeeper = new Properties();
        configZookeeper.put(""clientPort"", clientPort + """");
        configZookeeper.put(""host"", ""localhost"");
        configZookeeper.put("".........................."");
        try (ZooKeeperServerEmbedded zkServer = ZooKeeperServerEmbedded
                .builder()
                .baseDir(baseDir)
                .configuration(configZookeeper)
                .exitHandler(ExitHandler.LOG_ONLY)
                .build()) {
            zkServer.start();
            //// wait.....
      }
```

This feature does not overlap with Curator TestingServer, this feature is meant to be used a fundation for projects like TestingServer but also to run ZooKeeper server nodes in production.

This code is running in production at https://www.mag-news.com and https://emailsuccess.com, in such products we are using a Java based process manager

Author: Enrico Olivelli <eolivelli@apache.org>
Author: Enrico Olivelli <eolivelli@gmail.com>

Reviewers: Damien Diederen <ddiederen@apache.org>

Closes #1526 from eolivelli/fix/ZOOKEEPER-3874-embedded-api",2020-11-18 18:18:12,Enrico Olivelli,Not TDD
efbd660e1c4b90a8f538f2cccb5dcb7094cf9a22,"ZOOKEEPER-3642: Fix potential data inconsistency due to DIFF sync after partial SNAP sync.

Based on https://github.com/apache/zookeeper/pull/1224 ; fixed unit test build issue.

Author: Fangmin Lyu <fangmin@apache.org>
Author: Michael Han <hanm@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Originally developed by Fangmin Lyu <fangmin@apache.org>

Closes #1515 from hanm/ZOOKEEPER-3642",2020-11-23 12:53:14,Michael Han,Not TDD
b35f43627d45c9c70679b104ea24b1f8e3451789,"ZOOKEEPER-4030: Optionally canonicalize host names in quorum SASL authentication

Without the option provided by this changeset, it is not convenient to use `CNAME`s to reference servers in `server.x` configuration lines while using quorum Kerberos authentication, as ""incorrect"" principals are generated by default.

Setting `kerberos.canonicalizeHostNames=true` causes the quorum server to substitute the canonical host name for the one specified in the configuration.  This has an effect on principal generation, and on the filtering of authorization IDs from incoming connections.

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #1564 from ztzg/ZOOKEEPER-4030-quorum-sasl-auth-with-cnames",2021-01-05 14:22:10,Damien Diederen,Not TDD
7fad7ea33365304f8c268279689a6cbeed6698bc,"ZOOKEEPER-3426: C client: Consider encoded length before completing handshake

Suhas Dantkale noticed that the C client, which uses non-blocking sockets, could end up reading only the first 40 bytes of a 41-byte connection response and concluding that its handshake was complete, leaving one byte in the pipe.

Similarly (though even less likely), the library could be left hanging waiting for a 41th byte after having received a fragmented 40-byte response from an old server.

This patch makes the logic resistant to fragmentation by considering the server-provided length encoded in the response packet.

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Mate Szalay-Beko <symat@apache.org>, Enrico Olivelli <eolivelli@apache.org>

Closes #1576 from ztzg/ZOOKEEPER-3426-c-client-short-handshake",2021-01-13 08:25:51,Damien Diederen,Not TDD
e8dc2b3210b001094b6179e0deacdb2cebded31f,"ZOOKEEPER-4058: Update checkstyle to the latest version 8.39

1.update checkstyle to latest version 8.39
See [https://checkstyle.sourceforge.io/config_javadoc.html](https://checkstyle.sourceforge.io/config_javadoc.html)

- JavadocMethod: remove properties `allowMissingJavadoc,allowMissingThrowsTags,allowThrowsTagsForSubclasses,allowUndeclaredRTE`

- LineLength: change it's parent to Checker

2.update XML dtd: `checkstyle-strict.xml, checkstyle-simple.xml, checkstyleSuppressions.xml`

3.fix code style:
- `QuorumPeer.java, PemReader.java`.  Operators like + and ? appear at newlines rather than at the end of the previous line.
- license of `TestApacheCuratorCompatibility.java`. Checkstyle JavadocParagraph:`<p>` tag should be placed immediately before the first word.

Author: lan <1728209643@qq.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Damien Diederen <ddiederen@apache.org>

Closes #1579 from lanicc/ZOOKEEPER-4058",2021-01-17 20:20:43,lan,Not TDD
190a227aa9d4655ebfe6ba9f5c2da426da8c5d98,"ZOOKEEPER-3301: Enforce the quota limit

- Thanks for the original work from ZOOKEEPER-1383, ZOOKEEPER-2593, ZOOKEEPER-451, especially the work from ZOOKEEPER-1383 contributed by [Thawan Kooburat](https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan)(I also sign off his name in the commit message) which also implemented the very valuable throughput quota.In the further, we will also do this.
- `zookeeper.enforeQuota`. When enabled and the client exceeds the total bytes or children count hard quota under a znode, the server will reject the request and reply the client a `QuotaExceededException` by force. The default value is: false.
- the checkQuota involves the `create()` and `setData()` api, not including the `delete()`.
- When users set the quota which's less than the existing stats, we give a thoughtful warning info.
- the following code in the StatsTrack has a bad augmentability:

  >             if (split.length != 2) {
  >                 throw new IllegalArgumentException(""invalid string "" + stats);
  >             }

   we do a trick to solve it for the expansibility, but we will get a little strange quota info(`Output quota for /c2 count=-1,bytes=-1=;byteHardLimit=-1;countHardLimit=5`) when using `listquota`. some UTs has covered it.
- the logic about `checkQuota` should be put in the `PrepRequestProcessor`, other than `DataTree`.
  we will get the following two negative effects if putting `checkQuota` in the `DataTree`:
  - 1. When the write request has exceeded the quota, the corresponding transaction log will load into disk successfully.It's not good, although it has any data inconsistency issue, because when the server restart, so long as the transaction logs are applied in the same order, the exceeded nodes will not be applied into the state machine.
  - 2. the client will be blocking and waiting for the response, because when throwing `QuotaExceededException` in the the `DataTree`, the` rc.stat` will be `null` and `BinaryOutputArchive#writeRecord` will throw `NPE`.
  - 3. Overall, the pre-check about the write request should be done in the `PrepRequestProcessor`(at least before `SyncRequestProcessor`)(Look at an example from `checkACL()`)
- more detail in the [ZOOKEEPER-3301](https://issues.apache.org/jira/browse/ZOOKEEPER-3301).
- [Added in 2020-02-25] use `RateLogger` to replace `LOG` to avoid quota exceed logs flooding the disk
- A `TODO` improvement is: only users have admin permission can write to `/zookeeper/quota`(just like `/zookeeper/config`) to avoid some users' misoperation

Author: maoling <maoling199210191@sina.com>

Reviewers: Mate Szalay-Beko <symat@apache.org>, Damien Diederen <ddiederen@apache.org>, Enrico Olivelli <eolivelli@apache.org>, Michael Han <hanm@apache.org>

Closes #934 from maoling/ZOOKEEPER-3301",2021-01-19 08:05:37,maoling,Mixed
58b4c10be5e6b992caac3b99a506e1d61bdec24d,"ZOOKEEPER-4201: C client: Disable SASL deprecation warnings on macOS

This patch works around the numerous deprecation notices added to the CyrusSASL library on macOS.  It is a direct ""port"" of the solution to MESOS-3030, which hit exactly the same problem:

https://issues.apache.org/jira/browse/MESOS-3030

https://reviews.apache.org/r/39230/diff/3/

The PR also includes a fix for the the `clockid_t` compilation issue mentioned in the ticket description, but the test suite as a whole remains broken on macOS as its linker does not support the `--wrap` option.

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1593 from ztzg/ZOOKEEPER-4201-catalina-c-client-fixes",2021-02-17 20:20:38,Damien Diederen,Not TDD
eb1569e4fbb55d12fa6211fbd997aa592fcb01af,"ZOOKEEPER-4219: Quota checks break setData in multi transactions

Without this patch, a multi() transaction such as the one implemented
in ZooKeeperQuotaTest.testMultiCreateThenSetDataShouldWork fails with
MarshallingError when 'enforceQuota' is enabled.

This happens whenever the node has an associated quota, whether it was
exceeded or not.

This is due to the server encountering null while trying to access a
database node by path--whereas that node only exists as a ChangeRecord
in the server's 'outstandingChanges' list:

    java.lang.NullPointerException
        at org.apache.zookeeper.server.ZooKeeperServer.checkQuota(ZooKeeperServer.java:2048)
        at org.apache.zookeeper.server.PrepRequestProcessor.pRequest2Txn(PrepRequestProcessor.java:397)

The patch adds an additional 'lastData' parameter to the quota
checking function, and passes the data from the ChangeRecord during
'setData' operations.

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>, Norbert Kalmar <nkalmar@apache.org>

Closes #1611 from ztzg/ZOOKEEPER-4219-quota-multi-setdata",2021-03-01 08:36:33,Damien Diederen,Not TDD
b4f9aab099880ba8ef08eaff697debe6cdeae057,"ZOOKEEPER-3922: The introduction of the oracle, a failure detector.

The introduction of the oracle makes ZooKeeper fault-tolerant in two-node systems.

The major changes are:
1. QuorumPeerConfig.java
- The changes allow users to enable the oracle and provide essential information.
- Create QuorumOracleMaj if configured.
2. FastLeaderElection.java
- A re-check mechanism checks the current received votes once the timeout expires.
- Add another case when receiving a LEADING notification for a node to locate the existed leader in two-node systems.
3. Leader.java
- Add a re-validation of outstanding proposals mechanism after the only follower goes away
- Add another handling case when the quorum is not maintainable. It queries the Oracle for maintaining the quorum along.
4. QuorumVerifier.java
- Add methods for QuorumOracleMaj.java
5. QuorumOracleMaj.java (This is a new file.)
- A sub-class of QuorumMaj
- It default reads a file that contains a binary value to behave as an Oracle.

Author: Ching-Chan Lee <leechingchankyo@gmail.com>

Reviewers: Benjamin Reed <breed@apache.org>, Michael Han <hanm@apache.org>

Closes #1444 from chingchan1996/ZOOKEEPER-3922",2021-03-01 20:51:05,Ching-Chan Lee,Mixed
425ee189dcf952fd7a2a38df375ec245dcdfbfc6,"ZOOKEEPER-3877: JMX Bean RemotePeerBean should enclose IPV6 host in square bracket same as LocalPeerBean

…quare bracket same as LocalPeerBean

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #1493 from arshadmohammad/ZOOKEEPER-3877-master",2021-03-02 11:37:47,Mohammad Arshad,Mixed
1214d3bf611d153ae8c3987523da01d3d6c82686,"ZOOKEEPER-3781: Create snapshots on followers when snapshot.trust.empty is true

snapshot.trust.empty is an escape hatch for users upgrading from 3.4.x to later Zookeeper
versions, allowing nodes to start with a non-empty transaction log but no snapshot.

The intent is for this setting to be enabled for a short while during the upgrade,
and then disabled again, as the check it disables is a safety feature.

Prior to this PR, a node would only write a snapshot locally if it became leader,
or if it had fallen so far behind the leader that the leader sent a SNAP message instead
of a DIFF. This made the upgrade process inconvenient, as not all nodes would create
a snapshot when snapshot.trust.empty was true, meaning that the safety check could
not be flipped back on.

This PR makes follower nodes write a local snapshot when they receive NEWLEADER,
if they have no local snapshot and snapshot.trust.empty is true.

Author: Stig Rohde Døssing <stig@humio.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Damien Diederen <ddiederen@apache.org>

Closes #1581 from srdo/zookeeper-3781",2021-03-06 19:40:32,Stig Rohde Døssing,Not TDD
0ab7766a8a968e03c7b3bb7c1b9d42af9eea152e,"ZOOKEEPER-4232: InvalidSnapshotTest corrupts its own test data

`InvalidSnapshotTest.testSnapshot` starts an instance of
`ZooKeeperServer` on the version-controlled `resources/data/invalidsnap`
directory, which, as a side-effect, \""fixes\"" the following
snapshot—which was broken on purpose (see ZOOKEEPER-367):

`zookeeper-server/src/test/resources/data/invalidsnap/version-2/snapshot.83f`

This status quo creates a number of problems:

1.  It makes the test ineffective after the first run;
2.  The file shows as modified in version control tools, which can be
    annoying;
3.  The \""fixed\"" snapshot can end up being committed by mistake,
    invalidating the test.

(\#3 is not theoretical; that \""fixed\"" snapshot frequently shows up in
pull requests, and was recently merged into master.).

Author: Damien Diederen <dd@crosstwine.com>

Reviewers: Mohammad Arshad <arshad@apache.org>

Closes #1622 from ztzg/ZOOKEEPER-4232-invalid-snapshot-is-invalid and squashes the following commits:

8b48eea98 [Damien Diederen] ZOOKEEPER-4232: Ensure that ZOOKEEPER-367 test data fails to parse
92507563d [Damien Diederen] ZOOKEEPER-4232: Run InvalidSnapshotTest on a copy of test data
dcf5604b9 [Damien Diederen] ZOOKEEPER-4232: Restore test data for ZOOKEEPER-367",2021-03-09 19:55:27,Damien Diederen,Not TDD
2e400114fdee9a870170749f6573d4499e1a850f,"ZOOKEEPER-1871: Add an option to zkCli to wait for connection before executing commands

-waitforconnection option will make zk client wait for -timeout time to connect to zk server.  timeout time is 30ms by default but can be specified explicitly for a session using -timeout option in command line.

Author: Mukti <muktikrishnan94@gmail.com>

Reviewers: maoling <maoling@apache.org>, Mohammad Arshad <arshad@apache.org>

Closes #1626 from MuktiKrishnan/ZOOKEEPER-1871-master and squashes the following commits:

2947514b2 [Mukti] ZOOKEEPER-1871: Removed statement which was re-creating zookeeper admin in ZooKeeperMain.java and added documentation for waitforconnection in zookeeperCLI.md and
c475d46ff [Mukti] ZOOKEEPER-1871: Add an option to zkCli to wailt for connection before executing commands",2021-03-12 00:05:07,Mukti Krishnan,Mixed
0b6862e3aadbb8980a09a673c08c438ae5da2e81,"ZOOKEEPER-4259: Allow AdminServer to force https

Initial commit to allow adminServer to only serve HTTPS requests
Questions:
-Is this fine that I stayed with portunification, or should we have a seperate secure port?

Author: Norbert Kalmar <nkalmar@apache.org>

Reviewers: Mate Szalay-Beko <symat@apache.org>, Enrico Olivelli <eolivelli@apache.org>

Closes #1652 from nkalmar/ZOOKEEPER-2512",2021-03-25 09:48:24,Norbert Kalmar,Mixed
de726d0a824582e482d4a725210fcd6051cb3bd0,"ZOOKEEPER-3128: Get CLI Command displays Authentication error for Authorization error

Handled the scenario missed in ZOOKEEPER-3891

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Damien Diederen <dd@crosstwine.com>

Closes #1634 from arshadmohammad/ZOOKEEPER-3128-master",2021-03-27 22:53:02,Mohammad Arshad,Not TDD
acbfb2d78996cbaa29b9dc764d4cb3463193dc45,"ZOOKEEPER-4257: learner.asyncSending, learner.closeSocketAsync and leader.closeSocketAsync should be configurable in zoo.cfg

Properties learner.asyncSending , learner.closeSocketAsync  and leader.closeSocketAsync  made configurable in zoo.cfg

Author: Ayush Mantri <aayushmantri@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mohammad Arshad <arshad@apache.org>

Closes #1645 from ayushmantri/ZK-4257 and squashes the following commits:

8ff5523c3 [Ayush Mantri] ZOOKEEPER-4257: learner.asyncSending and learner.closeSocketAsync should be configurable in zoo.cfg                 property name change done in backward compatible way
592931232 [Ayush Mantri] ZOOKEEPER-4257: learner.asyncSending and learner.closeSocketAsync should be configurable in zoo.cfg",2021-03-28 10:05:40,Ayush Mantri,Mixed
cdddda4c55acf29d4e0b2bc8f3de7b5c676e8ffc,"ZOOKEEPER-4269: acceptedEpoch.tmp rename failure will cause server startup error

Using accepted epoch from acceptedEpoch.tmp if it is available

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>,Damien Diederen <dd@crosstwine.com>

Closes #1664 from arshadmohammad/ZOOKEEPER-4269-master and squashes the following commits:

d8ae084c1 [Mohammad Arshad] Handled review comments
a2cc9a5b6 [Mohammad Arshad] Added test cases
b56837e55 [Mohammad Arshad] ZOOKEEPER-4269: acceptedEpoch.tmp rename failure will cause server startup error Using accepted epoch from acceptedEpoch.tmp if it is available",2021-04-01 02:52:49,Mohammad Arshad,Not TDD
1590a424cb7a8768b0ae01f2957856b1834dd68d,"ZOOKEEPER-4281: Allow packet of max packet length to be deserialized

### Problem
Resolves https://issues.apache.org/jira/browse/ZOOKEEPER-4281

There are sanity checks for packet size when deserializing a packet. One place has the inclusion: len >= packetLen.  It rejects to deserialize the bytes that are exactly sized jute.maxbuffer. It's confusing. This check should use "">"" so the maxbuffer length packet can still be deserialized, like the other checks.
```
if (len < 0 || len >= packetLen) {
    throw new IOException(""Packet len "" + len + "" is out of range!"");
}
```

### Solution
Change: `len >= packetLen`   ->  `len > packetLen`
```
if (len < 0 || len > packetLen) {
```

Author: Huizhi Lu <5187721+pkuwm@users.noreply.github.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mohammad Arshad <arshad@apache.org>, Michael Han <hanm@apache.org>

Closes #1683 from pkuwm/maxPacketLength",2021-04-21 10:07:24,Huizhi Lu,Mixed
f5c29aab9adb49d9d3580074d4d1a805579fa20d,"ZOOKEEPER-4007: A typo in the ZKUtil#validateFileInput method

Author: fangxiao <benec.fx@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>,  maoling <maoling@apache.org>

Closes #1687 from benecdict-fang/ZOOKEEPER-4007",2021-05-10 19:24:24,fangxiao,Mixed
b79abb2014db9684c00afd7d98c0a7cb69ce6c8b,"ZOOKEEPER-4054: Make prometheus listen host can configure

Make prometheus listen host can configure listen IP, helpful to security. default is 0.0.0.0

Author: shoothzj <shooothzj@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, maoling <maoling@apache.org>

Closes #1574 from Shoothzj/ZOOKEEPER-4054",2021-05-17 23:10:41,shoothzj,Mixed
e41dc7dbb0541745afdc768bf757e29c938a9ab8,"ZOOKEEPER-3970: Enable ZooKeeperServerController to expire session.

This is a follow up of ZOOKEEPER-3948. Here we enable ZooKeeperServerController to be able to expire a global or local session. This is very useful in our experience in integration testing when we want a controlled session expiration mechanism. This is done by having session tracker exposing both global and local session stats, so a zookeeper server can expire the sessions in the controller.

Author: Michael Han <hanm@apache.org>

Reviewers: Damien Diederen <ddiederen@apache.org>

Closes #1505 from hanm/ZOOKEEPER-3970",2021-05-20 09:27:40,Michael Han,Not TDD
5e6e15ac40cfd2cadac3e718e494a3c13b934b8d,"ZOOKEEPER-4312: ZooKeeperServerEmbedded: enhance server start/stop for testability

see https://issues.apache.org/jira/browse/ZOOKEEPER-4312

ZooKeeperServerEmbedded works well for running ZooKeeper but it lacks support for a few little features in order to use it for tests.

I saw these problems while working on the port of Curator Testing Server to ZooKeeperServerEmbedded.

There is no wait to wait for the server to be up-and-running
When you ""close()"" the server, it does not wait for the ports to be closed
There is no wait to have the ConnectString for the server

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: Damien Diederen <ddiederen@apache.org>

Closes #1710 from eolivelli/impl/embedded-2",2021-06-13 18:53:47,Enrico Olivelli,Not TDD
2d3065606a444c0b711c1809ce296db2ba56cb0c,"ZOOKEEPER-4284: Add metrics for observer sync time

Motivation

- With enabling the feature of followers hosting observers, we would need a metric to measure the observer sync time just like what we have for the follower sync time.

Changes

- Added the ""observer_sync_time"" metrics
- Added unit test on the metrics

Author: liwang <liwang@apple.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Michael Han <hanm@apache.org>, Damien Diederen <ddiederen@apache.org>

Closes #1691 from li4wang/ZOOKEEPER-4284",2021-06-30 06:53:49,liwang,Not TDD
2aa17ffe428b9ac8477cedfed293b18f12c2376e,"ZOOKEEPER-4325: Fix bug when list ""/"" with ZkUtil::listSubTreeBFS

Fix bug [ZOOKEEPER-4325](https://issues.apache.org/jira/browse/ZOOKEEPER-4325), re-create PR from [#1719](https://github.com/apache/zookeeper/pull/1719)

Author: autumind <shen.zhibing@mobcb.com>

Reviewers: maoling <maoling@apache.org>

Closes #1729 from autumind/master",2021-07-18 15:17:50,autumind,Mixed
a692cbab92e9bae53c9313241d9668d9de97ed8b,"ZOOKEEPER-4289: Reduce the performance impact of Prometheus metrics

Enabling Prometheus provider has significant impact on the performance of both read and write operations. This is to reduce the impact by making the Prometheus summary reporting as an async operation.

Load test results showed that the avg read latency and throughput after the fix is on par with the performance when Prometheus is disabled. For writes, the avg latency was reduced 25% and the avg throughput was increased 20% after the fix.

Author: liwang <liwang@apple.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <anmolnar@apache.org>

Closes #1698 from li4wang/ZOOKEEPER-4289",2021-07-28 11:24:15,liwang,Mixed
b05ea1a8454d806394e1ecdfca550e8c709d4c21,"ZOOKEEPER-4211: Expose Per Namespace Quota Metrics to Prometheus

Motivation

In 3.7, Quota limit can be enforced and the quota related stats are captured.  From the ""listquota"" CLI command, we can the quota limit and usage info. This is an addition to that so we can collect the quota metrics per top namespace and expose them to the Prometheus for monitor and alert purpose.

Summary of Changes

- added 5 quota metrics
- added GaugeSet metric type to group gauge metrics by key
- changed PrometheusMetricsProvider to to support the GaugeSet
- changed ZookeeperServer and DataTree to collect/publish quota metrics

Author: liwang <liwang@apple.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Damien Diederen <ddiederen@apache.org>

Closes #1644 from li4wang/ZOOKEEPER-4211",2021-07-29 09:35:47,liwang,Mixed
5f6ec6cc7fd303702dca31edd2317b33c6e66bd1,"ZOOKEEPER-4345: Avoid NoSunchMethodException caused by shaded zookeeper jar

Author: Bo <cuibo0108@163.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mohammad Arshad <arshad@apache.org>

Closes #1736 from cuibo01/zookeeper-4345 and squashes the following commits:

3965f2e8d [Bo] [ZOOKEEPER-4345]Avoid NoSunchMethodException caused by shaded
970972971 [Bo] [ZOOKEEPER-4345]Avoid NoSunchMethodException caused by shaded",2021-08-11 20:40:33,Bo Cui,Not TDD
d6b50ad739a49226e97ff28d68be605e1fa36fe5,"ZOOKEEPER-4367: Zookeeper#Login thread leak in case of Sasl AuthFailed.

https://issues.apache.org/jira/browse/ZOOKEEPER-4367

Things changed in this PR:
1. Moving `zooKeeperSaslClient` from `ClientCnxn` to `SendThread` since only SendThread is creating and accessing `zooKeeperSaslClient`
2. Moved closing of `zooKeeperSaslClient` from `ClientCnxn#disconnect` method to `SendThread#run` method. This will make sure that we will close zooKeeperSaslClient (and in turn close Login object) even if `ClientCnxn#disconnect` is not called which happens when we encounter AuthFailed Exceptions. Also it looks clean that whenever SendThread is terminating we clean up all the class variable.
3. Setting login to null when `ZooKeeperSaslClient#shutdown` is called. This helps me testing whether zooKeeperSaslClient object is shutdown and in turn Login object is shutdown.

Author: Rushabh Shah <rushabh.shah@rushabh-ltmflld.internal.salesforce.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Damien Diederen <ddiederen@apache.org>

Closes #1755 from shahrs87/ZOOKEEPER-4367",2021-09-27 17:48:29,Rushabh Shah,Not TDD
2dcc64d9411e7b24402222437215ab2fe1e59c2e,"ZOOKEEPER-4372: Added check and unit test for negative sequence numbers in lock recipe

I took a stab at fixing this and adding a simple case to one of the existing unit tests to check for negative sequence numbers. This is my first time working in the ZK Java implementation so please let me know if I need to make any adjustments. I updated the code to check if there is a prior ""-"" character in the index before the last ""-"" and move the index back one if there is.

Author: Colin McIntosh <cmcintosh@netflix.com>

Reviewers: maoling <maoling@apache.org>

Closes #1751 from colinmcintosh/cm/zk-lock-recipe-seq",2021-10-02 13:58:31,Colin McIntosh,Mixed
cb899167421d7a24f1e6c3f06aa4a621391df15f,"ZOOKEEPER-4349: delete the useless oraclePath directory generated by test suit

- when running the `QuorumOracleMajTest` and sub tests of `QuorumBase`(e.g: `MultiOpSessionUpgradeTest`), we generate lots of useless files which are not exempt from `Git`. we should delete them after the finish of one UT.
```
✗ tree zookeeper-server/tmp/
zookeeper-server/tmp/
└── oraclePath
    ├── 0
    │   └── mastership
    │       └── value
    └── 1
        └── mastership
            └── value
```
- fix a typo in the `zookeeperOracleQuorums.md `

Author: maoling <maoling@apache.org>

Reviewers: Ching-Chan Lee <leechingchankyo@gmail.com>

Closes #1742 from maoling/ZOOKEEPER-4349",2021-10-10 23:09:56,maoling,Not TDD
9f355f5a57f35d3760f8e669696622135c457938,"ZOOKEEPER-4377: KeeperException.create has NullPointerException when low version client requests the high version server

- When low version client accessed the high version server which has some new added error code, the client will get a NPE:
```
 java.lang.NullPointerException
at org.apache.zookeeper.KeeperException.create(KeeperException.java:94)
at org.apache.zookeeper.KeeperException.create(KeeperException.java:54)
at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:1538)
```
- How to reproduce this issue？For example:
```
the client version we using is 3.6.0, and server version we using is 3.7.0 which has a new added error code QUOTAEXCEEDED(-125),
we set quota at server side and use the client to create znodes which exceeds the quota,
the client will get a NPE
```
- Apply this patch, we will get the following:
```
 java.lang.IllegalArgumentException: The current client version cannot lookup this code:-125
 at org.apache.zookeeper.KeeperException$Code.get(KeeperException.java:449)
 at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:1347)
```
- we should backport this PR to all branches, making the client has upward compatibility
- more details in the [ZOOKEEPER-4377](https://issues.apache.org/jira/browse/ZOOKEEPER-4377)

Author: maoling <maoling@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, ruanwenjun <wenjun@apache.org>

Closes #1764 from maoling/ZOOKEEPER-4377",2021-10-17 15:07:58,maoling,Not TDD
eb63dd9757e7234515e81799d82cc0af4a0ae7f9,"ZOOKEEPER-4362: ZKDatabase.txnCount should not log non transactional requests

ZKDatabase.txnCount logged non transactional requests

    public boolean append(Request si) throws IOException {
        txnCount.incrementAndGet();
        return this.snapLog.append(si);
    }
snaplog.append may return false, but txnCount increased

maybe it would be better

    public boolean append(Request si) throws IOException {
        if (this.snapLog.append(si)) {
            txnCount.incrementAndGet();
            return true;
        }
        return false;
    }

Author: lanicc <lanettiesso@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, maoling <maoling@apache.org>

Closes #1744 from lanicc/ZOOKEEPER-4362 and squashes the following commits:

4b08e05ff [lanicc] ZOOKEEPER-4366: fix typo
4e1ad8d2c [lanicc] ZOOKEEPER-4366: Add test case for ZkDatabase txnCount
40b86bcad [lanicc] ZOOKEEPER-4362: ZKDatabase.txnCount should not log non transactional requests",2021-11-13 15:15:01,lanicc,Not TDD
8d82be71dfce6b6752717ca0a68a77ec3c03032b,"ZOOKEEPER-4267: Fix check-style issues

Formatted CertificatesToPlayWith to fix check-style issue :(whitespace) OperatorWrap: '+' should be on a new line

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: maoling <maoling@apache.org>

Closes #1662 from arshadmohammad/ZOOKEEPER-4267-master and squashes the following commits:

25d76aa6a [Mohammad Arshad] Removed CertificatesToPlayWith from checkstyleSuppressions.xml as issues are fixed
6fd457e4f [Mohammad Arshad] ZOOKEEPER-4267: Fix check-style issues Formatted ZKHostnameVerifierTest to fix check-style issue :(whitespace) OperatorWrap: '+' should be on a new line",2021-12-05 10:54:20,Mohammad Arshad,Not TDD
957f8fc0afbeca638f13f6fb739e49a921da2b9d,"ZOOKEEPER-3988: rg.apache.zookeeper.server.NettyServerCnxn.receiveMessage throws NullPointerException

Modifications:
- prevent the NPE, the code that throws NPE is only to record some metrics for non TLS requests

Related to:
- apache/pulsar#11070
- https://github.com/pravega/zookeeper-operator/issues/393

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: Nicolo² Boschi <boschi1997@gmail.com>, Andor Molnar <andor@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1798 from eolivelli/fix/ZOOKEEPER-3988-npe",2022-01-25 12:48:34,Enrico Olivelli,Mixed
85551f9be5b054fa4aee0636597b12bda2ecb2e8,"ZOOKEEPER-4427: Migrate to Logback

This is the first commit of Logback migration task.

1. Replaced log4j dependencies with logback alternatives,
2. Replaced log4j.properties files with logback.xml
3. Refactored unit tests to use logback for log capturing.

This patch doesn't cover the zookeeper-contrib projects, only the main codebase.

Author: Andor Molnar <andor@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Chris Nauroth <cnauroth@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1793 from anmolnar/ZOOKEEPER-4427",2022-01-27 10:06:29,Andor Molnar,Not TDD
1cc1eb6a2be7323a5c326652d59a070473bb8779,"ZOOKEEPER-4453: NettyServerCnxnFactory: allow to configure the early TLS connection drop feature

- add new flag netty.server.earlyDropSecureConnectionHandshakes to turn on/off ZOOKEEPER-3682
- disable ZOOKEEPER-3682 by default
- add docs
- add tests for this patch and for ZOOKEEPER-3682

see https://issues.apache.org/jira/browse/ZOOKEEPER-4453 for more context

Author: Enrico Olivelli <eolivelli@apache.org>

Reviewers: Mate Szalay-Beko <symat@apache.org>

Closes #1800 from eolivelli/fix/ZOOKEEPER-4453-b",2022-01-27 10:09:46,Enrico Olivelli,Mixed
b2c1b5af36a196ca2e9080750d212aa1a0550f7c,"ZOOKEEPER-4396: Read Key/trust store password from file

Key/trust store password is currently specified as plain text via system property or config property. To avoid exposing passwords as plain text and reduce security vulnerability, we provide the support of reading passwords from files.

The following four properties are added:

1. ssl.keyStore.passwordPath
2. ssl.quorum.keyStore.passwordPath
3. ssl.trustStore.passwordPath
4. ssl.quorum.trustStore.passwordPath

Specifies the file path that contains the key/trust store password. Reading the password from a file takes precedence over the explicit password property.

Author: liwang <liwang@apple.com>

Reviewers: hristopher Tubbs <ctubbsii@apache.org>, Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1773 from li4wang/ZOOKEEPER-4396",2022-01-28 08:27:11,liwang,Mixed
48191b63dfaa4d6d71572608a31338e15f02f0fa,"ZOOKEEPER-4465: zooinspector logback pattern config add escape for '(' and ')'

zooinspect logback config file `logback.xml` currently use a pattern of this
`<pattern>%5p [%t] (%F:%L) - %m%n</pattern> `
which not escape the '(' and ')', cause logback to ignore parts after ')'.

according to logback documents, '(' and ')' is used for grouping, need escape by `\` if used as normal char
https://logback.qos.ch/manual/layouts.html#grouping

this pr update it to (add '\' to escape)
`<pattern>%5p [%t] \(%F:%L\) - %m%n</pattern> `

Author: 67 <67@gd67.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Andor Molnar <andor@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1814 from iamgd67/ZOOKEEPER-4465",2022-02-15 11:29:09,67,Not TDD
609afd1281ace4d29aabfb48628aa9eead56c4bf,"ZOOKEEPER-4480: Introduce end to end compatibility tests

So far, I add a simplest test executing `bin/zkCli.sh sync /` for testing connectivity.

You can comment to enrich the test script.

This command itself is enough for proceeding the original proposal that merge `readOnly` field into `ConnectRequest` and `ConnectResponse` as it's tested with any successfully setup connection.

Author: tison <wander4096@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1826 from tisonkun/e2e",2022-02-28 15:31:28,tison,Not TDD
a5b6c38edd74b263638817f7b65d057c91d5a888,"ZOOKEEPER-4477: Single Kerberos ticket renewal failure can prevent all future renewals since Java 9

This bug is similar to the one fixed in https://issues.apache.org/jira/browse/KAFKA-12730.

Our Kerberos ticket refresh thread performs re-login by logging out and then logging in again. If
login fails, we retry after some sleep. Every reLogin() operation performs loginContext.logout()
and loginContext.login(). If login fails, we end up with two consecutive logouts. This used to
work in older Java versions, but from Java 9 onwards, this results in a NullPointerException due
to https://bugs.openjdk.java.net/browse/JDK-8173069. We should check if logout is required before
attempting logout.

I fixed the issue and added a new unit test to test some ticket renewal scenarios. I managed to
reproduce the problem in KerberosTicketRenewalTest.shouldRecoverIfKerberosNotAvailableForSomeTime()
which (before the fix) failed with Java13 but succeeded with Java8.

Author: Mate Szalay-Beko <symat@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #1828 from symat/ZOOKEEPER-4477-master",2022-03-01 14:30:23,Mate Szalay-Beko,Mixed
640b6dd65fd302ada1ac46c9b8c32f17dadb0d32,"ZOOKEEPER-4479: C tests: Avoid some jitter which results in flaky tests

With these commits, the various tests in `TestOperations.cc` set the `last_sent` and `last_recv` fields of the ""force-connected"" ZooKeeper handle to deterministic values (which match the initial value of the time mock).

When that value is not specified, these fields get set to the ""real"" time at the end of the  `forceConnected` function, which can be sufficiently different from the value held in the mock for some of the tests to fail.

Author: Damien Diederen <ddiederen@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>

Closes #1827 from ztzg/ZOOKEEPER-4479-flaky-c-test-operations",2022-03-01 17:13:50,Damien Diederen,Not TDD
99cb20e82743ef73db7257a3f9a4c55bc8acf037,"ZOOKEEPER-4473: zooInspector root child creates fail with path validate fix

zooInspector root child creates fail with path validate fix.
create node update UI only if creation success, if fail show message dialog about the reason.
add basic ZooInspectorManagerImpl tests using mocked zookeeper client.

Author: 67 <67@gd67.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1818 from iamgd67/ZOOKEEPER-4473",2022-03-04 13:56:43,67,Mixed
5b12b0e4eb010dca9b46047f559c6847d7e0b5f7,"ZOOKEEPER-4467: Format OpCode.addWatch in Request.op2String

Changes:
* Format `OpCode.addWatch` as ""addWatch"" in `Request.op2String`.

Author: Kezhu Wang <kezhuw@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, maoling <maoling@apache.org>

Closes #1819 from kezhuw/ZOOKEEPER-4467-op_code_addWatch_string and squashes the following commits:

97f891da1 [Kezhu Wang] fixup! ZOOKEEPER-4467: Format OpCode.addWatch in Request.op2String
ebe6faa30 [Kezhu Wang] ZOOKEEPER-4467: Format OpCode.addWatch in Request.op2String",2022-04-05 12:14:20,Kezhu Wang,Not TDD
54cb5c39a445c63967ec7c3a46724fe87908440b,"ZOOKEEPER-4504: ZKUtil#deleteRecursive causing deadlock in HDFS HA functionality

Make ZKUtil#deleteRecursive API fully compatible with older versions

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1843 from arshadmohammad/ZOOKEEPER-4504-DeleteRecursive and squashes the following commits:

851bb1ee9 [Mohammad Arshad] Added javadoc for ZKUtil#deleteRecursive(zk, pathRoot, batchSize) API
e7b33116c [Mohammad Arshad] Added test case to verify ZKUtil.deleteRecursive() in sync and async mode
008b2bd4a [Mohammad Arshad] ZOOKEEPER-4504: ZKUtil#deleteRecursive causing deadlock in HDFS HA functionality",2022-04-06 13:27:16,Mohammad Arshad,Mixed
86690ff40cb5c9f5782f0971db16e8fd1c3528e6,"ZOOKEEPER-1875: NullPointerException in ClientCnxn$EventThread.processEvent

Author: Mohammad Arshad <arshad@apache.org>

Reviewers: Mate Szalay-Beko <symat@apache.org>, Enrico Olivelli <eolivelli@apache.org>

Closes #1855 from arshadmohammad/ZOOKEEPER-1875-npe and squashes the following commits:

4a7d471e3 [Mohammad Arshad] Corrected impacted test cases
12f44d62e [Mohammad Arshad] ZOOKEEPER-1875: NullPointerException in ClientCnxn$EventThread.processEvent",2022-04-16 15:37:42,Mohammad Arshad,Mixed
724864487457d6f2eb7c331ef338936e1375072b,"ZOOKEEPER-3806: TLS - dynamic loading for client trust/key store

ZooKeer currently has support for reloading the Quorum Truststore & Keystore automatically when the certificate files change in the filesystem without server restart (https://github.com/apache/zookeeper/pull/680)

However, Reloading of key and trust store for **ClientX509Util** is not present; i.e., the server presented certs to the clients will not get reloaded automatically if the certificates in the filesystem change, short-lived certs requires the process restart.

Changes:

-  A new config property ""zookeeper.client.certReload"" is added, if it's true - ClientX509Util is reloaded automatically.

-  ZK uses an _X509AuthenticationProvider_ which is backed by an X509TrustManager and an X509KeyManager to perform _remote host certificate authentication_. We need to update the X509AuthenticationProvider's TrustStore as part of the X509Util file-watcher.
- Junit test case to verify the cert reload.

Author: Manu Mathew <manu.mathew@netapp.com>
Author: mathewmanu <manmathew@cs.stonybrook.edu>
Author: Manu Mathew <101424654+mathew-manu@users.noreply.github.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1839 from mathew-manu/ZOOKEEPER-3806",2022-05-06 17:52:40,Manu Mathew,Not TDD
794790c9f6cbacf158493867f3058a6de748b54e,"ZOOKEEPER-4308: Fix flaky test EagerACLFilterTest

There are several problems in this test:
* It uses `ParameterizedTest` which run tests in single jvm. But
  `ZooKeeperServer.enableEagerACLCheck` is `static` and loaded from env
  variable.
* It uses `assertNotSame` which assert on object reference equiality.
* It asserts on `zkLeader.getLastLoggedZxid()` while client connect to
  `connectedServer`. There is no happen-before between
  `zkLeader.getLastLoggedZxid()` and successful response from other
  server. The commit and response are routed to different servers and
  performed asynchronous in each server.

Author: Kezhu Wang <kezhuw@gmail.com>

Reviewers: maoling <maoling199210191@sina.com>, Mate Szalay-Beko <symat@apache.org>

Closes #1851 from kezhuw/ZOOKEEPER-4308-EagerACLFilterTest",2022-06-24 15:30:51,Kezhu Wang,Not TDD
de7c5869d372e46af43979134d0e30b49d2319b1,"ZOOKEEPER-4492: Merge readOnly field into ConnectRequest and Response

According to [this comment in ZOOKEEPER-102](https://issues.apache.org/jira/browse/ZOOKEEPER-102?focusedCommentId=16977000&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-16977000) I introduce a `Protocol` abstraction and going to moving all wire protocol concept into `cnxn` and this scope, so that client and server's business logics handle only deserialized/real record.

cc eolivelli maoling Randgalt

This supersedes #1832.

Author: tison <wander4096@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1837 from tisonkun/protocol",2022-06-27 08:19:39,tison,Mixed
a7e4dea7abccff018d123d54dd5d3ccc1544484e,"ZOOKEEPER-4573: Encapsulate request bytebuffer in Request

This patch is based on #1903.

This closes #1903.

Author: tison <wander4096@gmail.com>

Reviewers: Andor Molnar <andor@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1904 from tisonkun/encapsulate-request-bytebuffer",2022-07-12 13:03:07,tison,Mixed
2cd0c23454071faf0a16c58edb2414591ae5c5c3,"ZOOKEEPER-4565: Refine chroot strip to accommodate /zookeeper/ subtree

```java
if (serverPath.length() > chrootPath.length()) {
    event.setPath(serverPath.substring(chrootPath.length()));
}
```

Currently, chroot strip code listed above could result in illegal path
(aka. path not start with ""/""). This will disconnect zookeeper client
due to `StringIndexOutOfBoundsException` from `PathParentIterator.next`
in event handling.

Author: Kezhu Wang <kezhuw@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1899 from kezhuw/ZOOKEEPER-4565-refine-chroot-strip",2022-07-26 09:39:20,Kezhu Wang,Not TDD
bc1b231c9e32667b2978c86a6a64833470973dbd,"ZOOKEEPER-4327: Fix flaky RequestThrottlerTest

This PR tries to fix several test failures in `RequestThrottlerTest`.

First, `RequestThrottlerTest#testDropStaleRequests`.

Place `Thread.sleep(200)` after `submittedRequests.take()` in `RequestThrottler#run` will fail two assertions:
1. `assertEquals(2L, (long) metrics.get(""prep_processor_request_queued""))`
2. `assertEquals(1L, (long) metrics.get(""request_throttle_wait_count""))`

This happens due to `setStale` chould happen before throttle handling.

This commit solves this by introducing an interception point `RequestThrottler.throttleSleep` to build happen-before relations:
1. `throttling.countDown` happens before `setStale`, this ensures that unthrottled request are processed as usual.
2. `setStale` happens before `throttled.await`, this defends `RequestThrottler.throttleSleep` against spurious wakeup.

Second, `RequestThrottlerTest#testRequestThrottler`.

* `RequestThrottlerTest.testRequestThrottler:197 expected: <2> but was: <1>`

  `ZooKeeperServer#submitRequest` and `PrepRequestProcessor#processRequest` run in different threads, thus there is no guarantee on metric `prep_processor_request_queued` after `submitted.await(5, TimeUnit.SECONDS)`. Place `Thread.sleep(200)` before `zks.submitRequestNow(request)` in `RequestThrottler#run` will incur this failure.
* `RequestThrottlerTest.testRequestThrottler:206 expected: <5> but was: <4>`

  `entered.await(STALL_TIME, TimeUnit.MILLISECONDS)` could return `false` due to almost same timeout as `RequestThrottler#throttleSleep`. Place `Thread.sleep(500)` around `throttleSleep` will increase failure possibility.

Third, `RequestThrottlerTest#testGlobalOutstandingRequestThrottlingWithRequestThrottlerDisabled`.

* `RequestThrottlerTest.testGlobalOutstandingRequestThrottlingWithRequestThrottlerDisabled:340 expected: <3> but was: <4>`

  `ZooKeeperServer#shouldThrottle` depends on consistent sum of `getInflight` and `getInProcess`. But it is no true. Place `Thread.sleep(200)` before `zks.submitRequestNow(request)` in `RequestThrottler#run` could reproduce this.

Sees also https://github.com/apache/zookeeper/pull/1739, https://github.com/apache/zookeeper/pull/1821.

Author: Kezhu Wang <kezhuw@gmail.com>

Reviewers: Mate Szalay-Beko <symat@apache.org>, maoling <maoling@apache.org>

Closes #1887 from kezhuw/ZOOKEEPER-4327-flaky-RequestThrottlerTest.testDropStaleRequests",2022-09-25 16:21:45,Kezhu Wang,Mixed
3daefac37e8a7b456542c91adea541a938df1214,"ZOOKEEPER-4575: ZooKeeperServer#processPacket take record instead of bytes

This is the first step mentioned in [ZOOKEEPER-102](https://issues.apache.org/jira/browse/ZOOKEEPER-102) and we should not play with ByteBuffer among the request handling code path.

Author: tison <wander4096@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1905 from tisonkun/request-supplier",2022-10-05 17:55:54,tison,Mixed
90f813ea38a85ff2715662bad75f9bb6387fe4a6,"ZOOKEEPER-4303: Allow configuring client port to 0

https://issues.apache.org/jira/browse/ZOOKEEPER-4303

Allows specifying an explicit port 0 for the client port or secure client port, which will default to operating system behavior of finding an unbound port. Modified ZKServerEmbedded to report the actual port instead of the configured port.

Author: Mike Drob <mdrob@apple.com>

Reviewers: Kezhu Wang <kezhuw@gmail.com>, Enrico Olivelli <eolivelli@apache.org>, Mate Szalay-Beko <symat@apache.org>

Closes #1868 from madrob/zookeeper-4303",2022-10-11 22:23:12,Mike Drob,Not TDD
d3879db1ed019892373683694663b05ade0db6fe,ZOOKEEPER-4460: QuorumPeer overrides Thread.getId with different semantics.,2022-11-02 05:26:12,Chris Nauroth,Mixed
b069edeb2436a051ad2b18e03fd67ae8ec23875c,"ZOOKEEPER-4570: Admin server API for taking snapshot and stream out data (#1943)

Provides a snapshot command for taking snapshot and streaming out data

Author: Li Wang <liwang@apple.com>

Co-authored-by: Li Wang <liwang@apple.com>
Co-authored-by: Enrico Olivelli <eolivelli@apache.org>",2023-01-04 16:40:32,li4wang,Mixed
daea9e300f2332134600b1088265bae7b02d5383,"Revert ""ZOOKEEPER-1875: NullPointerException in ClientCnxn$EventThread.processEvent""

This reverts commit 86690ff40cb5c9f5782f0971db16e8fd1c3528e6.",2023-01-24 09:16:10,Enrico Olivelli,Mixed
d35bdfb9d3a4bc3d94f22785604418d4f650365d,"ZOOKEEPER-4571: Admin server API for restore database from a snapshot (#1961)

Provides a restore command for restoring database from a snapshot

Author: Li Wang <liwang@apple.com>

Co-authored-by: liwang <liwang@apple.com>",2023-01-26 18:12:14,li4wang,Mixed
629518b5ea2b26d88a9ec53d5a422afe9b12e452,"[ZOOKEEPER-4672] Code cleanup - apply JDK7 Diamond operator consistently (#1979)

Co-authored-by: Moderne <team@moderne.io>",2023-02-10 23:54:14,Tim te Beek,Mixed
2e9c3f3ceda90aeb9380acc87b253bf7661b7794,"[ZOOKEEPER-4647] Tests don't pass on JDK20 because we try to mock InetAddress (#1959)

- upgrade Mockito to 4.9.0
- use BurningWave DNS mock tools",2023-02-15 08:36:39,Enrico Olivelli,Mixed
255b0c9137a75635cf6e2c112672a045c58ce1cf,"ZOOKEEPER-4475: Fix NodeChildrenChanged delivered to recursive watcher (#1820)

The semantics of persistent recursive watch promise no child events on
descendant nodes. When there are standard child watches on descendants
of node being watches in persistent recursive mode, server will deliver
child events to client inevitably. So we have to filter out child events
for persistent recursive watches on client side.",2023-02-22 10:23:00,Kezhu Wang,Not TDD
d79811bf28f00fb1db6ec6002e884af6cfd0d7fc,"ZOOKEEPER-4639: Provide auth support for admin server APIs (#1966)

Author: Li Wang <liwang@apple.com>",2023-02-24 16:20:58,li4wang,Mixed
de8768807fc7a3fcabc9762b033cf59e695cf14b,"ZOOKEEPER-4296: Add null checks to ClientCnxnSocketNetty onClosing (#1697)

Co-authored-by: Colvin Cowie <COLVINCO@uk.ibm.com>",2023-02-27 15:41:01,Colvin Cowie,Mixed
16227468d64dd7e1744517a2e587099d5501c0c1,"[ZOOKEEPER-4676] ReadOnlyModeTest doesn't not compile on JDK20 (Thread.suspend has been removed) (#1985)


* checkstyle",2023-03-08 14:07:17,Enrico Olivelli,Not TDD
f46b8fb87ff3b06bab58bb6fcb73439a86bf9ab3,ZOOKEEPER-3731: Disallow HTTP TRACE method on PrometheusMetrics Server (#1682),2023-03-08 14:08:29,doxsch,Mixed
3eda8a3a00ef3230d6c16f6ddf9201a3c0f5ca07,"ZOOKEEPER-4682. Make FileSnap.deserialize a static method (#1992)

FileSnap.deserialize is effectively a static method. Change it to a
static method so that we don't need to do some new FileSnap(null)
hacks for workaround calling this method.

Signed-off-by: tison <wander4096@gmail.com>",2023-03-26 14:20:58,tison,Not TDD
a64dbf5b06ca1a73dc2ad6c7d31e679e312082aa,"ZOOKEEPER-4466: Support different watch modes on same path (#1859)

Signed-off-by: Kezhu Wang <kezhuw@gmail.com>
Co-authored-by: tison <wander4096@gmail.com>",2023-05-05 15:58:42,Kezhu Wang,Not TDD
b8d458f5c46cb3064d4a56f471d441011a558991,"ZOOKEEPER-4471: Match removing WatcherType to standard, persistent modes (#1998)

* ZOOKEEPER-4471: Match removing WatcherType to standard, persistent modes

Before ZOOKEEPER-1416, `WatcherType.Children` was used to remove
watchers attached through `ZooKeeper.getChildren`. `WatcherType.Data`
was used to remove watchers attached through `ZooKeeper.getData` and
`ZooKeeper.exists`.

ZOOKEEPER-1416 adds `AddWatchMode.PERSISTENT`. This watcher could be
completed remove using `WatcherType.Any`. But when removing through
`WatcherType.Data` or `WatcherType.Children`, part of
`AddWatchMode.PERSISTENT` will be left behind. And we get persistent
children or data watchers.

We are never claiming to support these type of watchers. So fix it.

In rare chance, we are going to support persistent data or children
watchers in future, I think we probably don't want to do such ""magic""
thing in ZooKeeper. So fix it.

This is a step towards ZOOKEEPER-4472 which proposed to support
`WatcherType.Persistent` and `WatcherType.PersistentRecursive` to remove
persistent watchers.

* Refactor newly added tests in WatchManagerTest

I found it somewhat hard to follow in self-review. Add given-when-then
comments from my best hope for reviewing and maintenance.",2023-06-13 21:13:33,Kezhu Wang,Mixed
3702a45459b4946d3c45d29c6f201077b66bf2ea,"ZOOKEEPER-3860: Avoid reverse DNS lookup for hostname verification when hostnames are provided in the connection url

Instead of altering the behaviour of `ZKTrustManager`, I'll add the following improvements:

1. `NetUtils.formatInetAddr()` should prefer using the hostname of resolved addresses when converting InetSocketAddress to String. Previously it only picked the hostname if address was missing, e.g. the hostname was unresolved. This change has the advantage of sending the hostname in the InitialMessage instead of the IP address, which will help avoiding unnecessary reverse DNS lookups in the election protocol when TLS is enabled.

2. Add extra debug logs to `ZKTrustManager` and remove logging the exception stack trace when IP verification failed. Logging of stack traces makes sense to me in error log entries only. Many times we hit into this when user turns on debug logging, seeing a big stack trace and believes it's an error in ZooKeeper.

Target branches: master, branch-3.8

Author: Andor Molnar <andor@cloudera.com>

Reviewers: eolivelli@apache.org

Closes #2005 from anmolnar/ZOOKEEPER-3860",2023-06-14 14:58:35,Andor Molnar,Mixed
e8b2fbeb101e22378aa47df291cc9ca6e58e1e8d,"ZOOKEEPER-4472: Remove persistent watches individually  (#2006)

* ZOOKEEPER-4472: Remove persistent watches individually

ZOOKEEPER-4466 supports different watch modes one same path, but there
are no corresponding `WatcherType`s for persistent watches. Client has
to resort to `WatcherType.Any` to remove them. This could accidently
interrupt other watches.

This PR adds `WatcherType.Persistent` and `WatcherType.PersistentRecursive`
to remove persistent watches individually.

* Assert removing WatcherType::Data from AddWatchMode::Persistent is impossible

* fixup! Assert removing WatcherType::Data from AddWatchMode::Persistent is impossible",2023-06-15 13:14:22,Kezhu Wang,Mixed
b3487c525542c44de1c65f2207cb5563afbf644d,ZOOKEEPER-4393 Problem to connect to zookeeper in FIPS mode (#2008),2023-06-15 13:58:01,Andor Molnár,Mixed
880f6064183c216d56d8c3e46a655c2b143f6d5e,"ZOOKEEPER-4655: Communicate the Zxid that triggered a WatchEvent to fire (#1950)

* Fix a race condition in WatcherCleanerTest.testDeadWatcherMetrics

Because the metrics were updated _after_ the listener is invoked, the listener does not always see
the fresh metric value. This fixes it so that the test waits for the value to become what we expect.

* Leverage an existing method and refactor the rest of the code to match

Since there was an existing waitFor method in ZKTestCase, along with an existing implementation of a
waitForMetric LearnerMetricsTest, this commit moves waitForMetric to ZKTestCase and refactors the
metric-related usages of waitFor.

* Communicate the Zxid that triggered a WatchEvent to fire

With the recent addition of persistent watches, many doors have opened up to significantly more
performant and intuitive local caches of remote state, but the actual implementation can be
difficult because to cache data locally, one needs to execute the following steps:

1. Set the watch
2. Bootstrap the watched subtree
3. Catch up on the events that fired during the bootstrap

The issue is it's now very difficult to deduplicate and sanely resolve the remote state during step
3 because it's unknown whether an event arrived during the bootstrap or after. For example,
imagine that between steps 1 and 2, a node /a was deleted then re-created. By the time step 3 is
executed, there will be a NodeDeleted event queued up followed by a NodeCreated, causing at best a
double read (one from the bootstrap, one from the NodeCreated) or at worst some data inconsistencies
in the local cache.

This change sets the Zxid in the response header whenever the watch event type is NodeCreated,
NodeDeleted, NodeDataChanged or NodeChildrenChanged.",2023-06-16 12:05:58,Paul Chesnais,Mixed
618b676bf16c2a68fa3c215fdba3fe6049359493,"ZOOKEEPER-3996: Fix flaky ReadOnlyModeTest.testConnectionEvents (#1896)

The same watcher was resued across different clients. It is hard to
know which event will last during verification, disconnected from old
client or connected from new client.

A brand new watcher solves this.",2023-06-19 11:07:28,Kezhu Wang,Not TDD
58eed9f5280be1c6a9ccacc47dd6afa65e916ae8,"ZOOKEEPER-4026: Support `OpCode.create2` in `OpCode.multi`

Currently, nesting `OpCode.create2` in `OpCode.multi` will not get `stat`(ZOOKEEPER-1297). The cause is multifold:
* `MultiOperationRecord.deserialize` decays `OpCode.create2` to  `OpCode.create`.
* `DataTree.processTxn` ignores `OpCode.create2`.

This commit complements ZOOKEEPER-1297 to add `stat` for `OpCode.create2` in `OpCode.multi`.

It also adds `CreateOptions` to cover create mode, acl and ttl to avoid massive overloading methods.

Author: Kezhu Wang <kezhuw@gmail.com>

Reviewers: Enrico Olivelli <eolivelli@apache.org>, Damien Diederen <ddiederen@apache.org>

Closes #1978 from kezhuw/ZOOKEEPER-4667-nest-create2-in-multi",2023-06-21 12:30:51,Kezhu Wang,Mixed
4a794276d3d371071c31f86c14da824fdd2e53c0,ZOOKEEPER-4622 Add Netty-TcNative OpenSSL Support (#2009),2023-07-04 16:49:51,Andor Molnár,Not TDD
f8459b816eb2c7c153ae9461b761434b993b2135,ZOOKEEPER-4717: Cache serialize data in the request to avoid repeat serialize. (#2030),2023-07-13 08:18:13,Yan Zhao,Mixed
e2e8ec661f8d50e5341bdefa0ccd8c5116f5ce4b,ZOOKEEPER-4714: Improve syncRequestProcessor performance (#2024),2023-07-17 18:16:16,Yan Zhao,Mixed
4882f7b63490971e44a669e98428615ef7bf472f,ZOOKEEPER-4719. Upgrade Bouncycastle from jdk15on to jdk18on (#2033),2023-07-17 18:21:45,ZhangJian He,Not TDD
6e746f8e881bfeb99cf0f74fa50a3d9c9d679229,"ZOOKEEPER-4607. Fix decode problem when sub tnx type is error (#1915)

Co-authored-by: tison <wander4096@gmail.com>",2023-07-18 20:04:24,Yan Zhao,Mixed
40aed41793e9bc4493d89e7c831d9da3258212fc,"ZOOKEEPER-4728: force to re-resolve hostname into IP when binding. (#2040)

* ZOOKEEPER-4728: force to re-resolve hostname into IP when binding

* ZOOKEEPER-4708: add test",2023-08-29 12:45:37,Luke Chen,Not TDD
e0890d0a79372be9c74b6d3f9314d693a89d255c,"ZOOKEEPER-4697: Add Builder to construct ZooKeeper and ZooKeeperAdmin (#2001)

* ZOOKEEPER-4697: Add Builder to construct ZooKeeper and its derivations

Currently, there are 10 constructor variants for `ZooKeeper` and 4 for
`ZooKeeperAdmin`. It is enough for us to resort to a builder.

The `build` method throws `IOException` to make it a drop-in replacement
of existing constructors of `ZooKeeper`.

This pr also unify body of `ZooKeeper` constructor to one. Previously,
there are diverged to two. One has `sessionId` and `sessionPasswd`, and
another doesn't have. This pr uses `sessionId == 0` to differentiate the
two as it is used in server side to differentiate session create and
reconnect.

* Restrict Builder to only ZooKeeper and ZooKeeperAdmin",2023-09-02 17:49:21,Kezhu Wang,Mixed
b31f776471fef79ab161f416d58367bdffaf37a9,ZOOKEEPER-2623: Fix database corruption caused by quorum check (#1988),2023-09-10 22:36:37,Kezhu Wang,Not TDD
f42c01de73867ffbc12707b3e9f9cd7f847fe462,"ZOOKEEPER-838: Move chroot from ClientCnxn to ZooKeeper (#2065)

This enables possibility for future that multiple `ZooKeeper` instances root at different paths and share same session.

This also fix bugs due to eager chroot stripping in `ClientCnxn`:

* Previously, in chroot ""/zoo"", client could lose connection due to delivering events for abnormal path ""keeper/config"". This path is constructed by eager chroot striping for path ""/zookeeper/config"" from events for `getConfig`. See ZOOKEEPER-4742.
* Previously, in chroot ""/zookeeper"" or ""/zookeeper/config"", watching through `getConfig` receive no event as `getConfig` register watcher in path ""/zookeeper/config"". But the path get stripped to ""/config"" or ""/"" before event delivery. See ZOOKEEPER-4601.

Co-authored-by: tison <wander4096@gmail.com>",2023-09-24 11:04:45,Kezhu Wang,Mixed
5823a3f78b3ae032385a8b6f7b7594b44cf3a25a,"ZOOKEEPER-4743: Increase data version once more when going back to -1 from Integer.MIN_VALUE (#2064)

Co-authored-by: zhaohaiyuan <zhaohaiyuan@meituan.com>
Co-authored-by: tison <wander4096@gmail.com>",2023-09-30 12:22:21,zhaohaidao,Mixed
6cae2cded2a6feeeea886a0f31f4f98450353340,"ZOOKEEPER-4415: Added TLSv1.3 support to server (#1919)

* ZOOKEEPER-4415: Added TLSv1.3 support to server

Enable TLSv1.3 when server is running on JDK that supports it.

 - Select TLSv1.3 as default protocol.
 - Include both TLSv1.2 and TLSv1.3 as default enabled protocols.
 - Include TLSv1.3 ciphers in default ciphers.

Signed-off-by: Tero Saarni <tero.saarni@est.tech>

* Fixed checkstyle errors

Signed-off-by: Tero Saarni <tero.saarni@est.tech>

---------

Signed-off-by: Tero Saarni <tero.saarni@est.tech>",2023-10-02 12:49:19,Tero Saarni,Mixed
e2070bed85d8b0c98a5a0045bf92421f473c412e,"ZOOKEEPER-4753: zookeeper-server: Improvement: Explicit handling of DIGEST-MD5 vs GSSAPI in quorum auth

Before this, the SASL-based quorum authorizer did not explicitly
distinguish between the DIGEST-MD5 and GSSAPI mechanisms: it was
simply relying on NameCallback and PasswordCallback for authentication
with the former and examining Kerberos principals in AuthorizeCallback
for the latter.

It turns out that some SASL/DIGEST-MD5 configurations cause
authentication and authorization IDs not to match the expected format,
and the DIGEST-MD5-based portions of the quorum test suite to fail
with obscure errors.  (They can be traced to failures to join the
quorum, but only by looking into detailed logs.)

This patch uses the login module name to determine whether DIGEST-MD5
or GSSAPI is used, and relaxes the authentication ID check for the
former.  As a cleanup, it keeps the password-based credential map
empty when Kerberos principals are expected.  It finally adapts a
test, and adds a new one, ensuring ""weirdly-shaped"" credentials only
cause authentication failures in the GSSAPI case.",2023-10-03 14:55:47,Damien Diederen,Not TDD
dc99bd75fe495c9ef2718fb1a10e175a23fb38d4,ZOOKEEPER-2623: [ADDENDUM] Fix flaky CheckTest::testCluster (#2067),2023-10-17 13:06:10,Kezhu Wang,Not TDD
ceebda9493bd2e406973e1f4a7f77f9e0121ba16,"ZOOKEEPER-2590: exists() should check read ACL permission

ZOOKEEPER-2590:exists() should check read ACL permission
ZOOKEEPER-2590. Skip ACL check if znode is missing
Reviewers: eolivelli
Author: anmolnar
Closes #2093 from anmolnar/ZOOKEEPER-2590",2023-12-04 13:30:16,Andor Molnár,Not TDD
315abde35eb827652f91aed06a4de3dacf9a0f07,"ZOOKEEPER-4785: Txn loss due to race condition in Learner.syncWithLeader() during DIFF sync (#2111)

Author: Li Wang <liwang@apple.com>

Co-authored-by: liwang <liwang@apple.com>",2024-01-25 22:22:32,li4wang,Not TDD
16abb9cfad03f6b420747a002f0e7de420d474d4,ZOOKEEPER-4236 Java Client SendThread create many unnecessary Login objects (#2128),2024-02-06 11:56:09,Andor Molnár,Not TDD
07f5cc6ea59e1a54f3ffac17bde5eb8af5f6491d,"ZOOKEEPER-4792: Use jvm as the prefix for the memory env log.

Reviewers: maoling
Author: horizonzy
Closes #2112 from horizonzy/tune-the-jvm-env-log",2024-02-07 15:35:30,Yan Zhao,Not TDD
e2ea0381f4b41ff05d86d6fbd0ed58a5d9dc9915,"ZOOKEEPER-4779: Fix ZKUtilTest which fails to run on WSL

Reviewers: maoling
Author: muthu90tech
Closes #2099 from muthu90tech/ZOOKEEPER-4779",2024-02-07 17:30:23,Muthuraj Ramalingakumar,Not TDD
72e3d9ce9cf1bdabf306eb53223e0953ee40748a,"ZOOKEEPER-4730: Incorrect datadir and logdir size reported from admin and and 4lw dirs command

Reviewers: kezhuw, eolivelli, maoling
Author: li4wang
Closes #2043 from li4wang/ZOOKEEPER-4730",2024-02-08 15:31:43,li4wang,Mixed
18c78cd10bc02d764a46ac1659b263cf69f2671d,"ZOOKEEPER-4794: Reduce the ZKDatabase#committedLog memory usage.

Reduce the committed log memory usage.
Fix ci.
Reviewers: eolivelli, hangc0276, anmolnar
Author: horizonzy
Closes #2115 from horizonzy/reduce-committed-log-memory-usage",2024-02-09 17:32:53,Yan Zhao,Mixed
31c7a7e4c2b3b71549a06f442f8a4c5e9f03a6df,"ZOOKEEPER-4723. Cleanup more in-place bytebuffer manipulations (#2036)

Signed-off-by: tison <wander4096@gmail.com>",2024-03-05 16:37:54,tison,Not TDD
bc1fc6d36435d3fad7b31642b647dc7680d7866e,"ZOOKEEPER-4276. Serving only with secureClientPort fails (#2117)

* Support TLS-only ZK server

* Cleanup

* Update documentation according to review comments",2024-03-09 11:46:21,Abhilash Kishore,Mixed
803c485db99134d8f41c2ea90ca9305e6b806d52,"ZOOKEEPER-4804. Use daemon threads for Netty client (#2142)

Co-authored-by: tison <wander4096@gmail.com>",2024-03-09 13:31:41,Istvan Toth,Mixed
d12aba599233b0fcba0b9b945ed3d2f45d4016f0,"ZOOKEEPER-4799: Refactor ACL check in 'addWatch' command

As of today, it is impossible to diagnose which watch events are dropped
because of ACLs.  Let's centralize, systematize, and log the checks at
the 'process()' site in the Netty and NIO connections.

(These 'process()' methods contain some duplicated code, and should also
be refactored at some point.  This series does not change them.)

This patch also adds a substantial number of tests in order to avoid
unexpected regressions.

Co-authored-by: Patrick Hunt <phunt@apache.org>
Co-authored-by: Damien Diederen <ddiederen@apache.org>",2024-03-16 18:29:17,Andor Molnar,Mixed
9b81d1012c283635f97c705e1bdce40b098313e5,ZOOKEEPER-4409 NullPointerException in SendAckRequestProcessor (#2163),2024-05-02 16:10:21,Yonghao Zou,Mixed
66202cb764c203f64b954a917e421be57d2ae67a,"[ZOOKEEPER-4831] update slf4j from 1.x to 2.0.13, logback to 1.3.14 (#2162)",2024-05-11 09:46:37,ZhangJian He,Not TDD
9a2dc253caf5e94ec64bd65a72a35c6bc5e2042c,"ZOOKEEPER-4834. fix typos in Apache ZooKeeper (#2167)

Signed-off-by: ZhangJian He <shoothzj@gmail.com>",2024-07-16 16:06:34,ZhangJian He,Mixed
c44cb3798245bd3de0157be7997d7125fde19193,"ZOOKEEPER-4798: Secure prometheus support (#2127)

Co-authored-by: purshotam shah <purushah@yahooinc.com>
Co-authored-by: tison <wander4096@gmail.com>",2024-08-02 11:47:46,puru,Not TDD
66f9cc3941f09ca00464760c78e30b97bd7c1faa,"ZOOKEEPER-2623: [ADDENDUM] Forbid OpCode.check outside OpCode.multi

ZOOKEEPER-2623: [ADDENDUM] Forbid OpCode.check outside OpCode.multi
Individual `OpCode.check` will get `UnimplementedException`.
Reviewers: anmolnar, shoothzj, tisonkun
Author: kezhuw
Closes #2104 from kezhuw/ZOOKEEPER-2623-addendum-forbid-opcode-check-outside-multi",2024-08-05 21:49:33,Kezhu Wang,Not TDD
90f8d835e065ea12dddd8ed9ca20872a4412c78a,"ZOOKEEPER-4814: Re-introduce support for clients incompatible with the 3.5+ `readOnly` extension

Reviewers: tisonkun, kezhuw
Author: ztzg
Closes #2146 from ztzg/ZOOKEEPER-4814-clients-without-read-only",2024-08-11 23:55:00,Damien Diederen,Mixed
0cf36616dffe3164bf46b3b8c627f6cc5e37e8c8,"ZOOKEEPER-4829: Support DatadirCleanup in minutes

Reviewers: anmolnar
Author: purushah
Closes #2178 from purushah/ZOOKEEPER-4829",2024-08-27 17:32:16,puru,Mixed
2c2b74c1c11b6531aabb1bf06782e859048d5983,"ZOOKEEPER-4851: Honor X-Forwarded-For optionally in IPAuthenticationProvider

Reviewers: kezhuw, purushah
Author: anmolnar
Closes #2181 from anmolnar/ZOOKEEPER-4851",2024-09-03 15:04:07,Andor Molnár,Mixed
fa3c504fada6a5cbbb929d0558f09c0eac6e1c8e,"ZOOKEEPER-4834: add typos check in ci workflow (#2184)

Signed-off-by: ZhangJian He <shoothzj@gmail.com>",2024-09-10 12:34:38,ZhangJian He,Not TDD
3e2d6f3436962cd4a0445bc6c22f583e425d7ced,"ZOOKEEPER-4747: Add synchronous sync to ease synchronous call chains (#2068)

Previously, there is no synchronous `sync` so client has to convert
asynchronous `sync` a bit to fit synchronous call chains. This is
apparently unfriendly.

Besides above, in absent of ZOOKEEPER-22, we can't issue a fire and
forget asynchronous `sync` to gain strong consistent. So it becomes
crucial for client to have a convenient synchronous `sync`.

Refs: ZOOKEEPER-1167, ZOOKEEPER-4747",2024-09-10 14:30:13,Kezhu Wang,Not TDD
3c4e15ef8d1f9969bd69c545f2e88eefeec5cb93,ZOOKEEPER-4733: non-return function error and asan error in CPPUNIT TESTs (#2045),2024-09-10 18:55:24,whyer6,Not TDD
34c6d9fc1dd7e38d99173d13d22f960f7cf70b7e,"ZOOKEEPER-4708: recreateSocketAddresses before comparing addresses

Reviewers: ppatierno, anmolnar, see-quick
Author: showuon
Closes #2041 from showuon/ZOOKEEPER-4708_2",2024-09-12 10:11:10,Luke Chen,Mixed
978d431f6e241dd7f58c5b105afcf4443f5bcbcb,"ZOOKEEPER-4860: Disable X-Forwarded-For by default

Reviewers: eolivelli, purushah
Author: anmolnar
Closes #2187 from anmolnar/ZOOKEEPER-4860",2024-09-17 10:34:39,Andor Molnár,Mixed
52f7af54c9f25992f71fc51acd165c01ab6781c5,"ZOOKEEPER-2332: Fix server failed to start for empty txn log

Reviewers: kezhuw, anmolnar, kezhuw
Author: fanyang89
Closes #2141 from fanyang89/ZOOKEEPER-2332",2024-09-18 15:34:23,fanyang,Mixed
9fcb805fa1bb37b1f64ceb3bc5d7ccf349971bb7,"ZOOKEEPER-4394: Apply only committed requests in sync with leader before NEWLEADER ACK

Reviewers: kezhuw, anmolnar, kezhuw
Author: AlphaCanisMajoris
Closes #2152 from AlphaCanisMajoris/ZK-4643",2024-09-19 10:28:02,AlphaCanisMajoris,Not TDD
dcaf74c369222a82000ea07a1e5953ca91782084,"ZOOKEEPER-4843: Encountering an 'Unreasonable Length' error when configuring jute.maxbuffer to 1GB or more

Reviewers: anmolnar, kezhuw
Author: arshadmohammad
Closes #2175 from arshadmohammad/totalBuffer",2024-09-20 13:15:11,Mohammad Arshad,Mixed
bc9afbf8ef1bc6156643d3d05c87fcf8411e9d8f,"ZOOKEEPER-4712: Fix partially shutdown of ZooKeeperServer and its processors

Reviewers: anmolnar, kezhuw, kezhuw, kezhuw
Author: jonmv
Closes #2154 from jonmv/jonmv/ZOOKEEPER-4541-take-2",2024-09-20 14:10:08,Jon Marius Venstad,Not TDD
890061841f7ca1848f28fc77c071ae4233b6303e,"ZOOKEEPER-4508: Expire session in client side to avoid endless connection loss

Reviewers: anmolnar
Author: kezhuw
Closes #2058 from kezhuw/ZOOKEEPER-4508-client-side-session-expiration",2024-09-23 17:26:20,Kezhu Wang,Not TDD
5a3c6a98f8714e46d3637b93e63d69632e411ba5,"ZOOKEEPER-4839: Fix SASL DIGEST-MD5 authenticated with last successfully logined username

Reviewers: kezhuw, kezhuw, kezhuw, anmolnar
Author: luoxiner
Closes #2176 from luoxiner/master",2024-09-24 19:46:23,Xin Luo,Not TDD
b99714543db86ca081a5d648c565f0d9cb4c82c2,"ZOOKEEPER-4864: Fix bad format when dump MultiTxn in TxnLogToolkit (#2192)

Decode Txn to record and format the output with the record for better format.",2024-10-15 15:03:54,Xin Luo,Mixed
fe64596e8d58839b98366861a628a3e1d16a7014,ZOOKEEPER-4889: Fallback to DIGEST-MD5 auth mech should be disabled in Fips mode (#2213),2024-11-25 07:28:26,Andor Molnár,Not TDD
3e02328048a9c753624d44aba51ac70cab60619a,"ZOOKEEPER-4872: SnapshotCommand should not perform fastForwardFromEdits

Reviewers: kezhuw
Author: li4wang
Closes #2210 from li4wang/ZOOKEEPER-4872",2024-11-27 09:13:02,li4wang,Not TDD
75f9781ecc3cde9fa5a032fa8cfa8c79b69ef879,"ZOOKEEPER-4819: Fix can't seek for writable tls server if connected to readonly server

Reviewers: kezhuw
Author: luoxiner
Closes #2200 from luoxiner/ZOOKEEPER-4819",2024-11-27 09:21:45,Xin Luo,Not TDD
d1d57c4af37cebb9a2dd10d372e30c90f85bf000,"ZOOKEEPER-4880: Generate comments from zookeeper.jute into code

Reviewers: kezhuw, tisonkun
Author: luozongle01
Closes #2206 from luozongle01/ZOOKEEPER-4880",2024-12-07 13:54:43,luozongle01,Mixed
